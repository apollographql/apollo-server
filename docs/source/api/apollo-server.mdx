---
title: "API Reference: ApolloServer"
api_reference: true
---

This API reference documents the `ApolloServer` class.

## `constructor`

Returns an initialized `ApolloServer` instance.

Takes an `options` object as a parameter. Supported fields of this object are described below.

### Example

<MultiCodeBlock>

```ts
import { ApolloServer } from '@apollo/server';

const server = new ApolloServer({
	typeDefs,
	resolvers,
});
```

</MultiCodeBlock>

### Options

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr>
<td colspan="2">

**Schema options**
</td>
</tr>
<tr class="required">
<td>

##### `typeDefs`

`String`, `DocumentNode`, or `Array<DocumentNode>`
</td>
<td>

A valid [Schema Definition Language](../schema/schema/#the-schema-definition-language) (SDL) string, document, or documents that represent your server's GraphQL schema. To generate documents, you can apply the `gql` tag (from [`graphql-tag`](https://www.npmjs.com/package/graphql-tag)) to valid SDL strings.

**Required** unless you provide [`schema`](#schema).

For an example, see [Define your GraphQL schema](../getting-started/#step-3-define-your-graphql-schema).
</td>
</tr>


<tr class="required">
<td>

##### `resolvers`

`Object` or `Array`
</td>
<td>

A map of functions that populate data for individual schema fields. Can also be an array of multiple maps that are merged.

**Required** unless you provide [`schema`](#schema).

For details, see [Resolvers](../data/resolvers/).
</td>
</tr>

<tr>
<td>

##### `introspection`

`Boolean`
</td>

<td>

If `true`, enables [schema introspection](https://graphql.org/learn/introspection/) by clients. This is required to use tools that figure out your server's schema from talking to it directly, like Apollo Sandbox and GraphQL Playground. (It's not needed for the non-Sandbox version of Apollo Studio Explorer, which uses the schema published in the Studio schema registry instead.)

The default value is `true`, **unless** the `NODE_ENV` environment variable is set to `production`.
</td>
</tr>


<tr>
<td>

##### `fieldResolver`

`GraphQLFieldResolver`
</td>

<td>

A custom resolver that will replace Apollo Server's [default field resolvers](../data/resolvers/#default-resolvers).
</td>
</tr>


<tr>
<td>

##### `schema`

`Object`
</td>

<td>

An executable GraphQL schema. You usually don't need to provide this value, because Apollo Server generates it from [`typeDefs`](#typedefs) and [`resolvers`](#resolvers).

This field is most commonly used with [Apollo Federation](https://www.apollographql.com/docs/federation/implementing-services/#generating-a-federated-schema), which uses a special `buildFederatedSchema` function to generate its schema.
</td>
</tr>


<tr>
<td>

##### `persistedQueries`

`Object` or `false`
</td>

<td>

If you're using [automated persisted queries (APQ)](../performance/apq/), you can provide an object with `cache` and/or `ttl` fields to customize how Apollo Server stores the mapping between operation hashes and query strings, or provide `false` to disable APQ entirely.
</td>
</tr>


<tr>
<td>

##### `rootValue`

`Any` or `Function`
</td>
<td>

A value or function called with the parsed `Document`, creating the root value passed to the GraphQL executor.

Providing a function is useful if you want to use a different root value depending on the operation's details, such as whether it's a query or mutation.
</td>
</tr>


<tr>
<td>

##### `validationRules`

`Array<Function>`
</td>
<td>

An array containing custom functions to use as additional [validation rules](https://github.com/graphql/graphql-js/tree/master/src/validation/rules) when validating the schema.
</td>
</tr>


<tr>
<td>

##### `documentStore`

`KeyValueCache<DocumentNode>` or `null`
</td>
<td>

A key-value cache that Apollo Server uses to store previously encountered GraphQL operations (as `DocumentNode`s). It does _not_ store query _results_.

Whenever Apollo Server receives an incoming operation, it checks whether that exact operation is present in its `documentStore`. If it's present, Apollo Server can safely skip parsing and validating the operation, thereby improving performance.

The default `documentStore` is an [`InMemoryLRUCache`](https://github.com/apollographql/apollo-utils/blob/main/packages/keyValueCache/src/InMemoryLRUCache.ts) with an approximate size of 30MiB. This is usually sufficient unless the server processes a large number of unique operations. Provide this option if you want to change the cache size or store the cache information in an alternate location.

To use `InMemoryLRUCache` but change its size to an amount `approximateDocumentStoreMiB`:

<div style="max-width: 400px;">

```typescript
import { InMemoryLRUCache } from '@apollo/utils.keyvaluecache';
import type { DocumentNode } from 'graphql';
new ApolloServer({
  documentStore: new InMemoryLRUCache<DocumentNode>({
    maxSize: Math.pow(2, 20) * approximateDocumentStoreMiB,
    sizeCalculation: InMemoryLRUCache.sizeCalculation,
  }),
  // ...
})
```

</div>

Pass `null` to disable this cache entirely.
</td>
</tr>

<tr>
<td>

##### `cache`

`KeyValueCache`
</td>
<td>

A `KeyValueCache` which Apollo Server uses for several features, including APQs and full response caching. This cache is also available to Apollo Server's data sources and plugins.

The default bounded cache is an [`InMemoryLRUCache`](https://www.npmjs.com/package/@apollo/utils.keyvaluecache) with a default size of roughly 30MiB.

To learn more about configuring Apollo Server's cache, see [Configuring cache backends](../performance/cache-backends).

</td>
</tr>


<tr>
<td colspan="2">

**Networking options**
</td>
</tr>

<tr>
<td>

##### `csrfPrevention`

`Boolean` or `Object`
</td>
<td>

By default, the [CSRF prevention](../security/cors#preventing-cross-site-request-forgery-csrf) feature is enabled to protect Apollo Server from CSRF and XS-Search attacks. This feature requires that clients sending operations via `GET` or multipart upload requests _must_ include a non-empty `Apollo-Require-Preflight` (or another non-special-cased) header in that request. 

You can disable this recommended security feature by passing `false` to `csrfPrevention`.
</td>
</tr>

<tr>
<td>

##### `formatError`

`Function`
</td>
<td>

Provide this function to transform the structure of error objects before they're sent to a client. 

The `formatError` hook receives two arguments: the first is a [`GraphQLFormattedError`](https://github.com/graphql/graphql-js/blob/29bf39faa670effd3c1561a1512ec7767658a63b/src/error/GraphQLError.ts#L215) (to be spent with the response), and the second is the original error. This function should return a [`GraphQLFormattedError`](https://github.com/graphql/graphql-js/blob/29bf39faa670effd3c1561a1512ec7767658a63b/src/error/GraphQLError.ts#L215) object.

</td>
</tr>

<tr>
<td>

##### `apollo`

`Object`
</td>
<td>

An object containing configuration options for connecting Apollo Server to [Apollo Studio](https://www.apollographql.com/docs/studio/). Each field of this object can also be set with an environment variable, which is the recommended method of setting these parameters. All fields are optional. The fields are:

- `key`: The [graph API key](https://www.apollographql.com/docs/studio/api-keys/#graph-api-keys) that Apollo Server should use to authenticate with Apollo Studio. You can set this with the `APOLLO_KEY` environment variable.
- `graphRef`: A reference of your graph in Apollo's registry, such as `graph-id@my-variant` or just `graph-id`. You can set this with the `APOLLO_GRAPH_REF` environment variable.
- `graphId`: The ID of your graph in Apollo's registry. You can set this with the `APOLLO_GRAPH_ID` environment variable. You may not specify this if you specify the graph ref.
- `graphVariant`: The [variant](https://www.apollographql.com/docs/studio/schema/registry/#managing-environments-with-variants) of your graph to associate this server's schema and metrics with. You can set this with the `APOLLO_GRAPH_VARIANT` environment variable. The default value is `current`. You may not specify this if you specify the graph ref.

</td>
</tr>

<tr>
<td>

##### `allowBatchedHttpRequests`

`Boolean`
</td>
<td>

Controls whether to allow [Batching Queries](../requests/#batching) in a single HTTP Request. Defaults to `false`. If a request comes in formatted as an array rather than as a single request object, an error will be thrown.
</td>
</tr>


<tr>
<td colspan="2">

**Lifecycle options**
</td>
</tr>

<tr>
<td>

##### `plugins`

`Array`
</td>
<td>

An array of [plugins](../integrations/plugins) to install in your server instance. Each array element can be either a valid plugin object or a zero-argument function that _returns_ a valid plugin object.

In certain cases, Apollo Server installs some of its built-in plugins automatically (for example, when you provide an Apollo Studio API key with the `APOLLO_KEY` environment variable). For details, see the API references for these plugins: [usage reporting](/apollo-server/plugin/usage-reporting/), [schema reporting](/apollo-server/plugin/schema-reporting/), and [inline trace](/apollo-server/plugin/inline-trace/).

</td>
</tr>


<tr>
<td>

##### `stopOnTerminationSignals`

`Boolean`
</td>
<td>

By default (when running in Node when the `NODE_ENV` environment variable does not equal `test` and not using a serverless-specific package), whenever Apollo Server receives a `SIGINT` or `SIGTERM` signal, it calls `await this.stop()` on itself. (While this call to `this.stop()` is running, it ignores all `SIGINT` and `SIGTERM` signals.) It then sends that same signal to itself to continue process shutdown.

Set this option to `false` to disable this default behavior, or to `true` to enable the behavior even when `NODE_ENV` _does_ equal `test`.

The signal handler is installed after [`start()`](#start) returns successfully.

You can also manually call `stop()` in other contexts. Note that `stop()` is asynchronous, so it isn't useful in a `process.on('exit')` handler.

</td>
</tr>


<tr>
<td colspan="2">

**Debugging options**
</td>
</tr>

<tr>
<td>

##### `includeStacktraceInErrorResponses`

`Boolean`
</td>

<td>
If `true`, stack traces are included in GraphQL responses when errors occur. 

Defaults to `true` unless the `NODE_ENV` environment variable is `production` or `test`.
</td>
</tr>


<tr>
<td>

##### `logger`

[`Logger`](https://www.npmjs.com/package/@apollo/utils.logger)
</td>
<td>

An object to use for logging in place of `console`. If provided, this object must implement all methods of [the `Logger` interface](https://www.npmjs.com/package/@apollo/utils.logger).

If you provide this value, Apollo Server automatically logs all messages of _all_ severity levels (`debug` through `error`). It is the responsibility of the logger to determine how to handle logged messages of each level.

This logger is automatically added to the `GraphQLRequestContext` object that's passed to all Apollo Server [plugin functions](/apollo-server/integrations/plugins/).
</td>
</tr>


<tr>
<td>

##### `parseOptions`

`Object`
</td>
<td>

An object that specifies how your server parses GraphQL operations. [See `graphql-js` for the available configuration options](https://github.com/graphql/graphql-js/blob/9df90799299f40b596938aba15e88c4cd4f2d376/src/language/parser.ts#L77).
</td>
</tr>

<tr>
<td>

##### `nodeEnv`

`string`
</td>
<td>

If this is set to any string value, use that value instead of the environment variable `NODE_ENV` for the features whose defaults depend on `NODE_ENV` (such as [`introspection`](#introspection)). Note that passing the empty string here is equivalent to running with the `NODE_ENV` environment variable unset. This is primarily meant for testing the effects of the `NODE_ENV` environment variable.
</td>
</tr>

</tbody>
</table>

## `start`

The async `start` method instructs Apollo Server to prepare to handle incoming operations.

> Call `start` **only** if you are using a framework integration for a non-"serverless" environment (e.g., [`expressMiddleware`](./express-middleware)).
> * If you're using a "serverless" framework integration (such as Lambda), you **don't** need to call this method before passing your server into the integration function. Your serverless integration function will take care of starting your server for you. 
>
> * If you're using `startStandaloneServer` you do **not** need to start your server before [passing it directly to `startStandaloneServer`](./standalone).

Always call `await server.start()` *before* passing your server into your integration function and starting to accept requests:

<MultiCodeBlock>

```ts
const server = new ApolloServer<MyContext>({
  typeDefs,
  resolvers,
});
await server.start();

app.use('/graphql',
  cors<cors.CorsRequest>(),
  json(),
  expressMiddleware(server),
);
```

</MultiCodeBlock>

This allows you to react to Apollo Server startup failures by crashing your process instead of starting to serve traffic.

If you are testing your server using [`executeOperation`](../testing/testing/) (i.e., you're not actually starting an HTTP server), you still need to call `start()` because `executeOperation` will *not* do that for you.

### Triggered actions

The `start` method triggers the following actions:

1. If your server is a [federated gateway](https://www.apollographql.com/docs/federation/managed-federation/overview/), it attempts to fetch its schema. If the fetch fails, `start` throws an error.
2. Your server calls all of the [`serverWillStart` handlers](../integrations/plugins-event-reference/#serverwillstart) of your installed plugins. If any of these handlers throw an error, `start` throws an error.

## `addPlugin`
You can use the `addPlugin` method to add plugins before your server is started. This is helpful when you want to add a plugin that accepts your initialized `ApolloServer` instance itself, like so:

<MultiCodeBlock>

```ts
const server = new ApolloServer({
  typeDefs,
  plugins: [
    makeFirstPlugin(),
  ],
});

server.addPlugin(makeSecondPlugin(server));
```

</MultiCodeBlock>

## `assertStarted`

Framework integrations should call `server.assertStarted()` to ensure a server has started before accepting requests. See [Building integrations](../integrations/building-integrations) for more details.

## `stop`

`ApolloServer.stop()` is an async method that tells all of Apollo Server's background tasks to complete. Specifically, it:

- Calls and awaits all [`drainServer` plugin handlers](/apollo-server/integrations/plugins-event-reference/#drainserver). These should generally:
  - Stop listening for new connections
  - Closes idle connections (i.e., connections with no current HTTP request)
  - Closes active connections whenever they become idle
  - Waits for all connections to be closed
  - After a grace period, if any connections remain active, forcefully close them. If you're using `startStandaloneServer`, this happens by default. Otherwise, you can use the [drain HTTP server plugin](/apollo-server/plugin/drain-http-server/) to drain your HTTP server.
- Transitions the server to a state where it will not start executing more GraphQL operations.
- Calls and awaits all [`serverWillStop` plugin handlers](/apollo-server/integrations/plugins-event-reference/#serverwillstop) (including the [usage reporting plugin](/apollo-server/plugin/usage-reporting/)'s handler, which sends a final usage report to Apollo Studio).
- If your server is a [federated gateway](https://www.apollographql.com/docs/federation/gateway/), `stop` also stops gateway-specific background activities, such as polling for updated service configuration.

This method takes no arguments. You should only call it after [`start()`](#start) returns successfully (or after you've called `startStandaloneServer` with your `ApolloServer` instance).

In some circumstances, Apollo Server calls `stop` automatically when the process receives a `SIGINT` or `SIGTERM` signal. See the [`stopOnTerminationSignals` constructor option](#stoponterminationsignals) for details.

## `executeOperation`

The async `executeOperation` method is used primarily for [testing GraphQL operations](../testing/testing/#testing-using-executeoperation) through Apollo Server's request pipeline _without_ sending an HTTP request.

```js
const result = await server.executeOperation({
  query: 'query SayHelloWorld($name: String) { hello(name: $name) }',
  variables: { name: 'world' },
});
```

The `executeOperation` method takes two arguments:
* The first argument is an object describing the GraphQL operation to be executed.
  * Supported fields are listed in the table below.
* The second optional argument is used as the operation's [context value](../data/resolvers/#the-context-argument).

Below are the available fields for the first argument of `executeOperation`:

### Fields
<table class="field-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr class="required">
<td>

##### `query`

`string` or `DocumentNode`
</td>

<td>

**Required**. The GraphQL operation to run. Note that you must use the `query` field even if the operation is a mutation.
</td>
</tr>

<tr>
<td>

##### `variables`

`object`
</td>
<td>
An object containing any GraphQL variables to use as argument values for the executed operation.
</td>
</tr>

<tr>
<td>

##### `operationName`

`string`
</td>
<td>

If `query` contains more than one operation definition, you must provide this option to indicate which operation to execute.
</td>
</tr>

</tbody>
</table>