---
title: "API Reference: apollo-server"
sidebar_title: apollo-server
api_reference: true
---

This API reference documents the exports from the `apollo-server` package.

## `class ApolloServer`

The core of an Apollo Server implementation. For an example, see [Get started with Apollo Server](/getting-started/).

### Methods

#### `constructor`

Returns an initialized `ApolloServer` instance.

Takes an `options` object as a parameter. Supported fields of this object are described below.

##### Example

```js
const server = new ApolloServer({
	typeDefs,
	resolvers
});
```

##### Options

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr>
<td colspan="2">

**Schema options**
</td>
</tr>
<tr class="required">
<td>

###### `typeDefs`

`DocumentNode` or `Array<DocumentNode>`
</td>
<td>

Document or documents that represent your server's GraphQL schema, generated by applying the [`gql`](#gql) tag to valid Schema Definition Language (SDL) strings.

**Required** unless you provide [`schema`](#schema).

For an example, see [Define your GraphQL schema](../getting-started/#step-3-define-your-graphql-schema).
</td>
</tr>


<tr class="required">
<td>

###### `resolvers`

`Object` or `Array`
</td>
<td>

A map of functions that populate data for individual schema fields. Can also be an array of multiple maps that are merged.

**Required** unless you provide [`schema`](#schema).

For details, see [Resolvers](../data/resolvers/).
</td>
</tr>


<tr>
<td>

###### `context`

`Object` or `Function`
</td>
<td>

An object (or a function that _creates_ an object) that's passed to every resolver that executes for a particular operation. This enables resolvers to share helpful context, such as a database connection.

[Certain fields](#middleware-specific-context-fields) are added to this object automatically, depending on which [Node.js middleware](../integrations/middleware/) your server uses.

For more details, see [The `context` argument](../data/resolvers/#the-context-argument).
</td>
</tr>


<tr>
<td>

###### `dataSources`

`Function`
</td>
<td>

A function that returns an object containing `DataSource` instances for use by your resolvers. The object is automatically added to each operation's [`context`](#context).

For more details, see [Adding data sources to Apollo Server](../data/data-sources/#adding-data-sources-to-apollo-server).
</td>
</tr>


<tr>
<td>

###### `introspection`

`Boolean`
</td>

<td>

If `true`, enables [schema introspection](https://graphql.org/learn/introspection/) by clients.

The default value is `true`, **unless** the `NODE_ENV` environment variable is set to `production`.
</td>
</tr>


<tr>
<td>

###### `schema`

`Object`
</td>

<td>

An executable GraphQL schema. You usually don't need to provide this value, because Apollo Server generates it from [`typeDefs`](#typedefs) and [`resolvers`](#resolvers).

This field is most commonly used with [Apollo Federation](https://www.apollographql.com/docs/federation/implementing-services/#generating-a-federated-schema), which uses a special `buildFederatedSchema` function to generate its schema.

Note that if you are using [file uploads](../data/file-uploads/), you need to add the `Upload` scalar to your schema manually before providing it here, as Apollo Server's automatic uploads integration does not apply if you use this particular option..
</td>
</tr>


<tr>
<td>

###### `persistedQueries`

`Object` or `false`
</td>

<td>

If you're using [automated persisted queries (APQ)](../performance/apq/), you can provide an object with a `cache` field as the value of this option to customize where Apolllo Server stores the mapping between operation hashes and query strings.

Provide `false` to disable APQ entirely.
</td>
</tr>


<tr>
<td>

###### `subscriptions`

`Object` or `String` or `false`
</td>

<td>

Provide a `String` to specify the server's subscription-specific endpoint, or an `Object` to further [configure subscription behavior](#subscription-configuration-fields).

Provide `false` to disable subscription operations entirely.
</td>
</tr>


<tr>
<td>

###### `rootValue`

`Any` or `Function`
</td>
<td>

A value or function called with the parsed `Document`, creating the root value passed to the GraphQL executor.

Providing a function is useful if you want to use a different root value depending on the operation's details, such as whether it's a query or mutation.
</td>
</tr>


<tr>
<td>

###### `validationRules`

`Object`
</td>
<td>

An object containing custom functions to use as additional [validation rules](https://github.com/graphql/graphql-js/tree/master/src/validation/rules) when validating the schema.
</td>
</tr>

<tr>
<td>

###### `uploads`

`Object` or `Boolean`
</td>
<td>

By default, Apollo Server 2 [integrates](../data/file-uploads/) an outdated version of [the `graphql-upload` npm module](https://www.npmjs.com/package/graphql-upload#graphql-upload) into your schema which does not support Node 14. If you provide an object here, it will be passed as the third `options` argument to that module's `processRequest` option.

We recommend instead that you pass `false` here, which will disable Apollo Server's integration with `graphql-upload`, and instead integrate the latest version of that module directly. This integration will be removed in Apollo Server 3.
</td>
</tr>

<tr>
<td colspan="2">

**Networking options**
</td>
</tr>

<tr>
<td>

###### `cors`

`Object` or `Boolean`
</td>
<td>

An `Object` containing [configuration options](https://github.com/expressjs/cors#configuration-options) for the server's CORS behavior. Provide `false` to remove CORS middleware entirely.

This option is used only by the `apollo-server` package. If you're integrating with Node.js middleware via a different package, instead see [`applyMiddleware`](#applymiddleware).
</td>
</tr>

###### `formatError`

`Function`
</td>
<td>

Provide this function to transform the structure of error objects before they're sent to a client. The function takes a [`GraphQLError`](https://github.com/graphql/graphql-js/blob/master/src/error/GraphQLError.js) object and should return a [`GraphQLFormattedError`](https://github.com/graphql/graphql-js/blob/master/src/error/formatError.js#L26) object.
</td>
</tr>

<tr>
<td>

###### `formatResponse`

`Function`
</td>
<td>

Provide this function to transform the structure of GraphQL response objects before they're sent to a client. The function takes a [`GraphQLResponse`](https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-types/src/index.ts#L77-L82) object and a [`GraphQLRequestContext`](https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-types/src/index.ts#L95-L130) object, and it should return a `GraphQLResponse` object, or null to preserve the existing structure.
</td>
</tr>

<tr>
<td>

###### `apollo`

`Object`
<td>

An object containing configuration options for connecting Apollo Server to [Apollo Studio](https://www.apollographql.com/docs/studio/). Each field of this object can also be set with an environment variable, which is the recommended method of setting these parameters. All fields are optional. The fields are:

- `key`: The [graph API key](https://www.apollographql.com/docs/studio/api-keys/#graph-api-keys) that Apollo Server should use to authenticate with Apollo Studio. You can set this with the `APOLLO_KEY` environment variable.
- `graphId`: The ID of your graph in Apollo's registry. You can set this with the `APOLLO_GRAPH_ID` environment variable. Most users will not specify this explicitly and allow Apollo Server to infer the ID from your API key.
- `graphVariant`: The [variant](https://www.apollographql.com/docs/studio/schema/registry/#managing-environments-with-variants) of your graph to associate this server's schema and metrics with. You can set this with the `APOLLO_GRAPH_VARIANT` environment variable. The default value is `current`.

</td>
</tr>


<tr>
<td colspan="2">

**Lifecycle options**
</td>
</tr>

<tr>
<td>

###### `plugins`

`Array`
</td>
<td>

An array of [plugins](../integrations/plugins) to install in your server instance. Each array element can be either a valid plugin object or a zero-argument function that _returns_ a valid plugin object.

In certain cases, Apollo Server installs some of its built-in plugins automatically (for example, when you provide an Apollo Studio API key with the `APOLLO_KEY` environment variable). For details, see the API references for these plugins: [usage reporting](./plugin/usage-reporting/), [schema reporting](./plugin/schema-reporting/), and [inline trace](./plugin/inline-trace/).

</td>
</tr>


<tr>
<td>

###### `stopOnTerminationSignals`

`Boolean`
</td>
<td>

By default (when running in Node and when the `NODE_ENV` environment variable does not equal `test`), whenever Apollo Server receives a `SIGINT` or `SIGTERM` signal, it calls `await this.stop()` on itself. (While this call to `this.stop()` is running, it ignores all `SIGINT` and `SIGTERM` signals.) It then sends that same signal to itself to continue process shutdown.

Set this option to `false` to disable this default behavior, or to `true` to enable the behavior even when `NODE_ENV` _does_ equal `test`.

You can also manually call `stop()` in other contexts. Note that `stop()` is asynchronous, so it isn't useful in a `process.on('exit')` handler.

</td>
</tr>

<tr>
<td>

###### `stopGracePeriodMillis`

`number`
</td>
<td>

The amount of time to wait after [`ApolloServer.stop()`](#stop) is called (including via a [termination signal](#stoponterminationsignals)) before forcefully closing all active connections. If you pass `Infinity`, Apollo Server waits indefinitely for all active connections to go idle.

**This option is used only by the `apollo-server` package.** If you're integrating with [Node.js middleware](../integrations/middleware/) via a different package, it's your responsibility to stop your HTTP server in whatever way is appropriate.

The default value is `10_000` (10 seconds).

</td>
</tr>


<tr>
<td colspan="2">

**Debugging options**
</td>
</tr>

<tr>
<td>

###### `debug`

`Boolean`
</td>

<td>

If `true`, enables development mode helpers and logs messages of all severity levels (`debug` through `error`). If `false`, only `warn`- and `error`-level messages are logged.

Defaults to `true`.
</td>
</tr>


<tr>
<td>

###### `logger`

[`Logger`](https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-types/src/index.ts#L146-L152)
</td>
<td>

An object to use for logging in place of `console`. If provided, this object must implement all methods of [the `Logger` interface](https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-types/src/index.ts#L146-L152).

If you provide this value, Apollo Server automatically logs all messages of _all_ severity levels (`debug` through `error`), regardless of whether the `debug` option is set to `true`. It is the responsibility of the logger to determine how to handle logged messages of each level.

This logger is automatically added to the `GraphQLRequestContext` object that's passed to all Apollo Server [plugin functions](../integrations/plugins/).
</td>
</tr>


<tr>
<td>

###### `mocks`

`Boolean` or `Object`
</td>
<td>

If `true`, enables [default mock resolvers](../testing/mocking/#default-mock-example) for schema fields. If an object, enables [_custom_ mock resolvers](../testing/mocking/#customizing-mocks) based on the object's fields.
</td>
</tr>


<tr>
<td>

###### `mockEntireSchema`

`Boolean`
</td>
<td>

If `true` and `mocks` is also specified, mock resolvers are enabled even for fields that you've defined a resolver for.

The default value is `true`. Set this to `false` to use mocked resolvers only for fields that you _haven't_ defined a resolver for.
</td>
</tr>

</tbody>
</table>

##### Experimental options

**These options are experimental.**  They might be removed or change at any time, even within a patch release.

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
<tr>
<td>

###### `experimental_approximateDocumentStoreMiB`

`number`
</td>
<td>

Sets the approximate size (in MiB) of the server's `DocumentNode` cache. The server checks the SHA-256 hash of each incoming operation against cached `DocumentNode`s, and skips unnecessary parsing and validation if a match is found.

The cache's default size is 30MiB, which is usually sufficient unless the server processes a large number of unique operations.
</td>
</tr>
</tbody>
</table>

##### Middleware-specific `context` fields

The `context` object passed between Apollo Server resolvers automatically includes certain fields, depending on which [Node.js middleware](../integrations/middleware/) you're using:

| Middleware | Context fields |
|---|---|
| AWS Lambda | <code>{<br/>&nbsp;&nbsp;event: [`APIGatewayProxyEvent`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/aws-lambda/index.d.ts#L78-L92),<br/>&nbsp;&nbsp;context: [`LambdaContext`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/aws-lambda/index.d.ts#L510-L534)<br/>}</code> |
| Azure Functions  | <code>{<br/>&nbsp;&nbsp;request: [`HttpRequest`](https://github.com/Azure/azure-functions-nodejs-worker/blob/ba8402bd3e86344e68cb06f65f9740b5d05a9700/types/public/Interfaces.d.ts#L73-L108),<br/>&nbsp;&nbsp;context: [`Context`](https://github.com/Azure/azure-functions-nodejs-worker/blob/ba8402bd3e86344e68cb06f65f9740b5d05a9700/types/public/Interfaces.d.ts#L18-L69)<br/>}</code> |
| Cloudflare  | <code>{ req: [`Request`](https://github.com/apollographql/apollo-server/blob/04fe6aa1314ca84de26b4dc26e9b29dda16b81bc/packages/apollo-server-env/src/fetch.d.ts#L37-L45) }</code> |
| Express | <code>{<br/>&nbsp;&nbsp;req: [`express.Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts),<br/>&nbsp;&nbsp;res: [`express.Response`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts#L490-L861)<br/>}</code> |
| Fastify  | <code>{<br/>&nbsp;&nbsp;request: [`FastifyRequest`](https://github.com/fastify/fastify/blob/1d4dcf2bcde46256c72e96c2cafc843a461c721e/types/request.d.ts#L15),<br/>&nbsp;&nbsp;reply: [`FastifyReply`](https://github.com/fastify/fastify/blob/1d4dcf2bcde46256c72e96c2cafc843a461c721e/types/reply.d.ts#L10)</br>}</code> |
| Google Cloud Functions  | <code>{ req: [`Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts), res: [`Response`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts#L490-L861) }</code> |
| hapi  | <code>{<br/>&nbsp;&nbsp;request: [`hapi.Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/05cbc5521f895344fb7dbf5c51902b6ff235aa69/types/hapi__hapi/index.d.ts#L406-L615),<br/>&nbsp;&nbsp;h: [`hapi.ResponseToolkit`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/05cbc5521f895344fb7dbf5c51902b6ff235aa69/types/hapi__hapi/index.d.ts#L999-L1113)<br/>}</code> |
| Koa | <code>{ ctx: [`Koa.Context`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/koa/index.d.ts#L724-L731) }</code> |
| Micro | <code>{ req: [`MicroRequest`](https://github.com/apollographql/apollo-server/blob/c356bcf3f2864b8d2fcca0add455071e0606ef46/packages/apollo-server-micro/src/types.ts#L3-L5), res: [`ServerResponse`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/node/v10/http.d.ts#L145-L158) }</code> |

##### Subscription configuration fields

Apollo Server supports the following fields of an object you provide to the [`subscriptions`](#subscriptions) option of the `ApolloServer` constructor:

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>

<tr class="required">
<td>

###### `path`

`String`
</td>
<td>

**Required.** The URL for the server's subscription-specific endpoint.
</td>
</tr>


<tr>
<td>

###### `keepAlive`

`Number`
</td>
<td>

The frequency with which the subscription endpoint should send keep-alive messages to open client connections, in milliseconds, if any.

If this value isn't provided, the subscription endpoint doesn't send keep-alive messages.
</td>
</tr>


<tr>
<td>

###### `onConnect`

`Function`
</td>

<td>

A lifecycle hook that's called whenever a subscription connection is initiated by a client. [See an example](../data/subscriptions/#example-authentication-with-onconnect)
</td>
</tr>


<tr>
<td>

###### `onDisconnect`

`Function`
</td>

<td>

A lifecycle hook that's called whenever a subscription connection is terminated by a client.
</td>
</tr>


</tbody>
</table>

#### `listen`

> This method is provided only by the `apollo-server` package. If you're integrating with Node.js middleware via a different package (such as `apollo-server-express`), instead see both [`start`](#start) and [`applyMiddleware`](#applymiddleware).

Instructs Apollo Server to begin listening for incoming requests:

```js
server.listen({
  port: 4001,
});
```

Takes an `options` object as a parameter, which is passed to the `listen` method of `http.Server`. Supported options are listed in the [documentation for `net.Server.listen`](https://nodejs.org/api/net.html#net_server_listen_options_callback).

Returns a `Promise` that resolves to an object containing the following properties:

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr>
<td>

###### `url`

`String`
</td>
<td>

The URL that the server is listening on.
</td>
</tr>


<tr>
<td>

###### `server`

[`http.Server`](https://nodejs.org/api/http.html#http_class_http_server)
</td>
<td>

The server instance that's listening at `url`.
</td>
</tr>


<tr>
<td>

###### `subscriptionsPath`

`String`
</td>
<td>

The path of the server's subscriptions endpoint.
</td>
</tr>


<tr>
<td>

###### `subscriptionsUrl`

`String`
</td>
<td>

The full URL of the server's subscriptions endpoint.
</td>
</tr>
</tbody>
</table>

#### `start`

The async `start` method instructs Apollo Server to prepare to handle incoming operations.

> Call `start` **only** if you are using a [middleware integration](../integrations/middleware/) for a non-"serverless" environment (e.g., `apollo-server-express`).
>
> * If you're using the core `apollo-server` library, call [`listen`](#listen) instead.
> * If you're using a "serverless" middleware integration (such as `apollo-server-lambda`), this method isn't necessary because the integration doesn't distinguish between starting the server and serving a request.

Always call `await server.start()` *before* calling `server.applyMiddleware` and starting your HTTP server. This allows you to react to Apollo Server startup failures by crashing your process instead of starting to serve traffic.

This method was optional in Apollo Server 2 but is required in Apollo Server 3.

##### Triggered actions

The `start` method triggers the following actions:

1. If your server is a [federated gateway](https://www.apollographql.com/docs/federation/managed-federation/overview/), it attempts to fetch its schema. If the fetch fails, `start` throws an error.
2. Your server calls all of the [`serverWillStart` handlers](../integrations/plugins/#serverwillstart) of your installed plugins. If any of these handlers throw an error, `start` throws an error.

#### `applyMiddleware`

Connects Apollo Server to the HTTP framework of a Node.js middleware library, such as hapi or express.

You call this method instead of [`listen`](#listen) if you're using a [middleware integration](../integrations/middleware/), such as `apollo-server-express`. You should call [`await server.start()`](#start) _before_ calling this method.

Takes an `options` object as a parameter. Supported fields of this object are described below.

##### Example

```js
const express = require('express');
const { ApolloServer } = require('apollo-server-express');
const { typeDefs, resolvers } = require('./schema');

async function startApolloServer() {
  const server = new ApolloServer({
    typeDefs,
    resolvers,
  });
  await server.start();

  const app = express();

  // Additional middleware can be mounted at this point to run before Apollo.
  app.use('*', jwtCheck, requireAuth, checkScope);

  // Mount Apollo middleware here.
  server.applyMiddleware({ app, path: '/specialUrl' });
  await new Promise(resolve => app.listen({ port: 4000 }, resolve));
  console.log(`ðŸš€ Server ready at http://localhost:4000${server.graphqlPath}`);
  return { server, app };
}
```

##### Options

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr class="required">
<td>

###### `app`

`HttpServer`
</td>
<td>

**Required.** The server middleware instance to integrate with Apollo Server.
</td>
</tr>


<tr>
<td>

###### `path`

`String`
</td>
<td>

The path for Apollo Server to listen on.

The default value is `/graphql`.
</td>
</tr>


<tr>
<td>

###### `cors`

`Object` or `Boolean`
</td>
<td>

Middleware-specific configuration options for CORS. See available options for your middleware: [express](https://github.com/expressjs/cors#cors) | [hapi](https://hapi.dev/api/?v=20.1.2#-routeoptionscors) | [koa](https://github.com/koajs/cors/)

Provide `false` to remove CORS middleware entirely, or `true` to use your middleware's default configuration.

The default value is `true`.
</td>
</tr>


<tr>
<td>

###### `bodyParserConfig`

`Object` or `Boolean`
</td>
<td>

Middleware-specific configuration options for body parsing. See available options for your middleware: [express](https://github.com/expressjs/body-parser#body-parser) | [koa](https://github.com/koajs/bodyparser)

Provide `false` to remove body parsing middleware entirely, or `true` to use your middleware's default configuration.

The default value is `true`.
</td>
</tr>

</tbody>
</table>

#### `getMiddleware`

Returns an array of the middlewares that together form a complete instance of Apollo Server. Includes middleware for HTTP body parsing, health checks, setting CORS headers, and serving a static UI, as well as actually executing GraphQL operations.

Unlike [`applyMiddleware`](#applymiddleware), `getMiddleware` does _not_ automatically apply Apollo Server middlewares to your application. Instead, this method enables you to apply or omit individual middlewares according to your use case. For an Express or Koa application, you can apply a particular middleware by calling `app.use`.

The `getMiddleware` method takes the same options as [`applyMiddleware`](#applymiddleware), **except** the `app` option.

#### `stop`

`ApolloServer.stop()` is an async method that tells all of Apollo Server's background tasks to complete. It calls and awaits all [`serverWillStop` plugin handlers](../integrations/plugins/#serverwillstop) (including the [usage reporting plugin](./plugin/usage-reporting/)'s handler, which sends a final usage report to Apollo Studio). This method takes no arguments.

If your server is a [federated gateway](https://www.apollographql.com/docs/federation/gateway/), `stop` also stops gateway-specific background activities, such as polling for updated service configuration.

In some circumstances, Apollo Server calls `stop` automatically when the process receives a `SIGINT` or `SIGTERM` signal. See the [`stopOnTerminationSignals` constructor option](#stoponterminationsignals) for details.

If you're using the `apollo-server` package (which handles setting up an HTTP server for you), this method first stops the HTTP server. Specifically, it:

* Stops listening for new connections
* Closes idle connections (i.e., connections with no current HTTP request)
* Closes active connections whenever they become idle
* Waits for all connections to be closed

If any connections remain active after a grace period (10 seconds by default), Apollo Server forcefully closes those connections. You can configure this grace period with the [`stopGracePeriodMillis` constructor option](#stopgraceperiodmillis).

If you're using a [middleware package](../integrations/middleware/) instead of `apollo-server`, you should stop your HTTP server before calling `ApolloServer.stop()`.

---

## `gql`

A [template literal tag](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#Tagged_templates) for wrapping GraphQL strings, such as schema definitions:

```js
const { gql } = require('apollo-server');

const typeDefs = gql`
  type Author {
    name
  }
`;
```

This converts GraphQL strings into the format that Apollo libraries expect when working with operations and schemas. It also helps tools identify when a string contains GraphQL language (such as to enable syntax highlighting).
