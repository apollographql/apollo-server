<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.4416d3c7f2735fbdaee5.css" data-identity="gatsby-global-css">@import url(https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic);
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}@font-face{font-family:Source Code Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcecodepro/v14/HI_SiYsKILxRpg3hIP6sJ7fM7PqlPevT.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7g.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/sourcesanspro/v14/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdr.ttf) format("truetype")}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{font-family:Source Sans Pro,sans-serif}code,pre{font-family:Source Code Pro,monospace}html{font-size:100%;line-height:1.45;overflow-y:auto}body{color:#5a6270}div.mermaid,h1,h2,h3,h4,h5,h6,img,ol,p,ul{margin:0 0 24px}h4,h5{margin-bottom:1.0875rem}h1,h2,h3,h4,h5,h6{color:#2f353f;line-height:1.1}h1,h2,h3,h4,h6{font-weight:400}h1{font-size:2.5rem}h2{font-size:1.73286rem}h3{font-size:1.4427rem}h4,li,p{font-size:1.125rem}h5{font-size:1rem}h6{font-size:.875rem}li,p{line-height:1.7}li li{font-size:1.05rem;line-height:1.4}ol,ul{margin-left:24px;padding:0}li{margin-bottom:12px}li>ol,li>ul{margin-top:12px}blockquote{border-left:2px solid #3f20ba;margin-left:0;padding:12px 20px}blockquote>ol,blockquote>p,blockquote>ul{font-size:inherit}blockquote>ol:last-child,blockquote>p:last-child,blockquote>ul:last-child{margin-bottom:0}blockquote li,td li{font-size:inherit;line-height:1.1}form{margin-bottom:0}hr{background-color:#dee2e7;border:none;height:1px;margin-bottom:23px}img.screenshot{border-radius:8px;box-shadow:0 0 0 1px rgba(18,21,26,.04),0 1px 4px 0 rgba(0,0,0,.08)}.gatsby-code-title{align-items:center;color:#5a6270;display:flex;font-family:Source Code Pro,monospace;font-size:15px;height:37px;margin-bottom:-37px;padding-left:19px}.gatsby-highlight-code-line{background-color:#ebeef0;display:block;margin-left:-3.5em;margin-right:-1em;padding-left:3.5em;padding-right:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.5em}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows{border-right:none}.gatsby-highlight pre[class*=language-].line-numbers .line-numbers-rows>span:before{color:#cad0d8}code[class*=language-],pre[class*=language-]{color:#2f353f;direction:ltr;font-family:Source Code Pro,monospace;font-size:15px;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:none;white-space:pre;word-break:normal;word-spacing:normal}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{background:#f4f6f8;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-]{background:#ebeef0;border-radius:.3em;color:#832363;font-size:.9em;padding:.1em .15em}.namespace{opacity:.7}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#b46626}.token.punctuation{color:#5a6270}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#832363}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#1d7b78}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:transparent;color:inherit}.token.atrule,.token.attr-value,.token.keyword{color:#3f20ba}.token.class-name,.token.function{color:#832363}.token.important,.token.regex,.token.variable{color:#84671d}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-]>code[class*=language-],pre[data-line]{position:relative}@media (detachedmediaquery:""){:root{--aa-detached-modal-max-height:600px}}:root{--aa-detached-modal-max-width:1000px;--aa-detached-modal-max-height:600px;--aa-item-content-title-font-size:1.125rem;--aa-item-content-title-line-height:1.25em}.app-container{margin:0 auto;max-width:1000px;width:100%}.aa-Autocomplete[aria-expanded=true]{visibility:hidden}.aa-Input{font-size:1.125rem}.aa-Container{height:100%;position:relative}.aa-Grid{-webkit-column-gap:calc(var(--aa-spacing-half)/2);column-gap:calc(var(--aa-spacing-half)/2);display:grid}.aa-DetachedContainer .aa-Grid{grid-template-columns:1fr}.aa-DetachedContainer--modal .aa-Grid{grid-template-columns:repeat(2,50%)}.aa-MultiGrid{-webkit-column-gap:calc(var(--aa-spacing-half)/2);column-gap:calc(var(--aa-spacing-half)/2);display:grid;grid-template-columns:1fr 1fr 1fr}.aa-AlgoliaAttribution{bottom:6px;display:flex;height:16px;position:absolute;right:6px}.aa-AlgoliaAttribution svg{height:100%}.aa-DocsetIcon{align-items:center;align-self:flex-start;color:#3e34d3;display:flex;font-size:var(--aa-item-content-title-font-size);height:var(--aa-item-content-title-line-height);justify-content:center}.aa-PreviewType .aa-DocsetIcon{height:auto}.aa-PreviewType .aa-DocsetIcon svg{height:24px;width:24px}.aa-DocsetIcon svg{fill:currentColor;height:1em;width:1em}.aa-PanelLayout{overflow-x:hidden;padding:0}.aa-Detached .aa-DetachedContainer{background:none}.aa-DetachedContainer .aa-DetachedFormContainer{background:rgba(var(--aa-background-color-rgb),var(--aa-background-color-alpha));padding:calc(var(--aa-spacing-half)*1.5)}.aa-DetachedContainer:not(.aa-DetachedContainer--modal) .aa-AlgoliaAttribution,.aa-DetachedContainer:not(.aa-DetachedContainer--modal) .aa-Preview.aa-Column{display:none}.aa-DetachedSearchButton{border-radius:4px;overflow:hidden;white-space:nowrap}.aa-DetachedSearchButtonIcon{flex-shrink:0}.aa-DetachedSearchButtonPlaceholder{flex-grow:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:0}.aa-NoResults{grid-column:span 2}.aa-SourceNoResults{align-items:center;display:flex;justify-content:center;padding:0}.aa-NoResults .aa-Source~.aa-Source{display:none}.aa-SourceHeaderTitle{font-size:.9rem;padding-left:calc(var(--aa-spacing-half)/2)}.aa-Preview.aa-Column{align-items:center;display:flex;flex-direction:column;padding:40px 20px;text-align:center}.aa-PreviewType{align-items:center;display:flex;justify-content:center;margin-bottom:20px}.aa-PreviewType .aa-DocsetIcon{margin-right:8px}.aa-PreviewImage{background:var(--aa-background-color);border:1px solid var(--aa-selected-color);border-radius:3px;display:flex;height:150px;justify-content:center;margin-bottom:var(--aa-spacing-half);padding:var(--aa-spacing-half)}.aa-PreviewImage img{max-width:100%;-o-object-fit:contain;object-fit:contain}.aa-PreviewBreacrumbs{align-items:center;color:#696969;display:flex;font-size:14px;justify-content:center;line-height:1.5;margin-bottom:var(--aa-spacing-half);white-space:nowrap;width:100%}.aa-PreviewBreacrumbs a{color:inherit;text-decoration:none}.aa-PreviewBreacrumbs a:hover{text-decoration:underline}.aa-PreviewBreacrumbs .aa-Chevron{background-color:#f4f6f8}.aa-PreviewBreacrumbs .aa-PreviewBreadcrumbsContent{background-color:#f4f6f8;padding:0 8px}.aa-PreviewBreacrumbs .aa-PreviewBreadcrumbsContent:first-child{border-bottom-left-radius:9999px;border-top-left-radius:9999px}.aa-PreviewBreacrumbs .aa-PreviewBreadcrumbsContent:last-child{border-bottom-right-radius:9999px;border-top-right-radius:9999px}.aa-PreviewBreacrumbs .aa-PreviewBreadcrumbsContent:hover~.aa-PreviewBreadcrumbsContent,.aa-PreviewBreacrumbs .aa-PreviewBreadcrumbsContent:not(:last-child):not(:hover){overflow:hidden;text-overflow:ellipsis}.aa-PreviewTitle{font-size:28px;font-weight:700;line-height:1;margin-bottom:var(--aa-spacing-half)}.aa-PreviewTitleWrapper{align-items:center;display:flex}.aa-PreviewTitleWrapper a{color:inherit;text-decoration:none}.aa-PreviewTitleWrapper a:hover{text-decoration:underline}.aa-PreviewDescription{color:var(--aa-content-text-color);font-size:1rem;line-height:1.5;max-width:100%}.aa-PreviewDescription mark,.aa-PreviewTitle mark{background:none;color:#3e34d3;font-weight:700}.aa-Item{border-radius:0;margin:0;padding:6px 4px}.aa-Item a{text-decoration:none}.aa-Item[aria-selected=true] mark{text-decoration:underline}.aa-ItemLink{grid-template-columns:1fr}.aa-ItemContent{grid-template-columns:28px 1fr 20px}.aa-ItemContentBody{grid-gap:0;white-space:nowrap}.aa-ItemContent mark{color:#3e34d3}.aa-ItemContentTitle{font-size:var(--aa-item-content-title-font-size)}.aa-ItemContentSnippet{color:rgba(46,46,47,.7);font-size:.875rem;overflow:hidden;text-overflow:ellipsis}.aa-ItemContentEnterKey{color:rgba(46,46,47,.7);justify-self:flex-end}.aa-Item[aria-selected=false] .aa-ItemContentEnterKey{display:none}[data-autocomplete-source-id=hits]{margin-bottom:var(--aa-spacing-half)}[data-autocomplete-source-id=suggestions] .aa-List{display:flex;flex-wrap:wrap;margin:0 calc(var(--aa-spacing-half)/2*-1px)}[data-autocomplete-source-id=suggestions] .aa-Item[aria-selected=true]{background:none}.aa-CategoriesContainer{margin-top:16px}.aa-CategoriesContainer .aa-QuerySuggestion{border:1px solid #d9cfff;border-radius:4px;color:#3f20ba;font-family:Source Code Pro,Menlo,monospace;font-size:13px;line-height:18px;margin:4px;padding:1px 6px;text-transform:uppercase}.aa-QuerySuggestion{background:none;border:1px solid rgba(var(--aa-panel-border-color-rgb),var(--aa-panel-border-color-alpha));border-radius:3px;color:rgba(var(--aa-icon-color-rgb),var(--aa-icon-color-alpha));cursor:pointer;display:inline-block;font-size:.85em;font-weight:700;margin:calc(var(--aa-spacing-half)/2/2);padding:var(--aa-spacing-half) var(--aa-spacing)}.aa-QuerySuggestion:hover{background:rgba(var(--aa-selected-color-rgb),var(--aa-selected-color-alpha))}.aa-QuerySuggestion mark{background:none;color:currentColor;font-weight:400}[data-autocomplete-source-id=suggestions] .aa-Item[aria-selected=true] .aa-QuerySuggestion{background:rgba(var(--aa-selected-color-rgb),var(--aa-selected-color-alpha));border-color:transparent}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}</style><meta name="generator" content="Gatsby 3.14.6"/><title data-react-helmet="true">Migrating to Apollo Server 3 - Apollo Server - Apollo GraphQL Docs</title><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><link data-react-helmet="true" rel="icon" href="https://www.apollographql.com/favicon.ico"/><link data-react-helmet="true" rel="icon" href="https://odyssey.apollographql.com/favicon.svg"/><link data-react-helmet="true" rel="canonical" href="https://www.apollographql.com/docs/apollo-server/*"/><meta data-react-helmet="true" name="description" content="A guide to using Apollo Server"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><meta data-react-helmet="true" property="og:title" content="Migrating to Apollo Server 3"/><meta data-react-helmet="true" property="og:site_name" content="Apollo GraphQL Docs"/><meta data-react-helmet="true" property="og:description" content="A guide to using Apollo Server"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Migrating to Apollo Server 3"/><meta data-react-helmet="true" name="twitter:description" content="A guide to using Apollo Server"/><meta data-react-helmet="true" property="og:image" content="https://res.cloudinary.com/apollographql/image/upload/w_1280,h_669,c_fill,q_auto,f_auto/w_1120,c_fit,co_rgb:FFFFFF,g_south_west,x_80,y_254,l_text:Source%20Sans%20Pro_80_bold:Migrating%20to%20Apollo%20Server%203/w_1120,c_fit,co_rgb:FFFFFF,g_north_west,x_80,y_445,l_text:Source%20Sans%20Pro_48:Apollo%20Server%20%E2%80%BA%20New%20in%20v3/apollo-docs-template2_dohzxt"/><meta data-react-helmet="true" name="twitter:site" content="@apollographql"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 72)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl+'';f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer', 'GTM-M964NS9');</script><script></script><script type="text/javascript" charset="UTF-8"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>
          var ffWidgetId = '3131c43c-bfb5-44e6-9a72-b4094f7ec028';
          var ffWidgetScript = document.createElement("script");
          ffWidgetScript.type = "text/javascript";
          ffWidgetScript.src = 'https://freddyfeedback.com/widget/freddyfeedback.js';
          document.head.appendChild(ffWidgetScript);
        </script><script src="https://www.apollographql.com/utm-grabber.js"></script><link as="script" rel="preload" href="/webpack-runtime-1e0d3b6f0e0e2f3ff88f.js"/><link as="script" rel="preload" href="/framework-bd32e92195540dc9b6da.js"/><link as="script" rel="preload" href="/79ac12c6-689c070edc40661ddeb0.js"/><link as="script" rel="preload" href="/app-a55f8575680208f4298f.js"/><link as="fetch" rel="preload" href="/page-data/migration/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1511030359.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2468095761.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M964NS9" height="0" width="0" style="display: none; visibility: hidden" aria-hidden="true"></iframe></noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 1vsoxt3">.css-1vsoxt3{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100vh;max-width:1440px;margin:0 auto;}</style><div class="css-1vsoxt3 exdt29b0"><style data-emotion="css 1bs7gxh">.css-1bs7gxh{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:312px;height:100vh;padding:24px;border-right:1px solid #DEE2E7;overflow-y:auto;position:-webkit-sticky;position:sticky;top:0;}@media (max-width: 850px){.css-1bs7gxh{height:100%;background-color:white;box-shadow:0 0 48px rgba(0,0,0,0.25);position:fixed;z-index:2;opacity:0;visibility:hidden;-webkit-transform:translateX(-100%);-moz-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);transition-property:transform,opacity,visibility;transition-duration:150ms;transition-timing-function:ease-in-out;}}</style><aside class="css-1bs7gxh ezgpdot2"><style data-emotion="css 1p14ewn">.css-1p14ewn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:24px;}</style><div class="css-1p14ewn ezgpdot1"><style data-emotion="css gbkvvb">.css-gbkvvb{color:#2F353F;-webkit-text-decoration:none;text-decoration:none;}</style><a href="https://www.apollographql.com/docs/" class="css-gbkvvb ezgpdot0"><style data-emotion="css 135j8ps">.css-135j8ps{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:24px;}</style><div class="css-135j8ps eetev6l2"><style data-emotion="css djsuo">.css-djsuo{margin-right:0.2857142857em;}</style><style data-emotion-css="dzwxe8">.css-dzwxe8{overflow:visible;height:293px;}.css-dzwxe8 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 979 293" style="height:1em" class="css-djsuo eetev6l1 css-dzwxe8"><g fill="currentColor" fill-rule="nonzero"><path d="M159.4 83.1H130L87.5 195.4h26.6l6.9-19h40.1l-7.3-21h-26.4l17.2-48.3 30.6 88.4h26.6zM606.3 195.3V83.1H630v91.2h46.6v21zM742.6 195.3V83.1h23.6v91.2h46.6v21zM475.4 103.2c19.5 0 35.5 16.2 35.5 36.1 0 19.9-15.9 36.1-35.5 36.1-19.5 0-35.4-16.2-35.4-36.1 0-19.9 15.9-36.1 35.4-36.1zm0-22c-31.5 0-57 26-57 58.1s25.5 58.1 57 58.1 57-26 57-58.1-25.5-58.1-57-58.1zM921.5 103.2c19.6 0 35.5 16.2 35.5 36.1 0 19.9-15.9 36.1-35.5 36.1-19.5 0-35.4-16.2-35.4-36.1-.1-19.9 15.8-36.1 35.4-36.1zm0-22c-31.5 0-57 26-57 58.1s25.5 58.1 57 58.1 57-26 57-58.1-25.5-58.1-57-58.1zM322 83.1h-51.4v112.3h23.5v-38.6H322c19.6 0 35.5-16.9 35.5-36.8 0-20.1-15.9-36.9-35.5-36.9zm0 51.6h-27.9V105H322c7.7 0 13.9 7 13.9 14.8 0 7.9-6.2 14.9-13.9 14.9z"></path><path d="M250.4 229.4c-2 0-3.8 1-4.9 2.6 0 0-5.3 6.2-8.2 9.1-12.1 12.3-26.1 21.9-41.8 28.7-16.2 7-33.4 10.5-51.2 10.5-17.8 0-35-3.5-51.2-10.5-15.6-6.8-29.7-16.5-41.8-28.8-12.1-12.3-21.6-26.6-28.2-42.6-6.9-16.5-10.3-34-10.3-52.1s3.5-35.6 10.3-52.1c6.6-15.9 16.1-30.3 28.2-42.6 12.1-12.3 26.1-22 41.8-28.7 16.2-7 33.4-10.5 51.2-10.5 17.8 0 35 3.5 51.2 10.5 11.4 4.9 22 11.4 31.5 19.3-.5 1.5-.8 3.2-.8 4.9 0 8.3 6.6 15.1 14.8 15.1 8.2 0 14.8-6.8 14.8-15.1S249.2 32 241 32c-2 0-4 .4-5.7 1.2C210.5 12.5 178.8.1 144.3.1 65 .2.7 65.6.7 146.4c0 80.8 64.3 146.2 143.6 146.2 44.4 0 84-20.5 110.4-52.7 1.1-1.1 1.8-2.7 1.8-4.4-.1-3.4-2.8-6.1-6.1-6.1z"></path></g></svg><style data-emotion="css 1dhgfy6">.css-1dhgfy6{height:0.7857142857em;margin-top:0.07142857143em;}</style><svg viewBox="0 0 48 16" xmlns="http://www.w3.org/2000/svg" class="css-1dhgfy6 eetev6l0"><path d="M2.564 0h42.192c.892 0 1.215.093 1.54.267.327.174.583.43.757.756.174.326.267.65.267 1.54v10.873c0 .892-.093 1.215-.267 1.54-.174.327-.43.583-.756.757-.326.174-.65.267-1.54.267H2.563c-.892 0-1.215-.093-1.54-.267a1.817 1.817 0 01-.757-.756C.093 14.65 0 14.327 0 13.437V2.563c0-.892.093-1.215.267-1.54.174-.327.43-.583.756-.757C1.35.093 1.673 0 2.563 0z" fill="#ebe6ff"></path><g fill="#3f20ba"><path d="M6.893 4.363c2.299 0 3.894 1.463 3.894 3.663 0 2.222-1.595 3.674-3.883 3.674H4V4.363zm.011 1.375H5.562v4.587h1.331c1.452 0 2.299-1.045 2.299-2.299 0-1.287-.792-2.288-2.288-2.288zM30.477 11.832c1.606 0 2.541-.891 3.058-1.804l-1.342-.649c-.308.594-.968 1.067-1.716 1.067-1.342 0-2.31-1.023-2.31-2.409s.968-2.409 2.31-2.409c.748 0 1.408.473 1.716 1.067l1.342-.66c-.517-.924-1.452-1.793-3.058-1.793-2.211 0-3.916 1.529-3.916 3.795 0 2.255 1.705 3.795 3.916 3.795zM40.388 11.832c1.969 0 2.937-1.012 2.937-2.354 0-2.739-4.213-1.958-4.213-3.113 0-.44.374-.726 1.034-.726.748 0 1.54.253 2.134.803l.869-1.166c-.726-.671-1.694-1.023-2.86-1.023-1.727 0-2.783 1.012-2.783 2.233 0 2.761 4.224 1.87 4.224 3.146 0 .429-.407.814-1.276.814a3.224 3.224 0 01-2.332-1.001l-.858 1.221c.693.693 1.705 1.166 3.124 1.166zM18.715 5.682c1.278 0 2.314 1.061 2.314 2.365 0 1.304-1.036 2.366-2.314 2.366-1.27 0-2.307-1.062-2.307-2.366-.007-1.304 1.03-2.365 2.307-2.365zm0-1.442C16.662 4.24 15 5.944 15 8.047c0 2.104 1.662 3.807 3.715 3.807s3.715-1.703 3.715-3.807c0-2.103-1.662-3.807-3.715-3.807z"></path></g></svg></div></a></div><div class="sidebar"><style data-emotion="css 18y74nd">.css-18y74nd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;margin-bottom:32px;}</style><span class="css-18y74nd efh8xek2"><style data-emotion="css 1ff36h2">.css-1ff36h2{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="css-1ff36h2 efh8xek6"><style data-emotion="css 3lqork">.css-3lqork{width:100%;}.css-3lqork:not(:hover){background-color:#F4F6F8;}</style><style data-emotion-css="y0nxrj">.css-y0nxrj{background-color:transparent;border-radius:4px;border-width:0;color:#3f20ba;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-y0nxrj[disabled],.css-y0nxrj[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-y0nxrj:hover,.css-y0nxrj[data-force-hover-state]{background-color:#ebe6ff;color:#3f20ba;}.css-y0nxrj:focus,.css-y0nxrj[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #311c87,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-y0nxrj:active,.css-y0nxrj[data-force-active-state],.css-y0nxrj[aria-expanded=true]{color:#3f20ba;background-color:#ad9bf6;box-shadow:none;outline:0;}</style><button style="display:flex" class="css-3lqork efh8xek5 css-y0nxrj"><span class="title-sidebar">Apollo Server</span><style data-emotion="css 1fs6g1o">.css-1fs6g1o{height:16px;width:16px;margin-left:auto;}</style><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1fs6g1o efh8xek4 css-1a134qk"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M2.25.747h6a1.5 1.5 0 0 1 1.5 1.5v6a1.5 1.5 0 0 1-1.5 1.5h-6a1.5 1.5 0 0 1-1.5-1.5v-6a1.5 1.5 0 0 1 1.5-1.5zM2.25 14.247h6a1.5 1.5 0 0 1 1.5 1.5v6a1.5 1.5 0 0 1-1.5 1.5h-6a1.5 1.5 0 0 1-1.5-1.5v-6a1.5 1.5 0 0 1 1.5-1.5zM15.75.747h6a1.5 1.5 0 0 1 1.5 1.5v6a1.5 1.5 0 0 1-1.5 1.5h-6a1.5 1.5 0 0 1-1.5-1.5v-6a1.5 1.5 0 0 1 1.5-1.5zM15.75 14.247h6a1.5 1.5 0 0 1 1.5 1.5v6a1.5 1.5 0 0 1-1.5 1.5h-6a1.5 1.5 0 0 1-1.5-1.5v-6a1.5 1.5 0 0 1 1.5-1.5z"></path></g></svg></button></div><style data-emotion="css bjn8wh">.css-bjn8wh{position:relative;}</style><div class="css-bjn8wh e1azhpec6" style="margin-left:8px"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n"><div style="height:20px" class="css-bjn8wh e1azhpec2"><style data-emotion="css 6dhm9o">.css-6dhm9o{visibility:hidden;}</style><div class="css-6dhm9o e1azhpec1">v3</div><div class="css-6dhm9o e1azhpec1">v2</div><style data-emotion="css 14fvduy">.css-14fvduy{position:absolute;top:0;left:0;}</style><div class="css-14fvduy e1azhpec0">v3</div></div><style data-emotion="css jubejm">.css-jubejm{height:1em;width:1em;margin-left:12px;}</style><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-jubejm e1azhpec5 css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg></button></div></span><style data-emotion="css o9l0yd">.css-o9l0yd{margin-left:0;margin-bottom:32px;list-style:none;}</style><ul class="css-o9l0yd ea7mcww6"><style data-emotion="css 1pbhkjy">.css-1pbhkjy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-size:1rem;line-height:1.5;margin-bottom:13px;}.css-1pbhkjy a{color:inherit;-webkit-text-decoration:none;text-decoration:none;padding:3px 10px;margin:-3px -10px;border-radius:4px;}.css-1pbhkjy a:hover{opacity:0.8;}.css-1pbhkjy a.active{color:#3f20ba;pointer-events:none;font-weight:600;background:#F4F6F8;}</style><li class="css-1pbhkjy ea7mcww5"><a href="/">Introduction</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/getting-started/">Get started</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Use the right package for your project" href="/integrations/middleware/">Choosing which package to use</a></li><li class="css-1pbhkjy ea7mcww5"><a href="https://www.apollographql.com/docs/federation/" target="_blank" rel="noopener noreferrer">Apollo Federation<style data-emotion="css 1dl06o9">.css-1dl06o9{height:14px;width:14px;vertical-align:-1px;margin-left:8px;color:#959DAA;}</style><style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:14px" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li></ul><style data-emotion="css 136sss4">.css-136sss4{letter-spacing:0.142em;text-transform:uppercase;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:12px;padding:4px 0;border:0;font-size:12px;font-weight:600;line-height:1;background:none;outline:none;cursor:pointer;color:inherit;}.css-136sss4:hover{opacity:0.8;}.css-136sss4 svg{height:12px;width:12px;margin-right:8px;}</style><button class="css-136sss4 ea7mcww7"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M3.75.748l7.72 7.72a.749.749 0 0 0 1.059.001l.001-.001 7.72-7.72M3.75 23.248l7.72-7.719a.749.749 0 0 1 1.059-.001l.001.001 7.72 7.719"></path></g></svg>Collapse<!-- --> all</button><div><style data-emotion="css 18f7tla">.css-18f7tla{position:relative;z-index:0;}.css-18f7tla .ea7mcww6{position:relative;z-index:2;}</style><div class="css-18f7tla ea7mcww4"><style data-emotion="css 17ml9b3">.css-17ml9b3{height:100%;width:100%;cursor:pointer;position:absolute;top:0;left:0;opacity:0;z-index:1;}.css-17ml9b3:hover~.ea7mcww3{opacity:0.8;}.css-17ml9b3:not(:checked)~ .ea7mcww3 svg{-webkit-transform:scaleY(-1);-moz-transform:scaleY(-1);-ms-transform:scaleY(-1);transform:scaleY(-1);}.css-17ml9b3:not(:checked)~ .ea7mcww6{display:none;}</style><input type="checkbox" value="New in v3" class="css-17ml9b3 ea7mcww1" checked=""/><style data-emotion="css 1q5wncs">.css-1q5wncs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;padding:12px 0;color:#2F353F;font-weight:bold;font-size:14px;line-height:15px;letter-spacing:0.142em;text-transform:uppercase;}.css-1q5wncs svg{height:10px;width:10px;}.css-1q5wncs.active{color:#3f20ba;}</style><div class="active css-1q5wncs ea7mcww3">New in v3<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a aria-current="page" class="active" href="/migration/">Migrating to Apollo Server 3</a></li><li class="css-1pbhkjy ea7mcww5"><a href="https://github.com/apollographql/apollo-server/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer">Changelog<style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:14px" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Defining a Schema" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Defining a Schema<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a href="/schema/schema/">Schema basics</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Abstract schema types" href="/schema/unions-interfaces/">Unions and interfaces</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/schema/custom-scalars/">Custom scalars</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Configure GraphQL types, fields, and arguments" href="/schema/directives/">Directives</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Apply custom logic to GraphQL types, fields, and arguments" href="/schema/creating-directives/">Creating directives</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Fetching Data" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Fetching Data<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a title="How Apollo Server processes GraphQL operations" href="/data/resolvers/">Resolvers</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Manage connections to databases and REST APIs" href="/data/data-sources/">Data sources</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Making errors actionable on the client and server" href="/data/errors/">Error handling</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Enabling file uploads in Apollo Server" href="/data/file-uploads/">File uploads</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Persistent GraphQL read operations" href="/data/subscriptions/">Subscriptions</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Development Workflow" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Development Workflow<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a href="/testing/build-run-queries/">Build and run queries</a></li><li class="css-1pbhkjy ea7mcww5"><a title="How to send requests to Apollo Server over HTTP" href="/requests/">Request format</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Mock your GraphQL data based on a schema." href="/testing/mocking/">Mocking</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Utilities for testing Apollo Server" href="/testing/testing/">Integration testing</a></li><li class="css-1pbhkjy ea7mcww5"><a href="https://www.apollographql.com/docs/studio/explorer/" target="_blank" rel="noopener noreferrer">Apollo Studio Explorer<style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:14px" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Performance" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Performance<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a title="Configure caching behavior on a per-field basis" href="/performance/caching/">Caching</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Improve network performance by sending smaller requests" href="/performance/apq/">Automatic persisted queries</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Security" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Security<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a title="Control access to your GraphQL API" href="/security/authentication/">Auth</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/security/terminating-ssl/">Terminating SSL</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Configuring proxy settings for outgoing requests" href="/proxy-configuration/">Proxy configuration</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Deployment" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Deployment<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a href="/deployment/heroku/">Heroku</a></li><li class="css-1pbhkjy ea7mcww5"><a title="How to deploy Apollo Server with AWS Lambda" href="/deployment/lambda/">Lambda</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Deploying your GraphQL server to Azure Functions" href="/deployment/azure-functions/">Azure Functions</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/deployment/gcp-functions/">Google Cloud Functions</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Monitoring" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Monitoring<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a title="How to monitor Apollo Server&#x27;s performance" href="/monitoring/metrics/">Metrics and logging</a></li><li class="css-1pbhkjy ea7mcww5"><a title="Determining the health status of the Apollo Server" href="/monitoring/health-checks/">Health checks</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="API Reference" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">API Reference<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a href="/api/apollo-server/">ApolloServer</a></li><li class="css-1pbhkjy ea7mcww5"><a href="https://www.apollographql.com/docs/federation/api/apollo-federation/" target="_blank" rel="noopener noreferrer">@apollo/federation<style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:14px" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li><li class="css-1pbhkjy ea7mcww5"><a href="https://www.apollographql.com/docs/federation/api/apollo-gateway/" target="_blank" rel="noopener noreferrer">@apollo/gateway<style data-emotion-css="qic6h7">.css-qic6h7{overflow:visible;height:25px;}.css-qic6h7 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 25 25" style="height:14px" class="css-1dl06o9 ea7mcww0 css-qic6h7"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.141 4.894H3.576A1.977 1.977 0 0 0 1.6 6.871v14.494c0 1.09.885 1.976 1.976 1.976h14.495a1.977 1.977 0 0 0 1.976-1.976V12.8M17.412 1.6h4.94a.99.99 0 0 1 .99.988V7.53m-10.883 4.952L23.05 1.89"></path></svg></a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Built-in Plugins" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Built-in Plugins<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a href="/builtin-plugins/">Overview</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/api/plugin/usage-reporting/">Usage reporting</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/api/plugin/schema-reporting/">Schema reporting</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/api/plugin/inline-trace/">Inline trace</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/api/plugin/drain-http-server/">Drain HTTP server</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/api/plugin/cache-control/">Cache control</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/api/plugin/landing-pages/">Landing pages</a></li></ul></div><div class="css-18f7tla ea7mcww4"><input type="checkbox" value="Custom Plugins" class="css-17ml9b3 ea7mcww1" checked=""/><div class="css-1q5wncs ea7mcww3">Custom Plugins<style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M.75 17.189L11.47 6.47a.749.749 0 0 1 1.059-.001l.001.001 10.72 10.719"></path></svg></div><ul class="css-o9l0yd ea7mcww6"><li class="css-1pbhkjy ea7mcww5"><a title="Extend Apollo Server with custom functionality" href="/integrations/plugins/">Creating plugins</a></li><li class="css-1pbhkjy ea7mcww5"><a href="/integrations/plugins-event-reference/">Event reference</a></li></ul></div></div></div></aside><main class="css-1ff36h2 efh8xek7"><style data-emotion="css 1ip6okp">.css-1ip6okp{position:-webkit-sticky;position:sticky;top:0;left:0;z-index:1;}</style><header class="css-1ip6okp edldhn51"><style data-emotion="css oaxw1r">.css-oaxw1r{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:72px;padding:0 56px;background-color:white;}@media (max-width: 850px){.css-oaxw1r{padding:0 24px;}}</style><div class="css-oaxw1r edldhn50"><style data-emotion="css 8jbk1d">.css-8jbk1d{display:none;}@media (max-width: 850px){.css-8jbk1d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-right:32px;color:#2F353F;}}</style><div class="css-8jbk1d efh8xek3"><style data-emotion="css 1m6zll5">.css-1m6zll5{padding:20px;margin-left:-20px;color:inherit;border:none;background:none;outline:none;cursor:pointer;}</style><button class="css-1m6zll5 e1qf1exz1"><style data-emotion="css 1ihqbbj">.css-1ihqbbj{height:24px;width:24px;display:block;fill:currentColor;}</style><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1ihqbbj e1qf1exz0 css-1a134qk"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M2.25 18.003h19.5M2.25 12.003h19.5M2.25 6.003h19.5"></path></g></svg></button><svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" width="32" fill="currentColor"><path d="M112.246 49H88.003L53 139.848h21.927l5.721-15.393h33.076l-5.989-17.024H85.961l14.164-39.091 25.199 71.508h21.928z"></path><path d="M196.313 73.038a4.991 4.991 0 00-.256-.897c-.027-.1-.12-.285-.12-.285a4.993 4.993 0 00-4.538-2.914 5 5 0 00-5 5c0 .562.098 1.1.268 1.603l-.014.005a90.354 90.354 0 013.346 24.451c0 24.039-9.362 46.641-26.359 63.64-16.999 17-39.6 26.36-63.64 26.36-24.039 0-46.642-9.362-63.639-26.36C19.36 146.642 10 124.04 10 100.001c0-24.04 9.362-46.641 26.361-63.64 16.997-17 39.6-26.36 63.639-26.36 21.466 0 41.781 7.47 57.987 21.173a12.218 12.218 0 00-.848 4.474c0 6.751 5.472 12.221 12.224 12.221 6.75 0 12.223-5.47 12.223-12.221s-5.473-12.224-12.223-12.224c-1.473 0-2.884.26-4.192.737C147.666 9.107 124.9 0 100 0 44.771 0 0 44.772 0 100.001c0 55.229 44.771 100.001 100 100.001s100-44.771 100-100.001c0-9.342-1.291-18.384-3.687-26.963z"></path></svg></div><style data-emotion="css 3gq4g2">.css-3gq4g2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:240px;}@media (max-width: 1120px){.css-3gq4g2{width:auto;margin-right:0;}}@media (max-width: 850px){.css-3gq4g2{display:none;}}</style><div class="css-3gq4g2 e1nk4tvb2"><style data-emotion="css 1aihuhw">.css-1aihuhw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#3f20ba;line-height:2;-webkit-text-decoration:none;text-decoration:none;}.css-1aihuhw:hover{color:#311c87;}</style><a href="https://studio.apollographql.com?referrer=docs" target="_blank" rel="noopener noreferrer" class="css-1aihuhw e1nk4tvb1">Launch Apollo Studio<style data-emotion="css gv5qlm">.css-gv5qlm{height:0.75em;width:0.75em;margin-left:0.5em;}</style><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-gv5qlm e1nk4tvb0 css-1a134qk"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1"><path d="M.75 12h22.5M12.75 1.5L23.25 12l-10.5 10.5"></path></g></svg></a></div></div></header><style data-emotion-css="1r1dph0">html{-webkit-scroll-padding-top:92px;-moz-scroll-padding-top:92px;-ms-scroll-padding-top:92px;scroll-padding-top:92px;}</style><style data-emotion="css ip9jqt">.css-ip9jqt{padding:40px 56px;padding-bottom:0;}@media (max-width: 850px){.css-ip9jqt{padding:32px 48px;}}@media (max-width: 600px){.css-ip9jqt{padding:24px 32px;}}</style><div class="css-ip9jqt ernxcdh2"><div class="header-wrapper"><style data-emotion="css cz947x">.css-cz947x:not(:last-child){margin-bottom:8px;}</style><h1 class="css-cz947x ei8t6h41">Migrating to Apollo Server 3</h1></div><hr/><style data-emotion="css 1o129hd">.css-1o129hd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1o129hd e694h6z7"><style data-emotion="css a181dj">.css-a181dj{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;width:0;}.css-a181dj .api-ref h4 code{font-size:1.1em;}.css-a181dj .api-ref *:not(pre)>code[class*="language-"]{padding:0;background:none;}</style><div class="css-a181dj e694h6z6"><style data-emotion="css nxch3i">.css-nxch3i a[href]:not([class]){color:#3f20ba;-webkit-text-decoration:none;text-decoration:none;}.css-nxch3i a[href]:not([class]):hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-nxch3i a[href]:not([class]) code{color:inherit;}.css-nxch3i h1 code,.css-nxch3i h2 code,.css-nxch3i h3 code,.css-nxch3i h4 code,.css-nxch3i h5 code,.css-nxch3i h6 code{white-space:normal;}.css-nxch3i h1 a,.css-nxch3i h2 a,.css-nxch3i h3 a,.css-nxch3i h4 a,.css-nxch3i h5 a,.css-nxch3i h6 a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-nxch3i h1 a:hover,.css-nxch3i h2 a:hover,.css-nxch3i h3 a:hover,.css-nxch3i h4 a:hover,.css-nxch3i h5 a:hover,.css-nxch3i h6 a:hover{color:#5A6270;}.css-nxch3i *:not(style)+ h2,.css-nxch3i *:not(style)+ h3,.css-nxch3i *:not(style)+ h4,.css-nxch3i *:not(style)+ h5{margin-top:64px;}.css-nxch3i img{display:block;max-width:100%;}.css-nxch3i .mermaid svg{max-width:100%;-webkit-filter:drop-shadow(2px 2px 2px #ddd);filter:drop-shadow(2px 2px 2px #ddd);}.css-nxch3i .three-columns .line-numbers-rows{display:none;}.css-nxch3i .three-columns .gatsby-highlight pre[class*="language-"].line-numbers{padding-left:0;line-height:1.3;}.css-nxch3i .three-columns .gatsby-highlight pre[class*="language-"].line-numbers code{font-size:14px;line-height:1;}</style><div class="content-wrapper css-nxch3i e694h6z5"><p>Apollo Server 3 is generally available.</p><p>The focus of this major-version release is to provide a lighter, nimbler core library as a foundation for future features and improved extensibility.</p><p><strong>Many Apollo Server 2 users don&#x27;t need to make any code changes to upgrade to Apollo Server 3!</strong> This is especially likely if you use the &quot;batteries-included&quot; <code class="language-text">apollo-server</code> library (as opposed to a <a href="/integrations/middleware/">middleware-specific library</a>).</p><p>This document explains which features <em>do</em> require code changes and how to make them. If you encounter issues while migrating, please <a href="https://github.com/apollographql/apollo-server/issues/new/choose" target="_blank" rel="noopener noreferrer">create an issue</a>.</p><blockquote><p>For a list of all breaking changes, <a href="https://github.com/apollographql/apollo-server/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer">see the changelog</a>.</p></blockquote><h2 id="bumped-dependencies" style="position:relative"><a class="headingLink" href="#bumped-dependencies">Bumped dependencies</a></h2><h3 id="nodejs" style="position:relative"><a class="headingLink" href="#nodejs">Node.js</a></h3><p><strong>Apollo Server 3 supports Node.js 12 and later.</strong> (Apollo Server 2 supports back to Node.js 6.) This includes <a href="https://nodejs.org/about/releases/" target="_blank" rel="noopener noreferrer">all LTS and Current versions at the time of release</a>.</p><p>If you&#x27;re using an older version of Node.js, upgrade your runtime before upgrading to Apollo Server 3.</p><h3 id="graphql" style="position:relative"><a class="headingLink" href="#graphql"><code class="language-text">graphql</code></a></h3><p>Apollo Server has a peer dependency on <a href="https://www.npmjs.com/package/graphql" target="_blank" rel="noopener noreferrer"><code class="language-text">graphql</code></a> (the core JS GraphQL implementation), which means you are responsible for choosing the version installed in your app.</p><p><strong>Apollo Server 3 supports <code class="language-text">graphql</code> v15.3.0 and later.</strong> (Apollo Server 2 supported <code class="language-text">graphql</code> v0.12 through v15.)</p><p>If you&#x27;re using an older version of <code class="language-text">graphql</code>, upgrade it to a supported version before upgrading to Apollo Server 3.</p><h2 id="removed-integrations" style="position:relative"><a class="headingLink" href="#removed-integrations">Removed integrations</a></h2><p>Apollo Server 2 provides built-in support for subscriptions and file uploads via the <code class="language-text">subscriptions-transport-ws</code> and <code class="language-text">graphql-upload</code> packages, respectively. It also serves GraphQL Playground from its base URL by default.</p><p>Apollo Server 3 removes these built-in integrations, in favor of enabling users to provide their own mechanisms for these features.</p><p>You can reenable all of these integrations as they exist in Apollo Server 2.</p><h3 id="subscriptions" style="position:relative"><a class="headingLink" href="#subscriptions">Subscriptions</a></h3><p>Apollo Server 2 provides limited, built-in support for WebSocket-based GraphQL subscriptions via the <code class="language-text">subscriptions-transport-ws</code> package. This integration doesn&#x27;t work with Apollo Server&#x27;s plugin system or Apollo Studio usage reporting.</p><p>Apollo Server 3 no longer contains this built-in integration. However, you can still use <code class="language-text">subscriptions-transport-ws</code> for subscriptions if you depend on this implementation. Note that as with Apollo Server 2, this integration won&#x27;t work with the plugin system or Studio usage reporting.</p><p>Additionally, Apollo Server 3 <a href="#exports-from-graphql-subscriptions">no longer re-exports all of the exports from the <code class="language-text">graphql-subscriptions</code> package</a> such as <code class="language-text">PubSub</code>.</p><p>We hope to add more fully-integrated subscription support to Apollo Server in a future version.</p><blockquote><p>Note that the <code class="language-text">subscriptions-transport-ws</code> library is no longer maintained. A newer, actively-maintained <code class="language-text">graphql-ws</code> package exists. These libraries implement different protocols for GraphQL subscriptions over WebSocket, so you need to adjust your client to support <code class="language-text">graphql-ws</code>. This migration guide shows how to reenable <code class="language-text">subscriptions-transport-ws</code> to make your transition from Apollo Server 2 to Apollo Server 3 as easy as possible, but we recommend that you then migrate from <code class="language-text">subscriptions-transport-ws</code> to <code class="language-text">graphql-ws</code> once you&#x27;ve finished the upgrade. The <a href="/data/subscriptions/">subscriptions documentation</a> shows how to use the newer <code class="language-text">graphql-ws</code> rather than the unmaintained <code class="language-text">subscriptions-transport-ws</code>.</p></blockquote><h4 id="reenabling-subscriptions" style="position:relative"><a class="headingLink" href="#reenabling-subscriptions">Reenabling subscriptions</a></h4><blockquote><p>Currently, these instructions are only for Apollo Server&#x27;s Express integration. It is likely possible to integrate <code class="language-text">subscriptions-transport-ws</code> with other integrations. PRs to this migration guide are certainly welcome!</p></blockquote><p>In Apollo Server 3, you can&#x27;t use <code class="language-text">subscriptions-transport-ws</code> with the &quot;batteries-included&quot; <code class="language-text">apollo-server</code> package. If your project uses <code class="language-text">apollo-server</code> with subscriptions, first <a href="/integrations/middleware/#swapping-out-apollo-server">swap to <code class="language-text">apollo-server-express</code></a>.</p><p>Then, complete the following:</p><ol><li><p>Install <code class="language-text">subscriptions-transport-ws</code> and <code class="language-text">@graphql-tools/schema</code>.</p><div class="gatsby-highlight" data-language="shell"><style data-emotion="css 1gcd36t">.css-1gcd36t{margin-bottom:1.45rem;border:1px solid #DEE2E7;border-radius:4px;}</style><div class="css-1gcd36t e1ulzjg73"><style data-emotion="css 1y4makq">.css-1y4makq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;padding:4px;border-bottom:1px solid #DEE2E7;}</style><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><style data-emotion="css r8v8pb">.css-r8v8pb{padding:15px;background-color:#F4F6F8;overflow:auto;}</style><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-shell line-numbers"><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> subscriptions-transport-ws @graphql-tools/schema</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div></li><li><p>Add the following imports in the module where your Apollo Server is currently instantiated. We&#x27;ll use these in the subsequent steps.</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> createServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;http&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> execute<span class="token punctuation">,</span> subscribe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> SubscriptionServer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;subscriptions-transport-ws&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> makeExecutableSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@graphql-tools/schema&#x27;</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span></span></pre></div></div></div></li><li><p>Create an <code class="language-text">http.Server</code> instance with your Express <code class="language-text">app</code>.</p><p>In order to set up both the HTTP and WebSocket servers, we&#x27;ll need to create an <code class="language-text">http.Server</code>. Do this by passing your Express <code class="language-text">app</code> to the <code class="language-text">createServer</code> function which we imported from the Node.js <code class="language-text">http</code> module.</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// This `app` is the returned value from `express()`.</span>
<span class="token keyword">const</span> httpServer <span class="token operator">=</span> <span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span></span></pre></div></div></div></li><li><p>Create an instance of <code class="language-text">GraphQLSchema</code> (if one doesn&#x27;t already exist).</p><blockquote><p>Your server may already pass a <code class="language-text">schema</code> to the <code class="language-text">ApolloServer</code> constructor. If it does, this step can be skipped. You&#x27;ll use the existing <code class="language-text">schema</code> instance in a later step.</p></blockquote><p>The <code class="language-text">SubscriptionServer</code> (which we&#x27;ll instantiate next) doesn&#x27;t accept <code class="language-text">typeDefs</code> and <code class="language-text">resolvers</code> directly, but rather an executable <code class="language-text">GraphQLSchema</code>. We can pass this <code class="language-text">schema</code> object to both the <code class="language-text">SubscriptionServer</code> and <code class="language-text">ApolloServer</code>. This way, it&#x27;s clear that the same schema is being used in both places.</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token function">makeExecutableSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  schema<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div></li><li><p>Create the <code class="language-text">SubscriptionServer</code>.</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> subscriptionServer <span class="token operator">=</span> SubscriptionServer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// This is the `schema` we just created.</span>
  schema<span class="token punctuation">,</span>
  <span class="token comment">// These are imported from `graphql`.</span>
  execute<span class="token punctuation">,</span>
  subscribe<span class="token punctuation">,</span>
  <span class="token comment">// Providing `onConnect` is the `SubscriptionServer` equivalent to the</span>
  <span class="token comment">// `context` function in `ApolloServer`. Please [see the docs](https://github.com/apollographql/subscriptions-transport-ws#constructoroptions-socketoptions--socketserver)</span>
  <span class="token comment">// for more information on this hook.</span>
  <span class="token keyword">async</span> <span class="token function">onConnect</span><span class="token punctuation">(</span>
    <span class="token parameter"><span class="token literal-property property">connectionParams</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
    <span class="token literal-property property">webSocket</span><span class="token operator">:</span> WebSocket<span class="token punctuation">,</span>
    <span class="token literal-property property">context</span><span class="token operator">:</span> ConnectionContext</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If an object is returned here, it will be passed as the `context`</span>
    <span class="token comment">// argument to your subscription resolvers.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// This is the `httpServer` we created in a previous step.</span>
  <span class="token literal-property property">server</span><span class="token operator">:</span> httpServer<span class="token punctuation">,</span>
  <span class="token comment">// This `server` is the instance returned from `new ApolloServer`.</span>
  <span class="token literal-property property">path</span><span class="token operator">:</span> server<span class="token punctuation">.</span>graphqlPath<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div></li><li><p>Add a plugin to your <code class="language-text">ApolloServer</code> constructor to close the <code class="language-text">SubscriptionServer</code>.</p><div class="gatsby-code-title">index.js-10</div><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  schema<span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">serverWillStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token keyword">async</span> <span class="token function">drainServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          subscriptionServer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div></li><li><p>Finally, adjust the existing <code class="language-text">listen</code>.</p><p>Most applications will be calling <code class="language-text">app.listen(...)</code> on their Express app. <strong>This should be changed to <code class="language-text">httpServer.listen(...)</code></strong> using the same arguments. This will begin listening on the HTTP and WebSocket transports simultaneously.</p></li></ol><p>A completed example of migrating subscriptions is shown below:</p><style data-emotion="css 19ru0l8">.css-19ru0l8{margin-bottom:1.45rem;border-left:2px solid #3f20ba;}</style><div class="css-19ru0l8 e1yz1yf66"><style data-emotion="css 18j0rgo">.css-18j0rgo{border:1px solid #CAD0D8;border-left:0;border-top-right-radius:4px;border-bottom-right-radius:4px;}</style><div class="css-18j0rgo e1yz1yf65"><style data-emotion="css mt7589">.css-mt7589{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:100%;padding:12px 16px;border:0;font-size:16px;color:#3f20ba;line-height:calc(5/3);text-align:left;background:none;outline:none;cursor:pointer;}.css-mt7589:hover{background-color:rgba(0,0,0,0.05);}.css-mt7589:active{background-color:rgba(0,0,0,0.1);}.css-mt7589 svg{height:14px;width:14px;margin-right:12px;}</style><button class="css-mt7589 e1yz1yf64"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M23.25 7.311L12.53 18.03a.749.749 0 0 1-1.059.001l-.001-.001L.75 7.311"></path></svg>Click to expand</button></div></div><h3 id="file-uploads" style="position:relative"><a class="headingLink" href="#file-uploads">File uploads</a></h3><p>Apollo Server 2 provides built-in support for file uploads via an outdated version of the <code class="language-text">graphql-upload</code> library. Using an updated version of <code class="language-text">graphql-upload</code> requires you to disable this built-in support due to backward incompatible changes.</p><p>This built-in support is removed in Apollo Server 3. To use <code class="language-text">graphql-upload</code>, you can choose an appropriate version and integrate it yourself. Note that <code class="language-text">graphql-upload</code> does not support federation or every <a href="/integrations/middleware/">Node.js framework</a> supported by Apollo Server.</p><p>To use <code class="language-text">graphql-upload</code> with Apollo Server 3, see the <a href="/data/file-uploads/">documentation on enabling file uploads in Apollo Server</a>. Note that if your project currently uses uploads with the &quot;batteries-included&quot; <code class="language-text">apollo-server</code> package, you must first <a href="/integrations/middleware/#swapping-out-apollo-server">swap to <code class="language-text">apollo-server-express</code></a>.</p><p>Additionally, Apollo Server 3 <a href="#exports-from-graphql-upload">no longer re-exports the <code class="language-text">GraphQLUpload</code> symbol from the <code class="language-text">graphql-uploads</code> package</a>.</p><h3 id="graphql-playground" style="position:relative"><a class="headingLink" href="#graphql-playground">GraphQL Playground</a></h3><p>By default, Apollo Server 2 serves the (now-<a href="https://github.com/graphql/graphql-playground/issues/1143" target="_blank" rel="noopener noreferrer">retired</a>) <a href="https://github.com/graphql/graphql-playground" target="_blank" rel="noopener noreferrer">GraphQL Playground</a> IDE from its base URL in non-production environments. In production, it serves no landing page. Apollo Server 2 also accepts a <code class="language-text">playground</code> constructor option to override this default behavior (for example, to enable GraphQL Playground even in production).</p><p>Apollo Server 3 removes GraphQL Playground (and its associated constructor option) in favor of a landing page that links to Apollo Sandbox in non-production environments. In production, it serves a simplified landing page instead.</p><p>You can customize your Apollo Server 3 landing page, as described in <a href="/testing/build-run-queries/">Build and run queries</a>.</p><h4 id="reenabling-graphql-playground" style="position:relative"><a class="headingLink" href="#reenabling-graphql-playground">Reenabling GraphQL Playground</a></h4><p>You can continue to use GraphQL Playground by installing its associated plugin. You customize its behavior by passing options to the plugin instead of via the <code class="language-text">playground</code> constructor option.</p><p>If your code did not specify the <code class="language-text">playground</code> constructor option and you&#x27;d like to keep the previous behavior instead of trying the new splash page, you can do that as follows:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginLandingPageGraphQLPlayground<span class="token punctuation">,</span>
         ApolloServerPluginLandingPageDisabled <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#x27;production&#x27;</span>
      <span class="token operator">?</span> <span class="token function">ApolloServerPluginLandingPageDisabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">ApolloServerPluginLandingPageGraphQLPlayground</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>If your code passed <code class="language-text">new ApolloServer({playground: true})</code>, you can keep the previous behavior with:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginLandingPageGraphQLPlayground <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ApolloServerPluginLandingPageGraphQLPlayground</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>If your code passed <code class="language-text">new ApolloServer({playground: false})</code> you can keep the previous behavior with:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginLandingPageDisabled <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ApolloServerPluginLandingPageDisabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>If your code passed an options object like <code class="language-text">new ApolloServer({playground: playgroundOptions})</code>, you can keep the previous behavior with:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginLandingPageGraphQLPlayground <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ApolloServerPluginLandingPageGraphQLPlayground</span><span class="token punctuation">(</span>playgroundOptions<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h4 id="additional-changes-to-graphql-playground" style="position:relative"><a class="headingLink" href="#additional-changes-to-graphql-playground">Additional changes to GraphQL Playground</a></h4><h5 id="specifying-an-endpoint" style="position:relative"><a class="headingLink" href="#specifying-an-endpoint">Specifying an <code class="language-text">endpoint</code></a></h5><p>In Apollo Server 2, the default value of GraphQL Playground&#x27;s <code class="language-text">endpoint</code> option is determined in different ways by different Node.js framework integrations. In many cases, it&#x27;s necessary to manually specify <code class="language-text">playground: {endpoint}</code>.</p><p>In Apollo Server 3, the default endpoint used by GraphQL Playground is the browser&#x27;s current URL. In many cases, this means that you don&#x27;t have to specify <code class="language-text">endpoint</code> anymore. If your Apollo Server 2 app specified <code class="language-text">playground: {endpoint}</code> (and you wish to continue using GraphQL Playground), try removing <code class="language-text">endpoint</code> from the options passed to <code class="language-text">ApolloServerPluginLandingPageGraphQLPlayground</code> and see if it works for you.</p><h5 id="specifying-settings" style="position:relative"><a class="headingLink" href="#specifying-settings">Specifying <code class="language-text">settings</code></a></h5><p>In Apollo Server 2, the behavior of the <code class="language-text">settings</code> GraphQL Playground option can be surprising. If you don&#x27;t explicitly pass <code class="language-text">{playground: {settings: {...}}}</code> then GraphQL Playground always uses settings that are built into its React application (some of which can be adjusted by the user in their browser). However, if you pass <em>any object</em> as <code class="language-text">playground: {settings: {...}}</code>, <a href="https://github.com/apollographql/apollo-server/blob/70a431212bd2d07d68c962cb5ded63ecc6a21963/packages/apollo-server-core/src/playground.ts#L38-L46" target="_blank" rel="noopener noreferrer">several default value overrides</a> take effect.</p><p>This surprising behavior is removed in Apollo Server 3. All <code class="language-text">settings</code> use default values from the GraphQL Playground React app if they aren&#x27;t specified in the <code class="language-text">settings</code> option to <code class="language-text">ApolloServerPluginLandingPageGraphQLPlayground</code>.</p><p>If your app does pass in <code class="language-text">playground: {settings: {...}}</code> and you want to make sure the settings used in your GraphQL Playground do not change, you should copy any relevant settings from <a href="https://github.com/apollographql/apollo-server/blob/70a431212bd2d07d68c962cb5ded63ecc6a21963/packages/apollo-server-core/src/playground.ts#L38-L46" target="_blank" rel="noopener noreferrer">the Apollo Server 2 code</a> into your app.</p><p>For example, you could replace:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">playground</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string-property property">&#x27;some.setting&#x27;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>with:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginLandingPageGraphQLPlayground <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ApolloServerPluginLandingPageGraphQLPlayground</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&#x27;some.setting&#x27;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;general.betaUpdates&#x27;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;editor.theme&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;dark&#x27;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;editor.cursorShape&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;line&#x27;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;editor.reuseHeaders&#x27;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;tracing.hideTracingResponse&#x27;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;queryPlan.hideQueryPlanResponse&#x27;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;editor.fontSize&#x27;</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;editor.fontFamily&#x27;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&#x27;Source Code Pro&#x27;, &#x27;Consolas&#x27;, &#x27;Inconsolata&#x27;, &#x27;Droid Sans Mono&#x27;, &#x27;Monaco&#x27;, monospace</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token string-property property">&#x27;request.credentials&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;omit&#x27;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h2 id="removed-constructor-options" style="position:relative"><a class="headingLink" href="#removed-constructor-options">Removed constructor options</a></h2><p>The following <code class="language-text">ApolloServer</code> constructor options have been removed in favor of other features or configuration methods.</p><h3 id="extensions" style="position:relative"><a class="headingLink" href="#extensions"><code class="language-text">extensions</code></a></h3><p>Apollo Server 3 removes support for the <code class="language-text">graphql-extensions</code> API, which was used to extend Apollo Server&#x27;s functionality. This API has numerous limitations relative to the <a href="/integrations/plugins/">plugins API</a> introduced in Apollo Server v2.2.0.</p><p>Unlike <code class="language-text">graphql-extensions</code>, the plugins API enables cross-request state, and its hooks virtually all interact with the same <code class="language-text">GraphQLRequestContext</code> object.</p><p>If you&#x27;ve written your own extensions (passed to <code class="language-text">new ApolloServer({extensions: ...})</code>), you should <a href="/integrations/plugins/">rewrite them as plugins</a> before upgrading to Apollo Server 3.</p><h3 id="engine" style="position:relative"><a class="headingLink" href="#engine"><code class="language-text">engine</code></a></h3><p>&quot;Engine&quot; is a previous name of <a href="https://www.apollographql.com/docs/studio/">Apollo Studio</a>. Prior to Apollo Server v2.18.0, you passed the <code class="language-text">engine</code> constructor option to configure how Apollo Server communicates with Studio. Additionally, you could specifying your Apollo API key with the <code class="language-text">ENGINE_API_KEY</code> environment variable, and you could specify a graph variant with the <code class="language-text">ENGINE_SCHEMA_TAG</code> environment variable.</p><p>In later versions of Apollo Server (including Apollo Server 3), you instead provide this configuration via a combination of the <code class="language-text">apollo</code> constructor option, plugins, and <code class="language-text">APOLLO_</code>-prefixed environment variables. Apollo Server 3 does not support the <code class="language-text">engine</code> constructor option or the <code class="language-text">ENGINE_</code>-prefixed environment variables.</p><p>If your project still uses the <code class="language-text">engine</code> option or the <code class="language-text">ENGINE_</code>-prefixed environment variables, see <a href="/v2/migration-engine-plugins/">Migrating from the <code class="language-text">engine</code> option</a> before upgrading to Apollo Server 3.</p><p>Note that if you are using Studio, make sure to <a href="#guessing-apollo-studio-graph-id-from-api-key">set your graph ref or graph ID</a>.</p><h3 id="schemadirectives" style="position:relative"><a class="headingLink" href="#schemadirectives"><code class="language-text">schemaDirectives</code></a></h3><p>In Apollo Server 2, you can pass <code class="language-text">schemaDirectives</code> to <code class="language-text">new ApolloServer</code> alongside <code class="language-text">typeDefs</code> and <code class="language-text">resolvers</code>. These arguments are all passed through to the <a href="https://www.graphql-tools.com/docs/generate-schema/#makeexecutableschemaoptions" target="_blank" rel="noopener noreferrer"><code class="language-text">makeExecutableSchema</code> function</a>  from the <code class="language-text">graphql-tools</code> package.</p><p>The <code class="language-text">graphql-tools</code> project deprecated the  <a href="https://github.com/ardatan/graphql-tools/blob/%40graphql-tools/schema%407.1.5/website/docs/legacy-schema-directives.md" target="_blank" rel="noopener noreferrer"><code class="language-text">schemaDirectives</code> feature</a> and removed it in v8 of <code class="language-text">@graphql-tools/schema</code>.</p><p>In Apollo Server 3, the <code class="language-text">ApolloServer</code> constructor now only passes <code class="language-text">typeDefs</code>, <code class="language-text">resolvers</code>, and <code class="language-text">parseOptions</code> through to <code class="language-text">makeExecutableSchema</code>.</p><p>If you would like to still use <code class="language-text">schemaDirectives</code>, you can install an older version of <code class="language-text">@graphql-tools/schema</code> yourself with <code class="language-text">npm install @graphql-tools/schema@7</code> and call <code class="language-text">makeExecutableSchema</code> yourself and pass its returned schema as the <code class="language-text">schema</code> constructor option.</p><p>That is, you can replace:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  typeDefs<span class="token punctuation">,</span>
  resolvers<span class="token punctuation">,</span>
  schemaDirectives<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>with:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// Make sure you are using v7, not anything newer!</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> makeExecutableSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@graphql-tools/schema&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">schema</span><span class="token operator">:</span> <span class="token function">makeExecutableSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    typeDefs<span class="token punctuation">,</span>
    resolvers<span class="token punctuation">,</span>
    schemaDirectives<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>This can help you with the initial migration to Apollo Server 3. As <code class="language-text">schemaDirectives</code> is no longer part of the actively maintained version of <code class="language-text">@graphql-tools/schema</code>, we recommend that once you&#x27;ve successfully migrated to Apollo Server 3, you then port your schema directive to the <a href="https://www.graphql-tools.com/docs/schema-directives" target="_blank" rel="noopener noreferrer">newer schema directives API</a> which uses the <code class="language-text">mapSchema</code> function in <code class="language-text">@graphql-tools/utils</code>.</p><blockquote><p>In Apollo Server 2, there are subtle differences between providing a schema with <code class="language-text">schema</code> versus providing it with <code class="language-text">typeDefs</code> and <code class="language-text">resolvers</code>. For example, the automatic definition of the <code class="language-text">@cacheControl</code> directive is added only in the latter case. These differences are removed in Apollo Server 3 (for example, the definition of the <code class="language-text">@cacheControl</code> directive is <em>never</em> automatically added).</p></blockquote><h3 id="tracing" style="position:relative"><a class="headingLink" href="#tracing"><code class="language-text">tracing</code></a></h3><p>In Apollo Server 2, the <code class="language-text">tracing</code> constructor option enables a trace mechanism implemented in the <code class="language-text">apollo-tracing</code> package. This package uses a comparatively inefficient JSON format for execution traces returned via the <code class="language-text">tracing</code> GraphQL response extension. The format is consumed only by the deprecated <code class="language-text">engineproxy</code> and GraphQL Playground. It is <em>not</em> the tracing format used for Apollo Studio usage reporting or federated inline traces.</p><p>The <code class="language-text">tracing</code> constructor option is removed in Apollo Server 3. The <code class="language-text">apollo-tracing</code> package has been deprecated and is no longer being published.</p><p>If you rely on this deprecated trace format, you might be able to use the old version of <code class="language-text">apollo-server-tracing</code> directly:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;apollo-tracing&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><blockquote><p>This workaround has not been tested! If you need this to work and it doesn&#x27;t, please file an issue and we will investigate a fix to enable support in Apollo Server 3.</p></blockquote><h3 id="cachecontrol" style="position:relative"><a class="headingLink" href="#cachecontrol"><code class="language-text">cacheControl</code></a></h3><p>In Apollo Server 2, <a href="/performance/caching/">cache policy support</a> is configured via the <code class="language-text">cacheControl</code> constructor option. There are several improvements to the semantics of cache policies in Apollo Server 3, as well as changes to how caching is configured.</p><p>The <code class="language-text">cacheControl</code> constructor option is removed in Apollo Server 3. To customize cache control, you instead manually install the <a href="/api/plugin/cache-control/">cache control plugin</a> and provide custom options to it.</p><p>For example, if you currently provide <code class="language-text">defaultMaxAge</code> and/or <code class="language-text">calculateHttpHeaders</code> to <code class="language-text">cacheControl</code> like so:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">cacheControl</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    defaultMaxAge<span class="token punctuation">,</span>
    calculateHttpHeaders<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>You now provide them like so:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginCacheControl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ApolloServerPluginCacheControl</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      defaultMaxAge<span class="token punctuation">,</span>
      calculateHttpHeaders<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>If you currently pass <code class="language-text">cacheControl: false</code> like so:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">cacheControl</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span></span></pre></div></div></div><p>You now install the disabling plugin like so:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> ApolloServerPluginCacheControlDisabled <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;apollo-server-core&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ApolloServerPluginCacheControlDisabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>In Apollo Server 2, <code class="language-text">cacheControl: true</code> was a shorthand for setting <code class="language-text">cacheControl: {stripFormattedExtensions: false, calculateHttpHeaders: false}</code>. If you either passed <code class="language-text">cacheControl: true</code> or explicitly passed <code class="language-text">stripFormattedExtensions: false</code>, Apollo Server 2 would include a <code class="language-text">cacheControl</code> response extension inside your GraphQL response. This was used by the deprecated <code class="language-text">engineproxy</code> server. Support for writing this response extension has been removed from Apollo Server 2. This allows for a more memory-efficient cache control plugin implementation.</p><p>In Apollo Server 2, definitions of the <code class="language-text">@cacheControl</code> directive (and the <code class="language-text">CacheControlScope</code> enum that it uses) were sometimes automatically inserted into your schema. (Specifically, they were added if you defined your schema with the <code class="language-text">typeDefs</code> and <code class="language-text">resolvers</code> options, but not if you used the <code class="language-text">modules</code> or <code class="language-text">schema</code> options or if you were a federated gateway. Passing <code class="language-text">cacheControl: false</code> did not stop the definitions from being inserted!) In Apollo Server 3, these definitions are never automatically inserted.</p><p>So <strong>if you use the <code class="language-text">@cacheControl</code> directive in your schema, you should add these definitions to your schema</strong>:</p><div class="gatsby-highlight" data-language="graphql"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-graphql line-numbers"><code class="language-graphql"><span class="token keyword">enum</span> <span class="token class-name">CacheControlScope</span> <span class="token punctuation">{</span>
  <span class="token constant">PUBLIC</span>
  <span class="token constant">PRIVATE</span>
<span class="token punctuation">}</span>

<span class="token keyword">directive</span> <span class="token directive function">@cacheControl</span><span class="token punctuation">(</span>
  <span class="token attr-name">maxAge</span><span class="token punctuation">:</span> <span class="token scalar">Int</span>
  <span class="token attr-name">scope</span><span class="token punctuation">:</span> <span class="token class-name">CacheControlScope</span>
  <span class="token attr-name">inheritMaxAge</span><span class="token punctuation">:</span> <span class="token scalar">Boolean</span>
<span class="token punctuation">)</span> <span class="token keyword">on</span> <span class="token constant">FIELD_DEFINITION</span> <span class="token operator">|</span> <span class="token constant">OBJECT</span> <span class="token operator">|</span> <span class="token constant">INTERFACE</span> <span class="token operator">|</span> <span class="token constant">UNION</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>(You may add them to your schema in Apollo Server 2 before upgrading if you&#x27;d like.)</p><p>In Apollo Server 2, plugins that want to change the operation&#x27;s overall cache policy can overwrite the field <code class="language-text">requestContext.overallCachePolicy</code>. In Apollo Server 3, that field is considered read-only, but it does have new methods to mutate its state. So you should replace:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript">requestContext<span class="token punctuation">.</span>overallCachePolicy <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>with:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript">requestContext<span class="token punctuation">.</span>overallCachePolicy<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>(You may also want to consider using <code class="language-text">restrict</code> instead of <code class="language-text">replace</code>; this method only allows <code class="language-text">maxAge</code> to be reduced and only allows <code class="language-text">scope</code> to change from <code class="language-text">PUBLIC</code> to <code class="language-text">PRIVATE</code>.)</p><p>In Apollo Server 2, fields returning a union type are treated similarly to fields returning a scalar type: <code class="language-text">@cacheControl</code> on the type itself is ignored, and <code class="language-text">maxAge</code> if unspecified is inherited from its parent in the operation (unless it is a root field) instead of defaulting to <code class="language-text">defaultMaxAge</code> (which itself defaults to 0). In Apollo Server 3, fields returning a union type are treated similarly to fields returning an interface or object type: <code class="language-text">@cacheControl</code> on the type itself is honored, and <code class="language-text">maxAge</code> if unspecified defaults to <code class="language-text">defaultMaxAge</code>. If you were relying on the inheritance behavior, you can specify <code class="language-text">@cacheControl(maxAge: ...)</code> explicitly on your union types or union-returning fields, or you can use the new <code class="language-text">@cacheControl(inheritMaxAge: true)</code> feature on the union-returning field to restore the Apollo Server 2 behavior. If your schema contained <code class="language-text">union SomeUnion @cacheControl(...)</code>, that directive will start having an effect when you upgrade to Apollo Server 3.</p><p>In Apollo Server 2, the <code class="language-text">@cacheControl</code> is honored on type definitions but not on type extensions. That is, if you write <code class="language-text">type SomeType @cacheControl(maxAge: 123)</code> it takes effect but if you write <code class="language-text">extend type SomeType @cacheControl(maxAge: 123)</code> it does not take effect. In Apollo Server 3, <code class="language-text">@cacheControl</code> is honored on object, interface, and union extensions. If your schema accidentally contained <code class="language-text">@cacheControl</code> on an <code class="language-text">extend</code>, that directive will start having an effect when you upgrade to Apollo Server 3.</p><p>In Apollo Server 2, most of the logic related to cache control lives in the <code class="language-text">apollo-cache-control</code> package. This package exports a function called <code class="language-text">plugin</code> as well as TypeScript types <code class="language-text">CacheControlFormat</code>, <code class="language-text">CacheHint</code>, <code class="language-text">CacheScope</code>, and <code class="language-text">CacheControlExtensionOptions</code>. In Apollo Server 3, this logic lives in <code class="language-text">apollo-server-core</code> and the <code class="language-text">apollo-cache-control</code> package is no longer published. <code class="language-text">apollo-server-core</code> exports <code class="language-text">ApolloServerPluginCacheControl</code> and <code class="language-text">ApolloServerPluginCacheControlOptions</code> (which are similar to <code class="language-text">plugin</code> and <code class="language-text">CacheControlExtensionOptions</code>). <code class="language-text">apollo-server-types</code> exports <code class="language-text">CacheHint</code> and <code class="language-text">CacheScope</code>. There is no equivalent export to <code class="language-text">CacheControlFormat</code> because as described above, the code to write the <code class="language-text">cacheControl</code> response extension is not part of Apollo Server 3.</p><h3 id="playground" style="position:relative"><a class="headingLink" href="#playground"><code class="language-text">playground</code></a></h3><p>See <a href="#graphql-playground">GraphQL Playground</a>.</p><h2 id="removed-exports" style="position:relative"><a class="headingLink" href="#removed-exports">Removed exports</a></h2><p>In Apollo Server 2, <code class="language-text">apollo-server</code> and framework integration packages such as <code class="language-text">apollo-server-express</code> import many symbols from third-party packages and re-export them. This effectively ties the API of Apollo Server to a specific version of those third-party packages and makes it challenging to upgrade to a newer version or for you to upgrade those packages yourself.</p><p>In Apollo Server 3, most of these &quot;re-exports&quot; are removed. If you want to use these exports, you should import them directly from their originating package.</p><h3 id="exports-from-graphql-tools" style="position:relative"><a class="headingLink" href="#exports-from-graphql-tools">Exports from <code class="language-text">graphql-tools</code></a></h3><p>Apollo Server 2 exports every symbol exported by <a href="https://www.graphql-tools.com/" target="_blank" rel="noopener noreferrer"><code class="language-text">graphql-tools</code></a> v4. If you&#x27;re importing any of the following symbols from an Apollo Server package, you should instead run <code class="language-text">npm install graphql-tools@4.x</code> and import the symbol from <code class="language-text">graphql-tools</code>.</p><blockquote><p>Alternatively, read the <a href="https://www.graphql-tools.com/docs/introduction" target="_blank" rel="noopener noreferrer">GraphQL Tools docs</a> and find out which <code class="language-text">@graphql-tools/subpackage</code> the symbol is exported from in more modern versions of GraphQL Tools.</p></blockquote><ul><li><code class="language-text">AddArgumentsAsVariables</code></li><li><code class="language-text">AddTypenameToAbstract</code></li><li><code class="language-text">CheckResultAndHandleErrors</code></li><li><code class="language-text">DirectiveResolverFn</code></li><li><code class="language-text">ExpandAbstractTypes</code></li><li><code class="language-text">ExtractField</code></li><li><code class="language-text">FilterRootFields</code></li><li><code class="language-text">FilterToSchema</code></li><li><code class="language-text">FilterTypes</code></li><li><code class="language-text">GraphQLParseOptions</code></li><li><code class="language-text">IAddResolveFunctionsToSchemaOptions</code></li><li><code class="language-text">IConnectorCls</code></li><li><code class="language-text">IConnectorFn</code></li><li><code class="language-text">IConnector</code></li><li><code class="language-text">IConnectors</code></li><li><code class="language-text">IDelegateToSchemaOptions</code></li><li><code class="language-text">IDirectiveResolvers</code></li><li><code class="language-text">IEnumResolver</code></li><li><code class="language-text">IExecutableSchemaDefinition</code></li><li><code class="language-text">IFieldIteratorFn</code></li><li><code class="language-text">IFieldResolver</code></li><li><code class="language-text">IGraphQLToolsResolveInfo</code></li><li><code class="language-text">ILogger</code></li><li><code class="language-text">IMockFn</code></li><li><code class="language-text">IMockOptions</code></li><li><code class="language-text">IMockServer</code></li><li><code class="language-text">IMockTypeFn</code></li><li><code class="language-text">IMocks</code></li><li><code class="language-text">IResolverObject</code></li><li><code class="language-text">IResolverOptions</code></li><li><code class="language-text">IResolverValidationOptions</code></li><li><code class="language-text">IResolversParameter</code></li><li><code class="language-text">IResolvers</code></li><li><code class="language-text">ITypeDefinitions</code></li><li><code class="language-text">ITypedef</code></li><li><code class="language-text">MergeInfo</code></li><li><code class="language-text">MergeTypeCandidate</code></li><li><code class="language-text">MockList</code></li><li><code class="language-text">NextResolverFn</code></li><li><code class="language-text">Operation</code></li><li><code class="language-text">RenameRootFields</code></li><li><code class="language-text">RenameTypes</code></li><li><code class="language-text">ReplaceFieldWithFragment</code></li><li><code class="language-text">Request</code></li><li><code class="language-text">ResolveType</code></li><li><code class="language-text">Result</code></li><li><code class="language-text">SchemaDirectiveVisitor</code></li><li><code class="language-text">SchemaError</code></li><li><code class="language-text">TransformRootFields</code></li><li><code class="language-text">Transform</code></li><li><code class="language-text">TypeWithResolvers</code></li><li><code class="language-text">UnitOrList</code></li><li><code class="language-text">VisitTypeResult</code></li><li><code class="language-text">VisitType</code></li><li><code class="language-text">WrapQuery</code></li><li><code class="language-text">addCatchUndefinedToSchema</code></li><li><code class="language-text">addErrorLoggingToSchema</code></li><li><code class="language-text">addMockFunctionsToSchema</code></li><li><code class="language-text">addResolveFunctionsToSchema</code></li><li><code class="language-text">addSchemaLevelResolveFunction</code></li><li><code class="language-text">assertResolveFunctionsPresent</code></li><li><code class="language-text">attachConnectorsToContext</code></li><li><code class="language-text">attachDirectiveResolvers</code></li><li><code class="language-text">buildSchemaFromTypeDefinitions</code></li><li><code class="language-text">chainResolvers</code></li><li><code class="language-text">checkForResolveTypeResolver</code></li><li><code class="language-text">concatenateTypeDefs</code></li><li><code class="language-text">decorateWithLogger</code></li><li><code class="language-text">defaultCreateRemoteResolver</code></li><li><code class="language-text">defaultMergedResolver</code></li><li><code class="language-text">delegateToSchema</code></li><li><code class="language-text">extendResolversFromInterfaces</code></li><li><code class="language-text">extractExtensionDefinitions</code></li><li><code class="language-text">forEachField</code></li><li><code class="language-text">introspectSchema</code></li><li><code class="language-text">makeExecutableSchema</code></li><li><code class="language-text">makeRemoteExecutableSchema</code></li><li><code class="language-text">mergeSchemas</code></li><li><code class="language-text">mockServer</code></li><li><code class="language-text">transformSchema</code></li></ul><h3 id="exports-from-graphql-subscriptions" style="position:relative"><a class="headingLink" href="#exports-from-graphql-subscriptions">Exports from <code class="language-text">graphql-subscriptions</code></a></h3><p>Apollo Server 2 exports every symbol exported by <a href="https://www.npmjs.com/package/graphql-subscriptions" target="_blank" rel="noopener noreferrer"><code class="language-text">graphql-subscriptions</code></a>. If you are importing any of the following symbols from an Apollo Server package, you should instead run <code class="language-text">npm install graphql-subscriptions</code> and import the symbol from <code class="language-text">graphql-subscriptions</code> instead.</p><ul><li><code class="language-text">FilterFn</code></li><li><code class="language-text">PubSub</code></li><li><code class="language-text">PubSubEngine</code></li><li><code class="language-text">PubSubOptions</code></li><li><code class="language-text">ResolverFn</code></li><li><code class="language-text">withFilter</code></li></ul><h3 id="exports-from-graphql-upload" style="position:relative"><a class="headingLink" href="#exports-from-graphql-upload">Exports from <code class="language-text">graphql-upload</code></a></h3><p>Apollo Server 2 exports the <code class="language-text">GraphQLUpload</code> symbol from (our fork of) <code class="language-text">graphql-upload</code>. Apollo Server 3 no longer has built-in <code class="language-text">graphql-upload</code> integration. See <a href="/data/file-uploads/">the documentation on how to enable file uploads in Apollo Server 3</a>.</p><h3 id="exports-related-to-graphql-playground" style="position:relative"><a class="headingLink" href="#exports-related-to-graphql-playground">Exports related to GraphQL Playground</a></h3><p>Apollo Server 2 exports a <code class="language-text">defaultPlaygroundOptions</code> object, along with <code class="language-text">PlaygroundConfig</code> and <code class="language-text">PlaygroundRenderPageOptions</code> types to support the <code class="language-text">playground</code> top-level constructor argument.</p><p>In Apollo Server 3, GraphQL Playground is one of several landing pages implemented via plugins, and there are no default options for it. The <code class="language-text">ApolloServerPluginLandingPageGraphQLPlaygroundOptions</code> type exported from <code class="language-text">apollo-server-core</code> plays a similar role to <code class="language-text">PlaygroundConfig</code> and <code class="language-text">PlaygroundRenderPageOptions</code>. See <a href="#graphql-playground">the section on <code class="language-text">playground</code> above</a> for more details on configuring GraphQL Playground in Apollo Server 3.</p><h2 id="removed-features" style="position:relative"><a class="headingLink" href="#removed-features">Removed features</a></h2><p>Several small features have been removed from Apollo Server 3.</p><h3 id="guessing-apollo-studio-graph-id-from-api-key" style="position:relative"><a class="headingLink" href="#guessing-apollo-studio-graph-id-from-api-key">Guessing Apollo Studio graph ID from API key</a></h3><p>In Apollo Server 2, if you specify an Apollo API key (e.g., with the <code class="language-text">APOLLO_KEY</code> environment variable) that starts with <code class="language-text">service:your-graph-id:</code>, Apollo Server automatically guesses that your Studio graph ID (used for usage reporting, schema reporting, managed federation, and so on) is <code class="language-text">your-graph-id</code>.</p><p>In Apollo Server 3, you should instead specify your Studio graph ID explicitly when using features that connect to Studio. You can specify the graph ID by itself in the <code class="language-text">APOLLO_GRAPH_ID</code> environment variable (or via <code class="language-text">new ApolloServer({apollo: {graphId}}))</code>, or alongside the variant in a string like <code class="language-text">your-graph-id@your-graph-variant</code> in the <code class="language-text">APOLLO_GRAPH_REF</code> environment variable (or via <code class="language-text">new ApolloServer({apollo: {graphRef}})</code>). See <a href="/api/apollo-server/#apollo">the <code class="language-text">apollo</code> constructor option</a> for more details.</p><blockquote><p>If you set your API key but do <em>not</em> set your graph ref or ID:</p><ul><li>If you explicitly set up features like the usage reporting plugin or managed federation, Apollo Server 3 throws an error on startup.</li><li>If you don&#x27;t explicitly <a href="/api/plugin/usage-reporting/">set up or disable the usage reporting plugin</a>, Apollo Server 3 logs a warning suggesting that you either set your graph ref or disable the usage reporting plugin.</li></ul></blockquote><h3 id="apolloserverschema-field" style="position:relative"><a class="headingLink" href="#apolloserverschema-field"><code class="language-text">ApolloServer.schema</code> field</a></h3><p>Apollo Server 2 has a deprecated field <code class="language-text">ApolloServer.schema</code> (which doesn&#x27;t work when the server is a federated gateway). Apollo Server 3 does not contain this field. To access your server&#x27;s schema, you have a few options:</p><ul><li>Construct the schema yourself (e.g., with <code class="language-text">const schema = makeExecutableSchema({typeDefs, resolvers})</code> from <code class="language-text">@graphql-tools/schema</code>), pass it in as <code class="language-text">new ApolloServer({schema})</code>, and refer to this same <code class="language-text">schema</code> value elsewhere. Apollo Server 3 won&#x27;t modify the schema you pass in.</li><li>Write a plugin that uses the <a href="/integrations/plugins-event-reference/#serverwillstart"><code class="language-text">serverWillStart</code> event</a> to obtain the schema. Note that if your server is a gateway, this receives the <em>first</em> schema that&#x27;s loaded on startup but doesn&#x27;t receive any subsequent schemas if it updates dynamically.</li><li>If your server is a gateway, register a callback with <code class="language-text">gateway.onSchemaChange</code>. Note that this API has some inconsistent behavior. To resolve this, we are considering <a href="https://github.com/apollographql/apollo-server/pull/5187" target="_blank" rel="noopener noreferrer">adding an Apollo Server plugin event that receives all schema updates</a>.</li></ul><h3 id="apollo-server-testing" style="position:relative"><a class="headingLink" href="#apollo-server-testing"><code class="language-text">apollo-server-testing</code></a></h3><p>Apollo Server 2 contains a package <code class="language-text">apollo-server-testing</code>. This package is a thin wrapper around the <code class="language-text">server.executeOperation</code> method. As of Apollo Server 2.25.0, we no longer document this package and instead <a href="/testing/testing/">document using <code class="language-text">executeOperation</code> directly</a>.</p><p>In Apollo Server 3, we no longer publish this package. It&#x27;s possible that the Apollo Server 2 version of this package might work with Apollo Server 3 servers. If you do use <code class="language-text">apollo-server-testing</code>, we suggest that you migrate to using <code class="language-text">executeOperation</code> directly (with at least 2.25.0 of Apollo Server) before upgrading to Apollo Server 3.</p><p>If you used <code class="language-text">apollo-server-testing</code> like so:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{</span> createTestClient <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;apollo-server-testing&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> query<span class="token punctuation">,</span> mutate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">createTestClient</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">QUERY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token function">mutate</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">mutation</span><span class="token operator">:</span> <span class="token constant">MUTATION</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>then you can use <code class="language-text">executeOperation</code> like so:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">executeOperation</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">QUERY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">executeOperation</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token constant">MUTATION</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span></span></pre></div></div></div><blockquote><p>Note that prior to Apollo Server 2.25.0, <code class="language-text">apollo-server-testing</code> functions allowed you to pass your operation as a string or a <code class="language-text">DocumentNode</code> as returned from <code class="language-text">gql</code>, but <code class="language-text">executeOperation</code> only supported strings. As of v2.25.0, <code class="language-text">executeOperation</code> takes <code class="language-text">string</code> or <code class="language-text">DocumentNode</code>, which makes the change shown above straightforward in all cases.</p></blockquote><h3 id="apollo-datasource-rest-baseurl-override-change" style="position:relative"><a class="headingLink" href="#apollo-datasource-rest-baseurl-override-change"><code class="language-text">apollo-datasource-rest</code>: <code class="language-text">baseURL</code> override change</a></h3><p>When you create a <a href="/data/data-sources/"><code class="language-text">RESTDataSource</code></a> subclass, you need to provide its <code class="language-text">baseURL</code>. This can be done via <code class="language-text">this.baseURL = ...</code> in the constructor or <code class="language-text">resolveURL</code>, or via <code class="language-text">baseURL = ...</code> at the class level.</p><p>In Apollo Server 2 you can <em>also</em> provide <code class="language-text">baseURL</code> via a getter like <code class="language-text">get baseURL() { ... }</code>. Apollo Server 3 is compiled with TypeScript 4, which <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-0/#properties-overriding-accessors-and-vice-versa-is-an-error" target="_blank" rel="noopener noreferrer">no longer supports overriding a property with an accessor</a>, so this is no longer allowed.</p><p>If you used a getter in order to provide a dynamic URL, like this:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyDataSource</span> <span class="token keyword">extends</span> <span class="token class-name">RESTDataSource</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span> <span class="token function">baseURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">someDynamicallyCalculatedURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>you can instead override <code class="language-text">resolveURL</code>:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyDataSource</span> <span class="token keyword">extends</span> <span class="token class-name">RESTDataSource</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">resolveURL</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">request</span><span class="token operator">:</span> RequestOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token function">someDynamicallyCalculatedURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resolveURL</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h3 id="apollo-server-envs-global-type-definitions" style="position:relative"><a class="headingLink" href="#apollo-server-envs-global-type-definitions"><code class="language-text">apollo-server-env</code>&#x27;s global type definitions</a></h3><p>Global TypeScript definitions have been removed from <code class="language-text">apollo-server-env</code> since they conflicted with similar global types provided by <code class="language-text">@types/supertest</code>, which we use in Apollo Server&#x27;s test suite.  These removed types include types which resemble those of <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank" rel="noopener noreferrer">the Fetch API</a> including, e.g., <code class="language-text">fetch</code>, <code class="language-text">RequestInfo</code>, <code class="language-text">Headers</code>, <code class="language-text">Request</code>, <code class="language-text">Response</code>, <code class="language-text">ResponseInit</code>, and more.  <a href="https://github.com/apollographql/apollo-server/blob/32cfdcfdbd44f4f4e826f347f47fdcbc0475b5cc/packages/apollo-server-env/src/global.d.ts" target="_blank" rel="noopener noreferrer">See the full list prior to removal here</a>.</p><p>We don&#x27;t expect this to affect many users and we have not publicly suggested using these types in the past, but it&#x27;s possible that implementations may be using them inadvertently (e.g., from auto-import on <code class="language-text">apollo-server-env</code>).  While other type definition sets provide similar hand-curated types, for the time being, we have chosen to rely the same-named types from TypeScript&#x27;s <code class="language-text">lib.dom.d.ts</code> — e.g., <a href="https://github.com/microsoft/TypeScript/blob/3c604f1c0a412ef41f58c3f9b239b25e8d725751/lib/lib.dom.d.ts#L1470" target="_blank" rel="noopener noreferrer">its <code class="language-text">RequestInfo</code> type definition</a>.  Even if those types are more appropriate for browsers, they&#x27;re a reliable and well-maintained source.  For more details, including our plan for adjusting this again in the future, <a href="https://github.com/apollographql/apollo-server/pull/5165" target="_blank" rel="noopener noreferrer">see PR #5165</a>.</p><h2 id="changed-features" style="position:relative"><a class="headingLink" href="#changed-features">Changed features</a></h2><h3 id="plugin-api" style="position:relative"><a class="headingLink" href="#plugin-api">Plugin API</a></h3><h4 id="almost-all-plugin-events-are-now-async" style="position:relative"><a class="headingLink" href="#almost-all-plugin-events-are-now-async">Almost all plugin events are now async</a></h4><p>In Apollo Server 2, some <a href="/integrations/plugins-event-reference/">plugin events</a> are synchronous (their return value is not a <code class="language-text">Promise</code>), and some are &quot;maybe-asynchronous&quot; (they could return a <code class="language-text">Promise</code> if they wanted, but didn&#x27;t have to). This means that you can&#x27;t do asynchronous work in the former events, and the typings for the latter events are somewhat complex.</p><p>In Apollo Server 3, <em>almost</em> all plugin methods are always asynchronous: they always return a <code class="language-text">Promise</code> type. This includes <a href="/integrations/plugins/#end-hooks">end hooks</a> as well. The exceptions are <code class="language-text">willResolveField</code> and its end hook and <code class="language-text">schemaDidLoadOrUpdate</code>, which are always synchronous.</p><p>In practice, this means that all of your plugin events should use <code class="language-text">async</code> functions or methods. If you are using TypeScript, you need to do this for your code to compile.</p><blockquote><p>In practice, Apollo Server generally uses <code class="language-text">await</code> or <code class="language-text">Promise.all</code> on values returned by plugin methods instead of an explicit <code class="language-text">.then</code>. These constructs accept both <code class="language-text">Promise</code>s and normal values. If you aren&#x27;t using TypeScript, you might be able to get away with synchronous plugin methods for the time being.</p></blockquote><h4 id="willsendresponse-is-called-more-consistently" style="position:relative"><a class="headingLink" href="#willsendresponse-is-called-more-consistently"><code class="language-text">willSendResponse</code> is called more consistently</a></h4><p>In Apollo Server 2, some errors related to <a href="/performance/apq/">persisted queries</a> invoke the <code class="language-text">requestDidStart</code> and <code class="language-text">didEncounterError</code> plugin events <em>without</em> invoking the <code class="language-text">willSendResponse</code> event afterwards.</p><p>In Apollo Server 3, any request that makes it far enough to invoke <code class="language-text">requestDidStart</code> also invokes <code class="language-text">willSendResponse</code>. See <a href="https://github.com/apollographql/apollo-server/pull/5287" target="_blank" rel="noopener noreferrer">this PR</a> for details.</p><h4 id="executiondidstart-can-no-longer-return-a-function" style="position:relative"><a class="headingLink" href="#executiondidstart-can-no-longer-return-a-function"><code class="language-text">executionDidStart</code> can no longer return a function</a></h4><p>In Apollo Server 2, the <code class="language-text">executionDidStart</code> plugin event could return nothing, an object, or a function. If a function was provided, it would be called when execution finished (one might imagine an <code class="language-text">executionDidEnd</code>).</p><p>In Apollo Server 3, <code class="language-text">executionDidStart</code> must return either nothing or an object. If you previously returned a function, you can now return an object with an <code class="language-text">executionDidEnd</code> field like so:</p><div class="gatsby-highlight has-highlighted-lines" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  schema<span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">requestDidStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token keyword">async</span> <span class="token function">executionDidStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">          <span class="token keyword">return</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">            <span class="token keyword">async</span> <span class="token function">executionDidEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">              <span class="token comment">// your code here</span></span><span class="gatsby-highlight-code-line">            <span class="token punctuation">}</span></span><span class="gatsby-highlight-code-line">          <span class="token punctuation">}</span></span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>For more information, you can check out the related plugin documentation on <a href="/integrations/plugins/#end-hooks">end hooks</a>.</p><h4 id="gateway-interface-renamed-and-simplified" style="position:relative"><a class="headingLink" href="#gateway-interface-renamed-and-simplified">Gateway interface renamed and simplified</a></h4><p>In Apollo Server 2, the TypeScript type used for the <code class="language-text">gateway</code> constructor option is called <code class="language-text">GraphQLService</code>. In Apollo Server 3, it&#x27;s called <code class="language-text">GatewayInterface</code>. (For now, an identical interface named <code class="language-text">GraphQLService</code> continues to be exported.)</p><p>This interface now requires the following:</p><ul><li>The <code class="language-text">stop</code> method must be present.</li><li>The <code class="language-text">executor</code> method must async</li><li>The <code class="language-text">apollo</code> option must always be passed to the <code class="language-text">load</code> method.</li></ul><blockquote><p>All recent versions of <code class="language-text">@apollo/gateway</code> satisfy these stronger requirements.</p></blockquote><h3 id="bad-request-errors-more-consistently-return-4xx" style="position:relative"><a class="headingLink" href="#bad-request-errors-more-consistently-return-4xx">Bad request errors more consistently return 4xx</a></h3><p>In Apollo Server 2, certain poorly formatted requests receive HTTP responses with a 5xx status (indicating a server error) instead of 4xx (indicating a client error). For example, this occurs in some integrations for a missing POST body or a JSON parse error.</p><p>In Apollo Server 3, these errors are handled in a more consistent manner across integrations and consistently return HTTP responses with a 4xx status.</p><h3 id="extensions-custom-details-on-apolloerror" style="position:relative"><a class="headingLink" href="#extensions-custom-details-on-apolloerror">Extensions (custom details) on <code class="language-text">ApolloError</code></a></h3><h4 id="initializing-an-error" style="position:relative"><a class="headingLink" href="#initializing-an-error">Initializing an error</a></h4><p>In Apollo Server 2, <a href="/data/errors/#including-custom-error-details">error extensions</a> can be passed to the <code class="language-text">ApolloError</code> constructor either as the third argument, <em>or</em> as an <code class="language-text">extensions</code> option on the third argument.</p><p>In other words, these two lines are equivalent with Apollo Server 2:</p><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">ApolloError</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#x27;value&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">ApolloError</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> code<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#x27;value&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span></span></pre></div></div></div><p>In Apollo Server 3, only the first line above is supported. If you try to use the second line, the constructor throws an error. Before upgrading, replace any code using the second form with the first form.</p><h4 id="reading-error-extensions" style="position:relative"><a class="headingLink" href="#reading-error-extensions">Reading error extensions</a></h4><p>In Apollo Server 2, an error extension (<code class="language-text">foo</code>) is present in two locations on an <code class="language-text">ApolloError</code> object (<code class="language-text">error</code>): <code class="language-text">error.foo</code> <em>and</em> <code class="language-text">error.extensions.foo</code>. When that object is serialized for a JSON response, the extension is <em>also</em> present in two locations in the JSON: <code class="language-text">extensions.foo</code> and <code class="language-text">extensions.exception.foo</code>.</p><p>In Apollo Server 3, an error extension is present in <em>one</em> <code class="language-text">ApolloError</code> location: <code class="language-text">error.extensions.foo</code>. When the error is serialized to JSON, the extension is present only in <code class="language-text">extensions.foo</code>.</p><p>See <a href="https://github.com/apollographql/apollo-server/pull/5294" target="_blank" rel="noopener noreferrer">this PR</a> for more details.</p><h3 id="mocking" style="position:relative"><a class="headingLink" href="#mocking">Mocking</a></h3><p>In Apollo Server 2, the <code class="language-text">mocks</code> and <code class="language-text">mockEntireSchema</code> constructor options are essentially implemented as follows:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> addMockFunctionsToSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql-tools&#x27;</span><span class="token punctuation">;</span>  <span class="token comment">// v4.x</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> mocks<span class="token punctuation">,</span> mockEntireSchema <span class="token punctuation">}</span> <span class="token operator">=</span> constructorOptions<span class="token punctuation">;</span>
<span class="token keyword">const</span> schemaWithMocks <span class="token operator">=</span> <span class="token function">addMockFunctionsToSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  schema<span class="token punctuation">,</span>
  <span class="token literal-property property">mocks</span><span class="token operator">:</span>
    <span class="token keyword">typeof</span> mocks <span class="token operator">===</span> <span class="token string">&#x27;boolean&#x27;</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> mocks <span class="token operator">===</span> <span class="token string">&#x27;undefined&#x27;</span>
      <span class="token operator">?</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">:</span> mocks<span class="token punctuation">,</span>
  <span class="token literal-property property">preserveResolvers</span><span class="token operator">:</span>
    <span class="token keyword">typeof</span> mockEntireSchema <span class="token operator">===</span> <span class="token string">&#x27;undefined&#x27;</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token operator">!</span>mockEntireSchema<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>In Apollo Server 3, we&#x27;ve upgraded from <code class="language-text">graphql-tools</code> v4 to <code class="language-text">@graphql-tools/mock</code> v8. The details of how mocking works in GraphQL Tools has changed, and the name of the function that implements it has changed too. The new implementation is as follows:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> addMocksToSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@graphql-tools/mock&#x27;</span><span class="token punctuation">;</span>  <span class="token comment">// v8.x</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> mocks<span class="token punctuation">,</span> mockEntireSchema <span class="token punctuation">}</span> <span class="token operator">=</span> constructorOptions<span class="token punctuation">;</span>
<span class="token keyword">const</span> schemaWithMocks <span class="token operator">=</span> <span class="token function">addMocksToSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  schema<span class="token punctuation">,</span>
  <span class="token literal-property property">mocks</span><span class="token operator">:</span> mocks <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> mocks <span class="token operator">===</span> <span class="token string">&#x27;undefined&#x27;</span> <span class="token operator">?</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">:</span> mocks<span class="token punctuation">,</span>
  <span class="token literal-property property">preserveResolvers</span><span class="token operator">:</span>
    <span class="token keyword">typeof</span> mockEntireSchema <span class="token operator">===</span> <span class="token string">&#x27;undefined&#x27;</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token operator">!</span>mockEntireSchema<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>So the name of the function has changed, and additionally, the semantics of the function have changed. You can <a href="https://www.graphql-tools.com/docs/mocking/#migration-from-v7-and-below" target="_blank" rel="noopener noreferrer">read the GraphQL Tools migration docs</a> to see if you use any mocking features that have changed between v4 and v8, and adjust the value of your <code class="language-text">mocks</code> argument if so.</p><p>To use features of <code class="language-text">addMocksToSchema</code> that require passing more options to it than the three that <code class="language-text">ApolloServer</code> passes through, you can use the library directly. To do so, run <code class="language-text">npm install @graphql-tools/mock @graphql-tools/schema</code> in your app, and replace</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers<span class="token punctuation">,</span> mocks <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>with</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> addMocksToSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@graphql-tools/mock&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> makeExecutableSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;@graphql-tools/schema&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">schema</span><span class="token operator">:</span> <span class="token function">addMocksToSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">schema</span><span class="token operator">:</span> <span class="token function">makeExecutableSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> typeDefs<span class="token punctuation">,</span> resolvers <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">mocks</span><span class="token operator">:</span> <span class="token comment">// ...</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>Alternatively, to keep the current behavior without changing your mock functions at all, you can continue to use <code class="language-text">graphql-tools</code> v4. To do this, run <code class="language-text">npm install graphql-tools@v4.x</code> in your app, and replace</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>typeDefs<span class="token punctuation">,</span> resolvers<span class="token punctuation">,</span> mocks<span class="token punctuation">,</span> preserveResolvers<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>with</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> makeExecutableSchema<span class="token punctuation">,</span> addMockFunctionsToSchema <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql-tools&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">schema</span><span class="token operator">:</span> <span class="token function">addMockFunctionsToSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">schema</span><span class="token operator">:</span> <span class="token function">makeExecutableSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>typeDefs<span class="token punctuation">,</span> resolvers<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    mocks<span class="token punctuation">,</span>
    <span class="token literal-property property">preserveResolvers</span><span class="token operator">:</span>
      <span class="token keyword">typeof</span> mockEntireSchema <span class="token operator">===</span> <span class="token string">&#x27;undefined&#x27;</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token operator">:</span> <span class="token operator">!</span>mockEntireSchema<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h3 id="apollo-server-caching-test-suite-helpers" style="position:relative"><a class="headingLink" href="#apollo-server-caching-test-suite-helpers"><code class="language-text">apollo-server-caching</code> test suite helpers</a></h3><p>In Apollo Server 2, the <code class="language-text">apollo-server-caching</code> package exports functions like <code class="language-text">testKeyValueCache</code>, <code class="language-text">testKeyValueCache_Basic</code>, and <code class="language-text">testKeyValueCache_Expiration</code>, which define Jest test suites. The package also exports a <code class="language-text">TestableKeyValueCache</code> type that&#x27;s required for these test suites to be able to flush and close the cache.</p><p>You can use this to define Jest test suites for your own implementation of the <code class="language-text">KeyValueCache</code> interface, although this requires intricate Jest and TypeScript config to set up.</p><p>In Apollo Server 3, these functions and type are removed. Instead, a <code class="language-text">runKeyValueCacheTests</code> function is exported which can be run in any test suite (without any Jest-specific behavior). See the <code class="language-text">apollo-server-caching</code> README for more details.</p><h2 id="changes-to-framework-integrations" style="position:relative"><a class="headingLink" href="#changes-to-framework-integrations">Changes to framework integrations</a></h2><h3 id="start-now-mandatory-for-non-serverless-framework-integrations" style="position:relative"><a class="headingLink" href="#start-now-mandatory-for-non-serverless-framework-integrations"><code class="language-text">start()</code> now mandatory for non-serverless framework integrations</a></h3><p>Apollo Server v2.22 introduced the <code class="language-text">server.start()</code> method for non-serverless framework integrations (Express, Fastify, Hapi, Koa, Micro, and Cloudflare). Users of these integrations were encouraged to await a call to it immediately after creating an <code class="language-text">ApolloServer</code> object:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">startServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ApolloServer</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  server<span class="token punctuation">.</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span> app <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>If any plugin <code class="language-text">serverWillStart</code> events throw, or if the server fails to load its schema properly (for example, if the server is a gateway and cannot load its schema), then <code class="language-text">await server.start()</code> will throw. This allows you to ensure that Apollo Server has successfully loaded its configuration before you start listening for HTTP requests.</p><p>In Apollo Server 2, calling this method was optional. If you didn&#x27;t call it, you could still call methods like <code class="language-text">applyMiddleware</code> and start listening. If a startup failure occurred, all GraphQL requests would fail.</p><p>In Apollo Server 3, you <em>must</em> <code class="language-text">await server.start()</code> immediately after <code class="language-text">new ApolloServer</code> before calling <code class="language-text">applyMiddleware</code> (or <code class="language-text">getMiddleware</code> or <code class="language-text">getHandler</code>, depending on the integration). Note that you don&#x27;t have to call it before calling the testing method <code class="language-text">executeOperation</code>. Otherwise, that method will throw.</p><p>This does not apply to the batteries-included <code class="language-text">apollo-server</code> package (the server is started as part of the async method <code class="language-text">server.listen()</code>) or to serverless framework integrations.</p><h3 id="peer-deps-instead-of-direct-deps" style="position:relative"><a class="headingLink" href="#peer-deps-instead-of-direct-deps">Peer deps instead of direct deps</a></h3><p>In Apollo Server 2, the <code class="language-text">apollo-server-express</code>, <code class="language-text">apollo-server-koa</code>, and <code class="language-text">apollo-server-micro</code> packages have <em>direct</em> dependencies on <code class="language-text">express</code>, <code class="language-text">koa</code>, and <code class="language-text">micro</code> respectively, and <code class="language-text">apollo-server-fastify</code> and <code class="language-text">apollo-server-hapi</code> have no dependency on <code class="language-text">fastify</code>, <code class="language-text">hapi</code>, or <code class="language-text">@hapi/hapi</code>.</p><p>In Apollo Server 3, these packages have <em>peer</em> dependencies on their corresponding framework packages. This means that you need to install a version of that package of your choice yourself in your app (though most likely that was already the case).</p><h3 id="cors--is-now-the-default" style="position:relative"><a class="headingLink" href="#cors--is-now-the-default">CORS <code class="language-text">*</code> is now the default</a></h3><p>In Apollo Server 2, the default CORS configuration for most packages is to serve an <code class="language-text">access-control-allow-origin: *</code> header for all responses.</p><p>However, this is not the case in Apollo Server 2 for <code class="language-text">apollo-server-lambda</code>, <code class="language-text">apollo-server-cloud-functions</code>, or <code class="language-text">apollo-server-azure-functions</code> (these serve no CORS headers by default), or for <code class="language-text">apollo-server-koa</code> (this serves an <code class="language-text">access-control-allow-origin</code> header with a value matching the request&#x27;s origin by default).</p><p>In Apollo Server 3, all implementations of <code class="language-text">ApolloServer</code> that support CORS configuration have the same default of <code class="language-text">access-control-allow-origin: *</code>.</p><p>To use your framework&#x27;s Apollo Server 2 default CORS behavior in your Apollo Server 3 application, provide the options specified below to the <code class="language-text">createHandler</code>/<code class="language-text">getMiddleware</code> method.</p><h4 id="lambda--cloud-functions" style="position:relative"><a class="headingLink" href="#lambda--cloud-functions">Lambda / Cloud Functions</a></h4><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">expressGetMiddlewareOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">cors</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><h4 id="azure-functions" style="position:relative"><a class="headingLink" href="#azure-functions">Azure Functions</a></h4><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">cors</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><h4 id="koa" style="position:relative"><a class="headingLink" href="#koa">Koa</a></h4><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">getMiddleware</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">cors</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><blockquote><p><code class="language-text">apollo-server-micro</code> and <code class="language-text">apollo-server-cloudflare</code> do not support CORS configuration in Apollo Server 2 <em>or</em> 3.</p></blockquote><h3 id="apollo-server-express" style="position:relative"><a class="headingLink" href="#apollo-server-express"><code class="language-text">apollo-server-express</code></a></h3><p>In Apollo Server 2, <code class="language-text">apollo-server-express</code> officially supports both the <code class="language-text">express</code> framework and the older <a href="https://www.npmjs.com/package/connect" target="_blank" rel="noopener noreferrer"><code class="language-text">connect</code></a> framework.</p><p>In Apollo Server 3, we no longer guarantee future support for <code class="language-text">connect</code>. We do still run a test suite against it and we will try not to <em>unintentionally</em> break functionality under <code class="language-text">connect</code>, but if future changes are easier to implement in an Express-only fashion, we reserve the right to break <code class="language-text">connect</code> compatibility within Apollo Server 3.</p><h3 id="apollo-server-lambda" style="position:relative"><a class="headingLink" href="#apollo-server-lambda"><code class="language-text">apollo-server-lambda</code></a></h3><h4 id="now-based-on-express" style="position:relative"><a class="headingLink" href="#now-based-on-express">Now based on Express</a></h4><p>In Apollo Server 2, <code class="language-text">apollo-server-lambda</code> implements parsing AWS Lambda events and performing standard web framework logic inside the package itself. As Lambda added new capabilities, the logic had to adapt, and as Apollo Server added new features, they had to be implemented from scratch in <code class="language-text">apollo-server-lambda</code>. Additionally, there was no way to add additional HTTP functionality (e.g., &quot;middleware&quot;) to <code class="language-text">apollo-server-lambda</code>.</p><p>In Apollo Server 3, <code class="language-text">apollo-server-lambda</code> is implemented as a wrapper around <code class="language-text">apollo-server-express</code>, using an <a href="https://www.npmjs.com/package/@vendia/serverless-express" target="_blank" rel="noopener noreferrer">actively maintained package</a> to parse AWS Lambda events into Express requests. This simplifies the implementation and enables us to support new Lambda integrations such as Application Load Balancers. Additionally, because it now uses Express internally, you can extend HTTP functionality via Express middleware using the new <code class="language-text">expressAppFromMiddleware</code> option to <code class="language-text">createHandler</code>.</p><h4 id="createhandler-arguments-changed" style="position:relative"><a class="headingLink" href="#createhandler-arguments-changed"><code class="language-text">createHandler</code> arguments changed</a></h4><p>As part of the update described <a href="#now-based-on-express">above</a>, the arguments to <code class="language-text">createHandler</code> have changed. Instead of taking only <code class="language-text">cors</code> and <code class="language-text">onHealthCheck</code>, the method takes an <code class="language-text">expressGetMiddlewareOptions</code> option, which is an object that supports any of the options that the <code class="language-text">apollo-server-express</code> <code class="language-text">applyMiddleware</code> and <code class="language-text">getMiddleware</code> can take (other than <code class="language-text">app</code>).</p><p>For example, instead of:</p><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>onHealthCheck<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>you now write</p><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">expressGetMiddlewareOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>onHealthCheck<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>`</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><h4 id="handler-is-always-async" style="position:relative"><a class="headingLink" href="#handler-is-always-async">Handler is always async</a></h4><p>In Apollo Server 2, the handler returned by <code class="language-text">createHandler</code> can be called either as a function that takes a callback as a third argument, or (starting with Apollo Server v2.21.2) as an async function that returns a <code class="language-text">Promise</code>.</p><p>In Apollo Server 3, the handler returned by <code class="language-text">createHandler</code> is always an async function that returns a <code class="language-text">Promise</code>. Any callback passed in will be ignored.</p><p>All currently supported Lambda runtimes support async handlers. However, if you are currently wrapping the handler returned from <code class="language-text">createHandler</code> in your own larger handler and passing a callback into it, this no longer works. Rewrite your outer handler to be an async function and <code class="language-text">await</code> the <code class="language-text">Promise</code> returned from the handler returned by <code class="language-text">createHandler</code>.</p><p>For example, if your server looked like this:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> apolloHandler <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">doSomethingFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">apolloHandler</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">doSomethingLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><p>you can change it to look like this:</p><div class="gatsby-highlight" data-language="javascript"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">const</span> apolloHandler <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">doSomethingFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">apolloHandler</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token function">doSomethingLater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div></div></div><h3 id="apollo-server-cloud-functions" style="position:relative"><a class="headingLink" href="#apollo-server-cloud-functions"><code class="language-text">apollo-server-cloud-functions</code></a></h3><p>In Apollo Server 2, <code class="language-text">apollo-server-cloud-functions</code> implements standard web framework logic inside the package itself. Even though the Node.js API for Google Cloud Functions provides its request and response in the form of Express request and response objects, Apollo Server 2 has a bespoke implementation unrelated to <code class="language-text">apollo-server-express</code> and does not support all features supported by <code class="language-text">apollo-server-express</code>. Additionally, there is no way to add additional HTTP functionality (e.g., &quot;middleware&quot;) to <code class="language-text">apollo-server-cloud-functions</code>.</p><p>In Apollo Server 3, <code class="language-text">apollo-server-cloud-functions</code> is implemented on top of <code class="language-text">apollo-server-express</code> and supports all features supported by <code class="language-text">apollo-server-express</code>. You can add additional HTTP functionality via Express middleware using the new <code class="language-text">expressAppFromMiddleware</code> option to <code class="language-text">createHandler</code>.</p><p>As part of this, the arguments to <code class="language-text">createHandler</code> have changed. Instead of taking only <code class="language-text">cors</code>, it takes an <code class="language-text">expressGetMiddlewareOptions</code> option, which is an object taking any of the options that the <code class="language-text">apollo-server-express</code> <code class="language-text">applyMiddleware</code> and <code class="language-text">getMiddleware</code> can take (other than <code class="language-text">app</code>). For example, instead of:</p><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span>cors<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><p>you now write:</p><div class="gatsby-highlight" data-language="js"><div class="css-1gcd36t e1ulzjg73"><div class="css-1y4makq e1ulzjg72"><style data-emotion-css="hga22n">.css-hga22n{background-color:transparent;border-radius:4px;border-width:0;color:#424855;cursor:pointer;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;height:28px;min-width:76px;padding:0 12px;font-family:'Source Sans Pro',sans-serif;font-size:13px;line-height:1.54;font-weight:600;outline:0;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;}.css-hga22n[disabled],.css-hga22n[disabled]:hover{background-color:transparent;box-shadow:none;color:#959DAA;}.css-hga22n:hover,.css-hga22n[data-force-hover-state]{background-color:#F4F6F8;color:#424855;}.css-hga22n:focus,.css-hga22n[data-force-focus-state]{background-color:#ffffff;color:#2075d6;box-shadow:0 1px 4px 0 rgba(18,21,26,0.08),0 0 0 2px #bbdbff,inset 0 0 0 1px #2075d6,inset 0 -1px 0 0 rgba(18,21,26,0.05);}.css-hga22n:active,.css-hga22n[data-force-active-state],.css-hga22n[aria-expanded=true]{color:#424855;background-color:#EBEEF0;box-shadow:none;outline:0;}</style><button class="css-hga22n">Copy</button></div><div class="css-r8v8pb e1ulzjg70"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js">server<span class="token punctuation">.</span><span class="token function">createHandler</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">expressGetMiddlewareOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>cors<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div></div></div><h3 id="apollo-server-fastify" style="position:relative"><a class="headingLink" href="#apollo-server-fastify"><code class="language-text">apollo-server-fastify</code></a></h3><p>In Apollo Server 2, <code class="language-text">apollo-server-fastify</code> supports Fastify v2 and does <em>not</em> support Fastify v3. There is no dependency or peer dependency making this requirement clear.</p><p>In Apollo Server 3, <code class="language-text">apollo-server-fastify</code> supports Fastify v3. It has not been tested with versions of Fastify older than v3. There is a peer dependency on <code class="language-text">fastify</code> v3.</p><h3 id="apollo-server-hapi" style="position:relative"><a class="headingLink" href="#apollo-server-hapi"><code class="language-text">apollo-server-hapi</code></a></h3><p>We are not certain exactly which versions of Hapi are supported by <code class="language-text">apollo-server-hapi</code> in Apollo Server 2. We <em>are</em> certain that only <code class="language-text">@hapi/hapi</code> v20.1.2 and higher are supported by Node 16, and Apollo Server 2 was not tested with versions of <code class="language-text">hapi</code> newer than v17.8.5. (Hapi&#x27;s package name changed from <code class="language-text">hapi</code> to <code class="language-text">@hapi/hapi</code> between v18.1.0 and v18.2.0.)</p><p>In Apollo Server 3, <code class="language-text">apollo-server-hapi</code> works with <code class="language-text">@hapi/hapi</code> v20.1.2 and Node 16. It is not tested with older versions of Hapi. Note that the Hapi project believes that <a href="https://github.com/hapijs/hapi/issues/4114" target="_blank" rel="noopener noreferrer">all versions older than v20 have security issues</a>.</p></div><style data-emotion="css 1f6gfyy">.css-1f6gfyy{display:none;margin-top:48px;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}@media (max-width: 1120px){.css-1f6gfyy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (max-width: 850px){.css-1f6gfyy{display:none;}}@media (max-width: 600px){.css-1f6gfyy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:24px;}}</style><div class="css-1f6gfyy e694h6z0"><style data-emotion="css rntvij">.css-rntvij{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:0;}.css-rntvij:not(:last-child){margin-bottom:16px;}</style><h5 class="css-rntvij e694h6z2"><style data-emotion="css 1keuqhy">.css-1keuqhy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#5A6270;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}.css-1keuqhy:hover{color:#959DAA;}.css-1keuqhy svg{width:20px;height:20px;margin-right:6px;fill:currentColor;}</style><a target="_blank" rel="noopener noreferrer" href="https://github.com/apollographql/apollo-server/tree/main/docs/source/migration.mdx" class="css-1keuqhy e694h6z1"><style data-emotion-css="k9tv6n">.css-k9tv6n{overflow:visible;height:26px;}.css-k9tv6n *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 26 26" class="css-k9tv6n"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><path fill="currentColor" fill-rule="nonzero" d="M15.425 22.985V20.95c0-1.081-.371-1.876-1.112-2.385.465-.045.891-.107 1.279-.188a9.967 9.967 0 0 0 1.233-.348 6.039 6.039 0 0 0 1.166-.543c.344-.21.674-.482.991-.817.317-.335.583-.715.797-1.139.215-.424.384-.933.509-1.527a9.543 9.543 0 0 0 .188-1.963c0-1.384-.451-2.563-1.353-3.537.411-1.072.366-2.237-.134-3.497l-.335-.04c-.232-.027-.65.071-1.253.295-.603.224-1.279.589-2.03 1.098a12.317 12.317 0 0 0-3.309-.442c-1.152 0-2.251.147-3.296.442a11.41 11.41 0 0 0-1.346-.797 6.948 6.948 0 0 0-1.018-.429 3.503 3.503 0 0 0-1.132-.154.844.844 0 0 0-.134.027c-.5 1.268-.545 2.434-.134 3.497-.902.973-1.353 2.152-1.353 3.537 0 .715.063 1.369.188 1.963.125.594.295 1.103.509 1.527.214.424.48.804.797 1.139.317.335.647.607.991.817.344.21.732.391 1.166.543a9.54 9.54 0 0 0 1.233.348c.389.08.815.143 1.279.188-.732.5-1.098 1.295-1.098 2.385v2.075C10.5 24 14 24 15.425 22.985z"></path><circle cx="12" cy="12" r="12" stroke="currentColor" stroke-width="1.5"></circle></g></svg> Edit on GitHub</a></h5></div><style data-emotion="css 9ckfit">.css-9ckfit{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:64px 0;}@media (max-width: 850px){.css-9ckfit{padding:32px 0;}}</style><nav class="css-9ckfit e1sfxy7w4"><style data-emotion="css spe9v1">.css-spe9v1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-spe9v1 svg{height:16px;width:16px;}.css-spe9v1:hover{opacity:0.8;}</style><a class="css-spe9v1 e1sfxy7w3" href="/integrations/middleware/"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 14 24" class="css-1a134qk"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.5.75L1.78 11.47a.749.749 0 0 0-.001 1.059l.001.001L12.5 23.25"></path></svg><style data-emotion="css 16mhdhi">.css-16mhdhi{margin-left:24px;text-align:left;}@media (max-width: 850px){.css-16mhdhi{margin-left:16px;}}</style><div class="css-16mhdhi e1sfxy7w2"><style data-emotion="css 1vhhq4p">.css-1vhhq4p{letter-spacing:0.142em;text-transform:uppercase;font-size:12px;}</style><div class="css-1vhhq4p e1sfxy7w1">Previous</div><style data-emotion="css mtbysh">.css-mtbysh{color:#2F353F;}</style><div class="css-mtbysh e1sfxy7w0">Choosing an Apollo Server package</div></div></a><a style="margin-left:auto" class="css-spe9v1 e1sfxy7w3" href="/schema/schema/"><style data-emotion="css 18eg9eb">.css-18eg9eb{margin-right:24px;text-align:right;}@media (max-width: 850px){.css-18eg9eb{margin-right:16px;}}</style><div class="css-18eg9eb e1sfxy7w2"><div class="css-1vhhq4p e1sfxy7w1">Next</div><div class="css-mtbysh e1sfxy7w0">GraphQL schema basics</div></div><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5.5.75l10.72 10.72a.749.749 0 0 1 .001 1.059l-.001.001L5.5 23.25"></path></svg></a></nav></div><style data-emotion="css u6jpbo">.css-u6jpbo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:240px;max-height:calc(100vh - 72px);margin-top:-36px;padding:40px 0;margin-left:40px;position:-webkit-sticky;position:sticky;top:72px;}@media (max-width: 1120px){.css-u6jpbo{display:none;}}@media (max-width: 850px){.css-u6jpbo{display:block;}}@media (max-width: 600px){.css-u6jpbo{display:none;}}</style><aside class="css-u6jpbo e694h6z4"><style data-emotion="css 16ceglb">.css-16ceglb{font-weight:600;}</style><h4 class="css-16ceglb e694h6z3">Migrating to Apollo Server 3</h4><style data-emotion="css gmdgof">.css-gmdgof{margin-left:0;margin-bottom:48px;overflow:auto;}</style><ul class="css-gmdgof e1wyoreh1"><style data-emotion="css 1h656g5">.css-1h656g5{list-style:none;font-size:1rem;line-height:inherit;}.css-1h656g5.active{color:#3f20ba;font-weight:bold;}.css-1h656g5 a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-1h656g5 a:hover{opacity:0.8;}</style><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#bumped-dependencies">Bumped dependencies</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#nodejs">Node.js</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#graphql">graphql</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#removed-integrations">Removed integrations</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#subscriptions">Subscriptions</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#file-uploads">File uploads</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#graphql-playground">GraphQL Playground</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#removed-constructor-options">Removed constructor options</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#extensions">extensions</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#engine">engine</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#schemadirectives">schemaDirectives</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#tracing">tracing</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#cachecontrol">cacheControl</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#playground">playground</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#removed-exports">Removed exports</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#exports-from-graphql-tools">Exports from graphql-tools</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#exports-from-graphql-subscriptions">Exports from graphql-subscriptions</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#exports-from-graphql-upload">Exports from graphql-upload</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#exports-related-to-graphql-playground">Exports related to GraphQL Playground</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#removed-features">Removed features</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#guessing-apollo-studio-graph-id-from-api-key">Guessing Apollo Studio graph ID from API key</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apolloserverschema-field">ApolloServer.schema field</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-testing">apollo-server-testing</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-datasource-rest-baseurl-override-change">apollo-datasource-rest: baseURL override change</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-envs-global-type-definitions">apollo-server-env&#x27;s global type definitions</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#changed-features">Changed features</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#plugin-api">Plugin API</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#bad-request-errors-more-consistently-return-4xx">Bad request errors more consistently return 4xx</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#extensions-custom-details-on-apolloerror">Extensions (custom details) on ApolloError</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#mocking">Mocking</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-caching-test-suite-helpers">apollo-server-caching test suite helpers</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:"><a href="#changes-to-framework-integrations">Changes to framework integrations</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#start-now-mandatory-for-non-serverless-framework-integrations">start() now mandatory for non-serverless framework integrations</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#peer-deps-instead-of-direct-deps">Peer deps instead of direct deps</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#cors--is-now-the-default">CORS * is now the default</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-express">apollo-server-express</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-lambda">apollo-server-lambda</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-cloud-functions">apollo-server-cloud-functions</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-fastify">apollo-server-fastify</a></li><li class=" css-1h656g5 e1wyoreh0" style="padding-left:16px"><a href="#apollo-server-hapi">apollo-server-hapi</a></li></ul><h5 class="css-rntvij e694h6z2"><a class="css-1keuqhy e694h6z1"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" style="margin-top:-2px" class="css-1a134qk"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.729 1.2l3.346 6.629 6.44.638a.806.806 0 0 1 .5 1.374l-5.3 5.253 1.965 7.138a.813.813 0 0 1-1.151.935L12 19.934l-6.52 3.229a.813.813 0 0 1-1.151-.935l1.965-7.138L.99 9.837a.804.804 0 0 1 .5-1.374l6.44-.638L11.271 1.2a.819.819 0 0 1 1.458 0z"></path></svg> Rate article</a></h5><h5 class="css-rntvij e694h6z2"><a target="_blank" rel="noopener noreferrer" href="https://github.com/apollographql/apollo-server/tree/main/docs/source/migration.mdx" class="css-1keuqhy e694h6z1"><style data-emotion-css="k9tv6n">.css-k9tv6n{overflow:visible;height:26px;}.css-k9tv6n *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 26 26" class="css-k9tv6n"><g fill="none" fill-rule="evenodd" transform="translate(1 1)"><path fill="currentColor" fill-rule="nonzero" d="M15.425 22.985V20.95c0-1.081-.371-1.876-1.112-2.385.465-.045.891-.107 1.279-.188a9.967 9.967 0 0 0 1.233-.348 6.039 6.039 0 0 0 1.166-.543c.344-.21.674-.482.991-.817.317-.335.583-.715.797-1.139.215-.424.384-.933.509-1.527a9.543 9.543 0 0 0 .188-1.963c0-1.384-.451-2.563-1.353-3.537.411-1.072.366-2.237-.134-3.497l-.335-.04c-.232-.027-.65.071-1.253.295-.603.224-1.279.589-2.03 1.098a12.317 12.317 0 0 0-3.309-.442c-1.152 0-2.251.147-3.296.442a11.41 11.41 0 0 0-1.346-.797 6.948 6.948 0 0 0-1.018-.429 3.503 3.503 0 0 0-1.132-.154.844.844 0 0 0-.134.027c-.5 1.268-.545 2.434-.134 3.497-.902.973-1.353 2.152-1.353 3.537 0 .715.063 1.369.188 1.963.125.594.295 1.103.509 1.527.214.424.48.804.797 1.139.317.335.647.607.991.817.344.21.732.391 1.166.543a9.54 9.54 0 0 0 1.233.348c.389.08.815.143 1.279.188-.732.5-1.098 1.295-1.098 2.385v2.075C10.5 24 14 24 15.425 22.985z"></path><circle cx="12" cy="12" r="12" stroke="currentColor" stroke-width="1.5"></circle></g></svg> Edit on GitHub</a></h5><h5 class="css-rntvij e694h6z2"><a target="_blank" rel="noopener noreferrer" href="https://community.apollographql.com/" class="css-1keuqhy e694h6z1"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><g fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M11.25 18.75a1.5 1.5 0 0 1-1.5-1.5v-7.5a1.5 1.5 0 0 1 1.5-1.5h10.5a1.5 1.5 0 0 1 1.5 1.5v7.5a1.5 1.5 0 0 1-1.5 1.5h-1.5v4.5l-4.5-4.5h-4.5z"></path><path d="M6.75 12.75l-3 3v-4.5h-1.5a1.5 1.5 0 0 1-1.5-1.5v-7.5a1.5 1.5 0 0 1 1.5-1.5h10.5a1.5 1.5 0 0 1 1.5 1.5v3"></path></g></svg> Discuss in forums</a></h5></aside></div></div></main></div><style data-emotion="css 12zcwkl">.css-12zcwkl{width:100%;height:100%;background-color:rgba(90,98,112,0.5);overflow:auto;position:fixed;top:0;left:0;z-index:3;perspective:1000px;transition-property:opacity,visibility;transition-duration:150ms;transition-timing-function:ease-in-out;}</style><div style="opacity:0;visibility:hidden" class="css-12zcwkl em9i7t214"><style data-emotion="css 10dh5mk">.css-10dh5mk{margin-bottom:24px;border-radius:4px;box-shadow:rgba(0,0,0,0.1) 0 2px 12px;background-color:white;overflow:hidden;position:absolute;transform-origin:25% 25%;-webkit-transition:-webkit-transform 150ms ease-in-out;transition:transform 150ms ease-in-out;outline:none;}</style><div tabindex="-1" style="transform:translate3d(0,-24px,-16px) rotate3d(1,0,0.1,8deg)" class="css-10dh5mk em9i7t213"><style data-emotion="css 1d3ruj1">.css-1d3ruj1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-flow:row wrap;-webkit-flex-flow:row wrap;-ms-flex-flow:row wrap;flex-flow:row wrap;-webkit-writing-mode:vertical-lr;-ms-writing-mode:tb;writing-mode:vertical-lr;margin:12px;height:240px;padding-top:15px;}@media (max-width: 850px){.css-1d3ruj1{height:auto;width:300px;}}</style><nav class="css-1d3ruj1 em9i7t27"><style data-emotion="css 120ki2j">.css-120ki2j{display:block;width:220px;-webkit-writing-mode:horizontal-tb;-ms-writing-mode:lr;writing-mode:horizontal-tb;}@media (max-width: 850px){.css-120ki2j{width:100%;}}</style><div class="css-120ki2j em9i7t26"><style data-emotion="css bm3qgz">.css-bm3qgz{letter-spacing:0.142em;text-transform:uppercase;margin-left:12px;margin-bottom:0;font-size:13px;font-weight:600;color:#959DAA;}</style><h6 class="css-bm3qgz em9i7t212">Core</h6><style data-emotion="css 1959pia">.css-1959pia{margin:0;margin-bottom:20px;}</style><ul class="css-1959pia em9i7t211"><style data-emotion="css bhdh8d">.css-bhdh8d{list-style:none;margin:2px;margin-left:3px;}</style><li class="css-bhdh8d em9i7t210"><style data-emotion="css mne644">.css-mne644{display:block;height:100%;padding:8px;border-radius:4px;-webkit-text-decoration:none;text-decoration:none;background-color:transparent;transition-property:color,background-color;transition-duration:150ms;transition-timing-function:ease-in-out;}@media (hover: hover){.css-mne644:hover{background-color:#d9cfff;}.css-mne644:hover h4{color:#3f20ba;}}</style><a href="https://www.apollographql.com/docs" title="Learn about each part of the Apollo platform and how they all work together." class="css-mne644 em9i7t29"><style data-emotion="css 12yi4b2">.css-12yi4b2{margin-bottom:0;font-weight:600;color:#2F353F;}</style><h4 class="css-12yi4b2 em9i7t28">Apollo Basics</h4></a></li></ul></div><div class="css-120ki2j em9i7t26"><h6 class="css-bm3qgz em9i7t212">Apollo Client</h6><ul class="css-1959pia em9i7t211"><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/react" title="Manage your React app&#x27;s state and seamlessly execute GraphQL operations." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">JS / React</h4></a></li><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/ios" title="Manage your iOS app&#x27;s state and seamlessly execute GraphQL operations." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">iOS</h4></a></li><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/kotlin" title="Manage your Kotlin app&#x27;s state and seamlessly execute GraphQL operations." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">Kotlin / Android</h4></a></li></ul></div><div class="css-120ki2j em9i7t26"><h6 class="css-bm3qgz em9i7t212">Backend</h6><ul class="css-1959pia em9i7t211"><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/apollo-server" title="Configure a production-ready GraphQL server to fetch and combine data from multiple sources." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">Apollo Server</h4></a></li><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/federation" title="Implement a single unified graph across multiple subgraphs." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">Apollo Federation</h4></a></li><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/router" title="Optimize your federated graph with a high-performance graph router written in Rust." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">Apollo Router (alpha)</h4></a></li></ul></div><div class="css-120ki2j em9i7t26"><h6 class="css-bm3qgz em9i7t212">Tools</h6><ul class="css-1959pia em9i7t211"><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/graph-manager" title="Build your graph with your team, evolve it safely, and keep it running smoothly." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">Apollo Studio</h4></a></li><li class="css-bhdh8d em9i7t210"><a href="https://www.apollographql.com/docs/rover" title="Manage your Studio graphs and schemas from the command line." class="css-mne644 em9i7t29"><h4 class="css-12yi4b2 em9i7t28">Rover CLI</h4></a></li></ul></div></nav><style data-emotion="css 1we5kcv">.css-1we5kcv{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:16px 24px;background-color:#F4F6F8;}@media (max-width: 850px){.css-1we5kcv{display:block;}}</style><nav class="css-1we5kcv em9i7t23"><style data-emotion="css 16cjsrx">.css-16cjsrx{color:#5A6270;-webkit-text-decoration:none;text-decoration:none;}.css-16cjsrx:hover{color:#959DAA;}.css-16cjsrx:not(:last-child){margin-right:24px;}</style><a href="https://community.apollographql.com/" target="_blank" rel="noopener noreferrer" class="css-16cjsrx em9i7t22">Forums</a><a href="https://blog.apollographql.com/" target="_blank" rel="noopener noreferrer" class="css-16cjsrx em9i7t22">Blog</a><a href="https://www.apollographql.com/docs/community/" class="css-16cjsrx em9i7t22">Contribute</a><a href="https://summit.graphql.com/" target="_blank" rel="noopener noreferrer" class="css-16cjsrx em9i7t22">Summit</a><style data-emotion="css gdccfg">.css-gdccfg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-left:auto;}@media (max-width: 850px){.css-gdccfg{margin-top:8px;}}</style><div class="css-gdccfg em9i7t21"><style data-emotion="css 1u52uy1">.css-1u52uy1{color:#5A6270;}.css-1u52uy1:hover{color:#959DAA;}.css-1u52uy1:not(:last-child){margin-right:24px;}.css-1u52uy1 svg{height:24px;width:24px;display:block;fill:currentColor;}</style><a href="https://twitter.com/apollographql" title="Twitter" target="_blank" class="css-1u52uy1 em9i7t20"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="currentColor" d="M23.32 6.44a.5.5 0 0 0-.2-.87l-.79-.2a.5.5 0 0 1-.33-.7l.44-.89a.501.501 0 0 0-.58-.7l-2 .56a.502.502 0 0 1-.44-.08 5 5 0 0 0-8 4v.36a.25.25 0 0 1-.22.25c-2.81.33-5.5-1.1-8.4-4.44a.508.508 0 0 0-.51-.15A.5.5 0 0 0 2 4a7.575 7.575 0 0 0 .46 4.92.25.25 0 0 1-.26.36l-1.12-.22a.5.5 0 0 0-.57.59 5.15 5.15 0 0 0 2.37 3.78.25.25 0 0 1 0 .45l-.53.21a.5.5 0 0 0-.26.69 4.36 4.36 0 0 0 3.2 2.48.25.25 0 0 1 0 .47c-1.36.562-2.819.845-4.29.83a.51.51 0 0 0-.2 1 20.063 20.063 0 0 0 8.14 1.93 12.58 12.58 0 0 0 7-2A12.5 12.5 0 0 0 21.5 9.06v-.87a.499.499 0 0 1 .18-.38l1.64-1.37z"></path></svg></a><a href="https://www.youtube.com/channel/UC0pEW_GOrMJ23l8QcrGdKSw" title="YouTube" target="_blank" class="css-1u52uy1 em9i7t20"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="css-1a134qk"><path fill="currentColor" d="M20.06 3.5H3.94A3.94 3.94 0 0 0 0 7.44v9.12a3.94 3.94 0 0 0 3.94 3.94h16.12A3.94 3.94 0 0 0 24 16.56V7.44a3.94 3.94 0 0 0-3.94-3.94zM16.54 12l-6.77 4.36a.5.5 0 0 1-.77-.42V7.28a.5.5 0 0 1 .77-.42l6.77 4.33a.5.5 0 0 1 0 .84V12z"></path></svg></a></div></nav></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-74643563-13"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-74643563-13', {"send_page_view":false});gtag('config', 'G-0BGG5V2W2K', {"send_page_view":false});
      }
      </script><script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/migration/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-59aea5adbecf28484f73.js"],"app":["/app-a55f8575680208f4298f.js"],"component---node-modules-gatsby-theme-apollo-core-src-pages-404-js":["/component---node-modules-gatsby-theme-apollo-core-src-pages-404-js-517170fe97048272a691.js"],"component---node-modules-gatsby-theme-apollo-docs-src-components-template-js":[]};/*]]>*/</script><script src="/polyfill-59aea5adbecf28484f73.js" nomodule=""></script><script src="/app-a55f8575680208f4298f.js" async=""></script><script src="/79ac12c6-689c070edc40661ddeb0.js" async=""></script><script src="/framework-bd32e92195540dc9b6da.js" async=""></script><script src="/webpack-runtime-1e0d3b6f0e0e2f3ff88f.js" async=""></script></body></html>