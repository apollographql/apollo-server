{"expireTime":9007200901520843000,"key":"gatsby-plugin-mdx-entire-payload-7788e0c4f85fb3f56c2f2badc73855ee-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import {ExpansionPanel, MultiCodeBlock} from 'gatsby-theme-apollo-docs';","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":73,"offset":73},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Apollo Server 3 removes built-in support for subscriptions.","position":{"start":{"line":4,"column":5,"offset":79},"end":{"line":4,"column":64,"offset":138},"indent":[]}}],"position":{"start":{"line":4,"column":3,"offset":77},"end":{"line":4,"column":66,"offset":140},"indent":[]}},{"type":"text","value":" You can reenable support as ","position":{"start":{"line":4,"column":66,"offset":140},"end":{"line":4,"column":95,"offset":169},"indent":[]}},{"type":"link","title":null,"url":"#enabling-subscriptions","children":[{"type":"text","value":"described below","position":{"start":{"line":4,"column":96,"offset":170},"end":{"line":4,"column":111,"offset":185},"indent":[]}}],"position":{"start":{"line":4,"column":95,"offset":169},"end":{"line":4,"column":137,"offset":211},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":4,"column":137,"offset":211},"end":{"line":4,"column":138,"offset":212},"indent":[]}}],"position":{"start":{"line":4,"column":3,"offset":77},"end":{"line":4,"column":138,"offset":212},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Subscriptions are not currently supported in ","position":{"start":{"line":6,"column":5,"offset":219},"end":{"line":6,"column":50,"offset":264},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/federation/","children":[{"type":"text","value":"Apollo Federation","position":{"start":{"line":6,"column":51,"offset":265},"end":{"line":6,"column":68,"offset":282},"indent":[]}}],"position":{"start":{"line":6,"column":50,"offset":264},"end":{"line":6,"column":117,"offset":331},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":6,"column":117,"offset":331},"end":{"line":6,"column":118,"offset":332},"indent":[]}}],"position":{"start":{"line":6,"column":3,"offset":217},"end":{"line":6,"column":120,"offset":334},"indent":[]}}],"position":{"start":{"line":6,"column":3,"offset":217},"end":{"line":6,"column":120,"offset":334},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This article has been updated to use the ","position":{"start":{"line":8,"column":3,"offset":339},"end":{"line":8,"column":44,"offset":380},"indent":[]}},{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":8,"column":44,"offset":380},"end":{"line":8,"column":56,"offset":392},"indent":[]}},{"type":"text","value":" library to add support for subscriptions to Apollo Server. We no longer recommend using the previously documented ","position":{"start":{"line":8,"column":56,"offset":392},"end":{"line":8,"column":171,"offset":507},"indent":[]}},{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":8,"column":171,"offset":507},"end":{"line":8,"column":199,"offset":535},"indent":[]}},{"type":"text","value":", because this library is not actively maintained. For more information about the differences between the two libraries, see ","position":{"start":{"line":8,"column":199,"offset":535},"end":{"line":8,"column":324,"offset":660},"indent":[]}},{"type":"link","title":null,"url":"#switching-from-subscriptions-transport-ws","children":[{"type":"text","value":"Switching from ","position":{"start":{"line":8,"column":325,"offset":661},"end":{"line":8,"column":340,"offset":676},"indent":[]}},{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":8,"column":340,"offset":676},"end":{"line":8,"column":368,"offset":704},"indent":[]}}],"position":{"start":{"line":8,"column":324,"offset":660},"end":{"line":8,"column":413,"offset":749},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":8,"column":413,"offset":749},"end":{"line":8,"column":414,"offset":750},"indent":[]}}],"position":{"start":{"line":8,"column":3,"offset":339},"end":{"line":8,"column":414,"offset":750},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":75},"end":{"line":8,"column":414,"offset":750},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Subscriptions","position":{"start":{"line":10,"column":3,"offset":754},"end":{"line":10,"column":16,"offset":767},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":752},"end":{"line":10,"column":18,"offset":769},"indent":[]}},{"type":"text","value":" are long-lasting GraphQL read operations that can update their result whenever a particular server-side event occurs. Most commonly, updated results are ","position":{"start":{"line":10,"column":18,"offset":769},"end":{"line":10,"column":172,"offset":923},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"pushed","position":{"start":{"line":10,"column":173,"offset":924},"end":{"line":10,"column":179,"offset":930},"indent":[]}}],"position":{"start":{"line":10,"column":172,"offset":923},"end":{"line":10,"column":180,"offset":931},"indent":[]}},{"type":"text","value":" from the server to subscribing clients. For example, a chat application's server might use a subscription to push newly received messages to all clients in a particular chat room.","position":{"start":{"line":10,"column":180,"offset":931},"end":{"line":10,"column":360,"offset":1111},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":752},"end":{"line":10,"column":360,"offset":1111},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Because subscription updates are usually pushed by the server (instead of polled by the client), they usually use ","position":{"start":{"line":12,"column":1,"offset":1113},"end":{"line":12,"column":115,"offset":1227},"indent":[]}},{"type":"link","title":null,"url":"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API","children":[{"type":"text","value":"the WebSocket protocol","position":{"start":{"line":12,"column":116,"offset":1228},"end":{"line":12,"column":138,"offset":1250},"indent":[]}}],"position":{"start":{"line":12,"column":115,"offset":1227},"end":{"line":12,"column":204,"offset":1316},"indent":[]}},{"type":"text","value":" instead of HTTP.","position":{"start":{"line":12,"column":204,"offset":1316},"end":{"line":12,"column":221,"offset":1333},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":1113},"end":{"line":12,"column":221,"offset":1333},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Important:","position":{"start":{"line":14,"column":5,"offset":1339},"end":{"line":14,"column":15,"offset":1349},"indent":[]}}],"position":{"start":{"line":14,"column":3,"offset":1337},"end":{"line":14,"column":17,"offset":1351},"indent":[]}},{"type":"text","value":" Compared to queries and mutations, subscriptions are significantly more complex to implement. Before you begin, ","position":{"start":{"line":14,"column":17,"offset":1351},"end":{"line":14,"column":130,"offset":1464},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/data/subscriptions/#when-to-use-subscriptions","children":[{"type":"text","value":"confirm that your use case requires subscriptions","position":{"start":{"line":14,"column":131,"offset":1465},"end":{"line":14,"column":180,"offset":1514},"indent":[]}}],"position":{"start":{"line":14,"column":130,"offset":1464},"end":{"line":14,"column":269,"offset":1603},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":14,"column":269,"offset":1603},"end":{"line":14,"column":270,"offset":1604},"indent":[]}}],"position":{"start":{"line":14,"column":3,"offset":1337},"end":{"line":14,"column":270,"offset":1604},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1335},"end":{"line":14,"column":270,"offset":1604},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Schema definition","position":{"start":{"line":16,"column":4,"offset":1609},"end":{"line":16,"column":21,"offset":1626},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":1606},"end":{"line":16,"column":21,"offset":1626},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Your schema's ","position":{"start":{"line":18,"column":1,"offset":1628},"end":{"line":18,"column":15,"offset":1642},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":18,"column":15,"offset":1642},"end":{"line":18,"column":29,"offset":1656},"indent":[]}},{"type":"text","value":" type defines top-level fields that clients can subscribe to:","position":{"start":{"line":18,"column":29,"offset":1656},"end":{"line":18,"column":90,"offset":1717},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1628},"end":{"line":18,"column":90,"offset":1717},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"type Subscription {\n  postCreated: Post\n}","position":{"start":{"line":20,"column":1,"offset":1719},"end":{"line":24,"column":4,"offset":1775},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":26,"column":1,"offset":1777},"end":{"line":26,"column":5,"offset":1781},"indent":[]}},{"type":"inlineCode","value":"postCreated","position":{"start":{"line":26,"column":5,"offset":1781},"end":{"line":26,"column":18,"offset":1794},"indent":[]}},{"type":"text","value":" field will update its value whenever a new ","position":{"start":{"line":26,"column":18,"offset":1794},"end":{"line":26,"column":62,"offset":1838},"indent":[]}},{"type":"inlineCode","value":"Post","position":{"start":{"line":26,"column":62,"offset":1838},"end":{"line":26,"column":68,"offset":1844},"indent":[]}},{"type":"text","value":" is created on the backend, thus pushing the ","position":{"start":{"line":26,"column":68,"offset":1844},"end":{"line":26,"column":113,"offset":1889},"indent":[]}},{"type":"inlineCode","value":"Post","position":{"start":{"line":26,"column":113,"offset":1889},"end":{"line":26,"column":119,"offset":1895},"indent":[]}},{"type":"text","value":" to subscribing clients.","position":{"start":{"line":26,"column":119,"offset":1895},"end":{"line":26,"column":143,"offset":1919},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1777},"end":{"line":26,"column":143,"offset":1919},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Clients can subscribe to the ","position":{"start":{"line":28,"column":1,"offset":1921},"end":{"line":28,"column":30,"offset":1950},"indent":[]}},{"type":"inlineCode","value":"postCreated","position":{"start":{"line":28,"column":30,"offset":1950},"end":{"line":28,"column":43,"offset":1963},"indent":[]}},{"type":"text","value":" field with a GraphQL string, like this:","position":{"start":{"line":28,"column":43,"offset":1963},"end":{"line":28,"column":83,"offset":2003},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1921},"end":{"line":28,"column":83,"offset":2003},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"subscription PostFeed {\n  postCreated {\n    author\n    comment\n  }\n}","position":{"start":{"line":30,"column":1,"offset":2005},"end":{"line":37,"column":4,"offset":2088},"indent":[1,1,1,1,1,1,1]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"Each subscription operation can subscribe to only ","position":{"start":{"line":39,"column":3,"offset":2092},"end":{"line":39,"column":53,"offset":2142},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"one","position":{"start":{"line":39,"column":54,"offset":2143},"end":{"line":39,"column":57,"offset":2146},"indent":[]}}],"position":{"start":{"line":39,"column":53,"offset":2142},"end":{"line":39,"column":58,"offset":2147},"indent":[]}},{"type":"text","value":" field of the ","position":{"start":{"line":39,"column":58,"offset":2147},"end":{"line":39,"column":72,"offset":2161},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":39,"column":72,"offset":2161},"end":{"line":39,"column":86,"offset":2175},"indent":[]}},{"type":"text","value":" type.","position":{"start":{"line":39,"column":86,"offset":2175},"end":{"line":39,"column":92,"offset":2181},"indent":[]}}],"position":{"start":{"line":39,"column":3,"offset":2092},"end":{"line":39,"column":92,"offset":2181},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":2090},"end":{"line":39,"column":92,"offset":2181},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Enabling subscriptions","position":{"start":{"line":41,"column":4,"offset":2186},"end":{"line":41,"column":26,"offset":2208},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":2183},"end":{"line":41,"column":26,"offset":2208},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"Beginning in Apollo Server 3, subscriptions are ","position":{"start":{"line":43,"column":3,"offset":2212},"end":{"line":43,"column":51,"offset":2260},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"not","position":{"start":{"line":43,"column":53,"offset":2262},"end":{"line":43,"column":56,"offset":2265},"indent":[]}}],"position":{"start":{"line":43,"column":51,"offset":2260},"end":{"line":43,"column":58,"offset":2267},"indent":[]}},{"type":"text","value":" supported by the \"batteries-included\" ","position":{"start":{"line":43,"column":58,"offset":2267},"end":{"line":43,"column":97,"offset":2306},"indent":[]}},{"type":"inlineCode","value":"apollo-server","position":{"start":{"line":43,"column":97,"offset":2306},"end":{"line":43,"column":112,"offset":2321},"indent":[]}},{"type":"text","value":" package. To enable subscriptions, you must first ","position":{"start":{"line":43,"column":112,"offset":2321},"end":{"line":43,"column":162,"offset":2371},"indent":[]}},{"type":"link","title":null,"url":"../integrations/middleware/#swapping-out-apollo-server","children":[{"type":"text","value":"swap to the ","position":{"start":{"line":43,"column":163,"offset":2372},"end":{"line":43,"column":175,"offset":2384},"indent":[]}},{"type":"inlineCode","value":"apollo-server-express","position":{"start":{"line":43,"column":175,"offset":2384},"end":{"line":43,"column":198,"offset":2407},"indent":[]}},{"type":"text","value":" package","position":{"start":{"line":43,"column":198,"offset":2407},"end":{"line":43,"column":206,"offset":2415},"indent":[]}}],"position":{"start":{"line":43,"column":162,"offset":2371},"end":{"line":43,"column":263,"offset":2472},"indent":[]}},{"type":"text","value":" (or any other Apollo Server integration package that supports subscriptions).","position":{"start":{"line":43,"column":263,"offset":2472},"end":{"line":43,"column":341,"offset":2550},"indent":[]}}],"position":{"start":{"line":43,"column":3,"offset":2212},"end":{"line":43,"column":341,"offset":2550},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The following steps assume you've already swapped to ","position":{"start":{"line":45,"column":3,"offset":2555},"end":{"line":45,"column":56,"offset":2608},"indent":[]}},{"type":"inlineCode","value":"apollo-server-express","position":{"start":{"line":45,"column":56,"offset":2608},"end":{"line":45,"column":79,"offset":2631},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":45,"column":79,"offset":2631},"end":{"line":45,"column":80,"offset":2632},"indent":[]}}],"position":{"start":{"line":45,"column":3,"offset":2555},"end":{"line":45,"column":80,"offset":2632},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":2210},"end":{"line":45,"column":80,"offset":2632},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To run both an Express app ","position":{"start":{"line":47,"column":1,"offset":2634},"end":{"line":47,"column":28,"offset":2661},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"and","position":{"start":{"line":47,"column":29,"offset":2662},"end":{"line":47,"column":32,"offset":2665},"indent":[]}}],"position":{"start":{"line":47,"column":28,"offset":2661},"end":{"line":47,"column":33,"offset":2666},"indent":[]}},{"type":"text","value":" a separate WebSocket server for subscriptions, we'll create an ","position":{"start":{"line":47,"column":33,"offset":2666},"end":{"line":47,"column":97,"offset":2730},"indent":[]}},{"type":"inlineCode","value":"http.Server","position":{"start":{"line":47,"column":97,"offset":2730},"end":{"line":47,"column":110,"offset":2743},"indent":[]}},{"type":"text","value":" instance that effectively wraps the two and becomes our new ","position":{"start":{"line":47,"column":110,"offset":2743},"end":{"line":47,"column":171,"offset":2804},"indent":[]}},{"type":"inlineCode","value":"listen","position":{"start":{"line":47,"column":171,"offset":2804},"end":{"line":47,"column":179,"offset":2812},"indent":[]}},{"type":"text","value":"er.","position":{"start":{"line":47,"column":179,"offset":2812},"end":{"line":47,"column":182,"offset":2815},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":2634},"end":{"line":47,"column":182,"offset":2815},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":true,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Install ","position":{"start":{"line":49,"column":4,"offset":2820},"end":{"line":49,"column":12,"offset":2828},"indent":[]}},{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":49,"column":12,"offset":2828},"end":{"line":49,"column":24,"offset":2840},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":49,"column":24,"offset":2840},"end":{"line":49,"column":26,"offset":2842},"indent":[]}},{"type":"inlineCode","value":"ws","position":{"start":{"line":49,"column":26,"offset":2842},"end":{"line":49,"column":30,"offset":2846},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":49,"column":30,"offset":2846},"end":{"line":49,"column":32,"offset":2848},"indent":[]}},{"type":"inlineCode","value":"@graphql-tools/schema","position":{"start":{"line":49,"column":32,"offset":2848},"end":{"line":49,"column":55,"offset":2871},"indent":[]}},{"type":"text","value":", and 'apollo-server-core':","position":{"start":{"line":49,"column":55,"offset":2871},"end":{"line":49,"column":82,"offset":2898},"indent":[]}}],"position":{"start":{"line":49,"column":4,"offset":2820},"end":{"line":49,"column":82,"offset":2898},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"npm install graphql-ws ws @graphql-tools/schema apollo-server-core","position":{"start":{"line":50,"column":5,"offset":2903},"end":{"line":52,"column":8,"offset":2989},"indent":[5,5]}}],"position":{"start":{"line":49,"column":1,"offset":2817},"end":{"line":53,"column":1,"offset":2990},"indent":[1,1,1,1]}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Add the following imports to the file where you initialize your ","position":{"start":{"line":54,"column":4,"offset":2994},"end":{"line":54,"column":68,"offset":3058},"indent":[]}},{"type":"inlineCode","value":"ApolloServer","position":{"start":{"line":54,"column":68,"offset":3058},"end":{"line":54,"column":82,"offset":3072},"indent":[]}},{"type":"text","value":" instance (we'll use these in later steps):","position":{"start":{"line":54,"column":82,"offset":3072},"end":{"line":54,"column":125,"offset":3115},"indent":[]}}],"position":{"start":{"line":54,"column":4,"offset":2994},"end":{"line":54,"column":125,"offset":3115},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"import { createServer } from 'http';\nimport { ApolloServerPluginDrainHttpServer } from \"apollo-server-core\";\nimport { makeExecutableSchema } from '@graphql-tools/schema';\nimport { WebSocketServer } from 'ws';\nimport { useServer } from 'graphql-ws/lib/use/ws';","position":{"start":{"line":56,"column":5,"offset":3121},"end":{"line":62,"column":8,"offset":3429},"indent":[5,5,5,5,5,5]}}],"position":{"start":{"line":54,"column":1,"offset":2991},"end":{"line":63,"column":1,"offset":3430},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Next, in order to set up both the HTTP and subscription servers, we need to first create an ","position":{"start":{"line":64,"column":4,"offset":3434},"end":{"line":64,"column":96,"offset":3526},"indent":[]}},{"type":"inlineCode","value":"http.Server","position":{"start":{"line":64,"column":96,"offset":3526},"end":{"line":64,"column":109,"offset":3539},"indent":[]}},{"type":"text","value":". Do this by passing your Express ","position":{"start":{"line":64,"column":109,"offset":3539},"end":{"line":64,"column":143,"offset":3573},"indent":[]}},{"type":"inlineCode","value":"app","position":{"start":{"line":64,"column":143,"offset":3573},"end":{"line":64,"column":148,"offset":3578},"indent":[]}},{"type":"text","value":" to the ","position":{"start":{"line":64,"column":148,"offset":3578},"end":{"line":64,"column":156,"offset":3586},"indent":[]}},{"type":"inlineCode","value":"createServer","position":{"start":{"line":64,"column":156,"offset":3586},"end":{"line":64,"column":170,"offset":3600},"indent":[]}},{"type":"text","value":" function, which we imported from the ","position":{"start":{"line":64,"column":170,"offset":3600},"end":{"line":64,"column":208,"offset":3638},"indent":[]}},{"type":"inlineCode","value":"http","position":{"start":{"line":64,"column":208,"offset":3638},"end":{"line":64,"column":214,"offset":3644},"indent":[]}},{"type":"text","value":" module:","position":{"start":{"line":64,"column":214,"offset":3644},"end":{"line":64,"column":222,"offset":3652},"indent":[]}}],"position":{"start":{"line":64,"column":4,"offset":3434},"end":{"line":64,"column":222,"offset":3652},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"// This `app` is the returned value from `express()`.\nconst httpServer = createServer(app);","position":{"start":{"line":66,"column":5,"offset":3658},"end":{"line":69,"column":8,"offset":3786},"indent":[5,5,5]}}],"position":{"start":{"line":64,"column":1,"offset":3431},"end":{"line":70,"column":1,"offset":3787},"indent":[1,1,1,1,1,1]}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create an instance of ","position":{"start":{"line":71,"column":4,"offset":3791},"end":{"line":71,"column":26,"offset":3813},"indent":[]}},{"type":"inlineCode","value":"GraphQLSchema","position":{"start":{"line":71,"column":26,"offset":3813},"end":{"line":71,"column":41,"offset":3828},"indent":[]}},{"type":"text","value":" (if you haven't already).","position":{"start":{"line":71,"column":41,"offset":3828},"end":{"line":71,"column":67,"offset":3854},"indent":[]}}],"position":{"start":{"line":71,"column":4,"offset":3791},"end":{"line":71,"column":67,"offset":3854},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If you already pass the ","position":{"start":{"line":73,"column":7,"offset":3862},"end":{"line":73,"column":31,"offset":3886},"indent":[]}},{"type":"inlineCode","value":"schema","position":{"start":{"line":73,"column":31,"offset":3886},"end":{"line":73,"column":39,"offset":3894},"indent":[]}},{"type":"text","value":" option to the ","position":{"start":{"line":73,"column":39,"offset":3894},"end":{"line":73,"column":54,"offset":3909},"indent":[]}},{"type":"inlineCode","value":"ApolloServer","position":{"start":{"line":73,"column":54,"offset":3909},"end":{"line":73,"column":68,"offset":3923},"indent":[]}},{"type":"text","value":" constructor (instead of ","position":{"start":{"line":73,"column":68,"offset":3923},"end":{"line":73,"column":93,"offset":3948},"indent":[]}},{"type":"inlineCode","value":"typeDefs","position":{"start":{"line":73,"column":93,"offset":3948},"end":{"line":73,"column":103,"offset":3958},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":73,"column":103,"offset":3958},"end":{"line":73,"column":108,"offset":3963},"indent":[]}},{"type":"inlineCode","value":"resolvers","position":{"start":{"line":73,"column":108,"offset":3963},"end":{"line":73,"column":119,"offset":3974},"indent":[]}},{"type":"text","value":"), you can skip this step.","position":{"start":{"line":73,"column":119,"offset":3974},"end":{"line":73,"column":145,"offset":4000},"indent":[]}}],"position":{"start":{"line":73,"column":7,"offset":3862},"end":{"line":73,"column":145,"offset":4000},"indent":[]}}],"position":{"start":{"line":73,"column":5,"offset":3860},"end":{"line":73,"column":145,"offset":4000},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The subscription server (which we'll instantiate next) doesn't take ","position":{"start":{"line":75,"column":5,"offset":4006},"end":{"line":75,"column":73,"offset":4074},"indent":[]}},{"type":"inlineCode","value":"typeDefs","position":{"start":{"line":75,"column":73,"offset":4074},"end":{"line":75,"column":83,"offset":4084},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":75,"column":83,"offset":4084},"end":{"line":75,"column":88,"offset":4089},"indent":[]}},{"type":"inlineCode","value":"resolvers","position":{"start":{"line":75,"column":88,"offset":4089},"end":{"line":75,"column":99,"offset":4100},"indent":[]}},{"type":"text","value":" options. Instead, it takes an executable ","position":{"start":{"line":75,"column":99,"offset":4100},"end":{"line":75,"column":141,"offset":4142},"indent":[]}},{"type":"inlineCode","value":"GraphQLSchema","position":{"start":{"line":75,"column":141,"offset":4142},"end":{"line":75,"column":156,"offset":4157},"indent":[]}},{"type":"text","value":". We can pass this ","position":{"start":{"line":75,"column":156,"offset":4157},"end":{"line":75,"column":175,"offset":4176},"indent":[]}},{"type":"inlineCode","value":"schema","position":{"start":{"line":75,"column":175,"offset":4176},"end":{"line":75,"column":183,"offset":4184},"indent":[]}},{"type":"text","value":" object to both the subscription server and ","position":{"start":{"line":75,"column":183,"offset":4184},"end":{"line":75,"column":227,"offset":4228},"indent":[]}},{"type":"inlineCode","value":"ApolloServer","position":{"start":{"line":75,"column":227,"offset":4228},"end":{"line":75,"column":241,"offset":4242},"indent":[]}},{"type":"text","value":". This way, we make sure that the same schema is being used in both places.","position":{"start":{"line":75,"column":241,"offset":4242},"end":{"line":75,"column":316,"offset":4317},"indent":[]}}],"position":{"start":{"line":75,"column":5,"offset":4006},"end":{"line":75,"column":316,"offset":4317},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"const schema = makeExecutableSchema({ typeDefs, resolvers });\n// ...\nconst server = new ApolloServer({\n  schema,\n});","position":{"start":{"line":77,"column":5,"offset":4323},"end":{"line":83,"column":8,"offset":4488},"indent":[5,5,5,5,5,5]}}],"position":{"start":{"line":71,"column":1,"offset":3788},"end":{"line":84,"column":1,"offset":4489},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a ","position":{"start":{"line":85,"column":4,"offset":4493},"end":{"line":85,"column":13,"offset":4502},"indent":[]}},{"type":"inlineCode","value":"WebSocketServer","position":{"start":{"line":85,"column":13,"offset":4502},"end":{"line":85,"column":30,"offset":4519},"indent":[]}},{"type":"text","value":" to use as your subscription server.","position":{"start":{"line":85,"column":30,"offset":4519},"end":{"line":85,"column":66,"offset":4555},"indent":[]}}],"position":{"start":{"line":85,"column":4,"offset":4493},"end":{"line":85,"column":66,"offset":4555},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"  // Creating the WebSocket server\n  const wsServer = new WebSocketServer({\n    // This is the `httpServer` we created in a previous step.\n    server: httpServer,\n    // Pass a different path here if your ApolloServer serves at\n    // a different path.\n    path: '/graphql',\n  });\n\n  // Hand in the schema we just created and have the\n  // WebSocketServer start listening.\n  const serverCleanup = useServer({ schema }, wsServer);","position":{"start":{"line":87,"column":5,"offset":4561},"end":{"line":100,"column":8,"offset":5063},"indent":[5,5,5,5,5,5,5,5,1,5,5,5,5]}}],"position":{"start":{"line":85,"column":1,"offset":4490},"end":{"line":101,"column":1,"offset":5064},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Add ","position":{"start":{"line":102,"column":4,"offset":5068},"end":{"line":102,"column":8,"offset":5072},"indent":[]}},{"type":"link","title":null,"url":"../integrations/plugins","children":[{"type":"text","value":"plugins","position":{"start":{"line":102,"column":9,"offset":5073},"end":{"line":102,"column":16,"offset":5080},"indent":[]}}],"position":{"start":{"line":102,"column":8,"offset":5072},"end":{"line":102,"column":42,"offset":5106},"indent":[]}},{"type":"text","value":" to your ","position":{"start":{"line":102,"column":42,"offset":5106},"end":{"line":102,"column":51,"offset":5115},"indent":[]}},{"type":"inlineCode","value":"ApolloServer","position":{"start":{"line":102,"column":51,"offset":5115},"end":{"line":102,"column":65,"offset":5129},"indent":[]}},{"type":"text","value":" constructor to shutdown both the HTTP server and the ","position":{"start":{"line":102,"column":65,"offset":5129},"end":{"line":102,"column":119,"offset":5183},"indent":[]}},{"type":"inlineCode","value":"WebSocketServer","position":{"start":{"line":102,"column":119,"offset":5183},"end":{"line":102,"column":136,"offset":5200},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":102,"column":136,"offset":5200},"end":{"line":102,"column":137,"offset":5201},"indent":[]}}],"position":{"start":{"line":102,"column":4,"offset":5068},"end":{"line":102,"column":137,"offset":5201},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"  const server = new ApolloServer({\n    schema,\n    plugins: [\n      // Proper shutdown for the HTTP server.\n      ApolloServerPluginDrainHttpServer({ httpServer }),\n\n      // Proper shutdown for the WebSocket server.\n      {\n        async serverWillStart() {\n          return {\n            async drainServer() {\n              await serverCleanup.dispose();\n            },\n          };\n        },\n      },\n    ],\n  });","position":{"start":{"line":104,"column":5,"offset":5207},"end":{"line":123,"column":8,"offset":5722},"indent":[5,5,5,5,5,1,5,5,5,5,5,5,5,5,5,5,5,5,5]}}],"position":{"start":{"line":102,"column":1,"offset":5065},"end":{"line":124,"column":1,"offset":5723},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Finally, ensure you are ","position":{"start":{"line":125,"column":4,"offset":5727},"end":{"line":125,"column":28,"offset":5751},"indent":[]}},{"type":"inlineCode","value":"listen","position":{"start":{"line":125,"column":28,"offset":5751},"end":{"line":125,"column":36,"offset":5759},"indent":[]}},{"type":"text","value":"ing to your ","position":{"start":{"line":125,"column":36,"offset":5759},"end":{"line":125,"column":48,"offset":5771},"indent":[]}},{"type":"inlineCode","value":"httpServer","position":{"start":{"line":125,"column":48,"offset":5771},"end":{"line":125,"column":60,"offset":5783},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":125,"column":60,"offset":5783},"end":{"line":125,"column":61,"offset":5784},"indent":[]}}],"position":{"start":{"line":125,"column":4,"offset":5727},"end":{"line":125,"column":61,"offset":5784},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Most Express applications call ","position":{"start":{"line":127,"column":5,"offset":5790},"end":{"line":127,"column":36,"offset":5821},"indent":[]}},{"type":"inlineCode","value":"app.listen(...)","position":{"start":{"line":127,"column":36,"offset":5821},"end":{"line":127,"column":53,"offset":5838},"indent":[]}},{"type":"text","value":", but for your setup  change this to ","position":{"start":{"line":127,"column":53,"offset":5838},"end":{"line":127,"column":90,"offset":5875},"indent":[]}},{"type":"inlineCode","value":"httpServer.listen(...)","position":{"start":{"line":127,"column":90,"offset":5875},"end":{"line":127,"column":114,"offset":5899},"indent":[]}},{"type":"text","value":" using the same arguments. This way, the server starts listening on the HTTP and WebSocket transports simultaneously.","position":{"start":{"line":127,"column":114,"offset":5899},"end":{"line":127,"column":231,"offset":6016},"indent":[]}}],"position":{"start":{"line":127,"column":5,"offset":5790},"end":{"line":127,"column":231,"offset":6016},"indent":[]}}],"position":{"start":{"line":125,"column":1,"offset":5724},"end":{"line":127,"column":231,"offset":6016},"indent":[1,1]}}],"position":{"start":{"line":49,"column":1,"offset":2817},"end":{"line":127,"column":231,"offset":6016},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A completed example of setting up subscriptions is shown below:","position":{"start":{"line":129,"column":1,"offset":6018},"end":{"line":129,"column":64,"offset":6081},"indent":[]}}],"position":{"start":{"line":129,"column":1,"offset":6018},"end":{"line":129,"column":64,"offset":6081},"indent":[]}},{"type":"jsx","value":"<ExpansionPanel title=\"Click to expand\">","position":{"start":{"line":131,"column":1,"offset":6083},"end":{"line":131,"column":41,"offset":6123},"indent":[]}},{"type":"jsx","value":"<MultiCodeBlock>","position":{"start":{"line":133,"column":1,"offset":6125},"end":{"line":133,"column":17,"offset":6141},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"import { ApolloServer } from 'apollo-server-express';\nimport { createServer } from 'http';\nimport express from 'express';\nimport { ApolloServerPluginDrainHttpServer } from \"apollo-server-core\";\nimport { makeExecutableSchema } from '@graphql-tools/schema';\nimport { WebSocketServer } from 'ws';\nimport { useServer } from 'graphql-ws/lib/use/ws';\nimport resolvers from './resolvers';\nimport typeDefs from './typeDefs';\n\n// Create the schema, which will be used separately by ApolloServer and\n// the WebSocket server.\nconst schema = makeExecutableSchema({ typeDefs, resolvers });\n\n// Create an Express app and HTTP server; we will attach both the WebSocket\n// server and the ApolloServer to this HTTP server.\nconst app = express();\nconst httpServer = createServer(app);\n\n// Create our WebSocket server using the HTTP server we just set up.\nconst wsServer = new WebSocketServer({\n  server: httpServer,\n  path: '/graphql',\n});\n// Save the returned server's info so we can shutdown this server later\nconst serverCleanup = useServer({ schema }, wsServer);\n\n// Set up ApolloServer.\nconst server = new ApolloServer({\n  schema,\n  plugins: [\n    // Proper shutdown for the HTTP server.\n    ApolloServerPluginDrainHttpServer({ httpServer }),\n\n    // Proper shutdown for the WebSocket server.\n    {\n      async serverWillStart() {\n        return {\n          async drainServer() {\n            await serverCleanup.dispose();\n          },\n        };\n      },\n    },\n  ],\n});\nawait server.start();\nserver.applyMiddleware({ app });\n\nconst PORT = 4000;\n// Now that our HTTP server is fully set up, we can listen to it.\nhttpServer.listen(PORT, () => {\n  console.log(\n    `Server is now running on http://localhost:${PORT}${server.graphqlPath}`,\n  );\n});","position":{"start":{"line":135,"column":1,"offset":6143},"end":{"line":192,"column":4,"offset":7901},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"jsx","value":"</MultiCodeBlock>","position":{"start":{"line":194,"column":1,"offset":7903},"end":{"line":194,"column":18,"offset":7920},"indent":[]}},{"type":"jsx","value":"</ExpansionPanel>","position":{"start":{"line":196,"column":1,"offset":7922},"end":{"line":196,"column":18,"offset":7939},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Resolving a subscription","position":{"start":{"line":198,"column":4,"offset":7944},"end":{"line":198,"column":28,"offset":7968},"indent":[]}}],"position":{"start":{"line":198,"column":1,"offset":7941},"end":{"line":198,"column":28,"offset":7968},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Resolvers for ","position":{"start":{"line":200,"column":1,"offset":7970},"end":{"line":200,"column":15,"offset":7984},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":200,"column":15,"offset":7984},"end":{"line":200,"column":29,"offset":7998},"indent":[]}},{"type":"text","value":" fields differ from resolvers for fields of other types. Specifically, ","position":{"start":{"line":200,"column":29,"offset":7998},"end":{"line":200,"column":100,"offset":8069},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":200,"column":100,"offset":8069},"end":{"line":200,"column":114,"offset":8083},"indent":[]}},{"type":"text","value":" field resolvers are ","position":{"start":{"line":200,"column":114,"offset":8083},"end":{"line":200,"column":135,"offset":8104},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"objects","position":{"start":{"line":200,"column":137,"offset":8106},"end":{"line":200,"column":144,"offset":8113},"indent":[]}}],"position":{"start":{"line":200,"column":135,"offset":8104},"end":{"line":200,"column":146,"offset":8115},"indent":[]}},{"type":"text","value":" that define a ","position":{"start":{"line":200,"column":146,"offset":8115},"end":{"line":200,"column":161,"offset":8130},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":200,"column":161,"offset":8130},"end":{"line":200,"column":172,"offset":8141},"indent":[]}},{"type":"text","value":" function:","position":{"start":{"line":200,"column":172,"offset":8141},"end":{"line":200,"column":182,"offset":8151},"indent":[]}}],"position":{"start":{"line":200,"column":1,"offset":7970},"end":{"line":200,"column":182,"offset":8151},"indent":[]}},{"type":"code","lang":"ts:title=index.ts","meta":null,"value":"const resolvers = {\n  Subscription: {\n    postCreated: {\n      // More on pubsub below\n      subscribe: () => pubsub.asyncIterator(['POST_CREATED']),\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":202,"column":1,"offset":8153},"end":{"line":212,"column":4,"offset":8369},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":214,"column":1,"offset":8371},"end":{"line":214,"column":5,"offset":8375},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":214,"column":5,"offset":8375},"end":{"line":214,"column":16,"offset":8386},"indent":[]}},{"type":"text","value":" function ","position":{"start":{"line":214,"column":16,"offset":8386},"end":{"line":214,"column":26,"offset":8396},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"must","position":{"start":{"line":214,"column":28,"offset":8398},"end":{"line":214,"column":32,"offset":8402},"indent":[]}}],"position":{"start":{"line":214,"column":26,"offset":8396},"end":{"line":214,"column":34,"offset":8404},"indent":[]}},{"type":"text","value":" return an object of type ","position":{"start":{"line":214,"column":34,"offset":8404},"end":{"line":214,"column":60,"offset":8430},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":214,"column":60,"offset":8430},"end":{"line":214,"column":75,"offset":8445},"indent":[]}},{"type":"text","value":", a standard interface for iterating over asynchronous results. In the example above, an ","position":{"start":{"line":214,"column":75,"offset":8445},"end":{"line":214,"column":164,"offset":8534},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":214,"column":164,"offset":8534},"end":{"line":214,"column":179,"offset":8549},"indent":[]}},{"type":"text","value":" is generated by ","position":{"start":{"line":214,"column":179,"offset":8549},"end":{"line":214,"column":196,"offset":8566},"indent":[]}},{"type":"inlineCode","value":"pubsub.asyncIterator","position":{"start":{"line":214,"column":196,"offset":8566},"end":{"line":214,"column":218,"offset":8588},"indent":[]}},{"type":"text","value":" (more on this below).","position":{"start":{"line":214,"column":218,"offset":8588},"end":{"line":214,"column":240,"offset":8610},"indent":[]}}],"position":{"start":{"line":214,"column":1,"offset":8371},"end":{"line":214,"column":240,"offset":8610},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"The ","position":{"start":{"line":217,"column":5,"offset":8617},"end":{"line":217,"column":9,"offset":8621},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":217,"column":9,"offset":8621},"end":{"line":217,"column":17,"offset":8629},"indent":[]}},{"type":"text","value":" class","position":{"start":{"line":217,"column":17,"offset":8629},"end":{"line":217,"column":23,"offset":8635},"indent":[]}}],"position":{"start":{"line":217,"column":1,"offset":8613},"end":{"line":217,"column":23,"offset":8635},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":219,"column":3,"offset":8639},"end":{"line":219,"column":7,"offset":8643},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":219,"column":7,"offset":8643},"end":{"line":219,"column":15,"offset":8651},"indent":[]}},{"type":"text","value":" class is ","position":{"start":{"line":219,"column":15,"offset":8651},"end":{"line":219,"column":25,"offset":8661},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"not","position":{"start":{"line":219,"column":27,"offset":8663},"end":{"line":219,"column":30,"offset":8666},"indent":[]}}],"position":{"start":{"line":219,"column":25,"offset":8661},"end":{"line":219,"column":32,"offset":8668},"indent":[]}},{"type":"text","value":" recommended for production environments, because it's an in-memory event system that only supports a single server instance. After you get subscriptions working in development, we strongly recommend switching it out for a different subclass of the abstract ","position":{"start":{"line":219,"column":32,"offset":8668},"end":{"line":219,"column":290,"offset":8926},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts","children":[{"type":"inlineCode","value":"PubSubEngine","position":{"start":{"line":219,"column":291,"offset":8927},"end":{"line":219,"column":305,"offset":8941},"indent":[]}},{"type":"text","value":" class","position":{"start":{"line":219,"column":305,"offset":8941},"end":{"line":219,"column":311,"offset":8947},"indent":[]}}],"position":{"start":{"line":219,"column":290,"offset":8926},"end":{"line":219,"column":401,"offset":9037},"indent":[]}},{"type":"text","value":". Recommended subclasses are listed in ","position":{"start":{"line":219,"column":401,"offset":9037},"end":{"line":219,"column":440,"offset":9076},"indent":[]}},{"type":"link","title":null,"url":"#production-pubsub-libraries","children":[{"type":"text","value":"Production ","position":{"start":{"line":219,"column":441,"offset":9077},"end":{"line":219,"column":452,"offset":9088},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":219,"column":452,"offset":9088},"end":{"line":219,"column":460,"offset":9096},"indent":[]}},{"type":"text","value":" libraries","position":{"start":{"line":219,"column":460,"offset":9096},"end":{"line":219,"column":470,"offset":9106},"indent":[]}}],"position":{"start":{"line":219,"column":440,"offset":9076},"end":{"line":219,"column":501,"offset":9137},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":219,"column":501,"offset":9137},"end":{"line":219,"column":502,"offset":9138},"indent":[]}}],"position":{"start":{"line":219,"column":3,"offset":8639},"end":{"line":219,"column":502,"offset":9138},"indent":[]}}],"position":{"start":{"line":219,"column":1,"offset":8637},"end":{"line":219,"column":502,"offset":9138},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server uses a ","position":{"start":{"line":221,"column":1,"offset":9140},"end":{"line":221,"column":22,"offset":9161},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"publish-subscribe","position":{"start":{"line":221,"column":24,"offset":9163},"end":{"line":221,"column":41,"offset":9180},"indent":[]}}],"position":{"start":{"line":221,"column":22,"offset":9161},"end":{"line":221,"column":43,"offset":9182},"indent":[]}},{"type":"text","value":" (","position":{"start":{"line":221,"column":43,"offset":9182},"end":{"line":221,"column":45,"offset":9184},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"pub/sub","position":{"start":{"line":221,"column":47,"offset":9186},"end":{"line":221,"column":54,"offset":9193},"indent":[]}}],"position":{"start":{"line":221,"column":45,"offset":9184},"end":{"line":221,"column":56,"offset":9195},"indent":[]}},{"type":"text","value":") model to track events that update active subscriptions. The ","position":{"start":{"line":221,"column":56,"offset":9195},"end":{"line":221,"column":118,"offset":9257},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions","children":[{"type":"inlineCode","value":"graphql-subscriptions","position":{"start":{"line":221,"column":119,"offset":9258},"end":{"line":221,"column":142,"offset":9281},"indent":[]}},{"type":"text","value":" library","position":{"start":{"line":221,"column":142,"offset":9281},"end":{"line":221,"column":150,"offset":9289},"indent":[]}}],"position":{"start":{"line":221,"column":118,"offset":9257},"end":{"line":221,"column":207,"offset":9346},"indent":[]}},{"type":"text","value":" provides the ","position":{"start":{"line":221,"column":207,"offset":9346},"end":{"line":221,"column":221,"offset":9360},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":221,"column":221,"offset":9360},"end":{"line":221,"column":229,"offset":9368},"indent":[]}},{"type":"text","value":" class as a basic in-memory event bus to help you get started:","position":{"start":{"line":221,"column":229,"offset":9368},"end":{"line":221,"column":291,"offset":9430},"indent":[]}}],"position":{"start":{"line":221,"column":1,"offset":9140},"end":{"line":221,"column":291,"offset":9430},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To use the ","position":{"start":{"line":223,"column":1,"offset":9432},"end":{"line":223,"column":12,"offset":9443},"indent":[]}},{"type":"inlineCode","value":"graphql-subscriptions","position":{"start":{"line":223,"column":12,"offset":9443},"end":{"line":223,"column":35,"offset":9466},"indent":[]}},{"type":"text","value":" package, first install it like so:","position":{"start":{"line":223,"column":35,"offset":9466},"end":{"line":223,"column":70,"offset":9501},"indent":[]}}],"position":{"start":{"line":223,"column":1,"offset":9432},"end":{"line":223,"column":70,"offset":9501},"indent":[]}},{"type":"code","lang":"shell","meta":null,"value":"npm install graphql-subscriptions","position":{"start":{"line":225,"column":1,"offset":9503},"end":{"line":227,"column":4,"offset":9549},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A ","position":{"start":{"line":229,"column":1,"offset":9551},"end":{"line":229,"column":3,"offset":9553},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":229,"column":3,"offset":9553},"end":{"line":229,"column":11,"offset":9561},"indent":[]}},{"type":"text","value":" instance enables your server code to both ","position":{"start":{"line":229,"column":11,"offset":9561},"end":{"line":229,"column":54,"offset":9604},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":229,"column":54,"offset":9604},"end":{"line":229,"column":63,"offset":9613},"indent":[]}},{"type":"text","value":" events to a particular label and listen for events associated with a particular label. We can create a ","position":{"start":{"line":229,"column":63,"offset":9613},"end":{"line":229,"column":167,"offset":9717},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":229,"column":167,"offset":9717},"end":{"line":229,"column":175,"offset":9725},"indent":[]}},{"type":"text","value":" instance like so:","position":{"start":{"line":229,"column":175,"offset":9725},"end":{"line":229,"column":193,"offset":9743},"indent":[]}}],"position":{"start":{"line":229,"column":1,"offset":9551},"end":{"line":229,"column":193,"offset":9743},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"import { PubSub } from 'graphql-subscriptions';\n\nconst pubsub = new PubSub();","position":{"start":{"line":230,"column":1,"offset":9744},"end":{"line":234,"column":4,"offset":9831},"indent":[1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Publishing an event","position":{"start":{"line":236,"column":5,"offset":9837},"end":{"line":236,"column":24,"offset":9856},"indent":[]}}],"position":{"start":{"line":236,"column":1,"offset":9833},"end":{"line":236,"column":24,"offset":9856},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can publish an event using the ","position":{"start":{"line":238,"column":1,"offset":9858},"end":{"line":238,"column":36,"offset":9893},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":238,"column":36,"offset":9893},"end":{"line":238,"column":45,"offset":9902},"indent":[]}},{"type":"text","value":" method of a ","position":{"start":{"line":238,"column":45,"offset":9902},"end":{"line":238,"column":58,"offset":9915},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":238,"column":58,"offset":9915},"end":{"line":238,"column":66,"offset":9923},"indent":[]}},{"type":"text","value":" instance:","position":{"start":{"line":238,"column":66,"offset":9923},"end":{"line":238,"column":76,"offset":9933},"indent":[]}}],"position":{"start":{"line":238,"column":1,"offset":9858},"end":{"line":238,"column":76,"offset":9933},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"pubsub.publish('POST_CREATED', {\n  postCreated: {\n    author: 'Ali Baba',\n    comment: 'Open sesame'\n  }\n});","position":{"start":{"line":240,"column":1,"offset":9935},"end":{"line":247,"column":4,"offset":10053},"indent":[1,1,1,1,1,1,1]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The first parameter is the name of the event label you're publishing to, as a string.","position":{"start":{"line":249,"column":3,"offset":10057},"end":{"line":249,"column":88,"offset":10142},"indent":[]}}],"position":{"start":{"line":249,"column":3,"offset":10057},"end":{"line":249,"column":88,"offset":10142},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"You don't need to register a label name before publishing to it.","position":{"start":{"line":250,"column":8,"offset":10150},"end":{"line":250,"column":72,"offset":10214},"indent":[]}}],"position":{"start":{"line":250,"column":7,"offset":10149},"end":{"line":250,"column":73,"offset":10215},"indent":[]}}],"position":{"start":{"line":250,"column":7,"offset":10149},"end":{"line":250,"column":73,"offset":10215},"indent":[]}}],"position":{"start":{"line":250,"column":3,"offset":10145},"end":{"line":250,"column":73,"offset":10215},"indent":[]}}],"position":{"start":{"line":250,"column":3,"offset":10145},"end":{"line":250,"column":73,"offset":10215},"indent":[]}}],"position":{"start":{"line":249,"column":1,"offset":10055},"end":{"line":250,"column":73,"offset":10215},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The second parameter is the payload associated with the event.","position":{"start":{"line":251,"column":3,"offset":10218},"end":{"line":251,"column":65,"offset":10280},"indent":[]}}],"position":{"start":{"line":251,"column":3,"offset":10218},"end":{"line":251,"column":65,"offset":10280},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"The payload should include whatever data is necessary for your resolvers to populate the associated ","position":{"start":{"line":252,"column":8,"offset":10288},"end":{"line":252,"column":108,"offset":10388},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":252,"column":108,"offset":10388},"end":{"line":252,"column":122,"offset":10402},"indent":[]}},{"type":"text","value":" field and its subfields.","position":{"start":{"line":252,"column":122,"offset":10402},"end":{"line":252,"column":147,"offset":10427},"indent":[]}}],"position":{"start":{"line":252,"column":7,"offset":10287},"end":{"line":252,"column":148,"offset":10428},"indent":[]}}],"position":{"start":{"line":252,"column":7,"offset":10287},"end":{"line":252,"column":148,"offset":10428},"indent":[]}}],"position":{"start":{"line":252,"column":3,"offset":10283},"end":{"line":252,"column":148,"offset":10428},"indent":[]}}],"position":{"start":{"line":252,"column":3,"offset":10283},"end":{"line":252,"column":148,"offset":10428},"indent":[]}}],"position":{"start":{"line":251,"column":1,"offset":10216},"end":{"line":252,"column":148,"offset":10428},"indent":[1]}}],"position":{"start":{"line":249,"column":1,"offset":10055},"end":{"line":252,"column":148,"offset":10428},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"When working with GraphQL subscriptions, you ","position":{"start":{"line":254,"column":1,"offset":10430},"end":{"line":254,"column":46,"offset":10475},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":254,"column":46,"offset":10475},"end":{"line":254,"column":55,"offset":10484},"indent":[]}},{"type":"text","value":" an event whenever a subscription's return value should be updated. One common cause of such an update is a mutation, but ","position":{"start":{"line":254,"column":55,"offset":10484},"end":{"line":254,"column":177,"offset":10606},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"any","position":{"start":{"line":254,"column":178,"offset":10607},"end":{"line":254,"column":181,"offset":10610},"indent":[]}}],"position":{"start":{"line":254,"column":177,"offset":10606},"end":{"line":254,"column":182,"offset":10611},"indent":[]}},{"type":"text","value":" back-end logic might result in changes that should be ","position":{"start":{"line":254,"column":182,"offset":10611},"end":{"line":254,"column":237,"offset":10666},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":254,"column":237,"offset":10666},"end":{"line":254,"column":246,"offset":10675},"indent":[]}},{"type":"text","value":"ed.","position":{"start":{"line":254,"column":246,"offset":10675},"end":{"line":254,"column":249,"offset":10678},"indent":[]}}],"position":{"start":{"line":254,"column":1,"offset":10430},"end":{"line":254,"column":249,"offset":10678},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"As an example, let's say our GraphQL API supports a ","position":{"start":{"line":256,"column":1,"offset":10680},"end":{"line":256,"column":53,"offset":10732},"indent":[]}},{"type":"inlineCode","value":"createPost","position":{"start":{"line":256,"column":53,"offset":10732},"end":{"line":256,"column":65,"offset":10744},"indent":[]}},{"type":"text","value":" mutation:","position":{"start":{"line":256,"column":65,"offset":10744},"end":{"line":256,"column":75,"offset":10754},"indent":[]}}],"position":{"start":{"line":256,"column":1,"offset":10680},"end":{"line":256,"column":75,"offset":10754},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"type Mutation {\n  createPost(author: String, comment: String): Post\n}","position":{"start":{"line":258,"column":1,"offset":10756},"end":{"line":262,"column":4,"offset":10840},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A basic resolver for ","position":{"start":{"line":264,"column":1,"offset":10842},"end":{"line":264,"column":22,"offset":10863},"indent":[]}},{"type":"inlineCode","value":"createPost","position":{"start":{"line":264,"column":22,"offset":10863},"end":{"line":264,"column":34,"offset":10875},"indent":[]}},{"type":"text","value":" might look like this:","position":{"start":{"line":264,"column":34,"offset":10875},"end":{"line":264,"column":56,"offset":10897},"indent":[]}}],"position":{"start":{"line":264,"column":1,"offset":10842},"end":{"line":264,"column":56,"offset":10897},"indent":[]}},{"type":"code","lang":"js{3-6}","meta":null,"value":"const resolvers = {\n  Mutation: {\n    createPost(parent, args, context) {\n      // Datastore logic lives in postController\n      return postController.createPost(args);\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":266,"column":1,"offset":10899},"end":{"line":276,"column":4,"offset":11124},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Before we persist the new post's details in our datastore, we can ","position":{"start":{"line":278,"column":1,"offset":11126},"end":{"line":278,"column":67,"offset":11192},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":278,"column":67,"offset":11192},"end":{"line":278,"column":76,"offset":11201},"indent":[]}},{"type":"text","value":" an event that ","position":{"start":{"line":278,"column":76,"offset":11201},"end":{"line":278,"column":91,"offset":11216},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"also","position":{"start":{"line":278,"column":92,"offset":11217},"end":{"line":278,"column":96,"offset":11221},"indent":[]}}],"position":{"start":{"line":278,"column":91,"offset":11216},"end":{"line":278,"column":97,"offset":11222},"indent":[]}},{"type":"text","value":" includes those details:","position":{"start":{"line":278,"column":97,"offset":11222},"end":{"line":278,"column":121,"offset":11246},"indent":[]}}],"position":{"start":{"line":278,"column":1,"offset":11126},"end":{"line":278,"column":121,"offset":11246},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const resolvers = {\n  Mutation: {\n    createPost(parent, args, context) {\n      pubsub.publish('POST_CREATED', { postCreated: args }); // highlight-line\n      return postController.createPost(args);\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":280,"column":1,"offset":11248},"end":{"line":290,"column":4,"offset":11498},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next, we can listen for this event in our ","position":{"start":{"line":292,"column":1,"offset":11500},"end":{"line":292,"column":43,"offset":11542},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":292,"column":43,"offset":11542},"end":{"line":292,"column":57,"offset":11556},"indent":[]}},{"type":"text","value":" field's resolver.","position":{"start":{"line":292,"column":57,"offset":11556},"end":{"line":292,"column":75,"offset":11574},"indent":[]}}],"position":{"start":{"line":292,"column":1,"offset":11500},"end":{"line":292,"column":75,"offset":11574},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Listening for events","position":{"start":{"line":294,"column":5,"offset":11580},"end":{"line":294,"column":25,"offset":11600},"indent":[]}}],"position":{"start":{"line":294,"column":1,"offset":11576},"end":{"line":294,"column":25,"offset":11600},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An ","position":{"start":{"line":296,"column":1,"offset":11602},"end":{"line":296,"column":4,"offset":11605},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-async-iterator.ts","children":[{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":296,"column":5,"offset":11606},"end":{"line":296,"column":20,"offset":11621},"indent":[]}}],"position":{"start":{"line":296,"column":4,"offset":11605},"end":{"line":296,"column":118,"offset":11719},"indent":[]}},{"type":"text","value":" object listens for events that are associated with a particular label (or set of labels) and adds them to a queue for processing.","position":{"start":{"line":296,"column":118,"offset":11719},"end":{"line":296,"column":248,"offset":11849},"indent":[]}}],"position":{"start":{"line":296,"column":1,"offset":11602},"end":{"line":296,"column":248,"offset":11849},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can create an ","position":{"start":{"line":298,"column":1,"offset":11851},"end":{"line":298,"column":19,"offset":11869},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":298,"column":19,"offset":11869},"end":{"line":298,"column":34,"offset":11884},"indent":[]}},{"type":"text","value":" by calling the ","position":{"start":{"line":298,"column":34,"offset":11884},"end":{"line":298,"column":50,"offset":11900},"indent":[]}},{"type":"inlineCode","value":"asyncIterator","position":{"start":{"line":298,"column":50,"offset":11900},"end":{"line":298,"column":65,"offset":11915},"indent":[]}},{"type":"text","value":" method of ","position":{"start":{"line":298,"column":65,"offset":11915},"end":{"line":298,"column":76,"offset":11926},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":298,"column":76,"offset":11926},"end":{"line":298,"column":84,"offset":11934},"indent":[]}},{"type":"text","value":" and passing in an array containing the names of the event labels that this ","position":{"start":{"line":298,"column":84,"offset":11934},"end":{"line":298,"column":160,"offset":12010},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":298,"column":160,"offset":12010},"end":{"line":298,"column":175,"offset":12025},"indent":[]}},{"type":"text","value":" should listen for.","position":{"start":{"line":298,"column":175,"offset":12025},"end":{"line":298,"column":194,"offset":12044},"indent":[]}}],"position":{"start":{"line":298,"column":1,"offset":11851},"end":{"line":298,"column":194,"offset":12044},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"pubsub.asyncIterator(['POST_CREATED']);","position":{"start":{"line":300,"column":1,"offset":12046},"end":{"line":302,"column":4,"offset":12095},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Every ","position":{"start":{"line":304,"column":1,"offset":12097},"end":{"line":304,"column":7,"offset":12103},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":304,"column":7,"offset":12103},"end":{"line":304,"column":21,"offset":12117},"indent":[]}},{"type":"text","value":" field resolver's ","position":{"start":{"line":304,"column":21,"offset":12117},"end":{"line":304,"column":39,"offset":12135},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":304,"column":39,"offset":12135},"end":{"line":304,"column":50,"offset":12146},"indent":[]}},{"type":"text","value":" function must return an ","position":{"start":{"line":304,"column":50,"offset":12146},"end":{"line":304,"column":75,"offset":12171},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":304,"column":75,"offset":12171},"end":{"line":304,"column":90,"offset":12186},"indent":[]}},{"type":"text","value":" object.","position":{"start":{"line":304,"column":90,"offset":12186},"end":{"line":304,"column":98,"offset":12194},"indent":[]}}],"position":{"start":{"line":304,"column":1,"offset":12097},"end":{"line":304,"column":98,"offset":12194},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This brings us back to the code sample at the top of ","position":{"start":{"line":306,"column":1,"offset":12196},"end":{"line":306,"column":54,"offset":12249},"indent":[]}},{"type":"link","title":null,"url":"#resolving-a-subscription","children":[{"type":"text","value":"Resolving a subscription","position":{"start":{"line":306,"column":55,"offset":12250},"end":{"line":306,"column":79,"offset":12274},"indent":[]}}],"position":{"start":{"line":306,"column":54,"offset":12249},"end":{"line":306,"column":107,"offset":12302},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":306,"column":107,"offset":12302},"end":{"line":306,"column":108,"offset":12303},"indent":[]}}],"position":{"start":{"line":306,"column":1,"offset":12196},"end":{"line":306,"column":108,"offset":12303},"indent":[]}},{"type":"code","lang":"js:title=index.js","meta":null,"value":"const resolvers = {\n  Subscription: {\n    postCreated: {\n      subscribe: () => pubsub.asyncIterator(['POST_CREATED']),\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":308,"column":1,"offset":12305},"end":{"line":317,"column":4,"offset":12491},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"With this ","position":{"start":{"line":319,"column":1,"offset":12493},"end":{"line":319,"column":11,"offset":12503},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":319,"column":11,"offset":12503},"end":{"line":319,"column":22,"offset":12514},"indent":[]}},{"type":"text","value":" function set, Apollo Server uses the payloads of ","position":{"start":{"line":319,"column":22,"offset":12514},"end":{"line":319,"column":72,"offset":12564},"indent":[]}},{"type":"inlineCode","value":"POST_CREATED","position":{"start":{"line":319,"column":72,"offset":12564},"end":{"line":319,"column":86,"offset":12578},"indent":[]}},{"type":"text","value":" events to push updated values for the ","position":{"start":{"line":319,"column":86,"offset":12578},"end":{"line":319,"column":125,"offset":12617},"indent":[]}},{"type":"inlineCode","value":"postCreated","position":{"start":{"line":319,"column":125,"offset":12617},"end":{"line":319,"column":138,"offset":12630},"indent":[]}},{"type":"text","value":" field.","position":{"start":{"line":319,"column":138,"offset":12630},"end":{"line":319,"column":145,"offset":12637},"indent":[]}}],"position":{"start":{"line":319,"column":1,"offset":12493},"end":{"line":319,"column":145,"offset":12637},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Filtering events","position":{"start":{"line":321,"column":5,"offset":12643},"end":{"line":321,"column":21,"offset":12659},"indent":[]}}],"position":{"start":{"line":321,"column":1,"offset":12639},"end":{"line":321,"column":21,"offset":12659},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Sometimes, a client should only receive updated subscription data if that data meets certain criteria. To support this, you can call the ","position":{"start":{"line":323,"column":1,"offset":12661},"end":{"line":323,"column":138,"offset":12798},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":323,"column":138,"offset":12798},"end":{"line":323,"column":150,"offset":12810},"indent":[]}},{"type":"text","value":" helper function in your ","position":{"start":{"line":323,"column":150,"offset":12810},"end":{"line":323,"column":175,"offset":12835},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":323,"column":175,"offset":12835},"end":{"line":323,"column":189,"offset":12849},"indent":[]}},{"type":"text","value":" field's resolver.","position":{"start":{"line":323,"column":189,"offset":12849},"end":{"line":323,"column":207,"offset":12867},"indent":[]}}],"position":{"start":{"line":323,"column":1,"offset":12661},"end":{"line":323,"column":207,"offset":12867},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Example","position":{"start":{"line":325,"column":6,"offset":12874},"end":{"line":325,"column":13,"offset":12881},"indent":[]}}],"position":{"start":{"line":325,"column":1,"offset":12869},"end":{"line":325,"column":13,"offset":12881},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Let's say our server provides a ","position":{"start":{"line":327,"column":1,"offset":12883},"end":{"line":327,"column":33,"offset":12915},"indent":[]}},{"type":"inlineCode","value":"commentAdded","position":{"start":{"line":327,"column":33,"offset":12915},"end":{"line":327,"column":47,"offset":12929},"indent":[]}},{"type":"text","value":" subscription, which should notify clients whenever a comment is added to a specified code repository. A client can execute a subscription that looks like this:","position":{"start":{"line":327,"column":47,"offset":12929},"end":{"line":327,"column":207,"offset":13089},"indent":[]}}],"position":{"start":{"line":327,"column":1,"offset":12883},"end":{"line":327,"column":207,"offset":13089},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"subscription($repoName: String!){\n  commentAdded(repoFullName: $repoName) {\n    id\n    content\n  }\n}","position":{"start":{"line":329,"column":1,"offset":13091},"end":{"line":336,"column":4,"offset":13206},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This presents a potential issue: our server probably ","position":{"start":{"line":338,"column":1,"offset":13208},"end":{"line":338,"column":54,"offset":13261},"indent":[]}},{"type":"link","title":null,"url":"#publishing-an-event","children":[{"type":"text","value":"publishes","position":{"start":{"line":338,"column":55,"offset":13262},"end":{"line":338,"column":64,"offset":13271},"indent":[]}}],"position":{"start":{"line":338,"column":54,"offset":13261},"end":{"line":338,"column":87,"offset":13294},"indent":[]}},{"type":"text","value":" a ","position":{"start":{"line":338,"column":87,"offset":13294},"end":{"line":338,"column":90,"offset":13297},"indent":[]}},{"type":"inlineCode","value":"COMMENT_ADDED","position":{"start":{"line":338,"column":90,"offset":13297},"end":{"line":338,"column":105,"offset":13312},"indent":[]}},{"type":"text","value":" event whenever a comment is added to ","position":{"start":{"line":338,"column":105,"offset":13312},"end":{"line":338,"column":143,"offset":13350},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"any","position":{"start":{"line":338,"column":144,"offset":13351},"end":{"line":338,"column":147,"offset":13354},"indent":[]}}],"position":{"start":{"line":338,"column":143,"offset":13350},"end":{"line":338,"column":148,"offset":13355},"indent":[]}},{"type":"text","value":" repository. This means that the ","position":{"start":{"line":338,"column":148,"offset":13355},"end":{"line":338,"column":181,"offset":13388},"indent":[]}},{"type":"inlineCode","value":"commentAdded","position":{"start":{"line":338,"column":181,"offset":13388},"end":{"line":338,"column":195,"offset":13402},"indent":[]}},{"type":"text","value":" resolver executes for ","position":{"start":{"line":338,"column":195,"offset":13402},"end":{"line":338,"column":218,"offset":13425},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"every","position":{"start":{"line":338,"column":219,"offset":13426},"end":{"line":338,"column":224,"offset":13431},"indent":[]}}],"position":{"start":{"line":338,"column":218,"offset":13425},"end":{"line":338,"column":225,"offset":13432},"indent":[]}},{"type":"text","value":" new comment, regardless of which repository it's added to. As a result, subscribing clients might receive data they don't want (or shouldn't even have access to).","position":{"start":{"line":338,"column":225,"offset":13432},"end":{"line":338,"column":388,"offset":13595},"indent":[]}}],"position":{"start":{"line":338,"column":1,"offset":13208},"end":{"line":338,"column":388,"offset":13595},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To fix this, we can use the ","position":{"start":{"line":340,"column":1,"offset":13597},"end":{"line":340,"column":29,"offset":13625},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":340,"column":29,"offset":13625},"end":{"line":340,"column":41,"offset":13637},"indent":[]}},{"type":"text","value":" helper function to control updates on a per-client basis.","position":{"start":{"line":340,"column":41,"offset":13637},"end":{"line":340,"column":99,"offset":13695},"indent":[]}}],"position":{"start":{"line":340,"column":1,"offset":13597},"end":{"line":340,"column":99,"offset":13695},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Here's an example resolver for ","position":{"start":{"line":342,"column":1,"offset":13697},"end":{"line":342,"column":32,"offset":13728},"indent":[]}},{"type":"inlineCode","value":"commentAdded","position":{"start":{"line":342,"column":32,"offset":13728},"end":{"line":342,"column":46,"offset":13742},"indent":[]}},{"type":"text","value":" that uses the ","position":{"start":{"line":342,"column":46,"offset":13742},"end":{"line":342,"column":61,"offset":13757},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":342,"column":61,"offset":13757},"end":{"line":342,"column":73,"offset":13769},"indent":[]}},{"type":"text","value":" function:","position":{"start":{"line":342,"column":73,"offset":13769},"end":{"line":342,"column":83,"offset":13779},"indent":[]}}],"position":{"start":{"line":342,"column":1,"offset":13697},"end":{"line":342,"column":83,"offset":13779},"indent":[]}},{"type":"code","lang":"js{5-12}","meta":null,"value":"import { withFilter } from 'graphql-subscriptions';\n\nconst resolvers = {\n  Subscription: {\n    commentAdded: {\n      subscribe: withFilter(\n        () => pubsub.asyncIterator('COMMENT_ADDED'),\n        (payload, variables) => {\n          // Only push an update if the comment is on\n          // the correct repository for this operation\n          return (payload.commentAdded.repository_name === variables.repoFullName);\n        },\n      ),\n    }\n  },\n    // ...other resolvers...\n};","position":{"start":{"line":344,"column":1,"offset":13781},"end":{"line":362,"column":4,"offset":14279},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":364,"column":1,"offset":14281},"end":{"line":364,"column":5,"offset":14285},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":364,"column":5,"offset":14285},"end":{"line":364,"column":17,"offset":14297},"indent":[]}},{"type":"text","value":" function takes two parameters:","position":{"start":{"line":364,"column":17,"offset":14297},"end":{"line":364,"column":48,"offset":14328},"indent":[]}}],"position":{"start":{"line":364,"column":1,"offset":14281},"end":{"line":364,"column":48,"offset":14328},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The first parameter is exactly the function you would use for ","position":{"start":{"line":366,"column":3,"offset":14332},"end":{"line":366,"column":65,"offset":14394},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":366,"column":65,"offset":14394},"end":{"line":366,"column":76,"offset":14405},"indent":[]}},{"type":"text","value":" if you ","position":{"start":{"line":366,"column":76,"offset":14405},"end":{"line":366,"column":84,"offset":14413},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"weren't","position":{"start":{"line":366,"column":85,"offset":14414},"end":{"line":366,"column":92,"offset":14421},"indent":[]}}],"position":{"start":{"line":366,"column":84,"offset":14413},"end":{"line":366,"column":93,"offset":14422},"indent":[]}},{"type":"text","value":" applying a filter.","position":{"start":{"line":366,"column":93,"offset":14422},"end":{"line":366,"column":112,"offset":14441},"indent":[]}}],"position":{"start":{"line":366,"column":3,"offset":14332},"end":{"line":366,"column":112,"offset":14441},"indent":[]}}],"position":{"start":{"line":366,"column":1,"offset":14330},"end":{"line":366,"column":112,"offset":14441},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The second parameter is a ","position":{"start":{"line":367,"column":3,"offset":14444},"end":{"line":367,"column":29,"offset":14470},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"filter function","position":{"start":{"line":367,"column":31,"offset":14472},"end":{"line":367,"column":46,"offset":14487},"indent":[]}}],"position":{"start":{"line":367,"column":29,"offset":14470},"end":{"line":367,"column":48,"offset":14489},"indent":[]}},{"type":"text","value":" that returns ","position":{"start":{"line":367,"column":48,"offset":14489},"end":{"line":367,"column":62,"offset":14503},"indent":[]}},{"type":"inlineCode","value":"true","position":{"start":{"line":367,"column":62,"offset":14503},"end":{"line":367,"column":68,"offset":14509},"indent":[]}},{"type":"text","value":" if a subscription update ","position":{"start":{"line":367,"column":68,"offset":14509},"end":{"line":367,"column":94,"offset":14535},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"should","position":{"start":{"line":367,"column":95,"offset":14536},"end":{"line":367,"column":101,"offset":14542},"indent":[]}}],"position":{"start":{"line":367,"column":94,"offset":14535},"end":{"line":367,"column":102,"offset":14543},"indent":[]}},{"type":"text","value":" be sent to a particular client, and ","position":{"start":{"line":367,"column":102,"offset":14543},"end":{"line":367,"column":139,"offset":14580},"indent":[]}},{"type":"inlineCode","value":"false","position":{"start":{"line":367,"column":139,"offset":14580},"end":{"line":367,"column":146,"offset":14587},"indent":[]}},{"type":"text","value":" otherwise (","position":{"start":{"line":367,"column":146,"offset":14587},"end":{"line":367,"column":158,"offset":14599},"indent":[]}},{"type":"inlineCode","value":"Promise<boolean>","position":{"start":{"line":367,"column":158,"offset":14599},"end":{"line":367,"column":176,"offset":14617},"indent":[]}},{"type":"text","value":" is also allowed). This function takes two parameters of its own:","position":{"start":{"line":367,"column":176,"offset":14617},"end":{"line":367,"column":241,"offset":14682},"indent":[]}}],"position":{"start":{"line":367,"column":3,"offset":14444},"end":{"line":367,"column":241,"offset":14682},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"payload","position":{"start":{"line":368,"column":7,"offset":14689},"end":{"line":368,"column":16,"offset":14698},"indent":[]}},{"type":"text","value":" is the payload of the event that was published.","position":{"start":{"line":368,"column":16,"offset":14698},"end":{"line":368,"column":64,"offset":14746},"indent":[]}}],"position":{"start":{"line":368,"column":7,"offset":14689},"end":{"line":368,"column":64,"offset":14746},"indent":[]}}],"position":{"start":{"line":368,"column":3,"offset":14685},"end":{"line":368,"column":64,"offset":14746},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"variables","position":{"start":{"line":369,"column":7,"offset":14753},"end":{"line":369,"column":18,"offset":14764},"indent":[]}},{"type":"text","value":" is an object containing all arguments the client provided when initiating their subscription.","position":{"start":{"line":369,"column":18,"offset":14764},"end":{"line":369,"column":112,"offset":14858},"indent":[]}}],"position":{"start":{"line":369,"column":7,"offset":14753},"end":{"line":369,"column":112,"offset":14858},"indent":[]}}],"position":{"start":{"line":369,"column":3,"offset":14749},"end":{"line":369,"column":112,"offset":14858},"indent":[]}}],"position":{"start":{"line":368,"column":3,"offset":14685},"end":{"line":369,"column":112,"offset":14858},"indent":[3]}}],"position":{"start":{"line":367,"column":1,"offset":14442},"end":{"line":369,"column":112,"offset":14858},"indent":[1,1]}}],"position":{"start":{"line":366,"column":1,"offset":14330},"end":{"line":369,"column":112,"offset":14858},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":371,"column":1,"offset":14860},"end":{"line":371,"column":5,"offset":14864},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":371,"column":5,"offset":14864},"end":{"line":371,"column":17,"offset":14876},"indent":[]}},{"type":"text","value":" to make sure clients get exactly the subscription updates they want (and are allowed to receive).","position":{"start":{"line":371,"column":17,"offset":14876},"end":{"line":371,"column":115,"offset":14974},"indent":[]}}],"position":{"start":{"line":371,"column":1,"offset":14860},"end":{"line":371,"column":115,"offset":14974},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Basic runnable example","position":{"start":{"line":374,"column":4,"offset":14980},"end":{"line":374,"column":26,"offset":15002},"indent":[]}}],"position":{"start":{"line":374,"column":1,"offset":14977},"end":{"line":374,"column":26,"offset":15002},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An example server is available on ","position":{"start":{"line":376,"column":1,"offset":15004},"end":{"line":376,"column":35,"offset":15038},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/docs-examples/blob/main/apollo-server/v3/subscriptions-graphql-ws/src/index.ts","children":[{"type":"text","value":"GitHub","position":{"start":{"line":376,"column":36,"offset":15039},"end":{"line":376,"column":42,"offset":15045},"indent":[]}}],"position":{"start":{"line":376,"column":35,"offset":15038},"end":{"line":376,"column":156,"offset":15159},"indent":[]}},{"type":"text","value":" and CodeSandbox:","position":{"start":{"line":376,"column":156,"offset":15159},"end":{"line":376,"column":173,"offset":15176},"indent":[]}}],"position":{"start":{"line":376,"column":1,"offset":15004},"end":{"line":376,"column":173,"offset":15176},"indent":[]}},{"type":"jsx","value":"<a href=\"https://codesandbox.io/s/github/apollographql/docs-examples/tree/main/apollo-server/v3/subscriptions-graphql-ws?fontsize=14&hidenavigation=1&initialpath=%2Fgraphql&theme=dark\">\n  <img alt=\"Edit server-subscriptions-as3\" src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" />\n</a>","position":{"start":{"line":378,"column":1,"offset":15178},"end":{"line":380,"column":5,"offset":15475},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The server exposes one subscription (","position":{"start":{"line":382,"column":1,"offset":15477},"end":{"line":382,"column":38,"offset":15514},"indent":[]}},{"type":"inlineCode","value":"numberIncremented","position":{"start":{"line":382,"column":38,"offset":15514},"end":{"line":382,"column":57,"offset":15533},"indent":[]}},{"type":"text","value":") that returns an integer that's incremented on the server every second. Here's an example subscription that you can run against your server:","position":{"start":{"line":382,"column":57,"offset":15533},"end":{"line":382,"column":198,"offset":15674},"indent":[]}}],"position":{"start":{"line":382,"column":1,"offset":15477},"end":{"line":382,"column":198,"offset":15674},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"subscription IncrementingNumber {\n  numberIncremented\n}","position":{"start":{"line":384,"column":1,"offset":15676},"end":{"line":388,"column":4,"offset":15746},"indent":[1,1,1,1]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If you don't see the result of your subscription operation you might need to ","position":{"start":{"line":390,"column":3,"offset":15750},"end":{"line":390,"column":80,"offset":15827},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support","children":[{"type":"text","value":"adjust your Sandbox settings to use the ","position":{"start":{"line":390,"column":81,"offset":15828},"end":{"line":390,"column":121,"offset":15868},"indent":[]}},{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":390,"column":121,"offset":15868},"end":{"line":390,"column":133,"offset":15880},"indent":[]}},{"type":"text","value":" protocol","position":{"start":{"line":390,"column":133,"offset":15880},"end":{"line":390,"column":142,"offset":15889},"indent":[]}}],"position":{"start":{"line":390,"column":80,"offset":15827},"end":{"line":390,"column":237,"offset":15984},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":390,"column":237,"offset":15984},"end":{"line":390,"column":238,"offset":15985},"indent":[]}}],"position":{"start":{"line":390,"column":3,"offset":15750},"end":{"line":390,"column":238,"offset":15985},"indent":[]}}],"position":{"start":{"line":390,"column":1,"offset":15748},"end":{"line":390,"column":238,"offset":15985},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After you start up the server in CodeSandbox, follow the instructions in the browser to test running the ","position":{"start":{"line":392,"column":1,"offset":15987},"end":{"line":392,"column":106,"offset":16092},"indent":[]}},{"type":"inlineCode","value":"numberIncremented","position":{"start":{"line":392,"column":106,"offset":16092},"end":{"line":392,"column":125,"offset":16111},"indent":[]}},{"type":"text","value":" subscription in Apollo Sandbox. You should see the subscription's value update every second.","position":{"start":{"line":392,"column":125,"offset":16111},"end":{"line":392,"column":218,"offset":16204},"indent":[]}}],"position":{"start":{"line":392,"column":1,"offset":15987},"end":{"line":392,"column":218,"offset":16204},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Operation context","position":{"start":{"line":394,"column":4,"offset":16209},"end":{"line":394,"column":21,"offset":16226},"indent":[]}}],"position":{"start":{"line":394,"column":1,"offset":16206},"end":{"line":394,"column":21,"offset":16226},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When ","position":{"start":{"line":396,"column":1,"offset":16228},"end":{"line":396,"column":6,"offset":16233},"indent":[]}},{"type":"link","title":null,"url":"../data/resolvers/#the-context-argument","children":[{"type":"text","value":"initializing context","position":{"start":{"line":396,"column":7,"offset":16234},"end":{"line":396,"column":27,"offset":16254},"indent":[]}}],"position":{"start":{"line":396,"column":6,"offset":16233},"end":{"line":396,"column":69,"offset":16296},"indent":[]}},{"type":"text","value":" for a query or mutation, you usually extract HTTP headers and other request metadata from the ","position":{"start":{"line":396,"column":69,"offset":16296},"end":{"line":396,"column":164,"offset":16391},"indent":[]}},{"type":"inlineCode","value":"req","position":{"start":{"line":396,"column":164,"offset":16391},"end":{"line":396,"column":169,"offset":16396},"indent":[]}},{"type":"text","value":" object provided to the ","position":{"start":{"line":396,"column":169,"offset":16396},"end":{"line":396,"column":193,"offset":16420},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":396,"column":193,"offset":16420},"end":{"line":396,"column":202,"offset":16429},"indent":[]}},{"type":"text","value":" function.","position":{"start":{"line":396,"column":202,"offset":16429},"end":{"line":396,"column":212,"offset":16439},"indent":[]}}],"position":{"start":{"line":396,"column":1,"offset":16228},"end":{"line":396,"column":212,"offset":16439},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"For subscriptions,","position":{"start":{"line":398,"column":3,"offset":16443},"end":{"line":398,"column":21,"offset":16461},"indent":[]}}],"position":{"start":{"line":398,"column":1,"offset":16441},"end":{"line":398,"column":23,"offset":16463},"indent":[]}},{"type":"text","value":" you can extract information from a client's request by adding ","position":{"start":{"line":398,"column":23,"offset":16463},"end":{"line":398,"column":86,"offset":16526},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.ServerOptions.md","children":[{"type":"text","value":"options","position":{"start":{"line":398,"column":87,"offset":16527},"end":{"line":398,"column":94,"offset":16534},"indent":[]}}],"position":{"start":{"line":398,"column":86,"offset":16526},"end":{"line":398,"column":188,"offset":16628},"indent":[]}},{"type":"text","value":" to the first argument passed to the ","position":{"start":{"line":398,"column":188,"offset":16628},"end":{"line":398,"column":225,"offset":16665},"indent":[]}},{"type":"inlineCode","value":"useServer","position":{"start":{"line":398,"column":225,"offset":16665},"end":{"line":398,"column":236,"offset":16676},"indent":[]}},{"type":"text","value":" function.","position":{"start":{"line":398,"column":236,"offset":16676},"end":{"line":398,"column":246,"offset":16686},"indent":[]}}],"position":{"start":{"line":398,"column":1,"offset":16441},"end":{"line":398,"column":246,"offset":16686},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For example, you can provide a ","position":{"start":{"line":400,"column":1,"offset":16688},"end":{"line":400,"column":32,"offset":16719},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.ServerOptions.md#context","children":[{"type":"inlineCode","value":"context","position":{"start":{"line":400,"column":33,"offset":16720},"end":{"line":400,"column":42,"offset":16729},"indent":[]}},{"type":"text","value":" property","position":{"start":{"line":400,"column":42,"offset":16729},"end":{"line":400,"column":51,"offset":16738},"indent":[]}}],"position":{"start":{"line":400,"column":32,"offset":16719},"end":{"line":400,"column":153,"offset":16840},"indent":[]}},{"type":"text","value":" to add values to your GraphQL operation ","position":{"start":{"line":400,"column":153,"offset":16840},"end":{"line":400,"column":194,"offset":16881},"indent":[]}},{"type":"link","title":null,"url":"./resolvers/#the-context-argument","children":[{"type":"inlineCode","value":"context","position":{"start":{"line":400,"column":195,"offset":16882},"end":{"line":400,"column":204,"offset":16891},"indent":[]}}],"position":{"start":{"line":400,"column":194,"offset":16881},"end":{"line":400,"column":240,"offset":16927},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":400,"column":240,"offset":16927},"end":{"line":400,"column":241,"offset":16928},"indent":[]}}],"position":{"start":{"line":400,"column":1,"offset":16688},"end":{"line":400,"column":241,"offset":16928},"indent":[]}},{"type":"code","lang":"ts","meta":null,"value":"// ...\nuseServer(\n  {\n    // Our GraphQL schema.\n    schema,\n    // Adding a context property lets you add data to your GraphQL operation context\n     context: (ctx, msg, args) => {\n       // You can define your own function for setting a dynamic context\n       // or provide a static value\n      return getDynamicContext(ctx, msg, args);\n    },\n  },\n  wsServer,\n);","position":{"start":{"line":402,"column":1,"offset":16930},"end":{"line":417,"column":4,"offset":17305},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Notice that the first parameter passed to the ","position":{"start":{"line":419,"column":1,"offset":17307},"end":{"line":419,"column":47,"offset":17353},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":419,"column":47,"offset":17353},"end":{"line":419,"column":56,"offset":17362},"indent":[]}},{"type":"text","value":" function above is ","position":{"start":{"line":419,"column":56,"offset":17362},"end":{"line":419,"column":75,"offset":17381},"indent":[]}},{"type":"inlineCode","value":"ctx","position":{"start":{"line":419,"column":75,"offset":17381},"end":{"line":419,"column":80,"offset":17386},"indent":[]}},{"type":"text","value":". The ","position":{"start":{"line":419,"column":80,"offset":17386},"end":{"line":419,"column":86,"offset":17392},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.Context.md","children":[{"type":"inlineCode","value":"ctx object","position":{"start":{"line":419,"column":87,"offset":17393},"end":{"line":419,"column":99,"offset":17405},"indent":[]}}],"position":{"start":{"line":419,"column":86,"offset":17392},"end":{"line":419,"column":187,"offset":17493},"indent":[]}},{"type":"text","value":" represents the context of your ","position":{"start":{"line":419,"column":187,"offset":17493},"end":{"line":419,"column":219,"offset":17525},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"subscription server","position":{"start":{"line":419,"column":220,"offset":17526},"end":{"line":419,"column":239,"offset":17545},"indent":[]}}],"position":{"start":{"line":419,"column":219,"offset":17525},"end":{"line":419,"column":240,"offset":17546},"indent":[]}},{"type":"text","value":", not the ","position":{"start":{"line":419,"column":240,"offset":17546},"end":{"line":419,"column":250,"offset":17556},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"GraphQL operation context","position":{"start":{"line":419,"column":251,"offset":17557},"end":{"line":419,"column":276,"offset":17582},"indent":[]}}],"position":{"start":{"line":419,"column":250,"offset":17556},"end":{"line":419,"column":277,"offset":17583},"indent":[]}},{"type":"text","value":" that's passed to your resolvers.","position":{"start":{"line":419,"column":277,"offset":17583},"end":{"line":419,"column":310,"offset":17616},"indent":[]}}],"position":{"start":{"line":419,"column":1,"offset":17307},"end":{"line":419,"column":310,"offset":17616},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can access the parameters of a client's ","position":{"start":{"line":421,"column":1,"offset":17618},"end":{"line":421,"column":45,"offset":17662},"indent":[]}},{"type":"inlineCode","value":"subscription","position":{"start":{"line":421,"column":45,"offset":17662},"end":{"line":421,"column":59,"offset":17676},"indent":[]}},{"type":"text","value":" request to your WebSocket server via the ","position":{"start":{"line":421,"column":59,"offset":17676},"end":{"line":421,"column":101,"offset":17718},"indent":[]}},{"type":"inlineCode","value":"ctx.connectionParams","position":{"start":{"line":421,"column":101,"offset":17718},"end":{"line":421,"column":123,"offset":17740},"indent":[]}},{"type":"text","value":" property.","position":{"start":{"line":421,"column":123,"offset":17740},"end":{"line":421,"column":133,"offset":17750},"indent":[]}}],"position":{"start":{"line":421,"column":1,"offset":17618},"end":{"line":421,"column":133,"offset":17750},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Below is an example of the common use case of extracting an authentication token from a client ","position":{"start":{"line":423,"column":1,"offset":17752},"end":{"line":423,"column":96,"offset":17847},"indent":[]}},{"type":"inlineCode","value":"subscription","position":{"start":{"line":423,"column":96,"offset":17847},"end":{"line":423,"column":110,"offset":17861},"indent":[]}},{"type":"text","value":" request and using it to find the current user:","position":{"start":{"line":423,"column":110,"offset":17861},"end":{"line":423,"column":157,"offset":17908},"indent":[]}}],"position":{"start":{"line":423,"column":1,"offset":17752},"end":{"line":423,"column":157,"offset":17908},"indent":[]}},{"type":"code","lang":"ts","meta":null,"value":"const getDynamicContext = async (ctx, msg, args) => {\n  // ctx is the graphql-ws Context where connectionParams live\n if (ctx.connectionParams.authentication) {\n    const currentUser = await findUser(connectionParams.authentication);\n    return { currentUser };\n  }\n  // Otherwise let our resolvers know we don't have a current user\n  return { currentUser: null };\n};\n\nuseServer(\n  {\n    schema,\n    // Adding a context property lets you add data to your GraphQL operation context\n     context: (ctx, msg, args) => {\n       // Returning an object will add that information to our\n       // GraphQL context, which all of our resolvers have access to.\n      return getDynamicContext(ctx, msg, args);\n    },\n  },\n  wsServer,\n);","position":{"start":{"line":425,"column":1,"offset":17910},"end":{"line":448,"column":4,"offset":18644},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Putting it all together, if the ","position":{"start":{"line":449,"column":1,"offset":18645},"end":{"line":449,"column":33,"offset":18677},"indent":[]}},{"type":"inlineCode","value":"useServer.context","position":{"start":{"line":449,"column":33,"offset":18677},"end":{"line":449,"column":52,"offset":18696},"indent":[]}},{"type":"text","value":" function returns an ","position":{"start":{"line":449,"column":52,"offset":18696},"end":{"line":449,"column":73,"offset":18717},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"object","position":{"start":{"line":449,"column":74,"offset":18718},"end":{"line":449,"column":80,"offset":18724},"indent":[]}}],"position":{"start":{"line":449,"column":73,"offset":18717},"end":{"line":449,"column":81,"offset":18725},"indent":[]}},{"type":"text","value":", that object is passed to the GraphQL operation ","position":{"start":{"line":449,"column":81,"offset":18725},"end":{"line":449,"column":130,"offset":18774},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":449,"column":130,"offset":18774},"end":{"line":449,"column":139,"offset":18783},"indent":[]}},{"type":"text","value":", which is available to your resolvers.","position":{"start":{"line":449,"column":139,"offset":18783},"end":{"line":449,"column":178,"offset":18822},"indent":[]}}],"position":{"start":{"line":449,"column":1,"offset":18645},"end":{"line":449,"column":178,"offset":18822},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Note that the ","position":{"start":{"line":451,"column":1,"offset":18824},"end":{"line":451,"column":15,"offset":18838},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":451,"column":15,"offset":18838},"end":{"line":451,"column":24,"offset":18847},"indent":[]}},{"type":"text","value":" option is called once per ","position":{"start":{"line":451,"column":24,"offset":18847},"end":{"line":451,"column":51,"offset":18874},"indent":[]}},{"type":"inlineCode","value":"subscription","position":{"start":{"line":451,"column":51,"offset":18874},"end":{"line":451,"column":65,"offset":18888},"indent":[]}},{"type":"text","value":" request, not once per event emission. This means that in the above example, every time a client sends a ","position":{"start":{"line":451,"column":65,"offset":18888},"end":{"line":451,"column":170,"offset":18993},"indent":[]}},{"type":"inlineCode","value":"subscription","position":{"start":{"line":451,"column":170,"offset":18993},"end":{"line":451,"column":184,"offset":19007},"indent":[]}},{"type":"text","value":" operation, we check their authentication token.","position":{"start":{"line":451,"column":184,"offset":19007},"end":{"line":451,"column":232,"offset":19055},"indent":[]}}],"position":{"start":{"line":451,"column":1,"offset":18824},"end":{"line":451,"column":232,"offset":19055},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"inlineCode","value":"onConnect","position":{"start":{"line":453,"column":5,"offset":19061},"end":{"line":453,"column":16,"offset":19072},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":453,"column":16,"offset":19072},"end":{"line":453,"column":21,"offset":19077},"indent":[]}},{"type":"inlineCode","value":"onDisconnect","position":{"start":{"line":453,"column":21,"offset":19077},"end":{"line":453,"column":35,"offset":19091},"indent":[]}}],"position":{"start":{"line":453,"column":1,"offset":19057},"end":{"line":453,"column":35,"offset":19091},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can configure the subscription server's behavior whenever a client connects (","position":{"start":{"line":455,"column":1,"offset":19093},"end":{"line":455,"column":82,"offset":19174},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":455,"column":82,"offset":19174},"end":{"line":455,"column":93,"offset":19185},"indent":[]}},{"type":"text","value":") or disconnects (","position":{"start":{"line":455,"column":93,"offset":19185},"end":{"line":455,"column":111,"offset":19203},"indent":[]}},{"type":"inlineCode","value":"onDisconnect","position":{"start":{"line":455,"column":111,"offset":19203},"end":{"line":455,"column":125,"offset":19217},"indent":[]}},{"type":"text","value":").","position":{"start":{"line":455,"column":125,"offset":19217},"end":{"line":455,"column":127,"offset":19219},"indent":[]}}],"position":{"start":{"line":455,"column":1,"offset":19093},"end":{"line":455,"column":127,"offset":19219},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Defining an ","position":{"start":{"line":457,"column":1,"offset":19221},"end":{"line":457,"column":13,"offset":19233},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":457,"column":13,"offset":19233},"end":{"line":457,"column":24,"offset":19244},"indent":[]}},{"type":"text","value":" function enables you to reject a particular incoming connection by returning ","position":{"start":{"line":457,"column":24,"offset":19244},"end":{"line":457,"column":102,"offset":19322},"indent":[]}},{"type":"inlineCode","value":"false","position":{"start":{"line":457,"column":102,"offset":19322},"end":{"line":457,"column":109,"offset":19329},"indent":[]}},{"type":"text","value":" or by throwing an exception. This can be helpful if you want to check authentication when a client first connects to your subscription server.","position":{"start":{"line":457,"column":109,"offset":19329},"end":{"line":457,"column":252,"offset":19472},"indent":[]}}],"position":{"start":{"line":457,"column":1,"offset":19221},"end":{"line":457,"column":252,"offset":19472},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You provide these functions as options to the first argument of ","position":{"start":{"line":459,"column":1,"offset":19474},"end":{"line":459,"column":65,"offset":19538},"indent":[]}},{"type":"inlineCode","value":"useServer","position":{"start":{"line":459,"column":65,"offset":19538},"end":{"line":459,"column":76,"offset":19549},"indent":[]}},{"type":"text","value":", like so:","position":{"start":{"line":459,"column":76,"offset":19549},"end":{"line":459,"column":86,"offset":19559},"indent":[]}}],"position":{"start":{"line":459,"column":1,"offset":19474},"end":{"line":459,"column":86,"offset":19559},"indent":[]}},{"type":"code","lang":"ts{5,12}","meta":null,"value":"useServer(\n  {\n    schema,\n    // As before, ctx is the graphql-ws Context where connectionParams live.\n    onConnect: async (ctx) => {\n      // Check authentication every time a client connects.\n      if (tokenIsNotValid(ctx.connectionParams)) {\n        // You can return false to close the connection  or throw an explicit error\n        throw new Error('Auth token missing!');\n      }\n    },\n    onDisconnect(ctx, code, reason) {\n      console.log('Disconnected!');\n    },\n  },\n  wsServer,\n);","position":{"start":{"line":461,"column":1,"offset":19561},"end":{"line":479,"column":4,"offset":20071},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"For more information and examples of using ","position":{"start":{"line":480,"column":1,"offset":20072},"end":{"line":480,"column":44,"offset":20115},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":480,"column":44,"offset":20115},"end":{"line":480,"column":55,"offset":20126},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":480,"column":55,"offset":20126},"end":{"line":480,"column":60,"offset":20131},"indent":[]}},{"type":"inlineCode","value":"onDisconnect","position":{"start":{"line":480,"column":60,"offset":20131},"end":{"line":480,"column":74,"offset":20145},"indent":[]}},{"type":"text","value":", see the ","position":{"start":{"line":480,"column":74,"offset":20145},"end":{"line":480,"column":84,"offset":20155},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/enisdenjo/graphql-ws#ws-auth-handling","children":[{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":480,"column":85,"offset":20156},"end":{"line":480,"column":97,"offset":20168},"indent":[]}},{"type":"text","value":" documentation","position":{"start":{"line":480,"column":97,"offset":20168},"end":{"line":480,"column":111,"offset":20182},"indent":[]}}],"position":{"start":{"line":480,"column":84,"offset":20155},"end":{"line":480,"column":170,"offset":20241},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":480,"column":170,"offset":20241},"end":{"line":480,"column":171,"offset":20242},"indent":[]}}],"position":{"start":{"line":480,"column":1,"offset":20072},"end":{"line":480,"column":171,"offset":20242},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Example: Authentication with Apollo Client","position":{"start":{"line":482,"column":5,"offset":20248},"end":{"line":482,"column":47,"offset":20290},"indent":[]}}],"position":{"start":{"line":482,"column":1,"offset":20244},"end":{"line":482,"column":47,"offset":20290},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If you plan to use subscriptions with Apollo Client, ensure ","position":{"start":{"line":484,"column":2,"offset":20293},"end":{"line":484,"column":62,"offset":20353},"indent":[]}},{"type":"strong","children":[{"type":"link","title":null,"url":"#switching-from-subscriptions-transport-ws","children":[{"type":"text","value":"both your client and server subscription protocols are consistent","position":{"start":{"line":484,"column":65,"offset":20356},"end":{"line":484,"column":130,"offset":20421},"indent":[]}}],"position":{"start":{"line":484,"column":64,"offset":20355},"end":{"line":484,"column":175,"offset":20466},"indent":[]}}],"position":{"start":{"line":484,"column":62,"offset":20353},"end":{"line":484,"column":177,"offset":20468},"indent":[]}},{"type":"text","value":" for the subscription library you are using (this example uses the ","position":{"start":{"line":484,"column":177,"offset":20468},"end":{"line":484,"column":244,"offset":20535},"indent":[]}},{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":484,"column":244,"offset":20535},"end":{"line":484,"column":256,"offset":20547},"indent":[]}},{"type":"text","value":" library).","position":{"start":{"line":484,"column":256,"offset":20547},"end":{"line":484,"column":266,"offset":20557},"indent":[]}}],"position":{"start":{"line":484,"column":2,"offset":20293},"end":{"line":484,"column":266,"offset":20557},"indent":[]}}],"position":{"start":{"line":484,"column":1,"offset":20292},"end":{"line":484,"column":266,"offset":20557},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In Apollo Client, the ","position":{"start":{"line":486,"column":1,"offset":20559},"end":{"line":486,"column":23,"offset":20581},"indent":[]}},{"type":"inlineCode","value":"GraphQLWsLink","position":{"start":{"line":486,"column":23,"offset":20581},"end":{"line":486,"column":38,"offset":20596},"indent":[]}},{"type":"text","value":" constructor supports adding information to ","position":{"start":{"line":486,"column":38,"offset":20596},"end":{"line":486,"column":82,"offset":20640},"indent":[]}},{"type":"inlineCode","value":"connectionParams","position":{"start":{"line":486,"column":82,"offset":20640},"end":{"line":486,"column":100,"offset":20658},"indent":[]}},{"type":"text","value":" (","position":{"start":{"line":486,"column":100,"offset":20658},"end":{"line":486,"column":102,"offset":20660},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/data/subscriptions/#5-authenticate-over-websocket-optional","children":[{"type":"text","value":"example","position":{"start":{"line":486,"column":103,"offset":20661},"end":{"line":486,"column":110,"offset":20668},"indent":[]}}],"position":{"start":{"line":486,"column":102,"offset":20660},"end":{"line":486,"column":212,"offset":20770},"indent":[]}},{"type":"text","value":"). Those ","position":{"start":{"line":486,"column":212,"offset":20770},"end":{"line":486,"column":221,"offset":20779},"indent":[]}},{"type":"inlineCode","value":"connectionParams","position":{"start":{"line":486,"column":221,"offset":20779},"end":{"line":486,"column":239,"offset":20797},"indent":[]}},{"type":"text","value":" are sent to your server when it connects, allowing you to extract information from the client request by accessing ","position":{"start":{"line":486,"column":239,"offset":20797},"end":{"line":486,"column":355,"offset":20913},"indent":[]}},{"type":"inlineCode","value":"Context.connectionParams","position":{"start":{"line":486,"column":355,"offset":20913},"end":{"line":486,"column":381,"offset":20939},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":486,"column":381,"offset":20939},"end":{"line":486,"column":382,"offset":20940},"indent":[]}}],"position":{"start":{"line":486,"column":1,"offset":20559},"end":{"line":486,"column":382,"offset":20940},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Let's suppose we create our subscription client like so:","position":{"start":{"line":488,"column":1,"offset":20942},"end":{"line":488,"column":57,"offset":20998},"indent":[]}}],"position":{"start":{"line":488,"column":1,"offset":20942},"end":{"line":488,"column":57,"offset":20998},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"import { GraphQLWsLink } from '@apollo/client/link/subscriptions';\nimport { createClient } from 'graphql-ws';\n\nconst wsLink = new GraphQLWsLink(createClient({\n  url: 'ws://localhost:4000/subscriptions',\n  connectionParams: {\n    authorization: user.authToken,\n  },\n}));","position":{"start":{"line":490,"column":1,"offset":21000},"end":{"line":500,"column":4,"offset":21279},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":502,"column":1,"offset":21281},"end":{"line":502,"column":5,"offset":21285},"indent":[]}},{"type":"inlineCode","value":"connectionParams","position":{"start":{"line":502,"column":5,"offset":21285},"end":{"line":502,"column":23,"offset":21303},"indent":[]}},{"type":"text","value":" argument (which contains the information provided by the client) is passed to your server, enabling you to validate the user's credentials.","position":{"start":{"line":502,"column":23,"offset":21303},"end":{"line":502,"column":163,"offset":21443},"indent":[]}}],"position":{"start":{"line":502,"column":1,"offset":21281},"end":{"line":502,"column":163,"offset":21443},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"From there you can use the ","position":{"start":{"line":504,"column":1,"offset":21445},"end":{"line":504,"column":28,"offset":21472},"indent":[]}},{"type":"link","title":null,"url":"#operation-context","children":[{"type":"inlineCode","value":"useServer.context","position":{"start":{"line":504,"column":29,"offset":21473},"end":{"line":504,"column":48,"offset":21492},"indent":[]}},{"type":"text","value":" property","position":{"start":{"line":504,"column":48,"offset":21492},"end":{"line":504,"column":57,"offset":21501},"indent":[]}}],"position":{"start":{"line":504,"column":28,"offset":21472},"end":{"line":504,"column":78,"offset":21522},"indent":[]}},{"type":"text","value":" to authenticate the user, returning an object that's passed into your resolvers as the ","position":{"start":{"line":504,"column":78,"offset":21522},"end":{"line":504,"column":166,"offset":21610},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":504,"column":166,"offset":21610},"end":{"line":504,"column":175,"offset":21619},"indent":[]}},{"type":"text","value":" argument during execution.","position":{"start":{"line":504,"column":175,"offset":21619},"end":{"line":504,"column":202,"offset":21646},"indent":[]}}],"position":{"start":{"line":504,"column":1,"offset":21445},"end":{"line":504,"column":202,"offset":21646},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For our example, we can use the ","position":{"start":{"line":506,"column":1,"offset":21648},"end":{"line":506,"column":33,"offset":21680},"indent":[]}},{"type":"inlineCode","value":"connectionParams.authentication","position":{"start":{"line":506,"column":33,"offset":21680},"end":{"line":506,"column":66,"offset":21713},"indent":[]}},{"type":"text","value":" value provided by the client to look up the related user before passing that user along to our resolvers:","position":{"start":{"line":506,"column":66,"offset":21713},"end":{"line":506,"column":172,"offset":21819},"indent":[]}}],"position":{"start":{"line":506,"column":1,"offset":21648},"end":{"line":506,"column":172,"offset":21819},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const findUser = async (authToken) => {\n  // Find a user by their auth token\n};\n\nconst getDynamicContext = async (ctx, msg, args) => {\n if (ctx.connectionParams.authentication) {\n    const currentUser = await findUser(connectionParams.authentication);\n    return { currentUser };\n  }\n  // Let the resolvers know we don't have a current user so they can\n  // throw the appropriate error\n  return { currentUser: null };\n};\n\n// ...\nuseServer(\n  {\n    // Our GraphQL schema.\n    schema,\n     context: (ctx, msg, args) => {\n       // This will be run every time the client sends a subscription request\n      return getDynamicContext(ctx, msg, args);\n    },\n  },\n  wsServer,\n);","position":{"start":{"line":508,"column":1,"offset":21821},"end":{"line":535,"column":4,"offset":22502},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To sum up, the example above looks up a user based on the authentication token sent with each subscription request before returning the user object to be used by our resolvers. If no user exists or the lookup otherwise fails, our resolvers can throw an error and the corresponding ","position":{"start":{"line":537,"column":1,"offset":22504},"end":{"line":537,"column":282,"offset":22785},"indent":[]}},{"type":"inlineCode","value":"subscription","position":{"start":{"line":537,"column":282,"offset":22785},"end":{"line":537,"column":296,"offset":22799},"indent":[]}},{"type":"text","value":" operation is not executed.","position":{"start":{"line":537,"column":296,"offset":22799},"end":{"line":537,"column":323,"offset":22826},"indent":[]}}],"position":{"start":{"line":537,"column":1,"offset":22504},"end":{"line":537,"column":323,"offset":22826},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Production ","position":{"start":{"line":539,"column":4,"offset":22831},"end":{"line":539,"column":15,"offset":22842},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":539,"column":15,"offset":22842},"end":{"line":539,"column":23,"offset":22850},"indent":[]}},{"type":"text","value":" libraries","position":{"start":{"line":539,"column":23,"offset":22850},"end":{"line":539,"column":33,"offset":22860},"indent":[]}}],"position":{"start":{"line":539,"column":1,"offset":22828},"end":{"line":539,"column":33,"offset":22860},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"#the-pubsub-class","children":[{"type":"text","value":"As mentioned above","position":{"start":{"line":541,"column":2,"offset":22863},"end":{"line":541,"column":20,"offset":22881},"indent":[]}}],"position":{"start":{"line":541,"column":1,"offset":22862},"end":{"line":541,"column":40,"offset":22901},"indent":[]}},{"type":"text","value":", the ","position":{"start":{"line":541,"column":40,"offset":22901},"end":{"line":541,"column":46,"offset":22907},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":541,"column":46,"offset":22907},"end":{"line":541,"column":54,"offset":22915},"indent":[]}},{"type":"text","value":" class is ","position":{"start":{"line":541,"column":54,"offset":22915},"end":{"line":541,"column":64,"offset":22925},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":541,"column":65,"offset":22926},"end":{"line":541,"column":68,"offset":22929},"indent":[]}}],"position":{"start":{"line":541,"column":64,"offset":22925},"end":{"line":541,"column":69,"offset":22930},"indent":[]}},{"type":"text","value":" recommended for production environments, because its event-publishing system is in-memory. This means that events published by ","position":{"start":{"line":541,"column":69,"offset":22930},"end":{"line":541,"column":197,"offset":23058},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"one","position":{"start":{"line":541,"column":198,"offset":23059},"end":{"line":541,"column":201,"offset":23062},"indent":[]}}],"position":{"start":{"line":541,"column":197,"offset":23058},"end":{"line":541,"column":202,"offset":23063},"indent":[]}},{"type":"text","value":" instance of your GraphQL server are not received by subscriptions that are handled by ","position":{"start":{"line":541,"column":202,"offset":23063},"end":{"line":541,"column":289,"offset":23150},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"other","position":{"start":{"line":541,"column":290,"offset":23151},"end":{"line":541,"column":295,"offset":23156},"indent":[]}}],"position":{"start":{"line":541,"column":289,"offset":23150},"end":{"line":541,"column":296,"offset":23157},"indent":[]}},{"type":"text","value":" instances.","position":{"start":{"line":541,"column":296,"offset":23157},"end":{"line":541,"column":307,"offset":23168},"indent":[]}}],"position":{"start":{"line":541,"column":1,"offset":22862},"end":{"line":541,"column":307,"offset":23168},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Instead, you should use a subclass of the ","position":{"start":{"line":543,"column":1,"offset":23170},"end":{"line":543,"column":43,"offset":23212},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts","children":[{"type":"inlineCode","value":"PubSubEngine","position":{"start":{"line":543,"column":44,"offset":23213},"end":{"line":543,"column":58,"offset":23227},"indent":[]}},{"type":"text","value":" abstract class","position":{"start":{"line":543,"column":58,"offset":23227},"end":{"line":543,"column":73,"offset":23242},"indent":[]}}],"position":{"start":{"line":543,"column":43,"offset":23212},"end":{"line":543,"column":163,"offset":23332},"indent":[]}},{"type":"text","value":" that you can back with an external datastore such as Redis or Kafka.","position":{"start":{"line":543,"column":163,"offset":23332},"end":{"line":543,"column":232,"offset":23401},"indent":[]}}],"position":{"start":{"line":543,"column":1,"offset":23170},"end":{"line":543,"column":232,"offset":23401},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The following are community-created ","position":{"start":{"line":545,"column":1,"offset":23403},"end":{"line":545,"column":37,"offset":23439},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":545,"column":37,"offset":23439},"end":{"line":545,"column":45,"offset":23447},"indent":[]}},{"type":"text","value":" libraries for popular event-publishing systems:","position":{"start":{"line":545,"column":45,"offset":23447},"end":{"line":545,"column":93,"offset":23495},"indent":[]}}],"position":{"start":{"line":545,"column":1,"offset":23403},"end":{"line":545,"column":93,"offset":23495},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/davidyaha/graphql-redis-subscriptions","children":[{"type":"text","value":"Redis","position":{"start":{"line":547,"column":4,"offset":23500},"end":{"line":547,"column":9,"offset":23505},"indent":[]}}],"position":{"start":{"line":547,"column":3,"offset":23499},"end":{"line":547,"column":68,"offset":23564},"indent":[]}}],"position":{"start":{"line":547,"column":3,"offset":23499},"end":{"line":547,"column":68,"offset":23564},"indent":[]}}],"position":{"start":{"line":547,"column":1,"offset":23497},"end":{"line":547,"column":68,"offset":23564},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/axelspringer/graphql-google-pubsub","children":[{"type":"text","value":"Google PubSub","position":{"start":{"line":548,"column":4,"offset":23568},"end":{"line":548,"column":17,"offset":23581},"indent":[]}}],"position":{"start":{"line":548,"column":3,"offset":23567},"end":{"line":548,"column":73,"offset":23637},"indent":[]}}],"position":{"start":{"line":548,"column":3,"offset":23567},"end":{"line":548,"column":73,"offset":23637},"indent":[]}}],"position":{"start":{"line":548,"column":1,"offset":23565},"end":{"line":548,"column":73,"offset":23637},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/davidyaha/graphql-mqtt-subscriptions","children":[{"type":"text","value":"MQTT enabled broker","position":{"start":{"line":549,"column":4,"offset":23641},"end":{"line":549,"column":23,"offset":23660},"indent":[]}}],"position":{"start":{"line":549,"column":3,"offset":23640},"end":{"line":549,"column":81,"offset":23718},"indent":[]}}],"position":{"start":{"line":549,"column":3,"offset":23640},"end":{"line":549,"column":81,"offset":23718},"indent":[]}}],"position":{"start":{"line":549,"column":1,"offset":23638},"end":{"line":549,"column":81,"offset":23718},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/cdmbase/graphql-rabbitmq-subscriptions","children":[{"type":"text","value":"RabbitMQ","position":{"start":{"line":550,"column":4,"offset":23722},"end":{"line":550,"column":12,"offset":23730},"indent":[]}}],"position":{"start":{"line":550,"column":3,"offset":23721},"end":{"line":550,"column":72,"offset":23790},"indent":[]}}],"position":{"start":{"line":550,"column":3,"offset":23721},"end":{"line":550,"column":72,"offset":23790},"indent":[]}}],"position":{"start":{"line":550,"column":1,"offset":23719},"end":{"line":550,"column":72,"offset":23790},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/ancashoria/graphql-kafka-subscriptions","children":[{"type":"text","value":"Kafka","position":{"start":{"line":551,"column":4,"offset":23794},"end":{"line":551,"column":9,"offset":23799},"indent":[]}}],"position":{"start":{"line":551,"column":3,"offset":23793},"end":{"line":551,"column":69,"offset":23859},"indent":[]}}],"position":{"start":{"line":551,"column":3,"offset":23793},"end":{"line":551,"column":69,"offset":23859},"indent":[]}}],"position":{"start":{"line":551,"column":1,"offset":23791},"end":{"line":551,"column":69,"offset":23859},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/GraphQLCollege/graphql-postgres-subscriptions","children":[{"type":"text","value":"Postgres","position":{"start":{"line":552,"column":4,"offset":23863},"end":{"line":552,"column":12,"offset":23871},"indent":[]}}],"position":{"start":{"line":552,"column":3,"offset":23862},"end":{"line":552,"column":79,"offset":23938},"indent":[]}}],"position":{"start":{"line":552,"column":3,"offset":23862},"end":{"line":552,"column":79,"offset":23938},"indent":[]}}],"position":{"start":{"line":552,"column":1,"offset":23860},"end":{"line":552,"column":79,"offset":23938},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/MrBoolean/graphql-firestore-subscriptions","children":[{"type":"text","value":"Google Cloud Firestore","position":{"start":{"line":553,"column":4,"offset":23942},"end":{"line":553,"column":26,"offset":23964},"indent":[]}}],"position":{"start":{"line":553,"column":3,"offset":23941},"end":{"line":553,"column":89,"offset":24027},"indent":[]}}],"position":{"start":{"line":553,"column":3,"offset":23941},"end":{"line":553,"column":89,"offset":24027},"indent":[]}}],"position":{"start":{"line":553,"column":1,"offset":23939},"end":{"line":553,"column":89,"offset":24027},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/ably-labs/graphql-ably-pubsub","children":[{"type":"text","value":"Ably Realtime","position":{"start":{"line":554,"column":4,"offset":24031},"end":{"line":554,"column":17,"offset":24044},"indent":[]}}],"position":{"start":{"line":554,"column":3,"offset":24030},"end":{"line":554,"column":68,"offset":24095},"indent":[]}}],"position":{"start":{"line":554,"column":3,"offset":24030},"end":{"line":554,"column":68,"offset":24095},"indent":[]}}],"position":{"start":{"line":554,"column":1,"offset":24028},"end":{"line":554,"column":68,"offset":24095},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/swantzter/graphql-firebase-subscriptions","children":[{"type":"text","value":"Google Firebase Realtime Database","position":{"start":{"line":555,"column":4,"offset":24099},"end":{"line":555,"column":37,"offset":24132},"indent":[]}}],"position":{"start":{"line":555,"column":3,"offset":24098},"end":{"line":555,"column":99,"offset":24194},"indent":[]}}],"position":{"start":{"line":555,"column":3,"offset":24098},"end":{"line":555,"column":99,"offset":24194},"indent":[]}}],"position":{"start":{"line":555,"column":1,"offset":24096},"end":{"line":555,"column":99,"offset":24194},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/aaronpowell/graphql-azure-subscriptions","children":[{"type":"text","value":"Azure SignalR Service","position":{"start":{"line":556,"column":4,"offset":24198},"end":{"line":556,"column":25,"offset":24219},"indent":[]}}],"position":{"start":{"line":556,"column":3,"offset":24197},"end":{"line":556,"column":86,"offset":24280},"indent":[]}}],"position":{"start":{"line":556,"column":3,"offset":24197},"end":{"line":556,"column":86,"offset":24280},"indent":[]}}],"position":{"start":{"line":556,"column":1,"offset":24195},"end":{"line":556,"column":86,"offset":24280},"indent":[]}}],"position":{"start":{"line":547,"column":1,"offset":23497},"end":{"line":556,"column":86,"offset":24280},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If none of these libraries fits your use case, you can also create your own ","position":{"start":{"line":558,"column":1,"offset":24282},"end":{"line":558,"column":77,"offset":24358},"indent":[]}},{"type":"inlineCode","value":"PubSubEngine","position":{"start":{"line":558,"column":77,"offset":24358},"end":{"line":558,"column":91,"offset":24372},"indent":[]}},{"type":"text","value":" subclass. If you create a new open-source library, click ","position":{"start":{"line":558,"column":91,"offset":24372},"end":{"line":558,"column":149,"offset":24430},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Edit on GitHub","position":{"start":{"line":558,"column":151,"offset":24432},"end":{"line":558,"column":165,"offset":24446},"indent":[]}}],"position":{"start":{"line":558,"column":149,"offset":24430},"end":{"line":558,"column":167,"offset":24448},"indent":[]}},{"type":"text","value":" to let us know about it!","position":{"start":{"line":558,"column":167,"offset":24448},"end":{"line":558,"column":192,"offset":24473},"indent":[]}}],"position":{"start":{"line":558,"column":1,"offset":24282},"end":{"line":558,"column":192,"offset":24473},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Switching from ","position":{"start":{"line":560,"column":4,"offset":24478},"end":{"line":560,"column":19,"offset":24493},"indent":[]}},{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":560,"column":19,"offset":24493},"end":{"line":560,"column":47,"offset":24521},"indent":[]}}],"position":{"start":{"line":560,"column":1,"offset":24475},"end":{"line":560,"column":47,"offset":24521},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If you use subscriptions with Apollo Client you must ensure ","position":{"start":{"line":562,"column":2,"offset":24524},"end":{"line":562,"column":62,"offset":24584},"indent":[]}},{"type":"strong","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/data/subscriptions/#choice-of-subscription-protocol","children":[{"type":"text","value":"both your client and server subscription protocols are consistent","position":{"start":{"line":562,"column":65,"offset":24587},"end":{"line":562,"column":130,"offset":24652},"indent":[]}}],"position":{"start":{"line":562,"column":64,"offset":24586},"end":{"line":562,"column":225,"offset":24747},"indent":[]}}],"position":{"start":{"line":562,"column":62,"offset":24584},"end":{"line":562,"column":227,"offset":24749},"indent":[]}},{"type":"text","value":" for the subscription library you are using.","position":{"start":{"line":562,"column":227,"offset":24749},"end":{"line":562,"column":271,"offset":24793},"indent":[]}}],"position":{"start":{"line":562,"column":2,"offset":24524},"end":{"line":562,"column":271,"offset":24793},"indent":[]}}],"position":{"start":{"line":562,"column":1,"offset":24523},"end":{"line":562,"column":271,"offset":24793},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This article previously demonstrated using the ","position":{"start":{"line":564,"column":1,"offset":24795},"end":{"line":564,"column":48,"offset":24842},"indent":[]}},{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":564,"column":48,"offset":24842},"end":{"line":564,"column":76,"offset":24870},"indent":[]}},{"type":"text","value":" library to set up subscriptions. However, this library is no longer actively maintained. You can still use it with Apollo Server, but we strongly recommend using ","position":{"start":{"line":564,"column":76,"offset":24870},"end":{"line":564,"column":239,"offset":25033},"indent":[]}},{"type":"link","title":null,"url":"https://www.npmjs.com/package/graphql-ws","children":[{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":564,"column":240,"offset":25034},"end":{"line":564,"column":252,"offset":25046},"indent":[]}}],"position":{"start":{"line":564,"column":239,"offset":25033},"end":{"line":564,"column":295,"offset":25089},"indent":[]}},{"type":"text","value":" instead.","position":{"start":{"line":564,"column":295,"offset":25089},"end":{"line":564,"column":304,"offset":25098},"indent":[]}}],"position":{"start":{"line":564,"column":1,"offset":24795},"end":{"line":564,"column":304,"offset":25098},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If you intend to switch from ","position":{"start":{"line":566,"column":1,"offset":25100},"end":{"line":566,"column":30,"offset":25129},"indent":[]}},{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":566,"column":30,"offset":25129},"end":{"line":566,"column":58,"offset":25157},"indent":[]}},{"type":"text","value":" to ","position":{"start":{"line":566,"column":58,"offset":25157},"end":{"line":566,"column":62,"offset":25161},"indent":[]}},{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":566,"column":62,"offset":25161},"end":{"line":566,"column":74,"offset":25173},"indent":[]}},{"type":"text","value":" you will need to update the following clients:","position":{"start":{"line":566,"column":74,"offset":25173},"end":{"line":566,"column":121,"offset":25220},"indent":[]}}],"position":{"start":{"line":566,"column":1,"offset":25100},"end":{"line":566,"column":121,"offset":25220},"indent":[]}},{"type":"jsx","value":"<table>\n  <thead>\n    <tr>\n      <th>Client Name</th>\n      <th>To use graphql-ws (RECOMMENDED)</th>\n      <th>To use subscriptions-transport-ws</th>\n    </tr>\n  </thead>","position":{"start":{"line":568,"column":1,"offset":25222},"end":{"line":575,"column":11,"offset":25392},"indent":[1,1,1,1,1,1,1]}},{"type":"jsx","value":"<tbody>\n<tr>\n<td>","position":{"start":{"line":577,"column":1,"offset":25394},"end":{"line":579,"column":5,"offset":25411},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/studio/explorer/explorer/","children":[{"type":"text","value":"Apollo Studio Explorer","position":{"start":{"line":581,"column":2,"offset":25414},"end":{"line":581,"column":24,"offset":25436},"indent":[]}}],"position":{"start":{"line":581,"column":1,"offset":25413},"end":{"line":581,"column":87,"offset":25499},"indent":[]}}],"position":{"start":{"line":581,"column":1,"offset":25413},"end":{"line":581,"column":87,"offset":25499},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":583,"column":1,"offset":25501},"end":{"line":583,"column":6,"offset":25506},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":585,"column":1,"offset":25508},"end":{"line":585,"column":5,"offset":25512},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support","children":[{"type":"inlineCode","value":"graphql-ws","position":{"start":{"line":587,"column":2,"offset":25515},"end":{"line":587,"column":14,"offset":25527},"indent":[]}}],"position":{"start":{"line":587,"column":1,"offset":25514},"end":{"line":587,"column":109,"offset":25622},"indent":[]}}],"position":{"start":{"line":587,"column":1,"offset":25514},"end":{"line":587,"column":109,"offset":25622},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":589,"column":1,"offset":25624},"end":{"line":589,"column":6,"offset":25629},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":591,"column":1,"offset":25631},"end":{"line":591,"column":5,"offset":25635},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support","children":[{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":593,"column":2,"offset":25638},"end":{"line":593,"column":30,"offset":25666},"indent":[]}}],"position":{"start":{"line":593,"column":1,"offset":25637},"end":{"line":593,"column":125,"offset":25761},"indent":[]}}],"position":{"start":{"line":593,"column":1,"offset":25637},"end":{"line":593,"column":125,"offset":25761},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":594,"column":1,"offset":25762},"end":{"line":594,"column":6,"offset":25767},"indent":[]}},{"type":"jsx","value":"</tr>","position":{"start":{"line":596,"column":1,"offset":25769},"end":{"line":596,"column":6,"offset":25774},"indent":[]}},{"type":"jsx","value":"<tr>\n<td>","position":{"start":{"line":598,"column":1,"offset":25776},"end":{"line":599,"column":5,"offset":25785},"indent":[1]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/data/subscriptions","children":[{"type":"text","value":"Apollo Client Web","position":{"start":{"line":601,"column":2,"offset":25788},"end":{"line":601,"column":19,"offset":25805},"indent":[]}}],"position":{"start":{"line":601,"column":1,"offset":25787},"end":{"line":601,"column":81,"offset":25867},"indent":[]}}],"position":{"start":{"line":601,"column":1,"offset":25787},"end":{"line":601,"column":81,"offset":25867},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":603,"column":1,"offset":25869},"end":{"line":603,"column":6,"offset":25874},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":606,"column":1,"offset":25877},"end":{"line":606,"column":5,"offset":25881},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":608,"column":1,"offset":25883},"end":{"line":608,"column":5,"offset":25887},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/api/link/apollo-link-subscriptions/","children":[{"type":"inlineCode","value":"GraphQLWsLink","position":{"start":{"line":608,"column":6,"offset":25888},"end":{"line":608,"column":21,"offset":25903},"indent":[]}}],"position":{"start":{"line":608,"column":5,"offset":25887},"end":{"line":608,"column":100,"offset":25982},"indent":[]}},{"type":"jsx","value":"<br/>","position":{"start":{"line":608,"column":100,"offset":25982},"end":{"line":608,"column":105,"offset":25987},"indent":[]}},{"type":"text","value":"\n(Requires v3.5.10 or later)","position":{"start":{"line":608,"column":105,"offset":25987},"end":{"line":609,"column":28,"offset":26015},"indent":[1]}}],"position":{"start":{"line":608,"column":1,"offset":25883},"end":{"line":609,"column":28,"offset":26015},"indent":[1]}},{"type":"jsx","value":"</td>","position":{"start":{"line":611,"column":1,"offset":26017},"end":{"line":611,"column":6,"offset":26022},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":613,"column":1,"offset":26024},"end":{"line":613,"column":5,"offset":26028},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":615,"column":1,"offset":26030},"end":{"line":615,"column":5,"offset":26034},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/api/link/apollo-link-ws/","children":[{"type":"inlineCode","value":"WebSocketLink","position":{"start":{"line":615,"column":6,"offset":26035},"end":{"line":615,"column":21,"offset":26050},"indent":[]}}],"position":{"start":{"line":615,"column":5,"offset":26034},"end":{"line":615,"column":89,"offset":26118},"indent":[]}}],"position":{"start":{"line":615,"column":1,"offset":26030},"end":{"line":615,"column":89,"offset":26118},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":616,"column":1,"offset":26119},"end":{"line":616,"column":6,"offset":26124},"indent":[]}},{"type":"jsx","value":"</tr>","position":{"start":{"line":618,"column":1,"offset":26126},"end":{"line":618,"column":6,"offset":26131},"indent":[]}},{"type":"jsx","value":"<tr>\n<td>","position":{"start":{"line":621,"column":1,"offset":26134},"end":{"line":622,"column":5,"offset":26143},"indent":[1]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/ios/subscriptions/","children":[{"type":"text","value":"Apollo iOS","position":{"start":{"line":624,"column":2,"offset":26146},"end":{"line":624,"column":12,"offset":26156},"indent":[]}}],"position":{"start":{"line":624,"column":1,"offset":26145},"end":{"line":624,"column":68,"offset":26212},"indent":[]}}],"position":{"start":{"line":624,"column":1,"offset":26145},"end":{"line":624,"column":68,"offset":26212},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":626,"column":1,"offset":26214},"end":{"line":626,"column":6,"offset":26219},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":629,"column":1,"offset":26222},"end":{"line":629,"column":5,"offset":26226},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/ios/api/ApolloWebSocket/enums/WebSocket.WSProtocol/#graphql_transport_ws","children":[{"type":"inlineCode","value":"graphql_transport_ws","position":{"start":{"line":631,"column":2,"offset":26229},"end":{"line":631,"column":24,"offset":26251},"indent":[]}}],"position":{"start":{"line":631,"column":1,"offset":26228},"end":{"line":631,"column":134,"offset":26361},"indent":[]}},{"type":"jsx","value":"<br/>","position":{"start":{"line":631,"column":134,"offset":26361},"end":{"line":631,"column":139,"offset":26366},"indent":[]}},{"type":"text","value":"\n(Requires v0.51.0 or later)","position":{"start":{"line":631,"column":139,"offset":26366},"end":{"line":632,"column":28,"offset":26394},"indent":[1]}}],"position":{"start":{"line":631,"column":1,"offset":26228},"end":{"line":632,"column":28,"offset":26394},"indent":[1]}},{"type":"jsx","value":"</td>","position":{"start":{"line":634,"column":1,"offset":26396},"end":{"line":634,"column":6,"offset":26401},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":636,"column":1,"offset":26403},"end":{"line":636,"column":5,"offset":26407},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/ios/api/ApolloWebSocket/enums/WebSocket.WSProtocol/#graphql_ws","children":[{"type":"inlineCode","value":"graphql_ws","position":{"start":{"line":638,"column":2,"offset":26410},"end":{"line":638,"column":14,"offset":26422},"indent":[]}}],"position":{"start":{"line":638,"column":1,"offset":26409},"end":{"line":638,"column":114,"offset":26522},"indent":[]}}],"position":{"start":{"line":638,"column":1,"offset":26409},"end":{"line":638,"column":114,"offset":26522},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":639,"column":1,"offset":26523},"end":{"line":639,"column":6,"offset":26528},"indent":[]}},{"type":"jsx","value":"</tr>","position":{"start":{"line":641,"column":1,"offset":26530},"end":{"line":641,"column":6,"offset":26535},"indent":[]}},{"type":"jsx","value":"<tr>\n<td>","position":{"start":{"line":644,"column":1,"offset":26538},"end":{"line":645,"column":5,"offset":26547},"indent":[1]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/","children":[{"type":"text","value":"Apollo Kotlin","position":{"start":{"line":647,"column":2,"offset":26550},"end":{"line":647,"column":15,"offset":26563},"indent":[]}}],"position":{"start":{"line":647,"column":1,"offset":26549},"end":{"line":647,"column":85,"offset":26633},"indent":[]}}],"position":{"start":{"line":647,"column":1,"offset":26549},"end":{"line":647,"column":85,"offset":26633},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":649,"column":1,"offset":26635},"end":{"line":649,"column":6,"offset":26640},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":651,"column":1,"offset":26642},"end":{"line":651,"column":5,"offset":26646},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/#customizing-your-websocket-protocol","children":[{"type":"inlineCode","value":"GraphQLWsProtocol","position":{"start":{"line":653,"column":2,"offset":26649},"end":{"line":653,"column":21,"offset":26668},"indent":[]}}],"position":{"start":{"line":653,"column":1,"offset":26648},"end":{"line":653,"column":127,"offset":26774},"indent":[]}},{"type":"jsx","value":"<br/>","position":{"start":{"line":653,"column":127,"offset":26774},"end":{"line":653,"column":132,"offset":26779},"indent":[]}},{"type":"text","value":"\n(Requires v3.0.0 or later)","position":{"start":{"line":653,"column":132,"offset":26779},"end":{"line":654,"column":27,"offset":26806},"indent":[1]}}],"position":{"start":{"line":653,"column":1,"offset":26648},"end":{"line":654,"column":27,"offset":26806},"indent":[1]}},{"type":"jsx","value":"</td>","position":{"start":{"line":656,"column":1,"offset":26808},"end":{"line":656,"column":6,"offset":26813},"indent":[]}},{"type":"jsx","value":"<td>","position":{"start":{"line":658,"column":1,"offset":26815},"end":{"line":658,"column":5,"offset":26819},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/#customizing-your-websocket-protocol","children":[{"type":"inlineCode","value":"SubscriptionWsProtocol","position":{"start":{"line":660,"column":2,"offset":26822},"end":{"line":660,"column":26,"offset":26846},"indent":[]}}],"position":{"start":{"line":660,"column":1,"offset":26821},"end":{"line":660,"column":132,"offset":26952},"indent":[]}}],"position":{"start":{"line":660,"column":1,"offset":26821},"end":{"line":660,"column":132,"offset":26952},"indent":[]}},{"type":"jsx","value":"</td>","position":{"start":{"line":661,"column":1,"offset":26953},"end":{"line":661,"column":6,"offset":26958},"indent":[]}},{"type":"jsx","value":"</tr>","position":{"start":{"line":663,"column":1,"offset":26960},"end":{"line":663,"column":6,"offset":26965},"indent":[]}},{"type":"jsx","value":"</tbody>\n</table>","position":{"start":{"line":665,"column":1,"offset":26967},"end":{"line":666,"column":9,"offset":26984},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"For more information on using Apollo Server with ","position":{"start":{"line":668,"column":1,"offset":26986},"end":{"line":668,"column":50,"offset":27035},"indent":[]}},{"type":"inlineCode","value":"subscriptions-transport-ws","position":{"start":{"line":668,"column":50,"offset":27035},"end":{"line":668,"column":78,"offset":27063},"indent":[]}},{"type":"text","value":", you can view the ","position":{"start":{"line":668,"column":78,"offset":27063},"end":{"line":668,"column":97,"offset":27082},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/apollo-server/blob/4b82967c10a69aa104848a8c9d15c591b528918c/docs/source/data/subscriptions.mdx","children":[{"type":"text","value":"previous version of this article here","position":{"start":{"line":668,"column":98,"offset":27083},"end":{"line":668,"column":135,"offset":27120},"indent":[]}}],"position":{"start":{"line":668,"column":97,"offset":27082},"end":{"line":668,"column":265,"offset":27250},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":668,"column":265,"offset":27250},"end":{"line":668,"column":266,"offset":27251},"indent":[]}}],"position":{"start":{"line":668,"column":1,"offset":26986},"end":{"line":668,"column":266,"offset":27251},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Subscriptions in Apollo Server\",\"sidebar_title\":\"Subscriptions\",\"description\":\"Persistent GraphQL read operations\"}","position":{"start":{"line":672,"column":1,"offset":27255},"end":{"line":672,"column":154,"offset":27408},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":672,"column":154,"offset":27408}}},"scopeImports":["import {ExpansionPanel, MultiCodeBlock} from 'gatsby-theme-apollo-docs';","import * as React from 'react'"],"scopeIdentifiers":["ExpansionPanel","MultiCodeBlock","React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Subscriptions in Apollo Server\",\n  \"sidebar_title\": \"Subscriptions\",\n  \"description\": \"Persistent GraphQL read operations\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Apollo Server 3 removes built-in support for subscriptions.\"), \" You can reenable support as \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#enabling-subscriptions\"\n  }, \"described below\"), \".\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Subscriptions are not currently supported in \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://www.apollographql.com/docs/federation/\"\n  }, \"Apollo Federation\"), \".\")), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"This article has been updated to use the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\"), \" library to add support for subscriptions to Apollo Server. We no longer recommend using the previously documented \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\"), \", because this library is not actively maintained. For more information about the differences between the two libraries, see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#switching-from-subscriptions-transport-ws\"\n  }, \"Switching from \", mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\")), \".\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Subscriptions\"), \" are long-lasting GraphQL read operations that can update their result whenever a particular server-side event occurs. Most commonly, updated results are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"pushed\"), \" from the server to subscribing clients. For example, a chat application's server might use a subscription to push newly received messages to all clients in a particular chat room.\"), mdx(\"p\", null, \"Because subscription updates are usually pushed by the server (instead of polled by the client), they usually use \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\"\n  }, \"the WebSocket protocol\"), \" instead of HTTP.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Important:\"), \" Compared to queries and mutations, subscriptions are significantly more complex to implement. Before you begin, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#when-to-use-subscriptions\"\n  }, \"confirm that your use case requires subscriptions\"), \".\")), mdx(\"h2\", {\n    \"id\": \"schema-definition\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#schema-definition\",\n    \"aria-label\": \"schema definition permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Schema definition\"), mdx(\"p\", null, \"Your schema's \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" type defines top-level fields that clients can subscribe to:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"type\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Subscription\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Post\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"postCreated\"), \" field will update its value whenever a new \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Post\"), \" is created on the backend, thus pushing the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Post\"), \" to subscribing clients.\"), mdx(\"p\", null, \"Clients can subscribe to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"postCreated\"), \" field with a GraphQL string, like this:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"subscription\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token object\"\n  }, \"PostFeed\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token object\"\n  }, \"postCreated\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"author\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"comment\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Each subscription operation can subscribe to only \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"one\"), \" field of the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" type.\")), mdx(\"h2\", {\n    \"id\": \"enabling-subscriptions\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#enabling-subscriptions\",\n    \"aria-label\": \"enabling subscriptions permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Enabling subscriptions\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Beginning in Apollo Server 3, subscriptions are \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" supported by the \\\"batteries-included\\\" \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"apollo-server\"), \" package. To enable subscriptions, you must first \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/integrations/middleware/#swapping-out-apollo-server\"\n  }, \"swap to the \", mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"apollo-server-express\"), \" package\"), \" (or any other Apollo Server integration package that supports subscriptions).\"), mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The following steps assume you've already swapped to \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"apollo-server-express\"), \".\")), mdx(\"p\", null, \"To run both an Express app \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"and\"), \" a separate WebSocket server for subscriptions, we'll create an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"http.Server\"), \" instance that effectively wraps the two and becomes our new \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"listen\"), \"er.\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Install \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\"), \", \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ws\"), \", \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"@graphql-tools/schema\"), \", and 'apollo-server-core':\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"bash\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-bash line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-bash\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"npm\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"install\"), \" graphql-ws ws @graphql-tools/schema apollo-server-core\"), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Add the following imports to the file where you initialize your \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ApolloServer\"), \" instance (we'll use these in later steps):\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" createServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'http'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServerPluginDrainHttpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"apollo-server-core\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" makeExecutableSchema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'@graphql-tools/schema'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" WebSocketServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" useServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'graphql-ws/lib/use/ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Next, in order to set up both the HTTP and subscription servers, we need to first create an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"http.Server\"), \". Do this by passing your Express \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"app\"), \" to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"createServer\"), \" function, which we imported from the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"http\"), \" module:\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// This `app` is the returned value from `express()`.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"app\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Create an instance of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"GraphQLSchema\"), \" (if you haven't already).\"), mdx(\"blockquote\", {\n    parentName: \"li\"\n  }, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If you already pass the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"schema\"), \" option to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ApolloServer\"), \" constructor (instead of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"typeDefs\"), \" and \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"resolvers\"), \"), you can skip this step.\")), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"The subscription server (which we'll instantiate next) doesn't take \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"typeDefs\"), \" and \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"resolvers\"), \" options. Instead, it takes an executable \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"GraphQLSchema\"), \". We can pass this \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"schema\"), \" object to both the subscription server and \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ApolloServer\"), \". This way, we make sure that the same schema is being used in both places.\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" schema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"makeExecutableSchema\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" typeDefs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Create a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"WebSocketServer\"), \" to use as your subscription server.\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Creating the WebSocket server\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" wsServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"WebSocketServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// This is the `httpServer` we created in a previous step.\"), \"\\n    server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" httpServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Pass a different path here if your ApolloServer serves at\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// a different path.\"), \"\\n    path\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'/graphql'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Hand in the schema we just created and have the\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// WebSocketServer start listening.\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" serverCleanup \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" schema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Add \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/integrations/plugins/\"\n  }, \"plugins\"), \" to your \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ApolloServer\"), \" constructor to shutdown both the HTTP server and the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"WebSocketServer\"), \":\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, \"  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    plugins\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Proper shutdown for the HTTP server.\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"ApolloServerPluginDrainHttpServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Proper shutdown for the WebSocket server.\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"serverWillStart\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n            \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"drainServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n              \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" serverCleanup\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"dispose\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n            \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }))))), mdx(\"li\", {\n    parentName: \"ol\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Finally, ensure you are \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"listen\"), \"ing to your \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"httpServer\"), \".\"), mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Most Express applications call \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"app.listen(...)\"), \", but for your setup  change this to \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"httpServer.listen(...)\"), \" using the same arguments. This way, the server starts listening on the HTTP and WebSocket transports simultaneously.\"))), mdx(\"p\", null, \"A completed example of setting up subscriptions is shown below:\"), mdx(ExpansionPanel, {\n    title: \"Click to expand\",\n    mdxType: \"ExpansionPanel\"\n  }, mdx(MultiCodeBlock, {\n    mdxType: \"MultiCodeBlock\"\n  }, mdx(\"div\", {\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server-express'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" createServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'http'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" express \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'express'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServerPluginDrainHttpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"apollo-server-core\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" makeExecutableSchema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'@graphql-tools/schema'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" WebSocketServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" useServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'graphql-ws/lib/use/ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'./resolvers'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" typeDefs \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'./typeDefs'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create the schema, which will be used separately by ApolloServer and\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// the WebSocket server.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" schema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"makeExecutableSchema\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" typeDefs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create an Express app and HTTP server; we will attach both the WebSocket\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// server and the ApolloServer to this HTTP server.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" app \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"express\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"app\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create our WebSocket server using the HTTP server we just set up.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" wsServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"WebSocketServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" httpServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  path\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'/graphql'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Save the returned server's info so we can shutdown this server later\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" serverCleanup \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" schema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Set up ApolloServer.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  plugins\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Proper shutdown for the HTTP server.\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"ApolloServerPluginDrainHttpServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Proper shutdown for the WebSocket server.\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"serverWillStart\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"drainServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n            \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" serverCleanup\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"dispose\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"start\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\nserver\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"applyMiddleware\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" app \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"4000\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Now that our HTTP server is fully set up, we can listen to it.\"), \"\\nhttpServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"listen\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"console\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"Server is now running on http://localhost:\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"server\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"graphqlPath\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"div\", {\n    \"className\": \"gatsby-code-title\"\n  }, \"index.js\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server-express'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" createServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'http'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" express \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'express'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServerPluginDrainHttpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server-core'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" makeExecutableSchema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'@graphql-tools/schema'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" WebSocketServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" useServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'graphql-ws/lib/use/ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'./resolvers'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" typeDefs \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'./typeDefs'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create the schema, which will be used separately by ApolloServer and\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// the WebSocket server.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" schema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"makeExecutableSchema\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" typeDefs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create an Express app and HTTP server; we will attach both the WebSocket\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// server and the ApolloServer to this HTTP server.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" app \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"express\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"app\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Create our WebSocket server using the HTTP server we just set up.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" wsServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"WebSocketServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"server\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" httpServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"path\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'/graphql'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Save the returned server's info so we can shutdown this server later\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" serverCleanup \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" schema \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Set up ApolloServer.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"plugins\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Proper shutdown for the HTTP server.\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"ApolloServerPluginDrainHttpServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Proper shutdown for the WebSocket server.\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"serverWillStart\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"drainServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n            \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" serverCleanup\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"dispose\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"start\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\nserver\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"applyMiddleware\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" app \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"4000\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Now that our HTTP server is fully set up, we can listen to it.\"), \"\\nhttpServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"listen\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"Server is now running on http://localhost:\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"server\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"graphqlPath\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))))), mdx(\"h2\", {\n    \"id\": \"resolving-a-subscription\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#resolving-a-subscription\",\n    \"aria-label\": \"resolving a subscription permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Resolving a subscription\"), mdx(\"p\", null, \"Resolvers for \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" fields differ from resolvers for fields of other types. Specifically, \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field resolvers are \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"objects\"), \" that define a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function:\"), mdx(\"div\", {\n    \"className\": \"gatsby-code-title\"\n  }, \"index.ts\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  Subscription\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    postCreated\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// More on pubsub below\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"subscribe\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"must\"), \" return an object of type \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \", a standard interface for iterating over asynchronous results. In the example above, an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" is generated by \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"pubsub.asyncIterator\"), \" (more on this below).\"), mdx(\"h3\", {\n    \"id\": \"the-pubsub-class\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#the-pubsub-class\",\n    \"aria-label\": \"the pubsub class permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"The \", mdx(\"code\", {\n    parentName: \"h3\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" recommended for production environments, because it's an in-memory event system that only supports a single server instance. After you get subscriptions working in development, we strongly recommend switching it out for a different subclass of the abstract \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"PubSubEngine\"), \" class\"), \". Recommended subclasses are listed in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#production-pubsub-libraries\"\n  }, \"Production \", mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" libraries\"), \".\")), mdx(\"p\", null, \"Apollo Server uses a \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"publish-subscribe\"), \" (\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"pub/sub\"), \") model to track events that update active subscriptions. The \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql-subscriptions\"), \" library\"), \" provides the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class as a basic in-memory event bus to help you get started:\"), mdx(\"p\", null, \"To use the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"graphql-subscriptions\"), \" package, first install it like so:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"shell\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-shell line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-shell\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"npm\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"install\"), \" graphql-subscriptions\"), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"A \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" instance enables your server code to both \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" events to a particular label and listen for events associated with a particular label. We can create a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" instance like so:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" PubSub \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'graphql-subscriptions'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" pubsub \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"PubSub\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"h3\", {\n    \"id\": \"publishing-an-event\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#publishing-an-event\",\n    \"aria-label\": \"publishing an event permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Publishing an event\"), mdx(\"p\", null, \"You can publish an event using the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" method of a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" instance:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"publish\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"author\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Ali Baba'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"comment\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Open sesame'\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The first parameter is the name of the event label you're publishing to, as a string.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"You don't need to register a label name before publishing to it.\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The second parameter is the payload associated with the event.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"The payload should include whatever data is necessary for your resolvers to populate the associated \", mdx(\"code\", {\n    parentName: \"em\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field and its subfields.\"))))), mdx(\"p\", null, \"When working with GraphQL subscriptions, you \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" an event whenever a subscription's return value should be updated. One common cause of such an update is a mutation, but \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"any\"), \" back-end logic might result in changes that should be \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \"ed.\"), mdx(\"p\", null, \"As an example, let's say our GraphQL API supports a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"createPost\"), \" mutation:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"type\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Mutation\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"author\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar\"\n  }, \"String\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"comment\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar\"\n  }, \"String\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Post\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"A basic resolver for \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"createPost\"), \" might look like this:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight has-highlighted-lines\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Mutation\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token parameter\"\n  }, \"parent\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" context\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token comment\"\n  }, \"// Datastore logic lives in postController\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" postController\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"args\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\")), \"  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Before we persist the new post's details in our datastore, we can \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" an event that \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"also\"), \" includes those details:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Mutation\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"parent\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      pubsub\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"publish\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" args \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), \"      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" postController\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Next, we can listen for this event in our \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field's resolver.\"), mdx(\"h3\", {\n    \"id\": \"listening-for-events\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#listening-for-events\",\n    \"aria-label\": \"listening for events permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Listening for events\"), mdx(\"p\", null, \"An \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-async-iterator.ts\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\")), \" object listens for events that are associated with a particular label (or set of labels) and adds them to a queue for processing.\"), mdx(\"p\", null, \"You can create an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" by calling the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"asyncIterator\"), \" method of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" and passing in an array containing the names of the event labels that this \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" should listen for.\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Every \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field resolver's \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function must return an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" object.\"), mdx(\"p\", null, \"This brings us back to the code sample at the top of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#resolving-a-subscription\"\n  }, \"Resolving a subscription\"), \":\"), mdx(\"div\", {\n    \"className\": \"gatsby-code-title\"\n  }, \"index.js\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"subscribe\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"With this \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function set, Apollo Server uses the payloads of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"POST_CREATED\"), \" events to push updated values for the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"postCreated\"), \" field.\"), mdx(\"h3\", {\n    \"id\": \"filtering-events\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#filtering-events\",\n    \"aria-label\": \"filtering events permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Filtering events\"), mdx(\"p\", null, \"Sometimes, a client should only receive updated subscription data if that data meets certain criteria. To support this, you can call the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" helper function in your \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field's resolver.\"), mdx(\"h4\", {\n    \"id\": \"example\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"#example\",\n    \"aria-label\": \"example permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Example\"), mdx(\"p\", null, \"Let's say our server provides a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"commentAdded\"), \" subscription, which should notify clients whenever a comment is added to a specified code repository. A client can execute a subscription that looks like this:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$repoName\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar\"\n  }, \"String\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property-query\"\n  }, \"commentAdded\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"repoFullName\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$repoName\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"id\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"content\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"This presents a potential issue: our server probably \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#publishing-an-event\"\n  }, \"publishes\"), \" a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"COMMENT_ADDED\"), \" event whenever a comment is added to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"any\"), \" repository. This means that the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"commentAdded\"), \" resolver executes for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"every\"), \" new comment, regardless of which repository it's added to. As a result, subscribing clients might receive data they don't want (or shouldn't even have access to).\"), mdx(\"p\", null, \"To fix this, we can use the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" helper function to control updates on a per-client basis.\"), mdx(\"p\", null, \"Here's an example resolver for \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"commentAdded\"), \" that uses the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" function:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight has-highlighted-lines\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" withFilter \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'graphql-subscriptions'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"commentAdded\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"subscribe\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"withFilter\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"        \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" pubsub\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'COMMENT_ADDED'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"        \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token parameter\"\n  }, \"payload\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" variables\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"          \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token comment\"\n  }, \"// Only push an update if the comment is on\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"          \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token comment\"\n  }, \"// the correct repository for this operation\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"          \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"payload\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"commentAdded\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"repository_name \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" variables\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"repoFullName\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"        \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\")), \"      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" function takes two parameters:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The first parameter is exactly the function you would use for \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" if you \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"weren't\"), \" applying a filter.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The second parameter is a \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"filter function\"), \" that returns \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"true\"), \" if a subscription update \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"should\"), \" be sent to a particular client, and \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"false\"), \" otherwise (\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Promise<boolean>\"), \" is also allowed). This function takes two parameters of its own:\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"payload\"), \" is the payload of the event that was published.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"variables\"), \" is an object containing all arguments the client provided when initiating their subscription.\")))), mdx(\"p\", null, \"Use \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" to make sure clients get exactly the subscription updates they want (and are allowed to receive).\"), mdx(\"h2\", {\n    \"id\": \"basic-runnable-example\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#basic-runnable-example\",\n    \"aria-label\": \"basic runnable example permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Basic runnable example\"), mdx(\"p\", null, \"An example server is available on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/docs-examples/blob/main/apollo-server/v3/subscriptions-graphql-ws/src/index.ts\"\n  }, \"GitHub\"), \" and CodeSandbox:\"), mdx(\"a\", {\n    href: \"https://codesandbox.io/s/github/apollographql/docs-examples/tree/main/apollo-server/v3/subscriptions-graphql-ws?fontsize=14&hidenavigation=1&initialpath=%2Fgraphql&theme=dark\"\n  }, mdx(\"img\", {\n    alt: \"Edit server-subscriptions-as3\",\n    src: \"https://codesandbox.io/static/img/play-codesandbox.svg\"\n  })), mdx(\"p\", null, \"The server exposes one subscription (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"numberIncremented\"), \") that returns an integer that's incremented on the server every second. Here's an example subscription that you can run against your server:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"subscription\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token object\"\n  }, \"IncrementingNumber\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"numberIncremented\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If you don't see the result of your subscription operation you might need to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support\"\n  }, \"adjust your Sandbox settings to use the \", mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\"), \" protocol\"), \".\")), mdx(\"p\", null, \"After you start up the server in CodeSandbox, follow the instructions in the browser to test running the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"numberIncremented\"), \" subscription in Apollo Sandbox. You should see the subscription's value update every second.\"), mdx(\"h2\", {\n    \"id\": \"operation-context\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#operation-context\",\n    \"aria-label\": \"operation context permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Operation context\"), mdx(\"p\", null, \"When \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/data/resolvers/#the-context-argument\"\n  }, \"initializing context\"), \" for a query or mutation, you usually extract HTTP headers and other request metadata from the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"req\"), \" object provided to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" function.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"For subscriptions,\"), \" you can extract information from a client's request by adding \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.ServerOptions.md\"\n  }, \"options\"), \" to the first argument passed to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"useServer\"), \" function.\"), mdx(\"p\", null, \"For example, you can provide a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.ServerOptions.md#context\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" property\"), \" to add values to your GraphQL operation \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/data/resolvers/#the-context-argument\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"context\")), \":\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Our GraphQL schema.\"), \"\\n    schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Adding a context property lets you add data to your GraphQL operation context\"), \"\\n     \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n       \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// You can define your own function for setting a dynamic context\"), \"\\n       \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// or provide a static value\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getDynamicContext\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Notice that the first parameter passed to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" function above is \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ctx\"), \". The \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.Context.md\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"ctx object\")), \" represents the context of your \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"subscription server\"), \", not the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQL operation context\"), \" that's passed to your resolvers.\"), mdx(\"p\", null, \"You can access the parameters of a client's \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscription\"), \" request to your WebSocket server via the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ctx.connectionParams\"), \" property.\"), mdx(\"p\", null, \"Below is an example of the common use case of extracting an authentication token from a client \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscription\"), \" request and using it to find the current user:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"getDynamicContext\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ctx is the graphql-ws Context where connectionParams live\"), \"\\n \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authentication\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" currentUser \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"findUser\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authentication\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" currentUser \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Otherwise let our resolvers know we don't have a current user\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" currentUser\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"null\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Adding a context property lets you add data to your GraphQL operation context\"), \"\\n     \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n       \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Returning an object will add that information to our\"), \"\\n       \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// GraphQL context, which all of our resolvers have access to.\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getDynamicContext\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Putting it all together, if the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"useServer.context\"), \" function returns an \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"object\"), \", that object is passed to the GraphQL operation \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \", which is available to your resolvers.\"), mdx(\"p\", null, \"Note that the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" option is called once per \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscription\"), \" request, not once per event emission. This means that in the above example, every time a client sends a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscription\"), \" operation, we check their authentication token.\"), mdx(\"h3\", {\n    \"id\": \"onconnect-and-ondisconnect\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#onconnect-and-ondisconnect\",\n    \"aria-label\": \"onconnect and ondisconnect permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"code\", {\n    parentName: \"h3\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" and \", mdx(\"code\", {\n    parentName: \"h3\",\n    \"className\": \"language-text\"\n  }, \"onDisconnect\")), mdx(\"p\", null, \"You can configure the subscription server's behavior whenever a client connects (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \") or disconnects (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onDisconnect\"), \").\"), mdx(\"p\", null, \"Defining an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" function enables you to reject a particular incoming connection by returning \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"false\"), \" or by throwing an exception. This can be helpful if you want to check authentication when a client first connects to your subscription server.\"), mdx(\"p\", null, \"You provide these functions as options to the first argument of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"useServer\"), \", like so:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight has-highlighted-lines\",\n    \"data-language\": \"ts\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-ts line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// As before, ctx is the graphql-ws Context where connectionParams live.\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function-variable function\"\n  }, \"onConnect\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), \"      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Check authentication every time a client connects.\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"tokenIsNotValid\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// You can return false to close the connection  or throw an explicit error\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"throw\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Error\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Auth token missing!'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"onDisconnect\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" code\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" reason\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), \"      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token builtin\"\n  }, \"console\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Disconnected!'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"For more information and examples of using \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" and \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onDisconnect\"), \", see the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/enisdenjo/graphql-ws#ws-auth-handling\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\"), \" documentation\"), \".\"), mdx(\"h3\", {\n    \"id\": \"example-authentication-with-apollo-client\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#example-authentication-with-apollo-client\",\n    \"aria-label\": \"example authentication with apollo client permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Example: Authentication with Apollo Client\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If you plan to use subscriptions with Apollo Client, ensure \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"#switching-from-subscriptions-transport-ws\"\n  }, \"both your client and server subscription protocols are consistent\")), \" for the subscription library you are using (this example uses the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\"), \" library).\")), mdx(\"p\", null, \"In Apollo Client, the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"GraphQLWsLink\"), \" constructor supports adding information to \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connectionParams\"), \" (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#5-authenticate-over-websocket-optional\"\n  }, \"example\"), \"). Those \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connectionParams\"), \" are sent to your server when it connects, allowing you to extract information from the client request by accessing \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Context.connectionParams\"), \".\"), mdx(\"p\", null, \"Let's suppose we create our subscription client like so:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" GraphQLWsLink \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'@apollo/client/link/subscriptions'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"import\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" createClient \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"from\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'graphql-ws'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" wsLink \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"GraphQLWsLink\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createClient\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"url\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'ws://localhost:4000/subscriptions'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"connectionParams\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"authorization\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" user\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authToken\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connectionParams\"), \" argument (which contains the information provided by the client) is passed to your server, enabling you to validate the user's credentials.\"), mdx(\"p\", null, \"From there you can use the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#operation-context\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"useServer.context\"), \" property\"), \" to authenticate the user, returning an object that's passed into your resolvers as the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" argument during execution.\"), mdx(\"p\", null, \"For our example, we can use the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connectionParams.authentication\"), \" value provided by the client to look up the related user before passing that user along to our resolvers:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"findUser\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"authToken\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Find a user by their auth token\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"getDynamicContext\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"ctx\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authentication\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" currentUser \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"findUser\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authentication\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" currentUser \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Let the resolvers know we don't have a current user so they can\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// throw the appropriate error\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"currentUser\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"null\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"useServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Our GraphQL schema.\"), \"\\n    schema\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n     \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"ctx\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n       \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// This will be run every time the client sends a subscription request\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"getDynamicContext\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"ctx\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" msg\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  wsServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"To sum up, the example above looks up a user based on the authentication token sent with each subscription request before returning the user object to be used by our resolvers. If no user exists or the lookup otherwise fails, our resolvers can throw an error and the corresponding \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscription\"), \" operation is not executed.\"), mdx(\"h2\", {\n    \"id\": \"production-pubsub-libraries\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#production-pubsub-libraries\",\n    \"aria-label\": \"production pubsub libraries permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Production \", mdx(\"code\", {\n    parentName: \"h2\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" libraries\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#the-pubsub-class\"\n  }, \"As mentioned above\"), \", the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" recommended for production environments, because its event-publishing system is in-memory. This means that events published by \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"one\"), \" instance of your GraphQL server are not received by subscriptions that are handled by \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"other\"), \" instances.\"), mdx(\"p\", null, \"Instead, you should use a subclass of the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"PubSubEngine\"), \" abstract class\"), \" that you can back with an external datastore such as Redis or Kafka.\"), mdx(\"p\", null, \"The following are community-created \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" libraries for popular event-publishing systems:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/davidyaha/graphql-redis-subscriptions\"\n  }, \"Redis\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/axelspringer/graphql-google-pubsub\"\n  }, \"Google PubSub\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/davidyaha/graphql-mqtt-subscriptions\"\n  }, \"MQTT enabled broker\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/cdmbase/graphql-rabbitmq-subscriptions\"\n  }, \"RabbitMQ\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/ancashoria/graphql-kafka-subscriptions\"\n  }, \"Kafka\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/GraphQLCollege/graphql-postgres-subscriptions\"\n  }, \"Postgres\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/MrBoolean/graphql-firestore-subscriptions\"\n  }, \"Google Cloud Firestore\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/ably-labs/graphql-ably-pubsub\"\n  }, \"Ably Realtime\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/swantzter/graphql-firebase-subscriptions\"\n  }, \"Google Firebase Realtime Database\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/aaronpowell/graphql-azure-subscriptions\"\n  }, \"Azure SignalR Service\"))), mdx(\"p\", null, \"If none of these libraries fits your use case, you can also create your own \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSubEngine\"), \" subclass. If you create a new open-source library, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Edit on GitHub\"), \" to let us know about it!\"), mdx(\"h2\", {\n    \"id\": \"switching-from-subscriptions-transport-ws\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#switching-from-subscriptions-transport-ws\",\n    \"aria-label\": \"switching from subscriptions transport ws permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Switching from \", mdx(\"code\", {\n    parentName: \"h2\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"If you use subscriptions with Apollo Client you must ensure \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#choice-of-subscription-protocol\"\n  }, \"both your client and server subscription protocols are consistent\")), \" for the subscription library you are using.\")), mdx(\"p\", null, \"This article previously demonstrated using the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\"), \" library to set up subscriptions. However, this library is no longer actively maintained. You can still use it with Apollo Server, but we strongly recommend using \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.npmjs.com/package/graphql-ws\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\")), \" instead.\"), mdx(\"p\", null, \"If you intend to switch from \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\"), \" to \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\"), \" you will need to update the following clients:\"), mdx(\"table\", null, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Client Name\"), mdx(\"th\", null, \"To use graphql-ws (RECOMMENDED)\"), mdx(\"th\", null, \"To use subscriptions-transport-ws\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/studio/explorer/explorer/\"\n  }, \"Apollo Studio Explorer\"))), mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql-ws\")))), mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\"))))), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions\"\n  }, \"Apollo Client Web\"))), mdx(\"td\", null, mdx(\"p\", null, \"Use \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/api/link/apollo-link-subscriptions/\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"GraphQLWsLink\")), mdx(\"br\", null), \"\\n(Requires v3.5.10 or later)\")), mdx(\"td\", null, mdx(\"p\", null, \"Use \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/api/link/apollo-link-ws/\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"WebSocketLink\"))))), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/ios/subscriptions/\"\n  }, \"Apollo iOS\"))), mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/ios/api/ApolloWebSocket/enums/WebSocket.WSProtocol/#graphql_transport_ws\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql_transport_ws\")), mdx(\"br\", null), \"\\n(Requires v0.51.0 or later)\")), mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/ios/api/ApolloWebSocket/enums/WebSocket.WSProtocol/#graphql_ws\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql_ws\"))))), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/\"\n  }, \"Apollo Kotlin\"))), mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/#customizing-your-websocket-protocol\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"GraphQLWsProtocol\")), mdx(\"br\", null), \"\\n(Requires v3.0.0 or later)\")), mdx(\"td\", null, mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/#customizing-your-websocket-protocol\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"SubscriptionWsProtocol\"))))))), mdx(\"p\", null, \"For more information on using Apollo Server with \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscriptions-transport-ws\"), \", you can view the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/apollo-server/blob/4b82967c10a69aa104848a8c9d15c591b528918c/docs/source/data/subscriptions.mdx\"\n  }, \"previous version of this article here\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport {ExpansionPanel, MultiCodeBlock} from 'gatsby-theme-apollo-docs';\nexport const _frontmatter = {\n  \"title\": \"Subscriptions in Apollo Server\",\n  \"sidebar_title\": \"Subscriptions\",\n  \"description\": \"Persistent GraphQL read operations\"\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <blockquote>\n      <p parentName=\"blockquote\"><strong parentName=\"p\">{`Apollo Server 3 removes built-in support for subscriptions.`}</strong>{` You can reenable support as `}<a parentName=\"p\" {...{\n          \"href\": \"#enabling-subscriptions\"\n        }}>{`described below`}</a>{`.`}</p>\n      <p parentName=\"blockquote\"><strong parentName=\"p\">{`Subscriptions are not currently supported in `}<a parentName=\"strong\" {...{\n            \"href\": \"https://www.apollographql.com/docs/federation/\"\n          }}>{`Apollo Federation`}</a>{`.`}</strong></p>\n      <p parentName=\"blockquote\">{`This article has been updated to use the `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`graphql-ws`}</code>{` library to add support for subscriptions to Apollo Server. We no longer recommend using the previously documented `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`subscriptions-transport-ws`}</code>{`, because this library is not actively maintained. For more information about the differences between the two libraries, see `}<a parentName=\"p\" {...{\n          \"href\": \"#switching-from-subscriptions-transport-ws\"\n        }}>{`Switching from `}<code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`subscriptions-transport-ws`}</code></a>{`.`}</p>\n    </blockquote>\n    <p><strong parentName=\"p\">{`Subscriptions`}</strong>{` are long-lasting GraphQL read operations that can update their result whenever a particular server-side event occurs. Most commonly, updated results are `}<em parentName=\"p\">{`pushed`}</em>{` from the server to subscribing clients. For example, a chat application's server might use a subscription to push newly received messages to all clients in a particular chat room.`}</p>\n    <p>{`Because subscription updates are usually pushed by the server (instead of polled by the client), they usually use `}<a parentName=\"p\" {...{\n        \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\"\n      }}>{`the WebSocket protocol`}</a>{` instead of HTTP.`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\"><strong parentName=\"p\">{`Important:`}</strong>{` Compared to queries and mutations, subscriptions are significantly more complex to implement. Before you begin, `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#when-to-use-subscriptions\"\n        }}>{`confirm that your use case requires subscriptions`}</a>{`.`}</p>\n    </blockquote>\n    <h2 {...{\n      \"id\": \"schema-definition\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#schema-definition\",\n        \"aria-label\": \"schema definition permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Schema definition`}</h2>\n    <p>{`Your schema's `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` type defines top-level fields that clients can subscribe to:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`type`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Subscription`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Post`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`postCreated`}</code>{` field will update its value whenever a new `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Post`}</code>{` is created on the backend, thus pushing the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Post`}</code>{` to subscribing clients.`}</p>\n    <p>{`Clients can subscribe to the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`postCreated`}</code>{` field with a GraphQL string, like this:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`subscription`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token object\"\n          }}>{`PostFeed`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token object\"\n          }}>{`postCreated`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`author`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`comment`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <blockquote>\n      <p parentName=\"blockquote\">{`Each subscription operation can subscribe to only `}<em parentName=\"p\">{`one`}</em>{` field of the `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`Subscription`}</code>{` type.`}</p>\n    </blockquote>\n    <h2 {...{\n      \"id\": \"enabling-subscriptions\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#enabling-subscriptions\",\n        \"aria-label\": \"enabling subscriptions permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Enabling subscriptions`}</h2>\n    <blockquote>\n      <p parentName=\"blockquote\">{`Beginning in Apollo Server 3, subscriptions are `}<strong parentName=\"p\">{`not`}</strong>{` supported by the \"batteries-included\" `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`apollo-server`}</code>{` package. To enable subscriptions, you must first `}<a parentName=\"p\" {...{\n          \"href\": \"/integrations/middleware/#swapping-out-apollo-server\"\n        }}>{`swap to the `}<code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`apollo-server-express`}</code>{` package`}</a>{` (or any other Apollo Server integration package that supports subscriptions).`}</p>\n      <p parentName=\"blockquote\">{`The following steps assume you've already swapped to `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`apollo-server-express`}</code>{`.`}</p>\n    </blockquote>\n    <p>{`To run both an Express app `}<em parentName=\"p\">{`and`}</em>{` a separate WebSocket server for subscriptions, we'll create an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`http.Server`}</code>{` instance that effectively wraps the two and becomes our new `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`listen`}</code>{`er.`}</p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Install `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`graphql-ws`}</code>{`, `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`ws`}</code>{`, `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`@graphql-tools/schema`}</code>{`, and 'apollo-server-core':`}</p>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"bash\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-bash line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-bash\"\n            }}><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`npm`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`install`}</span>{` graphql-ws ws @graphql-tools/schema apollo-server-core`}</code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span></span></pre></div>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Add the following imports to the file where you initialize your `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`ApolloServer`}</code>{` instance (we'll use these in later steps):`}</p>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.ts`}</div>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"ts\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-ts line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-ts\"\n            }}><span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` createServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'http'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` ApolloServerPluginDrainHttpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`\"apollo-server-core\"`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` makeExecutableSchema `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'@graphql-tools/schema'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` WebSocketServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'ws'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` useServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'graphql-ws/lib/use/ws'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Next, in order to set up both the HTTP and subscription servers, we need to first create an `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`http.Server`}</code>{`. Do this by passing your Express `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`app`}</code>{` to the `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`createServer`}</code>{` function, which we imported from the `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`http`}</code>{` module:`}</p>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.ts`}</div>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"ts\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-ts line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-ts\"\n            }}><span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// This \\`app\\` is the returned value from \\`express()\\`.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` httpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`createServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span>{`app`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Create an instance of `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`GraphQLSchema`}</code>{` (if you haven't already).`}</p>\n        <blockquote parentName=\"li\">\n          <p parentName=\"blockquote\">{`If you already pass the `}<code parentName=\"p\" {...{\n              \"className\": \"language-text\"\n            }}>{`schema`}</code>{` option to the `}<code parentName=\"p\" {...{\n              \"className\": \"language-text\"\n            }}>{`ApolloServer`}</code>{` constructor (instead of `}<code parentName=\"p\" {...{\n              \"className\": \"language-text\"\n            }}>{`typeDefs`}</code>{` and `}<code parentName=\"p\" {...{\n              \"className\": \"language-text\"\n            }}>{`resolvers`}</code>{`), you can skip this step.`}</p>\n        </blockquote>\n        <p parentName=\"li\">{`The subscription server (which we'll instantiate next) doesn't take `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`typeDefs`}</code>{` and `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`resolvers`}</code>{` options. Instead, it takes an executable `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`GraphQLSchema`}</code>{`. We can pass this `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`schema`}</code>{` object to both the subscription server and `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`ApolloServer`}</code>{`. This way, we make sure that the same schema is being used in both places.`}</p>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.ts`}</div>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"ts\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-ts line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-ts\"\n            }}><span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` schema `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`makeExecutableSchema`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` typeDefs`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` resolvers `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// ...`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  schema`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Create a `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`WebSocketServer`}</code>{` to use as your subscription server.`}</p>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.ts`}</div>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"ts\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-ts line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-ts\"\n            }}>{`  `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Creating the WebSocket server`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` wsServer `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`WebSocketServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// This is the \\`httpServer\\` we created in a previous step.`}</span>{`\n    server`}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` httpServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Pass a different path here if your ApolloServer serves at`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// a different path.`}</span>{`\n    path`}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'/graphql'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Hand in the schema we just created and have the`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// WebSocketServer start listening.`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` serverCleanup `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`useServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` schema `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` wsServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Add `}<a parentName=\"p\" {...{\n            \"href\": \"/integrations/plugins/\"\n          }}>{`plugins`}</a>{` to your `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`ApolloServer`}</code>{` constructor to shutdown both the HTTP server and the `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`WebSocketServer`}</code>{`:`}</p>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.ts`}</div>\n        <div parentName=\"li\" {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"ts\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-ts line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-ts\"\n            }}>{`  `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n    schema`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n    plugins`}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`[`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Proper shutdown for the HTTP server.`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`ApolloServerPluginDrainHttpServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` httpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Proper shutdown for the WebSocket server.`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n        `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`serverWillStart`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n          `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n            `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`drainServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n              `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`await`}</span>{` serverCleanup`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`dispose`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n            `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n          `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n        `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`]`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Finally, ensure you are `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`listen`}</code>{`ing to your `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`httpServer`}</code>{`.`}</p>\n        <p parentName=\"li\">{`Most Express applications call `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`app.listen(...)`}</code>{`, but for your setup  change this to `}<code parentName=\"p\" {...{\n            \"className\": \"language-text\"\n          }}>{`httpServer.listen(...)`}</code>{` using the same arguments. This way, the server starts listening on the HTTP and WebSocket transports simultaneously.`}</p>\n      </li>\n    </ol>\n    <p>{`A completed example of setting up subscriptions is shown below:`}</p>\n    <ExpansionPanel title=\"Click to expand\" mdxType=\"ExpansionPanel\">\n      <MultiCodeBlock mdxType=\"MultiCodeBlock\">\n        <div {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.ts`}</div>\n        <div {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"ts\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-ts line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-ts\"\n            }}><span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` ApolloServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'apollo-server-express'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` createServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'http'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` express `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'express'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` ApolloServerPluginDrainHttpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`\"apollo-server-core\"`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` makeExecutableSchema `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'@graphql-tools/schema'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` WebSocketServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'ws'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` useServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'graphql-ws/lib/use/ws'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` resolvers `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'./resolvers'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` typeDefs `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'./typeDefs'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Create the schema, which will be used separately by ApolloServer and`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// the WebSocket server.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` schema `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`makeExecutableSchema`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` typeDefs`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` resolvers `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Create an Express app and HTTP server; we will attach both the WebSocket`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// server and the ApolloServer to this HTTP server.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` app `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`express`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` httpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`createServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span>{`app`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Create our WebSocket server using the HTTP server we just set up.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` wsServer `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`WebSocketServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  server`}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` httpServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  path`}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'/graphql'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Save the returned server's info so we can shutdown this server later`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` serverCleanup `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`useServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` schema `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` wsServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Set up ApolloServer.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  schema`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  plugins`}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`[`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Proper shutdown for the HTTP server.`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`ApolloServerPluginDrainHttpServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` httpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Proper shutdown for the WebSocket server.`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`serverWillStart`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n        `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n          `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`drainServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n            `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`await`}</span>{` serverCleanup`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`dispose`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n          `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n        `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`]`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`await`}</span>{` server`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`start`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\nserver`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`applyMiddleware`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` app `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token constant\"\n              }}>{`PORT`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token number\"\n              }}>{`4000`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Now that our HTTP server is fully set up, we can listen to it.`}</span>{`\nhttpServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`listen`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token constant\"\n              }}>{`PORT`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token builtin\"\n              }}>{`console`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`log`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token template-string\"\n              }}><span parentName=\"span\" {...{\n                  \"className\": \"token template-punctuation string\"\n                }}>{`\\``}</span><span parentName=\"span\" {...{\n                  \"className\": \"token string\"\n                }}>{`Server is now running on http://localhost:`}</span><span parentName=\"span\" {...{\n                  \"className\": \"token interpolation\"\n                }}><span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`\\${`}</span><span parentName=\"span\" {...{\n                    \"className\": \"token constant\"\n                  }}>{`PORT`}</span><span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`}`}</span></span><span parentName=\"span\" {...{\n                  \"className\": \"token interpolation\"\n                }}><span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`\\${`}</span>{`server`}<span parentName=\"span\" {...{\n                    \"className\": \"token punctuation\"\n                  }}>{`.`}</span>{`graphqlPath`}<span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`}`}</span></span><span parentName=\"span\" {...{\n                  \"className\": \"token template-punctuation string\"\n                }}>{`\\``}</span></span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n        <div {...{\n          \"className\": \"gatsby-code-title\"\n        }}>{`index.js`}</div>\n        <div {...{\n          \"className\": \"gatsby-highlight\",\n          \"data-language\": \"js\"\n        }}><pre parentName=\"div\" {...{\n            \"style\": {\n              \"counterReset\": \"linenumber NaN\"\n            },\n            \"className\": \"language-js line-numbers\"\n          }}><code parentName=\"pre\" {...{\n              \"className\": \"language-js\"\n            }}><span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` ApolloServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'apollo-server-express'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` createServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'http'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` express `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'express'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` ApolloServerPluginDrainHttpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'apollo-server-core'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` makeExecutableSchema `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'@graphql-tools/schema'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` WebSocketServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'ws'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` useServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'graphql-ws/lib/use/ws'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` resolvers `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'./resolvers'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`import`}</span>{` typeDefs `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'./typeDefs'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Create the schema, which will be used separately by ApolloServer and`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// the WebSocket server.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` schema `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`makeExecutableSchema`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` typeDefs`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` resolvers `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Create an Express app and HTTP server; we will attach both the WebSocket`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// server and the ApolloServer to this HTTP server.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` app `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`express`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` httpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`createServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span>{`app`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Create our WebSocket server using the HTTP server we just set up.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` wsServer `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`WebSocketServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token literal-property property\"\n              }}>{`server`}</span><span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` httpServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token literal-property property\"\n              }}>{`path`}</span><span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token string\"\n              }}>{`'/graphql'`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Save the returned server's info so we can shutdown this server later`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` serverCleanup `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`useServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` schema `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` wsServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Set up ApolloServer.`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token class-name\"\n              }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  schema`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token literal-property property\"\n              }}>{`plugins`}</span><span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`[`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Proper shutdown for the HTTP server.`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`ApolloServerPluginDrainHttpServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` httpServer `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Proper shutdown for the WebSocket server.`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`serverWillStart`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n        `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n          `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`drainServer`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n            `}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`await`}</span>{` serverCleanup`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`dispose`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n          `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n        `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n      `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`]`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`await`}</span>{` server`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`start`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\nserver`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`applyMiddleware`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{` app `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n                \"className\": \"token keyword\"\n              }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token constant\"\n              }}>{`PORT`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token number\"\n              }}>{`4000`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token comment\"\n              }}>{`// Now that our HTTP server is fully set up, we can listen to it.`}</span>{`\nhttpServer`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`listen`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token constant\"\n              }}>{`PORT`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token operator\"\n              }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`{`}</span>{`\n  console`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span><span parentName=\"code\" {...{\n                \"className\": \"token function\"\n              }}>{`log`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`(`}</span>{`\n    `}<span parentName=\"code\" {...{\n                \"className\": \"token template-string\"\n              }}><span parentName=\"span\" {...{\n                  \"className\": \"token template-punctuation string\"\n                }}>{`\\``}</span><span parentName=\"span\" {...{\n                  \"className\": \"token string\"\n                }}>{`Server is now running on http://localhost:`}</span><span parentName=\"span\" {...{\n                  \"className\": \"token interpolation\"\n                }}><span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`\\${`}</span><span parentName=\"span\" {...{\n                    \"className\": \"token constant\"\n                  }}>{`PORT`}</span><span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`}`}</span></span><span parentName=\"span\" {...{\n                  \"className\": \"token interpolation\"\n                }}><span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`\\${`}</span>{`server`}<span parentName=\"span\" {...{\n                    \"className\": \"token punctuation\"\n                  }}>{`.`}</span>{`graphqlPath`}<span parentName=\"span\" {...{\n                    \"className\": \"token interpolation-punctuation punctuation\"\n                  }}>{`}`}</span></span><span parentName=\"span\" {...{\n                  \"className\": \"token template-punctuation string\"\n                }}>{`\\``}</span></span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`}`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`)`}</span><span parentName=\"code\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`;`}</span></code><span parentName=\"pre\" {...{\n              \"aria-hidden\": \"true\",\n              \"className\": \"line-numbers-rows\",\n              \"style\": {\n                \"whiteSpace\": \"normal\",\n                \"width\": \"auto\",\n                \"left\": \"0\"\n              }\n            }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n      </MultiCodeBlock>\n    </ExpansionPanel>\n    <h2 {...{\n      \"id\": \"resolving-a-subscription\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#resolving-a-subscription\",\n        \"aria-label\": \"resolving a subscription permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Resolving a subscription`}</h2>\n    <p>{`Resolvers for `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` fields differ from resolvers for fields of other types. Specifically, `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field resolvers are `}<strong parentName=\"p\">{`objects`}</strong>{` that define a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function:`}</p>\n    <div {...{\n      \"className\": \"gatsby-code-title\"\n    }}>{`index.ts`}</div>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"ts\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-ts line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  Subscription`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    postCreated`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// More on pubsub below`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`subscribe`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`asyncIterator`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`[`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`]`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function `}<strong parentName=\"p\">{`must`}</strong>{` return an object of type `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{`, a standard interface for iterating over asynchronous results. In the example above, an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` is generated by `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`pubsub.asyncIterator`}</code>{` (more on this below).`}</p>\n    <h3 {...{\n      \"id\": \"the-pubsub-class\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#the-pubsub-class\",\n        \"aria-label\": \"the pubsub class permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`The `}<code parentName=\"h3\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` class`}</h3>\n    <blockquote>\n      <p parentName=\"blockquote\">{`The `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`PubSub`}</code>{` class is `}<strong parentName=\"p\">{`not`}</strong>{` recommended for production environments, because it's an in-memory event system that only supports a single server instance. After you get subscriptions working in development, we strongly recommend switching it out for a different subclass of the abstract `}<a parentName=\"p\" {...{\n          \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n        }}><code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`PubSubEngine`}</code>{` class`}</a>{`. Recommended subclasses are listed in `}<a parentName=\"p\" {...{\n          \"href\": \"#production-pubsub-libraries\"\n        }}>{`Production `}<code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`PubSub`}</code>{` libraries`}</a>{`.`}</p>\n    </blockquote>\n    <p>{`Apollo Server uses a `}<strong parentName=\"p\">{`publish-subscribe`}</strong>{` (`}<strong parentName=\"p\">{`pub/sub`}</strong>{`) model to track events that update active subscriptions. The `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/graphql-subscriptions\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`graphql-subscriptions`}</code>{` library`}</a>{` provides the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` class as a basic in-memory event bus to help you get started:`}</p>\n    <p>{`To use the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`graphql-subscriptions`}</code>{` package, first install it like so:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"shell\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-shell line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-shell\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`npm`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`install`}</span>{` graphql-subscriptions`}</code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span></span></pre></div>\n    <p>{`A `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` instance enables your server code to both `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` events to a particular label and listen for events associated with a particular label. We can create a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` instance like so:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` PubSub `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'graphql-subscriptions'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` pubsub `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`PubSub`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <h3 {...{\n      \"id\": \"publishing-an-event\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#publishing-an-event\",\n        \"aria-label\": \"publishing an event permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Publishing an event`}</h3>\n    <p>{`You can publish an event using the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` method of a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` instance:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}>{`pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`publish`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`author`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Ali Baba'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`comment`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Open sesame'`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <ul>\n      <li parentName=\"ul\">{`The first parameter is the name of the event label you're publishing to, as a string.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><em parentName=\"li\">{`You don't need to register a label name before publishing to it.`}</em></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`The second parameter is the payload associated with the event.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><em parentName=\"li\">{`The payload should include whatever data is necessary for your resolvers to populate the associated `}<code parentName=\"em\" {...{\n                \"className\": \"language-text\"\n              }}>{`Subscription`}</code>{` field and its subfields.`}</em></li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`When working with GraphQL subscriptions, you `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` an event whenever a subscription's return value should be updated. One common cause of such an update is a mutation, but `}<em parentName=\"p\">{`any`}</em>{` back-end logic might result in changes that should be `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{`ed.`}</p>\n    <p>{`As an example, let's say our GraphQL API supports a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`createPost`}</code>{` mutation:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`type`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Mutation`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`createPost`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`author`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token scalar\"\n          }}>{`String`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`comment`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token scalar\"\n          }}>{`String`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Post`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`A basic resolver for `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`createPost`}</code>{` might look like this:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight has-highlighted-lines\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Mutation`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`createPost`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token parameter\"\n            }}>{`parent`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` args`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` context`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      `}<span parentName=\"span\" {...{\n              \"className\": \"token comment\"\n            }}>{`// Datastore logic lives in postController`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      `}<span parentName=\"span\" {...{\n              \"className\": \"token keyword\"\n            }}>{`return`}</span>{` postController`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`createPost`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`args`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span></span>{`  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Before we persist the new post's details in our datastore, we can `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` an event that `}<em parentName=\"p\">{`also`}</em>{` includes those details:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Mutation`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`createPost`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`parent`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` args`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      pubsub`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`publish`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{`'POST_CREATED'`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token literal-property property\"\n            }}>{`postCreated`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` args `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span>{`      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` postController`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`createPost`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Next, we can listen for this event in our `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field's resolver.`}</p>\n    <h3 {...{\n      \"id\": \"listening-for-events\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#listening-for-events\",\n        \"aria-label\": \"listening for events permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Listening for events`}</h3>\n    <p>{`An `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-async-iterator.ts\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`AsyncIterator`}</code></a>{` object listens for events that are associated with a particular label (or set of labels) and adds them to a queue for processing.`}</p>\n    <p>{`You can create an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` by calling the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`asyncIterator`}</code>{` method of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` and passing in an array containing the names of the event labels that this `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` should listen for.`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}>{`pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`asyncIterator`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`[`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`]`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Every `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field resolver's `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function must return an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` object.`}</p>\n    <p>{`This brings us back to the code sample at the top of `}<a parentName=\"p\" {...{\n        \"href\": \"#resolving-a-subscription\"\n      }}>{`Resolving a subscription`}</a>{`:`}</p>\n    <div {...{\n      \"className\": \"gatsby-code-title\"\n    }}>{`index.js`}</div>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`subscribe`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`asyncIterator`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`[`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`]`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`With this `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function set, Apollo Server uses the payloads of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`POST_CREATED`}</code>{` events to push updated values for the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`postCreated`}</code>{` field.`}</p>\n    <h3 {...{\n      \"id\": \"filtering-events\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#filtering-events\",\n        \"aria-label\": \"filtering events permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Filtering events`}</h3>\n    <p>{`Sometimes, a client should only receive updated subscription data if that data meets certain criteria. To support this, you can call the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` helper function in your `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field's resolver.`}</p>\n    <h4 {...{\n      \"id\": \"example\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h4\" {...{\n        \"href\": \"#example\",\n        \"aria-label\": \"example permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Example`}</h4>\n    <p>{`Let's say our server provides a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`commentAdded`}</code>{` subscription, which should notify clients whenever a comment is added to a specified code repository. A client can execute a subscription that looks like this:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token variable\"\n          }}>{`$repoName`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token scalar\"\n          }}>{`String`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`!`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token property-query\"\n          }}>{`commentAdded`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`repoFullName`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token variable\"\n          }}>{`$repoName`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`id`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`content`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`This presents a potential issue: our server probably `}<a parentName=\"p\" {...{\n        \"href\": \"#publishing-an-event\"\n      }}>{`publishes`}</a>{` a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`COMMENT_ADDED`}</code>{` event whenever a comment is added to `}<em parentName=\"p\">{`any`}</em>{` repository. This means that the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`commentAdded`}</code>{` resolver executes for `}<em parentName=\"p\">{`every`}</em>{` new comment, regardless of which repository it's added to. As a result, subscribing clients might receive data they don't want (or shouldn't even have access to).`}</p>\n    <p>{`To fix this, we can use the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` helper function to control updates on a per-client basis.`}</p>\n    <p>{`Here's an example resolver for `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`commentAdded`}</code>{` that uses the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` function:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight has-highlighted-lines\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` withFilter `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'graphql-subscriptions'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token literal-property property\"\n            }}>{`commentAdded`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      `}<span parentName=\"span\" {...{\n              \"className\": \"token literal-property property\"\n            }}>{`subscribe`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`withFilter`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`        `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`=>`}</span>{` pubsub`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`asyncIterator`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{`'COMMENT_ADDED'`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`        `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token parameter\"\n            }}>{`payload`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` variables`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`=>`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`          `}<span parentName=\"span\" {...{\n              \"className\": \"token comment\"\n            }}>{`// Only push an update if the comment is on`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`          `}<span parentName=\"span\" {...{\n              \"className\": \"token comment\"\n            }}>{`// the correct repository for this operation`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`          `}<span parentName=\"span\" {...{\n              \"className\": \"token keyword\"\n            }}>{`return`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`payload`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span>{`commentAdded`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span>{`repository_name `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`===`}</span>{` variables`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span>{`repoFullName`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`        `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span></span>{`      `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` function takes two parameters:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The first parameter is exactly the function you would use for `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`subscribe`}</code>{` if you `}<em parentName=\"li\">{`weren't`}</em>{` applying a filter.`}</li>\n      <li parentName=\"ul\">{`The second parameter is a `}<strong parentName=\"li\">{`filter function`}</strong>{` that returns `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`true`}</code>{` if a subscription update `}<em parentName=\"li\">{`should`}</em>{` be sent to a particular client, and `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`false`}</code>{` otherwise (`}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`Promise<boolean>`}</code>{` is also allowed). This function takes two parameters of its own:`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`payload`}</code>{` is the payload of the event that was published.`}</li>\n          <li parentName=\"ul\"><code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`variables`}</code>{` is an object containing all arguments the client provided when initiating their subscription.`}</li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`Use `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` to make sure clients get exactly the subscription updates they want (and are allowed to receive).`}</p>\n    <h2 {...{\n      \"id\": \"basic-runnable-example\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#basic-runnable-example\",\n        \"aria-label\": \"basic runnable example permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Basic runnable example`}</h2>\n    <p>{`An example server is available on `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/docs-examples/blob/main/apollo-server/v3/subscriptions-graphql-ws/src/index.ts\"\n      }}>{`GitHub`}</a>{` and CodeSandbox:`}</p>\n    <a href=\"https://codesandbox.io/s/github/apollographql/docs-examples/tree/main/apollo-server/v3/subscriptions-graphql-ws?fontsize=14&hidenavigation=1&initialpath=%2Fgraphql&theme=dark\">\n  <img alt=\"Edit server-subscriptions-as3\" src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" />\n    </a>\n    <p>{`The server exposes one subscription (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`numberIncremented`}</code>{`) that returns an integer that's incremented on the server every second. Here's an example subscription that you can run against your server:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`subscription`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token object\"\n          }}>{`IncrementingNumber`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`numberIncremented`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <blockquote>\n      <p parentName=\"blockquote\">{`If you don't see the result of your subscription operation you might need to `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support\"\n        }}>{`adjust your Sandbox settings to use the `}<code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`graphql-ws`}</code>{` protocol`}</a>{`.`}</p>\n    </blockquote>\n    <p>{`After you start up the server in CodeSandbox, follow the instructions in the browser to test running the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`numberIncremented`}</code>{` subscription in Apollo Sandbox. You should see the subscription's value update every second.`}</p>\n    <h2 {...{\n      \"id\": \"operation-context\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#operation-context\",\n        \"aria-label\": \"operation context permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Operation context`}</h2>\n    <p>{`When `}<a parentName=\"p\" {...{\n        \"href\": \"/data/resolvers/#the-context-argument\"\n      }}>{`initializing context`}</a>{` for a query or mutation, you usually extract HTTP headers and other request metadata from the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`req`}</code>{` object provided to the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{` function.`}</p>\n    <p><strong parentName=\"p\">{`For subscriptions,`}</strong>{` you can extract information from a client's request by adding `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.ServerOptions.md\"\n      }}>{`options`}</a>{` to the first argument passed to the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`useServer`}</code>{` function.`}</p>\n    <p>{`For example, you can provide a `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.ServerOptions.md#context\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`context`}</code>{` property`}</a>{` to add values to your GraphQL operation `}<a parentName=\"p\" {...{\n        \"href\": \"/data/resolvers/#the-context-argument\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`context`}</code></a>{`:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"ts\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-ts line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`useServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Our GraphQL schema.`}</span>{`\n    schema`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Adding a context property lets you add data to your GraphQL operation context`}</span>{`\n     `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` msg`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n       `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// You can define your own function for setting a dynamic context`}</span>{`\n       `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// or provide a static value`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`getDynamicContext`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` msg`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  wsServer`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Notice that the first parameter passed to the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{` function above is `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`ctx`}</code>{`. The `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/enisdenjo/graphql-ws/blob/master/docs/interfaces/server.Context.md\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`ctx object`}</code></a>{` represents the context of your `}<em parentName=\"p\">{`subscription server`}</em>{`, not the `}<em parentName=\"p\">{`GraphQL operation context`}</em>{` that's passed to your resolvers.`}</p>\n    <p>{`You can access the parameters of a client's `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscription`}</code>{` request to your WebSocket server via the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`ctx.connectionParams`}</code>{` property.`}</p>\n    <p>{`Below is an example of the common use case of extracting an authentication token from a client `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscription`}</code>{` request and using it to find the current user:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"ts\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-ts line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`getDynamicContext`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` msg`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ctx is the graphql-ws Context where connectionParams live`}</span>{`\n `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`if`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authentication`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` currentUser `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`findUser`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authentication`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` currentUser `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Otherwise let our resolvers know we don't have a current user`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` currentUser`}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`null`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`useServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    schema`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Adding a context property lets you add data to your GraphQL operation context`}</span>{`\n     `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` msg`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n       `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Returning an object will add that information to our`}</span>{`\n       `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// GraphQL context, which all of our resolvers have access to.`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`getDynamicContext`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` msg`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  wsServer`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Putting it all together, if the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`useServer.context`}</code>{` function returns an `}<em parentName=\"p\">{`object`}</em>{`, that object is passed to the GraphQL operation `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{`, which is available to your resolvers.`}</p>\n    <p>{`Note that the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{` option is called once per `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscription`}</code>{` request, not once per event emission. This means that in the above example, every time a client sends a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscription`}</code>{` operation, we check their authentication token.`}</p>\n    <h3 {...{\n      \"id\": \"onconnect-and-ondisconnect\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#onconnect-and-ondisconnect\",\n        \"aria-label\": \"onconnect and ondisconnect permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><code parentName=\"h3\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` and `}<code parentName=\"h3\" {...{\n        \"className\": \"language-text\"\n      }}>{`onDisconnect`}</code></h3>\n    <p>{`You can configure the subscription server's behavior whenever a client connects (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{`) or disconnects (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onDisconnect`}</code>{`).`}</p>\n    <p>{`Defining an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` function enables you to reject a particular incoming connection by returning `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`false`}</code>{` or by throwing an exception. This can be helpful if you want to check authentication when a client first connects to your subscription server.`}</p>\n    <p>{`You provide these functions as options to the first argument of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`useServer`}</code>{`, like so:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight has-highlighted-lines\",\n      \"data-language\": \"ts\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-ts line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-ts\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`useServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    schema`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// As before, ctx is the graphql-ws Context where connectionParams live.`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token function-variable function\"\n            }}>{`onConnect`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token keyword\"\n            }}>{`async`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`ctx`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`=>`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span>{`      `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Check authentication every time a client connects.`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`if`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`tokenIsNotValid`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n        `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// You can return false to close the connection  or throw an explicit error`}</span>{`\n        `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`throw`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Error`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Auth token missing!'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`onDisconnect`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`ctx`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` code`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` reason`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span>{`      `}<span parentName=\"code\" {...{\n            \"className\": \"token builtin\"\n          }}>{`console`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Disconnected!'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  wsServer`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`For more information and examples of using `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` and `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onDisconnect`}</code>{`, see the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/enisdenjo/graphql-ws#ws-auth-handling\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`graphql-ws`}</code>{` documentation`}</a>{`.`}</p>\n    <h3 {...{\n      \"id\": \"example-authentication-with-apollo-client\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#example-authentication-with-apollo-client\",\n        \"aria-label\": \"example authentication with apollo client permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Example: Authentication with Apollo Client`}</h3>\n    <blockquote>\n      <p parentName=\"blockquote\">{`If you plan to use subscriptions with Apollo Client, ensure `}<strong parentName=\"p\"><a parentName=\"strong\" {...{\n            \"href\": \"#switching-from-subscriptions-transport-ws\"\n          }}>{`both your client and server subscription protocols are consistent`}</a></strong>{` for the subscription library you are using (this example uses the `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`graphql-ws`}</code>{` library).`}</p>\n    </blockquote>\n    <p>{`In Apollo Client, the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`GraphQLWsLink`}</code>{` constructor supports adding information to `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connectionParams`}</code>{` (`}<a parentName=\"p\" {...{\n        \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#5-authenticate-over-websocket-optional\"\n      }}>{`example`}</a>{`). Those `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connectionParams`}</code>{` are sent to your server when it connects, allowing you to extract information from the client request by accessing `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Context.connectionParams`}</code>{`.`}</p>\n    <p>{`Let's suppose we create our subscription client like so:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` GraphQLWsLink `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'@apollo/client/link/subscriptions'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`import`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` createClient `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`from`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'graphql-ws'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` wsLink `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`GraphQLWsLink`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`createClient`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`url`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'ws://localhost:4000/subscriptions'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`connectionParams`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`authorization`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` user`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authToken`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connectionParams`}</code>{` argument (which contains the information provided by the client) is passed to your server, enabling you to validate the user's credentials.`}</p>\n    <p>{`From there you can use the `}<a parentName=\"p\" {...{\n        \"href\": \"#operation-context\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`useServer.context`}</code>{` property`}</a>{` to authenticate the user, returning an object that's passed into your resolvers as the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{` argument during execution.`}</p>\n    <p>{`For our example, we can use the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connectionParams.authentication`}</code>{` value provided by the client to look up the related user before passing that user along to our resolvers:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`findUser`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`authToken`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Find a user by their auth token`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`getDynamicContext`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`ctx`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` msg`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` args`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`if`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authentication`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` currentUser `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`findUser`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authentication`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` currentUser `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Let the resolvers know we don't have a current user so they can`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// throw the appropriate error`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`currentUser`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`null`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`useServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Our GraphQL schema.`}</span>{`\n    schema`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n     `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`ctx`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` msg`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` args`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n       `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// This will be run every time the client sends a subscription request`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`getDynamicContext`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`ctx`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` msg`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  wsServer`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`To sum up, the example above looks up a user based on the authentication token sent with each subscription request before returning the user object to be used by our resolvers. If no user exists or the lookup otherwise fails, our resolvers can throw an error and the corresponding `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscription`}</code>{` operation is not executed.`}</p>\n    <h2 {...{\n      \"id\": \"production-pubsub-libraries\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#production-pubsub-libraries\",\n        \"aria-label\": \"production pubsub libraries permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Production `}<code parentName=\"h2\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` libraries`}</h2>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"#the-pubsub-class\"\n      }}>{`As mentioned above`}</a>{`, the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` class is `}<em parentName=\"p\">{`not`}</em>{` recommended for production environments, because its event-publishing system is in-memory. This means that events published by `}<em parentName=\"p\">{`one`}</em>{` instance of your GraphQL server are not received by subscriptions that are handled by `}<em parentName=\"p\">{`other`}</em>{` instances.`}</p>\n    <p>{`Instead, you should use a subclass of the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`PubSubEngine`}</code>{` abstract class`}</a>{` that you can back with an external datastore such as Redis or Kafka.`}</p>\n    <p>{`The following are community-created `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` libraries for popular event-publishing systems:`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/davidyaha/graphql-redis-subscriptions\"\n        }}>{`Redis`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/axelspringer/graphql-google-pubsub\"\n        }}>{`Google PubSub`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/davidyaha/graphql-mqtt-subscriptions\"\n        }}>{`MQTT enabled broker`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/cdmbase/graphql-rabbitmq-subscriptions\"\n        }}>{`RabbitMQ`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/ancashoria/graphql-kafka-subscriptions\"\n        }}>{`Kafka`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/GraphQLCollege/graphql-postgres-subscriptions\"\n        }}>{`Postgres`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/MrBoolean/graphql-firestore-subscriptions\"\n        }}>{`Google Cloud Firestore`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/ably-labs/graphql-ably-pubsub\"\n        }}>{`Ably Realtime`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/swantzter/graphql-firebase-subscriptions\"\n        }}>{`Google Firebase Realtime Database`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/aaronpowell/graphql-azure-subscriptions\"\n        }}>{`Azure SignalR Service`}</a></li>\n    </ul>\n    <p>{`If none of these libraries fits your use case, you can also create your own `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSubEngine`}</code>{` subclass. If you create a new open-source library, click `}<strong parentName=\"p\">{`Edit on GitHub`}</strong>{` to let us know about it!`}</p>\n    <h2 {...{\n      \"id\": \"switching-from-subscriptions-transport-ws\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#switching-from-subscriptions-transport-ws\",\n        \"aria-label\": \"switching from subscriptions transport ws permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Switching from `}<code parentName=\"h2\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscriptions-transport-ws`}</code></h2>\n    <blockquote>\n      <p parentName=\"blockquote\">{`If you use subscriptions with Apollo Client you must ensure `}<strong parentName=\"p\"><a parentName=\"strong\" {...{\n            \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#choice-of-subscription-protocol\"\n          }}>{`both your client and server subscription protocols are consistent`}</a></strong>{` for the subscription library you are using.`}</p>\n    </blockquote>\n    <p>{`This article previously demonstrated using the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscriptions-transport-ws`}</code>{` library to set up subscriptions. However, this library is no longer actively maintained. You can still use it with Apollo Server, but we strongly recommend using `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.npmjs.com/package/graphql-ws\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`graphql-ws`}</code></a>{` instead.`}</p>\n    <p>{`If you intend to switch from `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscriptions-transport-ws`}</code>{` to `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`graphql-ws`}</code>{` you will need to update the following clients:`}</p>\n    <table>\n  <thead>\n    <tr>\n      <th>Client Name</th>\n      <th>To use graphql-ws (RECOMMENDED)</th>\n      <th>To use subscriptions-transport-ws</th>\n    </tr>\n  </thead>\n      <tbody>\n        <tr>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/studio/explorer/explorer/\"\n              }}>{`Apollo Studio Explorer`}</a></p>\n          </td>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`graphql-ws`}</code></a></p>\n          </td>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/studio/explorer/additional-features/#subscription-support\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`subscriptions-transport-ws`}</code></a></p>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions\"\n              }}>{`Apollo Client Web`}</a></p>\n          </td>\n          <td>\n            <p>{`Use `}<a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/react/api/link/apollo-link-subscriptions/\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`GraphQLWsLink`}</code></a><br />{`\n(Requires v3.5.10 or later)`}</p>\n          </td>\n          <td>\n            <p>{`Use `}<a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/react/api/link/apollo-link-ws/\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`WebSocketLink`}</code></a></p>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/ios/subscriptions/\"\n              }}>{`Apollo iOS`}</a></p>\n          </td>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/ios/api/ApolloWebSocket/enums/WebSocket.WSProtocol/#graphql_transport_ws\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`graphql_transport_ws`}</code></a><br />{`\n(Requires v0.51.0 or later)`}</p>\n          </td>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/ios/api/ApolloWebSocket/enums/WebSocket.WSProtocol/#graphql_ws\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`graphql_ws`}</code></a></p>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/\"\n              }}>{`Apollo Kotlin`}</a></p>\n          </td>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/#customizing-your-websocket-protocol\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`GraphQLWsProtocol`}</code></a><br />{`\n(Requires v3.0.0 or later)`}</p>\n          </td>\n          <td>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/kotlin/essentials/subscriptions/#customizing-your-websocket-protocol\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`SubscriptionWsProtocol`}</code></a></p>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <p>{`For more information on using Apollo Server with `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscriptions-transport-ws`}</code>{`, you can view the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/apollo-server/blob/4b82967c10a69aa104848a8c9d15c591b528918c/docs/source/data/subscriptions.mdx\"\n      }}>{`previous version of this article here`}</a>{`.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}