{"expireTime":9007200901521023000,"key":"gatsby-plugin-mdx-entire-payload-f9ebae9c3828456d2a2c843761e85b91-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import {ExpansionPanel} from 'gatsby-theme-apollo-docs';","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":57,"offset":57},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Subscriptions are not currently supported in ","position":{"start":{"line":4,"column":5,"offset":63},"end":{"line":4,"column":50,"offset":108},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/federation/","children":[{"type":"text","value":"Apollo Federation","position":{"start":{"line":4,"column":51,"offset":109},"end":{"line":4,"column":68,"offset":126},"indent":[]}}],"position":{"start":{"line":4,"column":50,"offset":108},"end":{"line":4,"column":117,"offset":175},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":4,"column":117,"offset":175},"end":{"line":4,"column":118,"offset":176},"indent":[]}}],"position":{"start":{"line":4,"column":3,"offset":61},"end":{"line":4,"column":120,"offset":178},"indent":[]}}],"position":{"start":{"line":4,"column":3,"offset":61},"end":{"line":4,"column":120,"offset":178},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":59},"end":{"line":4,"column":120,"offset":178},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Subscriptions","position":{"start":{"line":6,"column":3,"offset":182},"end":{"line":6,"column":16,"offset":195},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":180},"end":{"line":6,"column":18,"offset":197},"indent":[]}},{"type":"text","value":" are long-lasting GraphQL read operations that can update their result whenever a particular server-side event occurs. Most commonly, updated results are ","position":{"start":{"line":6,"column":18,"offset":197},"end":{"line":6,"column":172,"offset":351},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"pushed","position":{"start":{"line":6,"column":173,"offset":352},"end":{"line":6,"column":179,"offset":358},"indent":[]}}],"position":{"start":{"line":6,"column":172,"offset":351},"end":{"line":6,"column":180,"offset":359},"indent":[]}},{"type":"text","value":" from the server to subscribing clients. For example, a chat application's server might use a subscription to push newly received messages to all clients in a particular chat room.","position":{"start":{"line":6,"column":180,"offset":359},"end":{"line":6,"column":360,"offset":539},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":180},"end":{"line":6,"column":360,"offset":539},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Because subscription updates are usually pushed by the server (instead of polled by the client), they usually use ","position":{"start":{"line":8,"column":1,"offset":541},"end":{"line":8,"column":115,"offset":655},"indent":[]}},{"type":"link","title":null,"url":"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API","children":[{"type":"text","value":"the WebSocket protocol","position":{"start":{"line":8,"column":116,"offset":656},"end":{"line":8,"column":138,"offset":678},"indent":[]}}],"position":{"start":{"line":8,"column":115,"offset":655},"end":{"line":8,"column":204,"offset":744},"indent":[]}},{"type":"text","value":" instead of HTTP. To support this, Apollo Server lets you ","position":{"start":{"line":8,"column":204,"offset":744},"end":{"line":8,"column":262,"offset":802},"indent":[]}},{"type":"link","title":null,"url":"#setting-a-subscription-endpoint","children":[{"type":"text","value":"set a subscription-specific endpoint","position":{"start":{"line":8,"column":263,"offset":803},"end":{"line":8,"column":299,"offset":839},"indent":[]}}],"position":{"start":{"line":8,"column":262,"offset":802},"end":{"line":8,"column":334,"offset":874},"indent":[]}},{"type":"text","value":" that's separate from the default endpoint for queries and mutations.","position":{"start":{"line":8,"column":334,"offset":874},"end":{"line":8,"column":403,"offset":943},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":541},"end":{"line":8,"column":403,"offset":943},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use subscriptions with the core ","position":{"start":{"line":10,"column":1,"offset":945},"end":{"line":10,"column":41,"offset":985},"indent":[]}},{"type":"inlineCode","value":"apollo-server","position":{"start":{"line":10,"column":41,"offset":985},"end":{"line":10,"column":56,"offset":1000},"indent":[]}},{"type":"text","value":" library, or with any of Apollo Server's supported ","position":{"start":{"line":10,"column":56,"offset":1000},"end":{"line":10,"column":107,"offset":1051},"indent":[]}},{"type":"link","title":null,"url":"#using-with-middleware-integrations","children":[{"type":"text","value":"middleware integrations","position":{"start":{"line":10,"column":108,"offset":1052},"end":{"line":10,"column":131,"offset":1075},"indent":[]}}],"position":{"start":{"line":10,"column":107,"offset":1051},"end":{"line":10,"column":169,"offset":1113},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":10,"column":169,"offset":1113},"end":{"line":10,"column":170,"offset":1114},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":945},"end":{"line":10,"column":170,"offset":1114},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Important:","position":{"start":{"line":12,"column":5,"offset":1120},"end":{"line":12,"column":15,"offset":1130},"indent":[]}}],"position":{"start":{"line":12,"column":3,"offset":1118},"end":{"line":12,"column":17,"offset":1132},"indent":[]}},{"type":"text","value":" Compared to queries and mutations, subscriptions are significantly more complex to implement. Before you begin, ","position":{"start":{"line":12,"column":17,"offset":1132},"end":{"line":12,"column":130,"offset":1245},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/data/subscriptions/#when-to-use-subscriptions","children":[{"type":"text","value":"confirm that your use case requires subscriptions","position":{"start":{"line":12,"column":131,"offset":1246},"end":{"line":12,"column":180,"offset":1295},"indent":[]}}],"position":{"start":{"line":12,"column":130,"offset":1245},"end":{"line":12,"column":269,"offset":1384},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":12,"column":269,"offset":1384},"end":{"line":12,"column":270,"offset":1385},"indent":[]}}],"position":{"start":{"line":12,"column":3,"offset":1118},"end":{"line":12,"column":270,"offset":1385},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":1116},"end":{"line":12,"column":270,"offset":1385},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Schema definition","position":{"start":{"line":14,"column":4,"offset":1390},"end":{"line":14,"column":21,"offset":1407},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1387},"end":{"line":14,"column":21,"offset":1407},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Your schema's ","position":{"start":{"line":16,"column":1,"offset":1409},"end":{"line":16,"column":15,"offset":1423},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":16,"column":15,"offset":1423},"end":{"line":16,"column":29,"offset":1437},"indent":[]}},{"type":"text","value":" type defines top-level fields that clients can subscribe to:","position":{"start":{"line":16,"column":29,"offset":1437},"end":{"line":16,"column":90,"offset":1498},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":1409},"end":{"line":16,"column":90,"offset":1498},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"type Subscription {\n  postCreated: Post\n}","position":{"start":{"line":18,"column":1,"offset":1500},"end":{"line":22,"column":4,"offset":1556},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":24,"column":1,"offset":1558},"end":{"line":24,"column":5,"offset":1562},"indent":[]}},{"type":"inlineCode","value":"postCreated","position":{"start":{"line":24,"column":5,"offset":1562},"end":{"line":24,"column":18,"offset":1575},"indent":[]}},{"type":"text","value":" field will update its value whenever a new ","position":{"start":{"line":24,"column":18,"offset":1575},"end":{"line":24,"column":62,"offset":1619},"indent":[]}},{"type":"inlineCode","value":"Post","position":{"start":{"line":24,"column":62,"offset":1619},"end":{"line":24,"column":68,"offset":1625},"indent":[]}},{"type":"text","value":" is created on the backend, thus pushing the ","position":{"start":{"line":24,"column":68,"offset":1625},"end":{"line":24,"column":113,"offset":1670},"indent":[]}},{"type":"inlineCode","value":"Post","position":{"start":{"line":24,"column":113,"offset":1670},"end":{"line":24,"column":119,"offset":1676},"indent":[]}},{"type":"text","value":" to subscribing clients.","position":{"start":{"line":24,"column":119,"offset":1676},"end":{"line":24,"column":143,"offset":1700},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":1558},"end":{"line":24,"column":143,"offset":1700},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Clients can subscribe to the ","position":{"start":{"line":26,"column":1,"offset":1702},"end":{"line":26,"column":30,"offset":1731},"indent":[]}},{"type":"inlineCode","value":"postCreated","position":{"start":{"line":26,"column":30,"offset":1731},"end":{"line":26,"column":43,"offset":1744},"indent":[]}},{"type":"text","value":" field with a GraphQL string like this:","position":{"start":{"line":26,"column":43,"offset":1744},"end":{"line":26,"column":82,"offset":1783},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1702},"end":{"line":26,"column":82,"offset":1783},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"subscription PostFeed {\n  postCreated {\n    author\n    comment\n  }\n}","position":{"start":{"line":28,"column":1,"offset":1785},"end":{"line":35,"column":4,"offset":1868},"indent":[1,1,1,1,1,1,1]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"Each subscription operation can subscribe to only ","position":{"start":{"line":37,"column":3,"offset":1872},"end":{"line":37,"column":53,"offset":1922},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"one","position":{"start":{"line":37,"column":54,"offset":1923},"end":{"line":37,"column":57,"offset":1926},"indent":[]}}],"position":{"start":{"line":37,"column":53,"offset":1922},"end":{"line":37,"column":58,"offset":1927},"indent":[]}},{"type":"text","value":" field of the ","position":{"start":{"line":37,"column":58,"offset":1927},"end":{"line":37,"column":72,"offset":1941},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":37,"column":72,"offset":1941},"end":{"line":37,"column":86,"offset":1955},"indent":[]}},{"type":"text","value":" type.","position":{"start":{"line":37,"column":86,"offset":1955},"end":{"line":37,"column":92,"offset":1961},"indent":[]}}],"position":{"start":{"line":37,"column":3,"offset":1872},"end":{"line":37,"column":92,"offset":1961},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":1870},"end":{"line":37,"column":92,"offset":1961},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Setting a subscription endpoint","position":{"start":{"line":39,"column":4,"offset":1966},"end":{"line":39,"column":35,"offset":1997},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":1963},"end":{"line":39,"column":35,"offset":1997},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Because subscriptions use WebSocket instead of HTTP, Apollo Server uses a ","position":{"start":{"line":41,"column":1,"offset":1999},"end":{"line":41,"column":75,"offset":2073},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"second","position":{"start":{"line":41,"column":76,"offset":2074},"end":{"line":41,"column":82,"offset":2080},"indent":[]}}],"position":{"start":{"line":41,"column":75,"offset":2073},"end":{"line":41,"column":83,"offset":2081},"indent":[]}},{"type":"text","value":" GraphQL endpoint specifically for subscriptions. This endpoint uses the ","position":{"start":{"line":41,"column":83,"offset":2081},"end":{"line":41,"column":156,"offset":2154},"indent":[]}},{"type":"inlineCode","value":"ws","position":{"start":{"line":41,"column":156,"offset":2154},"end":{"line":41,"column":160,"offset":2158},"indent":[]}},{"type":"text","value":" protocol instead of ","position":{"start":{"line":41,"column":160,"offset":2158},"end":{"line":41,"column":181,"offset":2179},"indent":[]}},{"type":"inlineCode","value":"http","position":{"start":{"line":41,"column":181,"offset":2179},"end":{"line":41,"column":187,"offset":2185},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":41,"column":187,"offset":2185},"end":{"line":41,"column":188,"offset":2186},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1999},"end":{"line":41,"column":188,"offset":2186},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"By default, the subscription endpoint's path matches the path of your primary GraphQL endpoint (","position":{"start":{"line":43,"column":1,"offset":2188},"end":{"line":43,"column":97,"offset":2284},"indent":[]}},{"type":"inlineCode","value":"/graphql","position":{"start":{"line":43,"column":97,"offset":2284},"end":{"line":43,"column":107,"offset":2294},"indent":[]}},{"type":"text","value":" if not set). You can specify a different path for your subscription endpoint like so:","position":{"start":{"line":43,"column":107,"offset":2294},"end":{"line":43,"column":193,"offset":2380},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":2188},"end":{"line":43,"column":193,"offset":2380},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const server = new ApolloServer({\n  subscriptions: {\n    path: '/subscriptions'\n  },\n  // ...other options...\n}));","position":{"start":{"line":45,"column":1,"offset":2382},"end":{"line":52,"column":4,"offset":2506},"indent":[1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Resolving a subscription","position":{"start":{"line":54,"column":4,"offset":2511},"end":{"line":54,"column":28,"offset":2535},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":2508},"end":{"line":54,"column":28,"offset":2535},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Resolvers for ","position":{"start":{"line":56,"column":1,"offset":2537},"end":{"line":56,"column":15,"offset":2551},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":56,"column":15,"offset":2551},"end":{"line":56,"column":29,"offset":2565},"indent":[]}},{"type":"text","value":" fields differ from resolvers for fields of other types. Specifically, ","position":{"start":{"line":56,"column":29,"offset":2565},"end":{"line":56,"column":100,"offset":2636},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":56,"column":100,"offset":2636},"end":{"line":56,"column":114,"offset":2650},"indent":[]}},{"type":"text","value":" field resolvers are ","position":{"start":{"line":56,"column":114,"offset":2650},"end":{"line":56,"column":135,"offset":2671},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"objects","position":{"start":{"line":56,"column":136,"offset":2672},"end":{"line":56,"column":143,"offset":2679},"indent":[]}}],"position":{"start":{"line":56,"column":135,"offset":2671},"end":{"line":56,"column":144,"offset":2680},"indent":[]}},{"type":"text","value":" that define a ","position":{"start":{"line":56,"column":144,"offset":2680},"end":{"line":56,"column":159,"offset":2695},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":56,"column":159,"offset":2695},"end":{"line":56,"column":170,"offset":2706},"indent":[]}},{"type":"text","value":" function:","position":{"start":{"line":56,"column":170,"offset":2706},"end":{"line":56,"column":180,"offset":2716},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":2537},"end":{"line":56,"column":180,"offset":2716},"indent":[]}},{"type":"code","lang":"js:title=index.js","meta":null,"value":"const resolvers = {\n  Subscription: {\n    postCreated: {\n      // More on pubsub below\n      subscribe: () => pubsub.asyncIterator(['POST_CREATED']),\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":58,"column":1,"offset":2718},"end":{"line":68,"column":4,"offset":2934},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":70,"column":1,"offset":2936},"end":{"line":70,"column":5,"offset":2940},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":70,"column":5,"offset":2940},"end":{"line":70,"column":16,"offset":2951},"indent":[]}},{"type":"text","value":" function must return an object of type ","position":{"start":{"line":70,"column":16,"offset":2951},"end":{"line":70,"column":56,"offset":2991},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":70,"column":56,"offset":2991},"end":{"line":70,"column":71,"offset":3006},"indent":[]}},{"type":"text","value":", a standard interface for iterating over asynchronous results. In the example above, an ","position":{"start":{"line":70,"column":71,"offset":3006},"end":{"line":70,"column":160,"offset":3095},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":70,"column":160,"offset":3095},"end":{"line":70,"column":175,"offset":3110},"indent":[]}},{"type":"text","value":" is generated by ","position":{"start":{"line":70,"column":175,"offset":3110},"end":{"line":70,"column":192,"offset":3127},"indent":[]}},{"type":"inlineCode","value":"pubsub.asyncIterator","position":{"start":{"line":70,"column":192,"offset":3127},"end":{"line":70,"column":214,"offset":3149},"indent":[]}},{"type":"text","value":" (more on this below).","position":{"start":{"line":70,"column":214,"offset":3149},"end":{"line":70,"column":236,"offset":3171},"indent":[]}}],"position":{"start":{"line":70,"column":1,"offset":2936},"end":{"line":70,"column":236,"offset":3171},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"The ","position":{"start":{"line":73,"column":5,"offset":3178},"end":{"line":73,"column":9,"offset":3182},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":73,"column":9,"offset":3182},"end":{"line":73,"column":17,"offset":3190},"indent":[]}},{"type":"text","value":" class","position":{"start":{"line":73,"column":17,"offset":3190},"end":{"line":73,"column":23,"offset":3196},"indent":[]}}],"position":{"start":{"line":73,"column":1,"offset":3174},"end":{"line":73,"column":23,"offset":3196},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":75,"column":3,"offset":3200},"end":{"line":75,"column":7,"offset":3204},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":75,"column":7,"offset":3204},"end":{"line":75,"column":15,"offset":3212},"indent":[]}},{"type":"text","value":" class is ","position":{"start":{"line":75,"column":15,"offset":3212},"end":{"line":75,"column":25,"offset":3222},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"not","position":{"start":{"line":75,"column":27,"offset":3224},"end":{"line":75,"column":30,"offset":3227},"indent":[]}}],"position":{"start":{"line":75,"column":25,"offset":3222},"end":{"line":75,"column":32,"offset":3229},"indent":[]}},{"type":"text","value":" recommended for production environments, because it's an in-memory event system that only supports a single server instance. After you get subscriptions working in development, we strongly recommend switching it out for a different subclass of the abstract ","position":{"start":{"line":75,"column":32,"offset":3229},"end":{"line":75,"column":290,"offset":3487},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts","children":[{"type":"inlineCode","value":"PubSubEngine","position":{"start":{"line":75,"column":291,"offset":3488},"end":{"line":75,"column":305,"offset":3502},"indent":[]}},{"type":"text","value":" class","position":{"start":{"line":75,"column":305,"offset":3502},"end":{"line":75,"column":311,"offset":3508},"indent":[]}}],"position":{"start":{"line":75,"column":290,"offset":3487},"end":{"line":75,"column":401,"offset":3598},"indent":[]}},{"type":"text","value":". Recommended subclasses are listed in ","position":{"start":{"line":75,"column":401,"offset":3598},"end":{"line":75,"column":440,"offset":3637},"indent":[]}},{"type":"link","title":null,"url":"#production-pubsub-libraries","children":[{"type":"text","value":"Production ","position":{"start":{"line":75,"column":441,"offset":3638},"end":{"line":75,"column":452,"offset":3649},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":75,"column":452,"offset":3649},"end":{"line":75,"column":460,"offset":3657},"indent":[]}},{"type":"text","value":" libraries","position":{"start":{"line":75,"column":460,"offset":3657},"end":{"line":75,"column":470,"offset":3667},"indent":[]}}],"position":{"start":{"line":75,"column":440,"offset":3637},"end":{"line":75,"column":501,"offset":3698},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":75,"column":501,"offset":3698},"end":{"line":75,"column":502,"offset":3699},"indent":[]}}],"position":{"start":{"line":75,"column":3,"offset":3200},"end":{"line":75,"column":502,"offset":3699},"indent":[]}}],"position":{"start":{"line":75,"column":1,"offset":3198},"end":{"line":75,"column":502,"offset":3699},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server uses a ","position":{"start":{"line":77,"column":1,"offset":3701},"end":{"line":77,"column":22,"offset":3722},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"publish-subscribe","position":{"start":{"line":77,"column":24,"offset":3724},"end":{"line":77,"column":41,"offset":3741},"indent":[]}}],"position":{"start":{"line":77,"column":22,"offset":3722},"end":{"line":77,"column":43,"offset":3743},"indent":[]}},{"type":"text","value":" (","position":{"start":{"line":77,"column":43,"offset":3743},"end":{"line":77,"column":45,"offset":3745},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"pub/sub","position":{"start":{"line":77,"column":47,"offset":3747},"end":{"line":77,"column":54,"offset":3754},"indent":[]}}],"position":{"start":{"line":77,"column":45,"offset":3745},"end":{"line":77,"column":56,"offset":3756},"indent":[]}},{"type":"text","value":") model to track events that update active subscriptions. The ","position":{"start":{"line":77,"column":56,"offset":3756},"end":{"line":77,"column":118,"offset":3818},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions","children":[{"type":"inlineCode","value":"graphql-subscriptions","position":{"start":{"line":77,"column":119,"offset":3819},"end":{"line":77,"column":142,"offset":3842},"indent":[]}},{"type":"text","value":" library","position":{"start":{"line":77,"column":142,"offset":3842},"end":{"line":77,"column":150,"offset":3850},"indent":[]}}],"position":{"start":{"line":77,"column":118,"offset":3818},"end":{"line":77,"column":207,"offset":3907},"indent":[]}},{"type":"text","value":" (included in every ","position":{"start":{"line":77,"column":207,"offset":3907},"end":{"line":77,"column":227,"offset":3927},"indent":[]}},{"type":"inlineCode","value":"apollo-server","position":{"start":{"line":77,"column":227,"offset":3927},"end":{"line":77,"column":242,"offset":3942},"indent":[]}},{"type":"text","value":" package) provides the ","position":{"start":{"line":77,"column":242,"offset":3942},"end":{"line":77,"column":265,"offset":3965},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":77,"column":265,"offset":3965},"end":{"line":77,"column":273,"offset":3973},"indent":[]}},{"type":"text","value":" class as a basic in-memory event bus to help you get started:","position":{"start":{"line":77,"column":273,"offset":3973},"end":{"line":77,"column":335,"offset":4035},"indent":[]}}],"position":{"start":{"line":77,"column":1,"offset":3701},"end":{"line":77,"column":335,"offset":4035},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const { PubSub } = require('apollo-server');\n\nconst pubsub = new PubSub();","position":{"start":{"line":79,"column":1,"offset":4037},"end":{"line":83,"column":4,"offset":4121},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A ","position":{"start":{"line":85,"column":1,"offset":4123},"end":{"line":85,"column":3,"offset":4125},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":85,"column":3,"offset":4125},"end":{"line":85,"column":11,"offset":4133},"indent":[]}},{"type":"text","value":" instance enables your server code to both ","position":{"start":{"line":85,"column":11,"offset":4133},"end":{"line":85,"column":54,"offset":4176},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":85,"column":54,"offset":4176},"end":{"line":85,"column":63,"offset":4185},"indent":[]}},{"type":"text","value":" events to a particular label and listen for events associated with a particular label.","position":{"start":{"line":85,"column":63,"offset":4185},"end":{"line":85,"column":150,"offset":4272},"indent":[]}}],"position":{"start":{"line":85,"column":1,"offset":4123},"end":{"line":85,"column":150,"offset":4272},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Publishing an event","position":{"start":{"line":87,"column":5,"offset":4278},"end":{"line":87,"column":24,"offset":4297},"indent":[]}}],"position":{"start":{"line":87,"column":1,"offset":4274},"end":{"line":87,"column":24,"offset":4297},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You publish an event with the ","position":{"start":{"line":89,"column":1,"offset":4299},"end":{"line":89,"column":31,"offset":4329},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":89,"column":31,"offset":4329},"end":{"line":89,"column":40,"offset":4338},"indent":[]}},{"type":"text","value":" method of a ","position":{"start":{"line":89,"column":40,"offset":4338},"end":{"line":89,"column":53,"offset":4351},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":89,"column":53,"offset":4351},"end":{"line":89,"column":61,"offset":4359},"indent":[]}},{"type":"text","value":" instance:","position":{"start":{"line":89,"column":61,"offset":4359},"end":{"line":89,"column":71,"offset":4369},"indent":[]}}],"position":{"start":{"line":89,"column":1,"offset":4299},"end":{"line":89,"column":71,"offset":4369},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"pubsub.publish('POST_CREATED', {\n  postCreated: {\n    author: 'Ali Baba',\n    comment: 'Open sesame'\n  }\n});","position":{"start":{"line":91,"column":1,"offset":4371},"end":{"line":98,"column":4,"offset":4489},"indent":[1,1,1,1,1,1,1]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The first parameter is the name of the event label you're publishing to, as a string.","position":{"start":{"line":100,"column":3,"offset":4493},"end":{"line":100,"column":88,"offset":4578},"indent":[]}}],"position":{"start":{"line":100,"column":3,"offset":4493},"end":{"line":100,"column":88,"offset":4578},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"You don't need to register a label name before publishing to it.","position":{"start":{"line":101,"column":8,"offset":4586},"end":{"line":101,"column":72,"offset":4650},"indent":[]}}],"position":{"start":{"line":101,"column":7,"offset":4585},"end":{"line":101,"column":73,"offset":4651},"indent":[]}}],"position":{"start":{"line":101,"column":7,"offset":4585},"end":{"line":101,"column":73,"offset":4651},"indent":[]}}],"position":{"start":{"line":101,"column":3,"offset":4581},"end":{"line":101,"column":73,"offset":4651},"indent":[]}}],"position":{"start":{"line":101,"column":3,"offset":4581},"end":{"line":101,"column":73,"offset":4651},"indent":[]}}],"position":{"start":{"line":100,"column":1,"offset":4491},"end":{"line":101,"column":73,"offset":4651},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The second parameter is the payload associated with the event.","position":{"start":{"line":102,"column":3,"offset":4654},"end":{"line":102,"column":65,"offset":4716},"indent":[]}}],"position":{"start":{"line":102,"column":3,"offset":4654},"end":{"line":102,"column":65,"offset":4716},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"The payload should include whatever data is necessary for your resolvers to populate the associated ","position":{"start":{"line":103,"column":8,"offset":4724},"end":{"line":103,"column":108,"offset":4824},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":103,"column":108,"offset":4824},"end":{"line":103,"column":122,"offset":4838},"indent":[]}},{"type":"text","value":" field and its subfields.","position":{"start":{"line":103,"column":122,"offset":4838},"end":{"line":103,"column":147,"offset":4863},"indent":[]}}],"position":{"start":{"line":103,"column":7,"offset":4723},"end":{"line":103,"column":148,"offset":4864},"indent":[]}}],"position":{"start":{"line":103,"column":7,"offset":4723},"end":{"line":103,"column":148,"offset":4864},"indent":[]}}],"position":{"start":{"line":103,"column":3,"offset":4719},"end":{"line":103,"column":148,"offset":4864},"indent":[]}}],"position":{"start":{"line":103,"column":3,"offset":4719},"end":{"line":103,"column":148,"offset":4864},"indent":[]}}],"position":{"start":{"line":102,"column":1,"offset":4652},"end":{"line":103,"column":148,"offset":4864},"indent":[1]}}],"position":{"start":{"line":100,"column":1,"offset":4491},"end":{"line":103,"column":148,"offset":4864},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"When working with GraphQL subscriptions, you ","position":{"start":{"line":105,"column":1,"offset":4866},"end":{"line":105,"column":46,"offset":4911},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":105,"column":46,"offset":4911},"end":{"line":105,"column":55,"offset":4920},"indent":[]}},{"type":"text","value":" an event whenever a subscription's return value should be updated. One common cause of such an update is a mutation, but ","position":{"start":{"line":105,"column":55,"offset":4920},"end":{"line":105,"column":177,"offset":5042},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"any","position":{"start":{"line":105,"column":178,"offset":5043},"end":{"line":105,"column":181,"offset":5046},"indent":[]}}],"position":{"start":{"line":105,"column":177,"offset":5042},"end":{"line":105,"column":182,"offset":5047},"indent":[]}},{"type":"text","value":" back-end logic might result in changes that should be ","position":{"start":{"line":105,"column":182,"offset":5047},"end":{"line":105,"column":237,"offset":5102},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":105,"column":237,"offset":5102},"end":{"line":105,"column":246,"offset":5111},"indent":[]}},{"type":"text","value":"ed.","position":{"start":{"line":105,"column":246,"offset":5111},"end":{"line":105,"column":249,"offset":5114},"indent":[]}}],"position":{"start":{"line":105,"column":1,"offset":4866},"end":{"line":105,"column":249,"offset":5114},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"As an example, let's say our GraphQL API supports a ","position":{"start":{"line":107,"column":1,"offset":5116},"end":{"line":107,"column":53,"offset":5168},"indent":[]}},{"type":"inlineCode","value":"createPost","position":{"start":{"line":107,"column":53,"offset":5168},"end":{"line":107,"column":65,"offset":5180},"indent":[]}},{"type":"text","value":" mutation:","position":{"start":{"line":107,"column":65,"offset":5180},"end":{"line":107,"column":75,"offset":5190},"indent":[]}}],"position":{"start":{"line":107,"column":1,"offset":5116},"end":{"line":107,"column":75,"offset":5190},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"type Mutation {\n  createPost(author: String, comment: String): Post\n}","position":{"start":{"line":109,"column":1,"offset":5192},"end":{"line":113,"column":4,"offset":5276},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A basic resolver for ","position":{"start":{"line":115,"column":1,"offset":5278},"end":{"line":115,"column":22,"offset":5299},"indent":[]}},{"type":"inlineCode","value":"createPost","position":{"start":{"line":115,"column":22,"offset":5299},"end":{"line":115,"column":34,"offset":5311},"indent":[]}},{"type":"text","value":" might look like this:","position":{"start":{"line":115,"column":34,"offset":5311},"end":{"line":115,"column":56,"offset":5333},"indent":[]}}],"position":{"start":{"line":115,"column":1,"offset":5278},"end":{"line":115,"column":56,"offset":5333},"indent":[]}},{"type":"code","lang":"js{3-6}","meta":null,"value":"const resolvers = {\n  Mutation: {\n    createPost(parent, args, context) {\n      // Datastore logic lives in postController\n      return postController.createPost(args);\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":117,"column":1,"offset":5335},"end":{"line":127,"column":4,"offset":5560},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Before we persist the new post's details in our datastore, we can ","position":{"start":{"line":129,"column":1,"offset":5562},"end":{"line":129,"column":67,"offset":5628},"indent":[]}},{"type":"inlineCode","value":"publish","position":{"start":{"line":129,"column":67,"offset":5628},"end":{"line":129,"column":76,"offset":5637},"indent":[]}},{"type":"text","value":" an event that ","position":{"start":{"line":129,"column":76,"offset":5637},"end":{"line":129,"column":91,"offset":5652},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"also","position":{"start":{"line":129,"column":92,"offset":5653},"end":{"line":129,"column":96,"offset":5657},"indent":[]}}],"position":{"start":{"line":129,"column":91,"offset":5652},"end":{"line":129,"column":97,"offset":5658},"indent":[]}},{"type":"text","value":" includes those details:","position":{"start":{"line":129,"column":97,"offset":5658},"end":{"line":129,"column":121,"offset":5682},"indent":[]}}],"position":{"start":{"line":129,"column":1,"offset":5562},"end":{"line":129,"column":121,"offset":5682},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const resolvers = {\n  Mutation: {\n    createPost(parent, args, context) {\n      pubsub.publish('POST_CREATED', { postCreated: args }); // highlight-line\n      return postController.createPost(args);\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":131,"column":1,"offset":5684},"end":{"line":141,"column":4,"offset":5934},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next, we can listen for this event in our ","position":{"start":{"line":143,"column":1,"offset":5936},"end":{"line":143,"column":43,"offset":5978},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":143,"column":43,"offset":5978},"end":{"line":143,"column":57,"offset":5992},"indent":[]}},{"type":"text","value":" field's resolver.","position":{"start":{"line":143,"column":57,"offset":5992},"end":{"line":143,"column":75,"offset":6010},"indent":[]}}],"position":{"start":{"line":143,"column":1,"offset":5936},"end":{"line":143,"column":75,"offset":6010},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Listening for events","position":{"start":{"line":145,"column":5,"offset":6016},"end":{"line":145,"column":25,"offset":6036},"indent":[]}}],"position":{"start":{"line":145,"column":1,"offset":6012},"end":{"line":145,"column":25,"offset":6036},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An ","position":{"start":{"line":147,"column":1,"offset":6038},"end":{"line":147,"column":4,"offset":6041},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-async-iterator.ts","children":[{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":147,"column":5,"offset":6042},"end":{"line":147,"column":20,"offset":6057},"indent":[]}}],"position":{"start":{"line":147,"column":4,"offset":6041},"end":{"line":147,"column":118,"offset":6155},"indent":[]}},{"type":"text","value":" object listens for events that are associated with a particular label (or set of labels) and adds them to a queue for processing. You create an ","position":{"start":{"line":147,"column":118,"offset":6155},"end":{"line":147,"column":263,"offset":6300},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":147,"column":263,"offset":6300},"end":{"line":147,"column":278,"offset":6315},"indent":[]}},{"type":"text","value":" by calling the ","position":{"start":{"line":147,"column":278,"offset":6315},"end":{"line":147,"column":294,"offset":6331},"indent":[]}},{"type":"inlineCode","value":"asyncIterator","position":{"start":{"line":147,"column":294,"offset":6331},"end":{"line":147,"column":309,"offset":6346},"indent":[]}},{"type":"text","value":" method of ","position":{"start":{"line":147,"column":309,"offset":6346},"end":{"line":147,"column":320,"offset":6357},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":147,"column":320,"offset":6357},"end":{"line":147,"column":328,"offset":6365},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":147,"column":328,"offset":6365},"end":{"line":147,"column":329,"offset":6366},"indent":[]}}],"position":{"start":{"line":147,"column":1,"offset":6038},"end":{"line":147,"column":329,"offset":6366},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"pubsub.asyncIterator(['POST_CREATED']);","position":{"start":{"line":149,"column":1,"offset":6368},"end":{"line":151,"column":4,"offset":6417},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You pass this method an array containing the names of all event labels that the ","position":{"start":{"line":153,"column":1,"offset":6419},"end":{"line":153,"column":81,"offset":6499},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":153,"column":81,"offset":6499},"end":{"line":153,"column":96,"offset":6514},"indent":[]}},{"type":"text","value":" should listen for.","position":{"start":{"line":153,"column":96,"offset":6514},"end":{"line":153,"column":115,"offset":6533},"indent":[]}}],"position":{"start":{"line":153,"column":1,"offset":6419},"end":{"line":153,"column":115,"offset":6533},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Every ","position":{"start":{"line":155,"column":1,"offset":6535},"end":{"line":155,"column":7,"offset":6541},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":155,"column":7,"offset":6541},"end":{"line":155,"column":21,"offset":6555},"indent":[]}},{"type":"text","value":" field resolver's ","position":{"start":{"line":155,"column":21,"offset":6555},"end":{"line":155,"column":39,"offset":6573},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":155,"column":39,"offset":6573},"end":{"line":155,"column":50,"offset":6584},"indent":[]}},{"type":"text","value":" function must return an ","position":{"start":{"line":155,"column":50,"offset":6584},"end":{"line":155,"column":75,"offset":6609},"indent":[]}},{"type":"inlineCode","value":"AsyncIterator","position":{"start":{"line":155,"column":75,"offset":6609},"end":{"line":155,"column":90,"offset":6624},"indent":[]}},{"type":"text","value":" object. This brings us back to the code sample at the top of ","position":{"start":{"line":155,"column":90,"offset":6624},"end":{"line":155,"column":152,"offset":6686},"indent":[]}},{"type":"link","title":null,"url":"#resolving-a-subscription","children":[{"type":"text","value":"Resolving a subscription","position":{"start":{"line":155,"column":153,"offset":6687},"end":{"line":155,"column":177,"offset":6711},"indent":[]}}],"position":{"start":{"line":155,"column":152,"offset":6686},"end":{"line":155,"column":205,"offset":6739},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":155,"column":205,"offset":6739},"end":{"line":155,"column":206,"offset":6740},"indent":[]}}],"position":{"start":{"line":155,"column":1,"offset":6535},"end":{"line":155,"column":206,"offset":6740},"indent":[]}},{"type":"code","lang":"js:title=index.js","meta":null,"value":"const resolvers = {\n  Subscription: {\n    postCreated: {\n      subscribe: () => pubsub.asyncIterator(['POST_CREATED']),\n    },\n  },\n  // ...other resolvers...\n};","position":{"start":{"line":157,"column":1,"offset":6742},"end":{"line":166,"column":4,"offset":6928},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"With this ","position":{"start":{"line":168,"column":1,"offset":6930},"end":{"line":168,"column":11,"offset":6940},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":168,"column":11,"offset":6940},"end":{"line":168,"column":22,"offset":6951},"indent":[]}},{"type":"text","value":" function set, Apollo Server uses the payloads of ","position":{"start":{"line":168,"column":22,"offset":6951},"end":{"line":168,"column":72,"offset":7001},"indent":[]}},{"type":"inlineCode","value":"POST_CREATED","position":{"start":{"line":168,"column":72,"offset":7001},"end":{"line":168,"column":86,"offset":7015},"indent":[]}},{"type":"text","value":" events to push updated values for the ","position":{"start":{"line":168,"column":86,"offset":7015},"end":{"line":168,"column":125,"offset":7054},"indent":[]}},{"type":"inlineCode","value":"postCreated","position":{"start":{"line":168,"column":125,"offset":7054},"end":{"line":168,"column":138,"offset":7067},"indent":[]}},{"type":"text","value":" field.","position":{"start":{"line":168,"column":138,"offset":7067},"end":{"line":168,"column":145,"offset":7074},"indent":[]}}],"position":{"start":{"line":168,"column":1,"offset":6930},"end":{"line":168,"column":145,"offset":7074},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Filtering events","position":{"start":{"line":170,"column":5,"offset":7080},"end":{"line":170,"column":21,"offset":7096},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":7076},"end":{"line":170,"column":21,"offset":7096},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Sometimes, a client should only receive updated subscription data if that data meets certain criteria. To support this, you can call the ","position":{"start":{"line":172,"column":1,"offset":7098},"end":{"line":172,"column":138,"offset":7235},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":172,"column":138,"offset":7235},"end":{"line":172,"column":150,"offset":7247},"indent":[]}},{"type":"text","value":" helper function in your ","position":{"start":{"line":172,"column":150,"offset":7247},"end":{"line":172,"column":175,"offset":7272},"indent":[]}},{"type":"inlineCode","value":"Subscription","position":{"start":{"line":172,"column":175,"offset":7272},"end":{"line":172,"column":189,"offset":7286},"indent":[]}},{"type":"text","value":" field's resolver.","position":{"start":{"line":172,"column":189,"offset":7286},"end":{"line":172,"column":207,"offset":7304},"indent":[]}}],"position":{"start":{"line":172,"column":1,"offset":7098},"end":{"line":172,"column":207,"offset":7304},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Example","position":{"start":{"line":174,"column":6,"offset":7311},"end":{"line":174,"column":13,"offset":7318},"indent":[]}}],"position":{"start":{"line":174,"column":1,"offset":7306},"end":{"line":174,"column":13,"offset":7318},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Let's say our server provides a ","position":{"start":{"line":176,"column":1,"offset":7320},"end":{"line":176,"column":33,"offset":7352},"indent":[]}},{"type":"inlineCode","value":"commentAdded","position":{"start":{"line":176,"column":33,"offset":7352},"end":{"line":176,"column":47,"offset":7366},"indent":[]}},{"type":"text","value":" subscription, which should notify clients whenever a comment is added to a specified code repository. A client can execute a subscription that looks like this:","position":{"start":{"line":176,"column":47,"offset":7366},"end":{"line":176,"column":207,"offset":7526},"indent":[]}}],"position":{"start":{"line":176,"column":1,"offset":7320},"end":{"line":176,"column":207,"offset":7526},"indent":[]}},{"type":"code","lang":"graphql","meta":null,"value":"subscription($repoName: String!){\n  commentAdded(repoFullName: $repoName) {\n    id\n    content\n  }\n}","position":{"start":{"line":178,"column":1,"offset":7528},"end":{"line":185,"column":4,"offset":7643},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This presents a potential issue: our server probably ","position":{"start":{"line":187,"column":1,"offset":7645},"end":{"line":187,"column":54,"offset":7698},"indent":[]}},{"type":"link","title":null,"url":"#publishing-an-event","children":[{"type":"text","value":"publishes","position":{"start":{"line":187,"column":55,"offset":7699},"end":{"line":187,"column":64,"offset":7708},"indent":[]}}],"position":{"start":{"line":187,"column":54,"offset":7698},"end":{"line":187,"column":87,"offset":7731},"indent":[]}},{"type":"text","value":"  a ","position":{"start":{"line":187,"column":87,"offset":7731},"end":{"line":187,"column":91,"offset":7735},"indent":[]}},{"type":"inlineCode","value":"COMMENT_ADDED","position":{"start":{"line":187,"column":91,"offset":7735},"end":{"line":187,"column":106,"offset":7750},"indent":[]}},{"type":"text","value":" event whenever a comment is added to ","position":{"start":{"line":187,"column":106,"offset":7750},"end":{"line":187,"column":144,"offset":7788},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"any","position":{"start":{"line":187,"column":145,"offset":7789},"end":{"line":187,"column":148,"offset":7792},"indent":[]}}],"position":{"start":{"line":187,"column":144,"offset":7788},"end":{"line":187,"column":149,"offset":7793},"indent":[]}},{"type":"text","value":" repository. This means that the ","position":{"start":{"line":187,"column":149,"offset":7793},"end":{"line":187,"column":182,"offset":7826},"indent":[]}},{"type":"inlineCode","value":"commentAdded","position":{"start":{"line":187,"column":182,"offset":7826},"end":{"line":187,"column":196,"offset":7840},"indent":[]}},{"type":"text","value":" resolver executes for ","position":{"start":{"line":187,"column":196,"offset":7840},"end":{"line":187,"column":219,"offset":7863},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"every","position":{"start":{"line":187,"column":220,"offset":7864},"end":{"line":187,"column":225,"offset":7869},"indent":[]}}],"position":{"start":{"line":187,"column":219,"offset":7863},"end":{"line":187,"column":226,"offset":7870},"indent":[]}},{"type":"text","value":" new comment, regardless of which repository it's added to. As a result, subscribing clients might receive data they don't want (or shouldn't even have access to).","position":{"start":{"line":187,"column":226,"offset":7870},"end":{"line":187,"column":389,"offset":8033},"indent":[]}}],"position":{"start":{"line":187,"column":1,"offset":7645},"end":{"line":187,"column":389,"offset":8033},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To fix this, we can use the ","position":{"start":{"line":189,"column":1,"offset":8035},"end":{"line":189,"column":29,"offset":8063},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":189,"column":29,"offset":8063},"end":{"line":189,"column":41,"offset":8075},"indent":[]}},{"type":"text","value":" helper function to control updates on a per-client basis.","position":{"start":{"line":189,"column":41,"offset":8075},"end":{"line":189,"column":99,"offset":8133},"indent":[]}}],"position":{"start":{"line":189,"column":1,"offset":8035},"end":{"line":189,"column":99,"offset":8133},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Here's an example resolver for ","position":{"start":{"line":191,"column":1,"offset":8135},"end":{"line":191,"column":32,"offset":8166},"indent":[]}},{"type":"inlineCode","value":"commentAdded","position":{"start":{"line":191,"column":32,"offset":8166},"end":{"line":191,"column":46,"offset":8180},"indent":[]}},{"type":"text","value":" that uses the ","position":{"start":{"line":191,"column":46,"offset":8180},"end":{"line":191,"column":61,"offset":8195},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":191,"column":61,"offset":8195},"end":{"line":191,"column":73,"offset":8207},"indent":[]}},{"type":"text","value":" function:","position":{"start":{"line":191,"column":73,"offset":8207},"end":{"line":191,"column":83,"offset":8217},"indent":[]}}],"position":{"start":{"line":191,"column":1,"offset":8135},"end":{"line":191,"column":83,"offset":8217},"indent":[]}},{"type":"code","lang":"js{5-12}","meta":null,"value":"const { withFilter } = require('apollo-server');\n\nconst resolvers = {\n  Subscription: {\n    commentAdded: {\n      subscribe: withFilter(\n        () => pubsub.asyncIterator('COMMENT_ADDED'),\n        (payload, variables) => {\n          // Only push an update if the comment is on\n          // the correct repository for this operation\n          return (payload.commentAdded.repository_name === variables.repoFullName);\n        },\n      ),\n    }\n  },\n    // ...other resolvers...\n};","position":{"start":{"line":193,"column":1,"offset":8219},"end":{"line":211,"column":4,"offset":8714},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":213,"column":1,"offset":8716},"end":{"line":213,"column":5,"offset":8720},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":213,"column":5,"offset":8720},"end":{"line":213,"column":17,"offset":8732},"indent":[]}},{"type":"text","value":" function takes two parameters:","position":{"start":{"line":213,"column":17,"offset":8732},"end":{"line":213,"column":48,"offset":8763},"indent":[]}}],"position":{"start":{"line":213,"column":1,"offset":8716},"end":{"line":213,"column":48,"offset":8763},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The first parameter is exactly the function you would use for ","position":{"start":{"line":215,"column":3,"offset":8767},"end":{"line":215,"column":65,"offset":8829},"indent":[]}},{"type":"inlineCode","value":"subscribe","position":{"start":{"line":215,"column":65,"offset":8829},"end":{"line":215,"column":76,"offset":8840},"indent":[]}},{"type":"text","value":" if you ","position":{"start":{"line":215,"column":76,"offset":8840},"end":{"line":215,"column":84,"offset":8848},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"weren't","position":{"start":{"line":215,"column":85,"offset":8849},"end":{"line":215,"column":92,"offset":8856},"indent":[]}}],"position":{"start":{"line":215,"column":84,"offset":8848},"end":{"line":215,"column":93,"offset":8857},"indent":[]}},{"type":"text","value":" applying a filter.","position":{"start":{"line":215,"column":93,"offset":8857},"end":{"line":215,"column":112,"offset":8876},"indent":[]}}],"position":{"start":{"line":215,"column":3,"offset":8767},"end":{"line":215,"column":112,"offset":8876},"indent":[]}}],"position":{"start":{"line":215,"column":1,"offset":8765},"end":{"line":215,"column":112,"offset":8876},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The second parameter is a ","position":{"start":{"line":216,"column":3,"offset":8879},"end":{"line":216,"column":29,"offset":8905},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"filter function","position":{"start":{"line":216,"column":31,"offset":8907},"end":{"line":216,"column":46,"offset":8922},"indent":[]}}],"position":{"start":{"line":216,"column":29,"offset":8905},"end":{"line":216,"column":48,"offset":8924},"indent":[]}},{"type":"text","value":" that returns ","position":{"start":{"line":216,"column":48,"offset":8924},"end":{"line":216,"column":62,"offset":8938},"indent":[]}},{"type":"inlineCode","value":"true","position":{"start":{"line":216,"column":62,"offset":8938},"end":{"line":216,"column":68,"offset":8944},"indent":[]}},{"type":"text","value":" if a subscription update ","position":{"start":{"line":216,"column":68,"offset":8944},"end":{"line":216,"column":94,"offset":8970},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"should","position":{"start":{"line":216,"column":95,"offset":8971},"end":{"line":216,"column":101,"offset":8977},"indent":[]}}],"position":{"start":{"line":216,"column":94,"offset":8970},"end":{"line":216,"column":102,"offset":8978},"indent":[]}},{"type":"text","value":" be sent to a particular client, and ","position":{"start":{"line":216,"column":102,"offset":8978},"end":{"line":216,"column":139,"offset":9015},"indent":[]}},{"type":"inlineCode","value":"false","position":{"start":{"line":216,"column":139,"offset":9015},"end":{"line":216,"column":146,"offset":9022},"indent":[]}},{"type":"text","value":" otherwise (","position":{"start":{"line":216,"column":146,"offset":9022},"end":{"line":216,"column":158,"offset":9034},"indent":[]}},{"type":"inlineCode","value":"Promise<boolean>","position":{"start":{"line":216,"column":158,"offset":9034},"end":{"line":216,"column":176,"offset":9052},"indent":[]}},{"type":"text","value":" is also allowed). This function takes two parameters of its own:","position":{"start":{"line":216,"column":176,"offset":9052},"end":{"line":216,"column":241,"offset":9117},"indent":[]}}],"position":{"start":{"line":216,"column":3,"offset":8879},"end":{"line":216,"column":241,"offset":9117},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"payload","position":{"start":{"line":217,"column":7,"offset":9124},"end":{"line":217,"column":16,"offset":9133},"indent":[]}},{"type":"text","value":" is the payload of the event that was published.","position":{"start":{"line":217,"column":16,"offset":9133},"end":{"line":217,"column":64,"offset":9181},"indent":[]}}],"position":{"start":{"line":217,"column":7,"offset":9124},"end":{"line":217,"column":64,"offset":9181},"indent":[]}}],"position":{"start":{"line":217,"column":3,"offset":9120},"end":{"line":217,"column":64,"offset":9181},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"variables","position":{"start":{"line":218,"column":7,"offset":9188},"end":{"line":218,"column":18,"offset":9199},"indent":[]}},{"type":"text","value":" is an object containing all arguments the client provided when initiating their subscription.","position":{"start":{"line":218,"column":18,"offset":9199},"end":{"line":218,"column":112,"offset":9293},"indent":[]}}],"position":{"start":{"line":218,"column":7,"offset":9188},"end":{"line":218,"column":112,"offset":9293},"indent":[]}}],"position":{"start":{"line":218,"column":3,"offset":9184},"end":{"line":218,"column":112,"offset":9293},"indent":[]}}],"position":{"start":{"line":217,"column":3,"offset":9120},"end":{"line":218,"column":112,"offset":9293},"indent":[3]}}],"position":{"start":{"line":216,"column":1,"offset":8877},"end":{"line":218,"column":112,"offset":9293},"indent":[1,1]}}],"position":{"start":{"line":215,"column":1,"offset":8765},"end":{"line":218,"column":112,"offset":9293},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Use ","position":{"start":{"line":220,"column":1,"offset":9295},"end":{"line":220,"column":5,"offset":9299},"indent":[]}},{"type":"inlineCode","value":"withFilter","position":{"start":{"line":220,"column":5,"offset":9299},"end":{"line":220,"column":17,"offset":9311},"indent":[]}},{"type":"text","value":" to make sure clients get exactly the subscription updates they want (and are allowed to receive).","position":{"start":{"line":220,"column":17,"offset":9311},"end":{"line":220,"column":115,"offset":9409},"indent":[]}}],"position":{"start":{"line":220,"column":1,"offset":9295},"end":{"line":220,"column":115,"offset":9409},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Basic runnable example","position":{"start":{"line":223,"column":4,"offset":9415},"end":{"line":223,"column":26,"offset":9437},"indent":[]}}],"position":{"start":{"line":223,"column":1,"offset":9412},"end":{"line":223,"column":26,"offset":9437},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An example server is available on ","position":{"start":{"line":225,"column":1,"offset":9439},"end":{"line":225,"column":35,"offset":9473},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/docs-examples/blob/main/server-subscriptions/index.js","children":[{"type":"text","value":"GitHub","position":{"start":{"line":225,"column":36,"offset":9474},"end":{"line":225,"column":42,"offset":9480},"indent":[]}}],"position":{"start":{"line":225,"column":35,"offset":9473},"end":{"line":225,"column":131,"offset":9569},"indent":[]}},{"type":"text","value":" and CodeSandbox:","position":{"start":{"line":225,"column":131,"offset":9569},"end":{"line":225,"column":148,"offset":9586},"indent":[]}}],"position":{"start":{"line":225,"column":1,"offset":9439},"end":{"line":225,"column":148,"offset":9586},"indent":[]}},{"type":"jsx","value":"<a href=\"https://codesandbox.io/s/github/apollographql/docs-examples/tree/main/apollo-server/v2/subscriptions?fontsize=14&hidenavigation=1&theme=dark\">\n  <img alt=\"Edit server-subscriptions\" src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" />\n</a>","position":{"start":{"line":227,"column":1,"offset":9588},"end":{"line":229,"column":5,"offset":9847},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The server exposes one subscription (","position":{"start":{"line":232,"column":1,"offset":9850},"end":{"line":232,"column":38,"offset":9887},"indent":[]}},{"type":"inlineCode","value":"numberIncremented","position":{"start":{"line":232,"column":38,"offset":9887},"end":{"line":232,"column":57,"offset":9906},"indent":[]}},{"type":"text","value":") that returns an integer that's incremented on the server every second. The example requires only the ","position":{"start":{"line":232,"column":57,"offset":9906},"end":{"line":232,"column":160,"offset":10009},"indent":[]}},{"type":"inlineCode","value":"apollo-server","position":{"start":{"line":232,"column":160,"offset":10009},"end":{"line":232,"column":175,"offset":10024},"indent":[]}},{"type":"text","value":" library.","position":{"start":{"line":232,"column":175,"offset":10024},"end":{"line":232,"column":184,"offset":10033},"indent":[]}}],"position":{"start":{"line":232,"column":1,"offset":9850},"end":{"line":232,"column":184,"offset":10033},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After you start up this server locally, you can visit ","position":{"start":{"line":234,"column":1,"offset":10035},"end":{"line":234,"column":55,"offset":10089},"indent":[]}},{"type":"inlineCode","value":"http://localhost:4000","position":{"start":{"line":234,"column":55,"offset":10089},"end":{"line":234,"column":78,"offset":10112},"indent":[]}},{"type":"text","value":" to test out running the ","position":{"start":{"line":234,"column":78,"offset":10112},"end":{"line":234,"column":103,"offset":10137},"indent":[]}},{"type":"inlineCode","value":"numberIncremented","position":{"start":{"line":234,"column":103,"offset":10137},"end":{"line":234,"column":122,"offset":10156},"indent":[]}},{"type":"text","value":" subscription in GraphQL Playground. You'll see the subscription's value update every second.","position":{"start":{"line":234,"column":122,"offset":10156},"end":{"line":234,"column":215,"offset":10249},"indent":[]}}],"position":{"start":{"line":234,"column":1,"offset":10035},"end":{"line":234,"column":215,"offset":10249},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Operation context","position":{"start":{"line":236,"column":4,"offset":10254},"end":{"line":236,"column":21,"offset":10271},"indent":[]}}],"position":{"start":{"line":236,"column":1,"offset":10251},"end":{"line":236,"column":21,"offset":10271},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When ","position":{"start":{"line":238,"column":1,"offset":10273},"end":{"line":238,"column":6,"offset":10278},"indent":[]}},{"type":"link","title":null,"url":"../data/resolvers/#the-context-argument","children":[{"type":"text","value":"initializing context","position":{"start":{"line":238,"column":7,"offset":10279},"end":{"line":238,"column":27,"offset":10299},"indent":[]}}],"position":{"start":{"line":238,"column":6,"offset":10278},"end":{"line":238,"column":69,"offset":10341},"indent":[]}},{"type":"text","value":" for a query or mutation, you usually extract HTTP headers and other request metadata from the ","position":{"start":{"line":238,"column":69,"offset":10341},"end":{"line":238,"column":164,"offset":10436},"indent":[]}},{"type":"inlineCode","value":"req","position":{"start":{"line":238,"column":164,"offset":10436},"end":{"line":238,"column":169,"offset":10441},"indent":[]}},{"type":"text","value":" object provided to the ","position":{"start":{"line":238,"column":169,"offset":10441},"end":{"line":238,"column":193,"offset":10465},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":238,"column":193,"offset":10465},"end":{"line":238,"column":202,"offset":10474},"indent":[]}},{"type":"text","value":" function.","position":{"start":{"line":238,"column":202,"offset":10474},"end":{"line":238,"column":212,"offset":10484},"indent":[]}}],"position":{"start":{"line":238,"column":1,"offset":10273},"end":{"line":238,"column":212,"offset":10484},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"For subscriptions,","position":{"start":{"line":240,"column":3,"offset":10488},"end":{"line":240,"column":21,"offset":10506},"indent":[]}}],"position":{"start":{"line":240,"column":1,"offset":10486},"end":{"line":240,"column":23,"offset":10508},"indent":[]}},{"type":"text","value":" you extract this metadata from the ","position":{"start":{"line":240,"column":23,"offset":10508},"end":{"line":240,"column":59,"offset":10544},"indent":[]}},{"type":"inlineCode","value":"connection","position":{"start":{"line":240,"column":59,"offset":10544},"end":{"line":240,"column":71,"offset":10556},"indent":[]}},{"type":"text","value":" object instead. This object adheres to the ","position":{"start":{"line":240,"column":71,"offset":10556},"end":{"line":240,"column":115,"offset":10600},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/subscriptions-transport-ws/blob/817e7de3a23db2b4d64eb846724175dba74025d0/src/server.ts#L24-L33","children":[{"type":"inlineCode","value":"ExecutionParams","position":{"start":{"line":240,"column":116,"offset":10601},"end":{"line":240,"column":133,"offset":10618},"indent":[]}},{"type":"text","value":" interface","position":{"start":{"line":240,"column":133,"offset":10618},"end":{"line":240,"column":143,"offset":10628},"indent":[]}}],"position":{"start":{"line":240,"column":115,"offset":10600},"end":{"line":240,"column":273,"offset":10758},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":240,"column":273,"offset":10758},"end":{"line":240,"column":274,"offset":10759},"indent":[]}}],"position":{"start":{"line":240,"column":1,"offset":10486},"end":{"line":240,"column":274,"offset":10759},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Because all operation types use the same ","position":{"start":{"line":242,"column":1,"offset":10761},"end":{"line":242,"column":42,"offset":10802},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":242,"column":42,"offset":10802},"end":{"line":242,"column":51,"offset":10811},"indent":[]}},{"type":"text","value":" initialization function, you should check which of ","position":{"start":{"line":242,"column":51,"offset":10811},"end":{"line":242,"column":103,"offset":10863},"indent":[]}},{"type":"inlineCode","value":"req","position":{"start":{"line":242,"column":103,"offset":10863},"end":{"line":242,"column":108,"offset":10868},"indent":[]}},{"type":"text","value":" or ","position":{"start":{"line":242,"column":108,"offset":10868},"end":{"line":242,"column":112,"offset":10872},"indent":[]}},{"type":"inlineCode","value":"connection","position":{"start":{"line":242,"column":112,"offset":10872},"end":{"line":242,"column":124,"offset":10884},"indent":[]}},{"type":"text","value":" is present for each incoming request:","position":{"start":{"line":242,"column":124,"offset":10884},"end":{"line":242,"column":162,"offset":10922},"indent":[]}}],"position":{"start":{"line":242,"column":1,"offset":10761},"end":{"line":242,"column":162,"offset":10922},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const server = new ApolloServer({\n  context: ({ req, connection }) => {\n    if (connection) { // Operation is a Subscription\n      // Obtain connectionParams-provided token from connection.context\n      const token = connection.context.authorization || \"\";\n      return { token };\n    } else { // Operation is a Query/Mutation\n      // Obtain header-provided token from req.headers\n      const token = req.headers.authorization || \"\";\n      return { token };\n    }\n  },\n});","position":{"start":{"line":244,"column":1,"offset":10924},"end":{"line":258,"column":4,"offset":11407},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This is especially important because metadata like auth tokens are sent differently depending on the transport.","position":{"start":{"line":260,"column":1,"offset":11409},"end":{"line":260,"column":112,"offset":11520},"indent":[]}}],"position":{"start":{"line":260,"column":1,"offset":11409},"end":{"line":260,"column":112,"offset":11520},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"inlineCode","value":"onConnect","position":{"start":{"line":262,"column":4,"offset":11525},"end":{"line":262,"column":15,"offset":11536},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":262,"column":15,"offset":11536},"end":{"line":262,"column":20,"offset":11541},"indent":[]}},{"type":"inlineCode","value":"onDisconnect","position":{"start":{"line":262,"column":20,"offset":11541},"end":{"line":262,"column":34,"offset":11555},"indent":[]}}],"position":{"start":{"line":262,"column":1,"offset":11522},"end":{"line":262,"column":34,"offset":11555},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can define functions that Apollo Server executes whenever a subscription request connects (","position":{"start":{"line":264,"column":1,"offset":11557},"end":{"line":264,"column":96,"offset":11652},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":264,"column":96,"offset":11652},"end":{"line":264,"column":107,"offset":11663},"indent":[]}},{"type":"text","value":") or disconnects (","position":{"start":{"line":264,"column":107,"offset":11663},"end":{"line":264,"column":125,"offset":11681},"indent":[]}},{"type":"inlineCode","value":"onDisconnect","position":{"start":{"line":264,"column":125,"offset":11681},"end":{"line":264,"column":139,"offset":11695},"indent":[]}},{"type":"text","value":").","position":{"start":{"line":264,"column":139,"offset":11695},"end":{"line":264,"column":141,"offset":11697},"indent":[]}}],"position":{"start":{"line":264,"column":1,"offset":11557},"end":{"line":264,"column":141,"offset":11697},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Defining an ","position":{"start":{"line":266,"column":1,"offset":11699},"end":{"line":266,"column":13,"offset":11711},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":266,"column":13,"offset":11711},"end":{"line":266,"column":24,"offset":11722},"indent":[]}},{"type":"text","value":" function provides the following benefits:","position":{"start":{"line":266,"column":24,"offset":11722},"end":{"line":266,"column":66,"offset":11764},"indent":[]}}],"position":{"start":{"line":266,"column":1,"offset":11699},"end":{"line":266,"column":66,"offset":11764},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can reject a particular incoming connection by throwing an exception or returning ","position":{"start":{"line":268,"column":3,"offset":11768},"end":{"line":268,"column":89,"offset":11854},"indent":[]}},{"type":"inlineCode","value":"false","position":{"start":{"line":268,"column":89,"offset":11854},"end":{"line":268,"column":96,"offset":11861},"indent":[]}},{"type":"text","value":" in ","position":{"start":{"line":268,"column":96,"offset":11861},"end":{"line":268,"column":100,"offset":11865},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":268,"column":100,"offset":11865},"end":{"line":268,"column":111,"offset":11876},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":268,"column":111,"offset":11876},"end":{"line":268,"column":112,"offset":11877},"indent":[]}}],"position":{"start":{"line":268,"column":3,"offset":11768},"end":{"line":268,"column":112,"offset":11877},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This is especially useful for ","position":{"start":{"line":269,"column":5,"offset":11882},"end":{"line":269,"column":35,"offset":11912},"indent":[]}},{"type":"link","title":null,"url":"#example-authentication-with-onconnect","children":[{"type":"text","value":"authentication","position":{"start":{"line":269,"column":36,"offset":11913},"end":{"line":269,"column":50,"offset":11927},"indent":[]}}],"position":{"start":{"line":269,"column":35,"offset":11912},"end":{"line":269,"column":91,"offset":11968},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":269,"column":91,"offset":11968},"end":{"line":269,"column":92,"offset":11969},"indent":[]}}],"position":{"start":{"line":269,"column":5,"offset":11882},"end":{"line":269,"column":92,"offset":11969},"indent":[]}}],"position":{"start":{"line":269,"column":3,"offset":11880},"end":{"line":269,"column":92,"offset":11969},"indent":[]}}],"position":{"start":{"line":269,"column":3,"offset":11880},"end":{"line":269,"column":92,"offset":11969},"indent":[]}}],"position":{"start":{"line":268,"column":1,"offset":11766},"end":{"line":269,"column":92,"offset":11969},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If ","position":{"start":{"line":270,"column":3,"offset":11972},"end":{"line":270,"column":6,"offset":11975},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":270,"column":6,"offset":11975},"end":{"line":270,"column":17,"offset":11986},"indent":[]}},{"type":"text","value":" returns an object, that object's fields are added to the WebSocket connection's ","position":{"start":{"line":270,"column":17,"offset":11986},"end":{"line":270,"column":98,"offset":12067},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":270,"column":98,"offset":12067},"end":{"line":270,"column":107,"offset":12076},"indent":[]}},{"type":"text","value":" object.","position":{"start":{"line":270,"column":107,"offset":12076},"end":{"line":270,"column":115,"offset":12084},"indent":[]}}],"position":{"start":{"line":270,"column":3,"offset":11972},"end":{"line":270,"column":115,"offset":12084},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This is ","position":{"start":{"line":271,"column":5,"offset":12089},"end":{"line":271,"column":13,"offset":12097},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":271,"column":14,"offset":12098},"end":{"line":271,"column":17,"offset":12101},"indent":[]}}],"position":{"start":{"line":271,"column":13,"offset":12097},"end":{"line":271,"column":18,"offset":12102},"indent":[]}},{"type":"text","value":" the ","position":{"start":{"line":271,"column":18,"offset":12102},"end":{"line":271,"column":23,"offset":12107},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"operation","position":{"start":{"line":271,"column":24,"offset":12108},"end":{"line":271,"column":33,"offset":12117},"indent":[]}}],"position":{"start":{"line":271,"column":23,"offset":12107},"end":{"line":271,"column":34,"offset":12118},"indent":[]}},{"type":"text","value":" ","position":{"start":{"line":271,"column":34,"offset":12118},"end":{"line":271,"column":35,"offset":12119},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":271,"column":35,"offset":12119},"end":{"line":271,"column":44,"offset":12128},"indent":[]}},{"type":"text","value":" that's passed between resolvers. However, you can transfer these values from the ","position":{"start":{"line":271,"column":44,"offset":12128},"end":{"line":271,"column":126,"offset":12210},"indent":[]}},{"type":"inlineCode","value":"connection","position":{"start":{"line":271,"column":126,"offset":12210},"end":{"line":271,"column":138,"offset":12222},"indent":[]}},{"type":"text","value":"'s ","position":{"start":{"line":271,"column":138,"offset":12222},"end":{"line":271,"column":141,"offset":12225},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":271,"column":141,"offset":12225},"end":{"line":271,"column":150,"offset":12234},"indent":[]}},{"type":"text","value":" when you ","position":{"start":{"line":271,"column":150,"offset":12234},"end":{"line":271,"column":160,"offset":12244},"indent":[]}},{"type":"link","title":null,"url":"#operation-context","children":[{"type":"text","value":"initialize operation context","position":{"start":{"line":271,"column":161,"offset":12245},"end":{"line":271,"column":189,"offset":12273},"indent":[]}}],"position":{"start":{"line":271,"column":160,"offset":12244},"end":{"line":271,"column":210,"offset":12294},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":271,"column":210,"offset":12294},"end":{"line":271,"column":211,"offset":12295},"indent":[]}}],"position":{"start":{"line":271,"column":5,"offset":12089},"end":{"line":271,"column":211,"offset":12295},"indent":[]}}],"position":{"start":{"line":271,"column":3,"offset":12087},"end":{"line":271,"column":211,"offset":12295},"indent":[]}}],"position":{"start":{"line":271,"column":3,"offset":12087},"end":{"line":271,"column":211,"offset":12295},"indent":[]}}],"position":{"start":{"line":270,"column":1,"offset":11970},"end":{"line":271,"column":211,"offset":12295},"indent":[1]}}],"position":{"start":{"line":268,"column":1,"offset":11766},"end":{"line":271,"column":211,"offset":12295},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You provide these function definitions to the constructor of ","position":{"start":{"line":273,"column":1,"offset":12297},"end":{"line":273,"column":62,"offset":12358},"indent":[]}},{"type":"inlineCode","value":"ApolloServer","position":{"start":{"line":273,"column":62,"offset":12358},"end":{"line":273,"column":76,"offset":12372},"indent":[]}},{"type":"text","value":", like so:","position":{"start":{"line":273,"column":76,"offset":12372},"end":{"line":273,"column":86,"offset":12382},"indent":[]}}],"position":{"start":{"line":273,"column":1,"offset":12297},"end":{"line":273,"column":86,"offset":12382},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const server = new ApolloServer({\n  subscriptions: {\n    onConnect: (connectionParams, webSocket, context) => {\n      console.log('Connected!')\n    },\n    onDisconnect: (webSocket, context) => {\n      console.log('Disconnected!')\n    },\n    // ...other options...\n  },\n});","position":{"start":{"line":275,"column":1,"offset":12384},"end":{"line":287,"column":4,"offset":12666},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"These functions are passed the following parameters:","position":{"start":{"line":289,"column":1,"offset":12668},"end":{"line":289,"column":53,"offset":12720},"indent":[]}}],"position":{"start":{"line":289,"column":1,"offset":12668},"end":{"line":289,"column":53,"offset":12720},"indent":[]}},{"type":"jsx","value":"<table class=\"field-table\">\n  <thead>\n    <tr>\n      <th>Name /<br/>Type</th>\n      <th>Description</th>\n    </tr>\n  </thead>","position":{"start":{"line":291,"column":1,"offset":12722},"end":{"line":297,"column":11,"offset":12847},"indent":[1,1,1,1,1,1]}},{"type":"jsx","value":"<tbody>\n<tr>\n<td>","position":{"start":{"line":299,"column":1,"offset":12849},"end":{"line":301,"column":5,"offset":12866},"indent":[1,1]}},{"type":"heading","depth":6,"children":[{"type":"inlineCode","value":"connectionParams","position":{"start":{"line":303,"column":8,"offset":12875},"end":{"line":303,"column":26,"offset":12893},"indent":[]}}],"position":{"start":{"line":303,"column":1,"offset":12868},"end":{"line":303,"column":26,"offset":12893},"indent":[]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"Object","position":{"start":{"line":305,"column":1,"offset":12895},"end":{"line":305,"column":9,"offset":12903},"indent":[]}}],"position":{"start":{"line":305,"column":1,"offset":12895},"end":{"line":305,"column":9,"offset":12903},"indent":[]}},{"type":"jsx","value":"</td>\n<td>","position":{"start":{"line":307,"column":1,"offset":12905},"end":{"line":308,"column":5,"offset":12915},"indent":[1]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Passed to ","position":{"start":{"line":310,"column":3,"offset":12919},"end":{"line":310,"column":13,"offset":12929},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":310,"column":13,"offset":12929},"end":{"line":310,"column":24,"offset":12940},"indent":[]}},{"type":"text","value":" only.","position":{"start":{"line":310,"column":24,"offset":12940},"end":{"line":310,"column":30,"offset":12946},"indent":[]}}],"position":{"start":{"line":310,"column":1,"offset":12917},"end":{"line":310,"column":32,"offset":12948},"indent":[]}}],"position":{"start":{"line":310,"column":1,"offset":12917},"end":{"line":310,"column":32,"offset":12948},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An object containing parameters included in the request, such as an ","position":{"start":{"line":312,"column":1,"offset":12950},"end":{"line":312,"column":69,"offset":13018},"indent":[]}},{"type":"link","title":null,"url":"#example-authentication-with-onconnect","children":[{"type":"text","value":"authentication token","position":{"start":{"line":312,"column":70,"offset":13019},"end":{"line":312,"column":90,"offset":13039},"indent":[]}}],"position":{"start":{"line":312,"column":69,"offset":13018},"end":{"line":312,"column":131,"offset":13080},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":312,"column":131,"offset":13080},"end":{"line":312,"column":132,"offset":13081},"indent":[]}}],"position":{"start":{"line":312,"column":1,"offset":12950},"end":{"line":312,"column":132,"offset":13081},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For details, see ","position":{"start":{"line":314,"column":1,"offset":13083},"end":{"line":314,"column":18,"offset":13100},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/data/subscriptions/#4-authenticate-over-websocket-optional","children":[{"type":"text","value":"Authenticate over WebSocket","position":{"start":{"line":314,"column":19,"offset":13101},"end":{"line":314,"column":46,"offset":13128},"indent":[]}}],"position":{"start":{"line":314,"column":18,"offset":13100},"end":{"line":314,"column":148,"offset":13230},"indent":[]}},{"type":"text","value":" in the Apollo Client documentation.","position":{"start":{"line":314,"column":148,"offset":13230},"end":{"line":314,"column":184,"offset":13266},"indent":[]}}],"position":{"start":{"line":314,"column":1,"offset":13083},"end":{"line":314,"column":184,"offset":13266},"indent":[]}},{"type":"jsx","value":"</td>\n</tr>","position":{"start":{"line":316,"column":1,"offset":13268},"end":{"line":317,"column":6,"offset":13279},"indent":[1]}},{"type":"jsx","value":"<tr>\n<td>","position":{"start":{"line":319,"column":1,"offset":13281},"end":{"line":320,"column":5,"offset":13290},"indent":[1]}},{"type":"heading","depth":6,"children":[{"type":"inlineCode","value":"webSocket","position":{"start":{"line":322,"column":8,"offset":13299},"end":{"line":322,"column":19,"offset":13310},"indent":[]}}],"position":{"start":{"line":322,"column":1,"offset":13292},"end":{"line":322,"column":19,"offset":13310},"indent":[]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"WebSocket","position":{"start":{"line":324,"column":1,"offset":13312},"end":{"line":324,"column":12,"offset":13323},"indent":[]}}],"position":{"start":{"line":324,"column":1,"offset":13312},"end":{"line":324,"column":12,"offset":13323},"indent":[]}},{"type":"jsx","value":"</td>\n<td>","position":{"start":{"line":325,"column":1,"offset":13324},"end":{"line":326,"column":5,"offset":13334},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"The connecting or disconnecting ","position":{"start":{"line":328,"column":1,"offset":13336},"end":{"line":328,"column":33,"offset":13368},"indent":[]}},{"type":"link","title":null,"url":"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket","children":[{"type":"inlineCode","value":"WebSocket","position":{"start":{"line":328,"column":34,"offset":13369},"end":{"line":328,"column":45,"offset":13380},"indent":[]}}],"position":{"start":{"line":328,"column":33,"offset":13368},"end":{"line":328,"column":106,"offset":13441},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":328,"column":106,"offset":13441},"end":{"line":328,"column":107,"offset":13442},"indent":[]}}],"position":{"start":{"line":328,"column":1,"offset":13336},"end":{"line":328,"column":107,"offset":13442},"indent":[]}},{"type":"jsx","value":"</td>\n</tr>","position":{"start":{"line":330,"column":1,"offset":13444},"end":{"line":331,"column":6,"offset":13455},"indent":[1]}},{"type":"jsx","value":"<tr>\n<td>","position":{"start":{"line":333,"column":1,"offset":13457},"end":{"line":334,"column":5,"offset":13466},"indent":[1]}},{"type":"heading","depth":6,"children":[{"type":"inlineCode","value":"context","position":{"start":{"line":336,"column":8,"offset":13475},"end":{"line":336,"column":17,"offset":13484},"indent":[]}}],"position":{"start":{"line":336,"column":1,"offset":13468},"end":{"line":336,"column":17,"offset":13484},"indent":[]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"ConnectionContext","position":{"start":{"line":338,"column":1,"offset":13486},"end":{"line":338,"column":20,"offset":13505},"indent":[]}}],"position":{"start":{"line":338,"column":1,"offset":13486},"end":{"line":338,"column":20,"offset":13505},"indent":[]}},{"type":"jsx","value":"</td>\n<td>","position":{"start":{"line":339,"column":1,"offset":13506},"end":{"line":340,"column":5,"offset":13516},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"Context object for the WebSocket connection. This is ","position":{"start":{"line":342,"column":1,"offset":13518},"end":{"line":342,"column":54,"offset":13571},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":342,"column":55,"offset":13572},"end":{"line":342,"column":58,"offset":13575},"indent":[]}}],"position":{"start":{"line":342,"column":54,"offset":13571},"end":{"line":342,"column":59,"offset":13576},"indent":[]}},{"type":"text","value":" the ","position":{"start":{"line":342,"column":59,"offset":13576},"end":{"line":342,"column":64,"offset":13581},"indent":[]}},{"type":"inlineCode","value":"context","position":{"start":{"line":342,"column":64,"offset":13581},"end":{"line":342,"column":73,"offset":13590},"indent":[]}},{"type":"text","value":" object for the associated subscription operation.","position":{"start":{"line":342,"column":73,"offset":13590},"end":{"line":342,"column":123,"offset":13640},"indent":[]}}],"position":{"start":{"line":342,"column":1,"offset":13518},"end":{"line":342,"column":123,"offset":13640},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/apollographql/subscriptions-transport-ws/blob/master/src/server.ts#L35-L43","children":[{"type":"text","value":"See fields","position":{"start":{"line":344,"column":2,"offset":13643},"end":{"line":344,"column":12,"offset":13653},"indent":[]}}],"position":{"start":{"line":344,"column":1,"offset":13642},"end":{"line":344,"column":108,"offset":13749},"indent":[]}}],"position":{"start":{"line":344,"column":1,"offset":13642},"end":{"line":344,"column":108,"offset":13749},"indent":[]}},{"type":"jsx","value":"</td>\n</tr>","position":{"start":{"line":346,"column":1,"offset":13751},"end":{"line":347,"column":6,"offset":13762},"indent":[1]}},{"type":"jsx","value":"</tbody>\n</table>","position":{"start":{"line":349,"column":1,"offset":13764},"end":{"line":350,"column":9,"offset":13781},"indent":[1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Example: Authentication with ","position":{"start":{"line":352,"column":5,"offset":13787},"end":{"line":352,"column":34,"offset":13816},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":352,"column":34,"offset":13816},"end":{"line":352,"column":45,"offset":13827},"indent":[]}}],"position":{"start":{"line":352,"column":1,"offset":13783},"end":{"line":352,"column":45,"offset":13827},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"On the client, ","position":{"start":{"line":354,"column":1,"offset":13829},"end":{"line":354,"column":16,"offset":13844},"indent":[]}},{"type":"inlineCode","value":"SubscriptionsClient","position":{"start":{"line":354,"column":16,"offset":13844},"end":{"line":354,"column":37,"offset":13865},"indent":[]}},{"type":"text","value":" supports adding token information to ","position":{"start":{"line":354,"column":37,"offset":13865},"end":{"line":354,"column":75,"offset":13903},"indent":[]}},{"type":"inlineCode","value":"connectionParams","position":{"start":{"line":354,"column":75,"offset":13903},"end":{"line":354,"column":93,"offset":13921},"indent":[]}},{"type":"text","value":" (","position":{"start":{"line":354,"column":93,"offset":13921},"end":{"line":354,"column":95,"offset":13923},"indent":[]}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/advanced/subscriptions/#authentication-over-websocket","children":[{"type":"text","value":"example","position":{"start":{"line":354,"column":96,"offset":13924},"end":{"line":354,"column":103,"offset":13931},"indent":[]}}],"position":{"start":{"line":354,"column":95,"offset":13923},"end":{"line":354,"column":200,"offset":14028},"indent":[]}},{"type":"text","value":") that will be sent with the first WebSocket message. In the server, all GraphQL subscriptions are delayed until the connection has been fully authenticated and the ","position":{"start":{"line":354,"column":200,"offset":14028},"end":{"line":354,"column":365,"offset":14193},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":354,"column":365,"offset":14193},"end":{"line":354,"column":376,"offset":14204},"indent":[]}},{"type":"text","value":" callback returns a truthy value.","position":{"start":{"line":354,"column":376,"offset":14204},"end":{"line":354,"column":409,"offset":14237},"indent":[]}}],"position":{"start":{"line":354,"column":1,"offset":13829},"end":{"line":354,"column":409,"offset":14237},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":356,"column":1,"offset":14239},"end":{"line":356,"column":5,"offset":14243},"indent":[]}},{"type":"inlineCode","value":"connectionParams","position":{"start":{"line":356,"column":5,"offset":14243},"end":{"line":356,"column":23,"offset":14261},"indent":[]}},{"type":"text","value":" argument in the ","position":{"start":{"line":356,"column":23,"offset":14261},"end":{"line":356,"column":40,"offset":14278},"indent":[]}},{"type":"inlineCode","value":"onConnect","position":{"start":{"line":356,"column":40,"offset":14278},"end":{"line":356,"column":51,"offset":14289},"indent":[]}},{"type":"text","value":" callback contains the information passed by the client and can be used to validate user credentials.\nThe GraphQL context can also be extended with the authenticated user data to enable fine grain authorization.","position":{"start":{"line":356,"column":51,"offset":14289},"end":{"line":357,"column":110,"offset":14500},"indent":[1]}}],"position":{"start":{"line":356,"column":1,"offset":14239},"end":{"line":357,"column":110,"offset":14500},"indent":[1]}},{"type":"code","lang":"js","meta":null,"value":"const { ApolloServer } = require('apollo-server');\nconst { resolvers, typeDefs } = require('./schema');\n\nconst validateToken = authToken => {\n  // ... validate token and return a Promise, rejects in case of an error\n};\n\nconst findUser = authToken => {\n  return tokenValidationResult => {\n    // ... finds user by auth token and return a Promise, rejects in case of an error\n  };\n};\n\nconst server = new ApolloServer({\n  typeDefs,\n  resolvers,\n  subscriptions: {\n    onConnect: (connectionParams, webSocket) => {\n      if (connectionParams.authToken) {\n        return validateToken(connectionParams.authToken)\n          .then(findUser(connectionParams.authToken))\n          .then(user => {\n            return {\n              currentUser: user,\n            };\n          });\n      }\n\n      throw new Error('Missing auth token!');\n    },\n  },\n});\n\nserver.listen().then(({ url, subscriptionsUrl }) => {\n  console.log(` Server ready at ${url}`);\n  console.log(` Subscriptions ready at ${subscriptionsUrl}`);\n});","position":{"start":{"line":359,"column":1,"offset":14502},"end":{"line":397,"column":4,"offset":15520},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The example above validates the user's token that is sent with the first initialization message on the transport, then it looks up the user and returns the user object as a Promise. The user object found will be available as ","position":{"start":{"line":399,"column":1,"offset":15522},"end":{"line":399,"column":226,"offset":15747},"indent":[]}},{"type":"inlineCode","value":"context.currentUser","position":{"start":{"line":399,"column":226,"offset":15747},"end":{"line":399,"column":247,"offset":15768},"indent":[]}},{"type":"text","value":" in your GraphQL resolvers.","position":{"start":{"line":399,"column":247,"offset":15768},"end":{"line":399,"column":274,"offset":15795},"indent":[]}}],"position":{"start":{"line":399,"column":1,"offset":15522},"end":{"line":399,"column":274,"offset":15795},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In case of an authentication error, the Promise will be rejected, which prevents the client's connection.","position":{"start":{"line":401,"column":1,"offset":15797},"end":{"line":401,"column":106,"offset":15902},"indent":[]}}],"position":{"start":{"line":401,"column":1,"offset":15797},"end":{"line":401,"column":106,"offset":15902},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Using with middleware integrations","position":{"start":{"line":404,"column":4,"offset":15908},"end":{"line":404,"column":38,"offset":15942},"indent":[]}}],"position":{"start":{"line":404,"column":1,"offset":15905},"end":{"line":404,"column":38,"offset":15942},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use subscriptions with any of Apollo Server's supported ","position":{"start":{"line":406,"column":1,"offset":15944},"end":{"line":406,"column":65,"offset":16008},"indent":[]}},{"type":"link","title":null,"url":"../integrations/middleware/","children":[{"type":"text","value":"middleware integrations","position":{"start":{"line":406,"column":66,"offset":16009},"end":{"line":406,"column":89,"offset":16032},"indent":[]}}],"position":{"start":{"line":406,"column":65,"offset":16008},"end":{"line":406,"column":119,"offset":16062},"indent":[]}},{"type":"text","value":". To do so, you call ","position":{"start":{"line":406,"column":119,"offset":16062},"end":{"line":406,"column":140,"offset":16083},"indent":[]}},{"type":"inlineCode","value":"installSubscriptionHandlers","position":{"start":{"line":406,"column":140,"offset":16083},"end":{"line":406,"column":169,"offset":16112},"indent":[]}},{"type":"text","value":" on your ","position":{"start":{"line":406,"column":169,"offset":16112},"end":{"line":406,"column":178,"offset":16121},"indent":[]}},{"type":"inlineCode","value":"ApolloServer","position":{"start":{"line":406,"column":178,"offset":16121},"end":{"line":406,"column":192,"offset":16135},"indent":[]}},{"type":"text","value":" instance.","position":{"start":{"line":406,"column":192,"offset":16135},"end":{"line":406,"column":202,"offset":16145},"indent":[]}}],"position":{"start":{"line":406,"column":1,"offset":15944},"end":{"line":406,"column":202,"offset":16145},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This example enables subscriptions for an Express server that uses ","position":{"start":{"line":408,"column":1,"offset":16147},"end":{"line":408,"column":68,"offset":16214},"indent":[]}},{"type":"inlineCode","value":"apollo-server-express","position":{"start":{"line":408,"column":68,"offset":16214},"end":{"line":408,"column":91,"offset":16237},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":408,"column":91,"offset":16237},"end":{"line":408,"column":92,"offset":16238},"indent":[]}}],"position":{"start":{"line":408,"column":1,"offset":16147},"end":{"line":408,"column":92,"offset":16238},"indent":[]}},{"type":"code","lang":"js","meta":null,"value":"const http = require('http');\nconst { ApolloServer } = require('apollo-server-express');\nconst express = require('express');\n\nasync function startApolloServer() {\n  const PORT = 4000;\n  const app = express();\n  const server = new ApolloServer({ typeDefs, resolvers });\n  await server.start();\n  server.applyMiddleware({app})\n\n  const httpServer = http.createServer(app);\n  server.installSubscriptionHandlers(httpServer); // highlight-line\n\n  // Make sure to call listen on httpServer, NOT on app.\n  await new Promise(resolve => httpServer.listen(PORT, resolve));\n  console.log(` Server ready at http://localhost:${PORT}${server.graphqlPath}`);\n  console.log(` Subscriptions ready at ws://localhost:${PORT}${server.subscriptionsPath}`);\n  return { server, app, httpServer };\n}","position":{"start":{"line":410,"column":1,"offset":16240},"end":{"line":431,"column":4,"offset":17029},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Production ","position":{"start":{"line":433,"column":4,"offset":17034},"end":{"line":433,"column":15,"offset":17045},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":433,"column":15,"offset":17045},"end":{"line":433,"column":23,"offset":17053},"indent":[]}},{"type":"text","value":" libraries","position":{"start":{"line":433,"column":23,"offset":17053},"end":{"line":433,"column":33,"offset":17063},"indent":[]}}],"position":{"start":{"line":433,"column":1,"offset":17031},"end":{"line":433,"column":33,"offset":17063},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"#the-pubsub-class","children":[{"type":"text","value":"As mentioned above","position":{"start":{"line":435,"column":2,"offset":17066},"end":{"line":435,"column":20,"offset":17084},"indent":[]}}],"position":{"start":{"line":435,"column":1,"offset":17065},"end":{"line":435,"column":40,"offset":17104},"indent":[]}},{"type":"text","value":", the ","position":{"start":{"line":435,"column":40,"offset":17104},"end":{"line":435,"column":46,"offset":17110},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":435,"column":46,"offset":17110},"end":{"line":435,"column":54,"offset":17118},"indent":[]}},{"type":"text","value":" class is ","position":{"start":{"line":435,"column":54,"offset":17118},"end":{"line":435,"column":64,"offset":17128},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":435,"column":65,"offset":17129},"end":{"line":435,"column":68,"offset":17132},"indent":[]}}],"position":{"start":{"line":435,"column":64,"offset":17128},"end":{"line":435,"column":69,"offset":17133},"indent":[]}},{"type":"text","value":" recommended for production environments, because its event-publishing system is in-memory. This means that events published by ","position":{"start":{"line":435,"column":69,"offset":17133},"end":{"line":435,"column":197,"offset":17261},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"one","position":{"start":{"line":435,"column":198,"offset":17262},"end":{"line":435,"column":201,"offset":17265},"indent":[]}}],"position":{"start":{"line":435,"column":197,"offset":17261},"end":{"line":435,"column":202,"offset":17266},"indent":[]}},{"type":"text","value":" instance of your GraphQL server are not received by subscriptions that are handled by ","position":{"start":{"line":435,"column":202,"offset":17266},"end":{"line":435,"column":289,"offset":17353},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"other","position":{"start":{"line":435,"column":290,"offset":17354},"end":{"line":435,"column":295,"offset":17359},"indent":[]}}],"position":{"start":{"line":435,"column":289,"offset":17353},"end":{"line":435,"column":296,"offset":17360},"indent":[]}},{"type":"text","value":" instances.","position":{"start":{"line":435,"column":296,"offset":17360},"end":{"line":435,"column":307,"offset":17371},"indent":[]}}],"position":{"start":{"line":435,"column":1,"offset":17065},"end":{"line":435,"column":307,"offset":17371},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Instead, you should use a subclass of the ","position":{"start":{"line":437,"column":1,"offset":17373},"end":{"line":437,"column":43,"offset":17415},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts","children":[{"type":"inlineCode","value":"PubSubEngine","position":{"start":{"line":437,"column":44,"offset":17416},"end":{"line":437,"column":58,"offset":17430},"indent":[]}},{"type":"text","value":" abstract class","position":{"start":{"line":437,"column":58,"offset":17430},"end":{"line":437,"column":73,"offset":17445},"indent":[]}}],"position":{"start":{"line":437,"column":43,"offset":17415},"end":{"line":437,"column":163,"offset":17535},"indent":[]}},{"type":"text","value":" that you can back with an external datastore such as Redis or Kafka.","position":{"start":{"line":437,"column":163,"offset":17535},"end":{"line":437,"column":232,"offset":17604},"indent":[]}}],"position":{"start":{"line":437,"column":1,"offset":17373},"end":{"line":437,"column":232,"offset":17604},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The following are community-created ","position":{"start":{"line":439,"column":1,"offset":17606},"end":{"line":439,"column":37,"offset":17642},"indent":[]}},{"type":"inlineCode","value":"PubSub","position":{"start":{"line":439,"column":37,"offset":17642},"end":{"line":439,"column":45,"offset":17650},"indent":[]}},{"type":"text","value":" libraries for popular event-publishing systems:","position":{"start":{"line":439,"column":45,"offset":17650},"end":{"line":439,"column":93,"offset":17698},"indent":[]}}],"position":{"start":{"line":439,"column":1,"offset":17606},"end":{"line":439,"column":93,"offset":17698},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/davidyaha/graphql-redis-subscriptions","children":[{"type":"text","value":"Redis","position":{"start":{"line":441,"column":4,"offset":17703},"end":{"line":441,"column":9,"offset":17708},"indent":[]}}],"position":{"start":{"line":441,"column":3,"offset":17702},"end":{"line":441,"column":68,"offset":17767},"indent":[]}}],"position":{"start":{"line":441,"column":3,"offset":17702},"end":{"line":441,"column":68,"offset":17767},"indent":[]}}],"position":{"start":{"line":441,"column":1,"offset":17700},"end":{"line":441,"column":68,"offset":17767},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/axelspringer/graphql-google-pubsub","children":[{"type":"text","value":"Google PubSub","position":{"start":{"line":442,"column":4,"offset":17771},"end":{"line":442,"column":17,"offset":17784},"indent":[]}}],"position":{"start":{"line":442,"column":3,"offset":17770},"end":{"line":442,"column":73,"offset":17840},"indent":[]}}],"position":{"start":{"line":442,"column":3,"offset":17770},"end":{"line":442,"column":73,"offset":17840},"indent":[]}}],"position":{"start":{"line":442,"column":1,"offset":17768},"end":{"line":442,"column":73,"offset":17840},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/davidyaha/graphql-mqtt-subscriptions","children":[{"type":"text","value":"MQTT enabled broker","position":{"start":{"line":443,"column":4,"offset":17844},"end":{"line":443,"column":23,"offset":17863},"indent":[]}}],"position":{"start":{"line":443,"column":3,"offset":17843},"end":{"line":443,"column":81,"offset":17921},"indent":[]}}],"position":{"start":{"line":443,"column":3,"offset":17843},"end":{"line":443,"column":81,"offset":17921},"indent":[]}}],"position":{"start":{"line":443,"column":1,"offset":17841},"end":{"line":443,"column":81,"offset":17921},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/cdmbase/graphql-rabbitmq-subscriptions","children":[{"type":"text","value":"RabbitMQ","position":{"start":{"line":444,"column":4,"offset":17925},"end":{"line":444,"column":12,"offset":17933},"indent":[]}}],"position":{"start":{"line":444,"column":3,"offset":17924},"end":{"line":444,"column":72,"offset":17993},"indent":[]}}],"position":{"start":{"line":444,"column":3,"offset":17924},"end":{"line":444,"column":72,"offset":17993},"indent":[]}}],"position":{"start":{"line":444,"column":1,"offset":17922},"end":{"line":444,"column":72,"offset":17993},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/ancashoria/graphql-kafka-subscriptions","children":[{"type":"text","value":"Kafka","position":{"start":{"line":445,"column":4,"offset":17997},"end":{"line":445,"column":9,"offset":18002},"indent":[]}}],"position":{"start":{"line":445,"column":3,"offset":17996},"end":{"line":445,"column":69,"offset":18062},"indent":[]}}],"position":{"start":{"line":445,"column":3,"offset":17996},"end":{"line":445,"column":69,"offset":18062},"indent":[]}}],"position":{"start":{"line":445,"column":1,"offset":17994},"end":{"line":445,"column":69,"offset":18062},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/GraphQLCollege/graphql-postgres-subscriptions","children":[{"type":"text","value":"Postgres","position":{"start":{"line":446,"column":4,"offset":18066},"end":{"line":446,"column":12,"offset":18074},"indent":[]}}],"position":{"start":{"line":446,"column":3,"offset":18065},"end":{"line":446,"column":79,"offset":18141},"indent":[]}}],"position":{"start":{"line":446,"column":3,"offset":18065},"end":{"line":446,"column":79,"offset":18141},"indent":[]}}],"position":{"start":{"line":446,"column":1,"offset":18063},"end":{"line":446,"column":79,"offset":18141},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/MrBoolean/graphql-firestore-subscriptions","children":[{"type":"text","value":"Google Cloud Firestore","position":{"start":{"line":447,"column":4,"offset":18145},"end":{"line":447,"column":26,"offset":18167},"indent":[]}}],"position":{"start":{"line":447,"column":3,"offset":18144},"end":{"line":447,"column":89,"offset":18230},"indent":[]}}],"position":{"start":{"line":447,"column":3,"offset":18144},"end":{"line":447,"column":89,"offset":18230},"indent":[]}}],"position":{"start":{"line":447,"column":1,"offset":18142},"end":{"line":447,"column":89,"offset":18230},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://github.com/ably-labs/graphql-ably-pubsub","children":[{"type":"text","value":"Ably Realtime","position":{"start":{"line":448,"column":4,"offset":18234},"end":{"line":448,"column":17,"offset":18247},"indent":[]}}],"position":{"start":{"line":448,"column":3,"offset":18233},"end":{"line":448,"column":68,"offset":18298},"indent":[]}}],"position":{"start":{"line":448,"column":3,"offset":18233},"end":{"line":448,"column":68,"offset":18298},"indent":[]}}],"position":{"start":{"line":448,"column":1,"offset":18231},"end":{"line":448,"column":68,"offset":18298},"indent":[]}}],"position":{"start":{"line":441,"column":1,"offset":17700},"end":{"line":448,"column":68,"offset":18298},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If none of these libraries fits your use case, you can also create your own ","position":{"start":{"line":450,"column":1,"offset":18300},"end":{"line":450,"column":77,"offset":18376},"indent":[]}},{"type":"inlineCode","value":"PubSubEngine","position":{"start":{"line":450,"column":77,"offset":18376},"end":{"line":450,"column":91,"offset":18390},"indent":[]}},{"type":"text","value":" subclass. If you create a new open-source library, click ","position":{"start":{"line":450,"column":91,"offset":18390},"end":{"line":450,"column":149,"offset":18448},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Edit on GitHub","position":{"start":{"line":450,"column":151,"offset":18450},"end":{"line":450,"column":165,"offset":18464},"indent":[]}}],"position":{"start":{"line":450,"column":149,"offset":18448},"end":{"line":450,"column":167,"offset":18466},"indent":[]}},{"type":"text","value":" to let us know about it!","position":{"start":{"line":450,"column":167,"offset":18466},"end":{"line":450,"column":192,"offset":18491},"indent":[]}}],"position":{"start":{"line":450,"column":1,"offset":18300},"end":{"line":450,"column":192,"offset":18491},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Subscriptions\",\"description\":\"Persistent GraphQL read operations\"}","position":{"start":{"line":453,"column":1,"offset":18494},"end":{"line":453,"column":105,"offset":18598},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":453,"column":105,"offset":18598}}},"scopeImports":["import {ExpansionPanel} from 'gatsby-theme-apollo-docs';","import * as React from 'react'"],"scopeIdentifiers":["ExpansionPanel","React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Subscriptions\",\n  \"description\": \"Persistent GraphQL read operations\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Subscriptions are not currently supported in \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://www.apollographql.com/docs/federation/\"\n  }, \"Apollo Federation\"), \".\"))), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Subscriptions\"), \" are long-lasting GraphQL read operations that can update their result whenever a particular server-side event occurs. Most commonly, updated results are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"pushed\"), \" from the server to subscribing clients. For example, a chat application's server might use a subscription to push newly received messages to all clients in a particular chat room.\"), mdx(\"p\", null, \"Because subscription updates are usually pushed by the server (instead of polled by the client), they usually use \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\"\n  }, \"the WebSocket protocol\"), \" instead of HTTP. To support this, Apollo Server lets you \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#setting-a-subscription-endpoint\"\n  }, \"set a subscription-specific endpoint\"), \" that's separate from the default endpoint for queries and mutations.\"), mdx(\"p\", null, \"You can use subscriptions with the core \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"apollo-server\"), \" library, or with any of Apollo Server's supported \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#using-with-middleware-integrations\"\n  }, \"middleware integrations\"), \".\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Important:\"), \" Compared to queries and mutations, subscriptions are significantly more complex to implement. Before you begin, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#when-to-use-subscriptions\"\n  }, \"confirm that your use case requires subscriptions\"), \".\")), mdx(\"h2\", {\n    \"id\": \"schema-definition\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#schema-definition\",\n    \"aria-label\": \"schema definition permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Schema definition\"), mdx(\"p\", null, \"Your schema's \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" type defines top-level fields that clients can subscribe to:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"type\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Subscription\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Post\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"postCreated\"), \" field will update its value whenever a new \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Post\"), \" is created on the backend, thus pushing the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Post\"), \" to subscribing clients.\"), mdx(\"p\", null, \"Clients can subscribe to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"postCreated\"), \" field with a GraphQL string like this:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"subscription\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token object\"\n  }, \"PostFeed\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token object\"\n  }, \"postCreated\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"author\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"comment\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Each subscription operation can subscribe to only \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"one\"), \" field of the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" type.\")), mdx(\"h2\", {\n    \"id\": \"setting-a-subscription-endpoint\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#setting-a-subscription-endpoint\",\n    \"aria-label\": \"setting a subscription endpoint permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Setting a subscription endpoint\"), mdx(\"p\", null, \"Because subscriptions use WebSocket instead of HTTP, Apollo Server uses a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"second\"), \" GraphQL endpoint specifically for subscriptions. This endpoint uses the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ws\"), \" protocol instead of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"http\"), \".\"), mdx(\"p\", null, \"By default, the subscription endpoint's path matches the path of your primary GraphQL endpoint (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"/graphql\"), \" if not set). You can specify a different path for your subscription endpoint like so:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"subscriptions\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"path\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'/subscriptions'\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other options...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"h2\", {\n    \"id\": \"resolving-a-subscription\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#resolving-a-subscription\",\n    \"aria-label\": \"resolving a subscription permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Resolving a subscription\"), mdx(\"p\", null, \"Resolvers for \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" fields differ from resolvers for fields of other types. Specifically, \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field resolvers are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"objects\"), \" that define a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function:\"), mdx(\"div\", {\n    \"className\": \"gatsby-code-title\"\n  }, \"index.js\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// More on pubsub below\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"subscribe\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function must return an object of type \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \", a standard interface for iterating over asynchronous results. In the example above, an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" is generated by \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"pubsub.asyncIterator\"), \" (more on this below).\"), mdx(\"h3\", {\n    \"id\": \"the-pubsub-class\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#the-pubsub-class\",\n    \"aria-label\": \"the pubsub class permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"The \", mdx(\"code\", {\n    parentName: \"h3\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" recommended for production environments, because it's an in-memory event system that only supports a single server instance. After you get subscriptions working in development, we strongly recommend switching it out for a different subclass of the abstract \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"PubSubEngine\"), \" class\"), \". Recommended subclasses are listed in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#production-pubsub-libraries\"\n  }, \"Production \", mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" libraries\"), \".\")), mdx(\"p\", null, \"Apollo Server uses a \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"publish-subscribe\"), \" (\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"pub/sub\"), \") model to track events that update active subscriptions. The \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"graphql-subscriptions\"), \" library\"), \" (included in every \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"apollo-server\"), \" package) provides the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class as a basic in-memory event bus to help you get started:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" PubSub \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" pubsub \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"PubSub\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"A \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" instance enables your server code to both \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" events to a particular label and listen for events associated with a particular label.\"), mdx(\"h3\", {\n    \"id\": \"publishing-an-event\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#publishing-an-event\",\n    \"aria-label\": \"publishing an event permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Publishing an event\"), mdx(\"p\", null, \"You publish an event with the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" method of a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" instance:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"publish\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"author\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Ali Baba'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"comment\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Open sesame'\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The first parameter is the name of the event label you're publishing to, as a string.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"You don't need to register a label name before publishing to it.\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The second parameter is the payload associated with the event.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"The payload should include whatever data is necessary for your resolvers to populate the associated \", mdx(\"code\", {\n    parentName: \"em\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field and its subfields.\"))))), mdx(\"p\", null, \"When working with GraphQL subscriptions, you \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" an event whenever a subscription's return value should be updated. One common cause of such an update is a mutation, but \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"any\"), \" back-end logic might result in changes that should be \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \"ed.\"), mdx(\"p\", null, \"As an example, let's say our GraphQL API supports a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"createPost\"), \" mutation:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"type\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Mutation\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"author\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar\"\n  }, \"String\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"comment\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar\"\n  }, \"String\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Post\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"A basic resolver for \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"createPost\"), \" might look like this:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight has-highlighted-lines\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Mutation\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token parameter\"\n  }, \"parent\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" context\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token comment\"\n  }, \"// Datastore logic lives in postController\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" postController\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"args\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\")), \"  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Before we persist the new post's details in our datastore, we can \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"publish\"), \" an event that \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"also\"), \" includes those details:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Mutation\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"parent\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" args\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      pubsub\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"publish\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" args \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), \"      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" postController\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createPost\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"args\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"Next, we can listen for this event in our \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field's resolver.\"), mdx(\"h3\", {\n    \"id\": \"listening-for-events\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#listening-for-events\",\n    \"aria-label\": \"listening for events permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Listening for events\"), mdx(\"p\", null, \"An \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-async-iterator.ts\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\")), \" object listens for events that are associated with a particular label (or set of labels) and adds them to a queue for processing. You create an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" by calling the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"asyncIterator\"), \" method of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \":\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"You pass this method an array containing the names of all event labels that the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" should listen for.\"), mdx(\"p\", null, \"Every \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field resolver's \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function must return an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"AsyncIterator\"), \" object. This brings us back to the code sample at the top of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#resolving-a-subscription\"\n  }, \"Resolving a subscription\"), \":\"), mdx(\"div\", {\n    \"className\": \"gatsby-code-title\"\n  }, \"index.js\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"postCreated\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"subscribe\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" pubsub\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'POST_CREATED'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"With this \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" function set, Apollo Server uses the payloads of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"POST_CREATED\"), \" events to push updated values for the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"postCreated\"), \" field.\"), mdx(\"h3\", {\n    \"id\": \"filtering-events\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#filtering-events\",\n    \"aria-label\": \"filtering events permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Filtering events\"), mdx(\"p\", null, \"Sometimes, a client should only receive updated subscription data if that data meets certain criteria. To support this, you can call the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" helper function in your \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Subscription\"), \" field's resolver.\"), mdx(\"h4\", {\n    \"id\": \"example\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"#example\",\n    \"aria-label\": \"example permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Example\"), mdx(\"p\", null, \"Let's say our server provides a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"commentAdded\"), \" subscription, which should notify clients whenever a comment is added to a specified code repository. A client can execute a subscription that looks like this:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"graphql\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-graphql line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-graphql\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$repoName\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token scalar\"\n  }, \"String\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"!\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property-query\"\n  }, \"commentAdded\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token attr-name\"\n  }, \"repoFullName\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token variable\"\n  }, \"$repoName\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"id\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token property\"\n  }, \"content\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"This presents a potential issue: our server probably \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#publishing-an-event\"\n  }, \"publishes\"), \"  a \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"COMMENT_ADDED\"), \" event whenever a comment is added to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"any\"), \" repository. This means that the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"commentAdded\"), \" resolver executes for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"every\"), \" new comment, regardless of which repository it's added to. As a result, subscribing clients might receive data they don't want (or shouldn't even have access to).\"), mdx(\"p\", null, \"To fix this, we can use the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" helper function to control updates on a per-client basis.\"), mdx(\"p\", null, \"Here's an example resolver for \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"commentAdded\"), \" that uses the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" function:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight has-highlighted-lines\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" withFilter \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"Subscription\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"    \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"commentAdded\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token literal-property property\"\n  }, \"subscribe\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"withFilter\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"        \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" pubsub\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"asyncIterator\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"'COMMENT_ADDED'\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"        \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token parameter\"\n  }, \"payload\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" variables\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"          \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token comment\"\n  }, \"// Only push an update if the comment is on\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"          \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token comment\"\n  }, \"// the correct repository for this operation\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"          \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"payload\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"commentAdded\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"repository_name \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token operator\"\n  }, \"===\"), \" variables\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"repoFullName\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"        \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\")), \"      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other resolvers...\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" function takes two parameters:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The first parameter is exactly the function you would use for \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"subscribe\"), \" if you \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"weren't\"), \" applying a filter.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The second parameter is a \", mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"filter function\"), \" that returns \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"true\"), \" if a subscription update \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"should\"), \" be sent to a particular client, and \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"false\"), \" otherwise (\", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"Promise<boolean>\"), \" is also allowed). This function takes two parameters of its own:\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"payload\"), \" is the payload of the event that was published.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"variables\"), \" is an object containing all arguments the client provided when initiating their subscription.\")))), mdx(\"p\", null, \"Use \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"withFilter\"), \" to make sure clients get exactly the subscription updates they want (and are allowed to receive).\"), mdx(\"h2\", {\n    \"id\": \"basic-runnable-example\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#basic-runnable-example\",\n    \"aria-label\": \"basic runnable example permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Basic runnable example\"), mdx(\"p\", null, \"An example server is available on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/docs-examples/blob/main/server-subscriptions/index.js\"\n  }, \"GitHub\"), \" and CodeSandbox:\"), mdx(\"a\", {\n    href: \"https://codesandbox.io/s/github/apollographql/docs-examples/tree/main/apollo-server/v2/subscriptions?fontsize=14&hidenavigation=1&theme=dark\"\n  }, mdx(\"img\", {\n    alt: \"Edit server-subscriptions\",\n    src: \"https://codesandbox.io/static/img/play-codesandbox.svg\"\n  })), mdx(\"p\", null, \"The server exposes one subscription (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"numberIncremented\"), \") that returns an integer that's incremented on the server every second. The example requires only the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"apollo-server\"), \" library.\"), mdx(\"p\", null, \"After you start up this server locally, you can visit \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"http://localhost:4000\"), \" to test out running the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"numberIncremented\"), \" subscription in GraphQL Playground. You'll see the subscription's value update every second.\"), mdx(\"h2\", {\n    \"id\": \"operation-context\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#operation-context\",\n    \"aria-label\": \"operation context permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Operation context\"), mdx(\"p\", null, \"When \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/v2/data/resolvers/#the-context-argument\"\n  }, \"initializing context\"), \" for a query or mutation, you usually extract HTTP headers and other request metadata from the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"req\"), \" object provided to the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" function.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"For subscriptions,\"), \" you extract this metadata from the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connection\"), \" object instead. This object adheres to the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/subscriptions-transport-ws/blob/817e7de3a23db2b4d64eb846724175dba74025d0/src/server.ts#L24-L33\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"ExecutionParams\"), \" interface\"), \".\"), mdx(\"p\", null, \"Because all operation types use the same \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" initialization function, you should check which of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"req\"), \" or \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connection\"), \" is present for each incoming request:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" req\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" connection \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"connection\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Operation is a Subscription\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Obtain connectionParams-provided token from connection.context\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" token \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" connection\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"context\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authorization \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"||\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" token \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"else\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Operation is a Query/Mutation\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Obtain header-provided token from req.headers\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" token \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" req\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"headers\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authorization \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"||\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"\\\"\\\"\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" token \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"This is especially important because metadata like auth tokens are sent differently depending on the transport.\"), mdx(\"h2\", {\n    \"id\": \"onconnect-and-ondisconnect\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#onconnect-and-ondisconnect\",\n    \"aria-label\": \"onconnect and ondisconnect permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"code\", {\n    parentName: \"h2\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" and \", mdx(\"code\", {\n    parentName: \"h2\",\n    \"className\": \"language-text\"\n  }, \"onDisconnect\")), mdx(\"p\", null, \"You can define functions that Apollo Server executes whenever a subscription request connects (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \") or disconnects (\", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onDisconnect\"), \").\"), mdx(\"p\", null, \"Defining an \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" function provides the following benefits:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"You can reject a particular incoming connection by throwing an exception or returning \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"false\"), \" in \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \".\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This is especially useful for \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#example-authentication-with-onconnect\"\n  }, \"authentication\"), \".\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" returns an object, that object's fields are added to the WebSocket connection's \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" object.\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This is \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"not\"), \" the \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"operation\"), \" \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" that's passed between resolvers. However, you can transfer these values from the \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"connection\"), \"'s \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" when you \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"#operation-context\"\n  }, \"initialize operation context\"), \".\")))), mdx(\"p\", null, \"You provide these function definitions to the constructor of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ApolloServer\"), \", like so:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"subscriptions\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"onConnect\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"connectionParams\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" webSocket\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Connected!'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"onDisconnect\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"webSocket\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" context\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Disconnected!'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ...other options...\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"These functions are passed the following parameters:\"), mdx(\"table\", {\n    className: \"field-table\"\n  }, mdx(\"thead\", null, mdx(\"tr\", null, mdx(\"th\", null, \"Name /\", mdx(\"br\", null), \"Type\"), mdx(\"th\", null, \"Description\"))), mdx(\"tbody\", null, mdx(\"tr\", null, mdx(\"td\", null, mdx(\"h6\", {\n    \"id\": \"connectionparams\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h6\",\n    \"href\": \"#connectionparams\",\n    \"aria-label\": \"connectionparams permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"code\", {\n    parentName: \"h6\",\n    \"className\": \"language-text\"\n  }, \"connectionParams\")), mdx(\"p\", null, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"Object\"))), mdx(\"td\", null, mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Passed to \", mdx(\"code\", {\n    parentName: \"strong\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" only.\")), mdx(\"p\", null, \"An object containing parameters included in the request, such as an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#example-authentication-with-onconnect\"\n  }, \"authentication token\"), \".\"), mdx(\"p\", null, \"For details, see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#4-authenticate-over-websocket-optional\"\n  }, \"Authenticate over WebSocket\"), \" in the Apollo Client documentation.\"))), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"h6\", {\n    \"id\": \"websocket\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h6\",\n    \"href\": \"#websocket\",\n    \"aria-label\": \"websocket permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"code\", {\n    parentName: \"h6\",\n    \"className\": \"language-text\"\n  }, \"webSocket\")), mdx(\"p\", null, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"WebSocket\"))), mdx(\"td\", null, mdx(\"p\", null, \"The connecting or disconnecting \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"WebSocket\")), \".\"))), mdx(\"tr\", null, mdx(\"td\", null, mdx(\"h6\", {\n    \"id\": \"context\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h6\",\n    \"href\": \"#context\",\n    \"aria-label\": \"context permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), mdx(\"code\", {\n    parentName: \"h6\",\n    \"className\": \"language-text\"\n  }, \"context\")), mdx(\"p\", null, mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ConnectionContext\"))), mdx(\"td\", null, mdx(\"p\", null, \"Context object for the WebSocket connection. This is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context\"), \" object for the associated subscription operation.\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/subscriptions-transport-ws/blob/master/src/server.ts#L35-L43\"\n  }, \"See fields\")))))), mdx(\"h3\", {\n    \"id\": \"example-authentication-with-onconnect\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#example-authentication-with-onconnect\",\n    \"aria-label\": \"example authentication with onconnect permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Example: Authentication with \", mdx(\"code\", {\n    parentName: \"h3\",\n    \"className\": \"language-text\"\n  }, \"onConnect\")), mdx(\"p\", null, \"On the client, \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"SubscriptionsClient\"), \" supports adding token information to \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connectionParams\"), \" (\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/advanced/subscriptions/#authentication-over-websocket\"\n  }, \"example\"), \") that will be sent with the first WebSocket message. In the server, all GraphQL subscriptions are delayed until the connection has been fully authenticated and the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" callback returns a truthy value.\"), mdx(\"p\", null, \"The \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"connectionParams\"), \" argument in the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"onConnect\"), \" callback contains the information passed by the client and can be used to validate user credentials.\\nThe GraphQL context can also be extended with the authenticated user data to enable fine grain authorization.\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" resolvers\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" typeDefs \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'./schema'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"validateToken\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"authToken\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ... validate token and return a Promise, rejects in case of an error\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"findUser\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"authToken\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"tokenValidationResult\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// ... finds user by auth token and return a Promise, rejects in case of an error\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  typeDefs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  resolvers\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"subscriptions\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function-variable function\"\n  }, \"onConnect\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"connectionParams\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" webSocket\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"if\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authToken\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n        \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"validateToken\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authToken\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"then\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"findUser\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"connectionParams\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"authToken\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"then\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"user\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n            \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n              \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"currentUser\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" user\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n            \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n          \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n\\n      \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"throw\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Error\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'Missing auth token!'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\nserver\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"listen\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"then\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" url\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" subscriptionsUrl \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\uD83D\\uDE80 Server ready at \"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"url\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\uD83D\\uDE80 Subscriptions ready at \"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"subscriptionsUrl\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"The example above validates the user's token that is sent with the first initialization message on the transport, then it looks up the user and returns the user object as a Promise. The user object found will be available as \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"context.currentUser\"), \" in your GraphQL resolvers.\"), mdx(\"p\", null, \"In case of an authentication error, the Promise will be rejected, which prevents the client's connection.\"), mdx(\"h2\", {\n    \"id\": \"using-with-middleware-integrations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#using-with-middleware-integrations\",\n    \"aria-label\": \"using with middleware integrations permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Using with middleware integrations\"), mdx(\"p\", null, \"You can use subscriptions with any of Apollo Server's supported \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/v2/integrations/middleware/\"\n  }, \"middleware integrations\"), \". To do so, you call \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"installSubscriptionHandlers\"), \" on your \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ApolloServer\"), \" instance.\"), mdx(\"p\", null, \"This example enables subscriptions for an Express server that uses \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"apollo-server-express\"), \":\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-js line-numbers\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" http \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'http'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" ApolloServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'apollo-server-express'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" express \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"require\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'express'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"async\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"function\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"startApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"4000\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" app \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"express\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" server \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"ApolloServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" typeDefs\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" resolvers \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"start\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"applyMiddleware\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"app\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\n\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" http\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"createServer\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"app\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"gatsby-highlight-code-line\"\n  }, \"  server\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token function\"\n  }, \"installSubscriptionHandlers\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"httpServer\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \";\")), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token comment\"\n  }, \"// Make sure to call listen on httpServer, NOT on app.\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"new\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token class-name\"\n  }, \"Promise\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, \"resolve\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" httpServer\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"listen\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" resolve\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\uD83D\\uDE80 Server ready at http://localhost:\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"server\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"graphqlPath\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  console\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"log\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"\\uD83D\\uDE80 Subscriptions ready at ws://localhost:\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token constant\"\n  }, \"PORT\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"server\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"subscriptionsPath\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"return\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" server\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" app\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" httpServer \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"pre\",\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }, mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"h2\", {\n    \"id\": \"production-pubsub-libraries\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#production-pubsub-libraries\",\n    \"aria-label\": \"production pubsub libraries permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Production \", mdx(\"code\", {\n    parentName: \"h2\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" libraries\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#the-pubsub-class\"\n  }, \"As mentioned above\"), \", the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" class is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" recommended for production environments, because its event-publishing system is in-memory. This means that events published by \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"one\"), \" instance of your GraphQL server are not received by subscriptions that are handled by \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"other\"), \" instances.\"), mdx(\"p\", null, \"Instead, you should use a subclass of the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n  }, mdx(\"code\", {\n    parentName: \"a\",\n    \"className\": \"language-text\"\n  }, \"PubSubEngine\"), \" abstract class\"), \" that you can back with an external datastore such as Redis or Kafka.\"), mdx(\"p\", null, \"The following are community-created \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSub\"), \" libraries for popular event-publishing systems:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/davidyaha/graphql-redis-subscriptions\"\n  }, \"Redis\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/axelspringer/graphql-google-pubsub\"\n  }, \"Google PubSub\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/davidyaha/graphql-mqtt-subscriptions\"\n  }, \"MQTT enabled broker\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/cdmbase/graphql-rabbitmq-subscriptions\"\n  }, \"RabbitMQ\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/ancashoria/graphql-kafka-subscriptions\"\n  }, \"Kafka\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/GraphQLCollege/graphql-postgres-subscriptions\"\n  }, \"Postgres\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/MrBoolean/graphql-firestore-subscriptions\"\n  }, \"Google Cloud Firestore\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/ably-labs/graphql-ably-pubsub\"\n  }, \"Ably Realtime\"))), mdx(\"p\", null, \"If none of these libraries fits your use case, you can also create your own \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"PubSubEngine\"), \" subclass. If you create a new open-source library, click \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Edit on GitHub\"), \" to let us know about it!\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport {ExpansionPanel} from 'gatsby-theme-apollo-docs';\nexport const _frontmatter = {\n  \"title\": \"Subscriptions\",\n  \"description\": \"Persistent GraphQL read operations\"\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <blockquote>\n      <p parentName=\"blockquote\"><strong parentName=\"p\">{`Subscriptions are not currently supported in `}<a parentName=\"strong\" {...{\n            \"href\": \"https://www.apollographql.com/docs/federation/\"\n          }}>{`Apollo Federation`}</a>{`.`}</strong></p>\n    </blockquote>\n    <p><strong parentName=\"p\">{`Subscriptions`}</strong>{` are long-lasting GraphQL read operations that can update their result whenever a particular server-side event occurs. Most commonly, updated results are `}<em parentName=\"p\">{`pushed`}</em>{` from the server to subscribing clients. For example, a chat application's server might use a subscription to push newly received messages to all clients in a particular chat room.`}</p>\n    <p>{`Because subscription updates are usually pushed by the server (instead of polled by the client), they usually use `}<a parentName=\"p\" {...{\n        \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API\"\n      }}>{`the WebSocket protocol`}</a>{` instead of HTTP. To support this, Apollo Server lets you `}<a parentName=\"p\" {...{\n        \"href\": \"#setting-a-subscription-endpoint\"\n      }}>{`set a subscription-specific endpoint`}</a>{` that's separate from the default endpoint for queries and mutations.`}</p>\n    <p>{`You can use subscriptions with the core `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`apollo-server`}</code>{` library, or with any of Apollo Server's supported `}<a parentName=\"p\" {...{\n        \"href\": \"#using-with-middleware-integrations\"\n      }}>{`middleware integrations`}</a>{`.`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\"><strong parentName=\"p\">{`Important:`}</strong>{` Compared to queries and mutations, subscriptions are significantly more complex to implement. Before you begin, `}<a parentName=\"p\" {...{\n          \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#when-to-use-subscriptions\"\n        }}>{`confirm that your use case requires subscriptions`}</a>{`.`}</p>\n    </blockquote>\n    <h2 {...{\n      \"id\": \"schema-definition\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#schema-definition\",\n        \"aria-label\": \"schema definition permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Schema definition`}</h2>\n    <p>{`Your schema's `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` type defines top-level fields that clients can subscribe to:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`type`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Subscription`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Post`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`postCreated`}</code>{` field will update its value whenever a new `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Post`}</code>{` is created on the backend, thus pushing the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Post`}</code>{` to subscribing clients.`}</p>\n    <p>{`Clients can subscribe to the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`postCreated`}</code>{` field with a GraphQL string like this:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`subscription`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token object\"\n          }}>{`PostFeed`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token object\"\n          }}>{`postCreated`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`author`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`comment`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <blockquote>\n      <p parentName=\"blockquote\">{`Each subscription operation can subscribe to only `}<em parentName=\"p\">{`one`}</em>{` field of the `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`Subscription`}</code>{` type.`}</p>\n    </blockquote>\n    <h2 {...{\n      \"id\": \"setting-a-subscription-endpoint\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#setting-a-subscription-endpoint\",\n        \"aria-label\": \"setting a subscription endpoint permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Setting a subscription endpoint`}</h2>\n    <p>{`Because subscriptions use WebSocket instead of HTTP, Apollo Server uses a `}<em parentName=\"p\">{`second`}</em>{` GraphQL endpoint specifically for subscriptions. This endpoint uses the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`ws`}</code>{` protocol instead of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`http`}</code>{`.`}</p>\n    <p>{`By default, the subscription endpoint's path matches the path of your primary GraphQL endpoint (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`/graphql`}</code>{` if not set). You can specify a different path for your subscription endpoint like so:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`subscriptions`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`path`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'/subscriptions'`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other options...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <h2 {...{\n      \"id\": \"resolving-a-subscription\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#resolving-a-subscription\",\n        \"aria-label\": \"resolving a subscription permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Resolving a subscription`}</h2>\n    <p>{`Resolvers for `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` fields differ from resolvers for fields of other types. Specifically, `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field resolvers are `}<em parentName=\"p\">{`objects`}</em>{` that define a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function:`}</p>\n    <div {...{\n      \"className\": \"gatsby-code-title\"\n    }}>{`index.js`}</div>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// More on pubsub below`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`subscribe`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`asyncIterator`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`[`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`]`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function must return an object of type `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{`, a standard interface for iterating over asynchronous results. In the example above, an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` is generated by `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`pubsub.asyncIterator`}</code>{` (more on this below).`}</p>\n    <h3 {...{\n      \"id\": \"the-pubsub-class\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#the-pubsub-class\",\n        \"aria-label\": \"the pubsub class permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`The `}<code parentName=\"h3\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` class`}</h3>\n    <blockquote>\n      <p parentName=\"blockquote\">{`The `}<code parentName=\"p\" {...{\n          \"className\": \"language-text\"\n        }}>{`PubSub`}</code>{` class is `}<strong parentName=\"p\">{`not`}</strong>{` recommended for production environments, because it's an in-memory event system that only supports a single server instance. After you get subscriptions working in development, we strongly recommend switching it out for a different subclass of the abstract `}<a parentName=\"p\" {...{\n          \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n        }}><code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`PubSubEngine`}</code>{` class`}</a>{`. Recommended subclasses are listed in `}<a parentName=\"p\" {...{\n          \"href\": \"#production-pubsub-libraries\"\n        }}>{`Production `}<code parentName=\"a\" {...{\n            \"className\": \"language-text\"\n          }}>{`PubSub`}</code>{` libraries`}</a>{`.`}</p>\n    </blockquote>\n    <p>{`Apollo Server uses a `}<strong parentName=\"p\">{`publish-subscribe`}</strong>{` (`}<strong parentName=\"p\">{`pub/sub`}</strong>{`) model to track events that update active subscriptions. The `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/graphql-subscriptions\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`graphql-subscriptions`}</code>{` library`}</a>{` (included in every `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`apollo-server`}</code>{` package) provides the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` class as a basic in-memory event bus to help you get started:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` PubSub `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'apollo-server'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` pubsub `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`PubSub`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`A `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` instance enables your server code to both `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` events to a particular label and listen for events associated with a particular label.`}</p>\n    <h3 {...{\n      \"id\": \"publishing-an-event\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#publishing-an-event\",\n        \"aria-label\": \"publishing an event permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Publishing an event`}</h3>\n    <p>{`You publish an event with the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` method of a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` instance:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}>{`pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`publish`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`author`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Ali Baba'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`comment`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Open sesame'`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <ul>\n      <li parentName=\"ul\">{`The first parameter is the name of the event label you're publishing to, as a string.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><em parentName=\"li\">{`You don't need to register a label name before publishing to it.`}</em></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`The second parameter is the payload associated with the event.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><em parentName=\"li\">{`The payload should include whatever data is necessary for your resolvers to populate the associated `}<code parentName=\"em\" {...{\n                \"className\": \"language-text\"\n              }}>{`Subscription`}</code>{` field and its subfields.`}</em></li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`When working with GraphQL subscriptions, you `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` an event whenever a subscription's return value should be updated. One common cause of such an update is a mutation, but `}<em parentName=\"p\">{`any`}</em>{` back-end logic might result in changes that should be `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{`ed.`}</p>\n    <p>{`As an example, let's say our GraphQL API supports a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`createPost`}</code>{` mutation:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`type`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Mutation`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`createPost`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`author`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token scalar\"\n          }}>{`String`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`comment`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token scalar\"\n          }}>{`String`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Post`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`A basic resolver for `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`createPost`}</code>{` might look like this:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight has-highlighted-lines\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Mutation`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`createPost`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token parameter\"\n            }}>{`parent`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` args`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` context`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      `}<span parentName=\"span\" {...{\n              \"className\": \"token comment\"\n            }}>{`// Datastore logic lives in postController`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      `}<span parentName=\"span\" {...{\n              \"className\": \"token keyword\"\n            }}>{`return`}</span>{` postController`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`createPost`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`args`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span></span>{`  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Before we persist the new post's details in our datastore, we can `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`publish`}</code>{` an event that `}<em parentName=\"p\">{`also`}</em>{` includes those details:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Mutation`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`createPost`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`parent`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` args`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      pubsub`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`publish`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{`'POST_CREATED'`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token literal-property property\"\n            }}>{`postCreated`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` args `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span>{`      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` postController`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`createPost`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`args`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`Next, we can listen for this event in our `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field's resolver.`}</p>\n    <h3 {...{\n      \"id\": \"listening-for-events\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#listening-for-events\",\n        \"aria-label\": \"listening for events permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Listening for events`}</h3>\n    <p>{`An `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-async-iterator.ts\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`AsyncIterator`}</code></a>{` object listens for events that are associated with a particular label (or set of labels) and adds them to a queue for processing. You create an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` by calling the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`asyncIterator`}</code>{` method of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{`:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}>{`pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`asyncIterator`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`[`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`]`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span></span></pre></div>\n    <p>{`You pass this method an array containing the names of all event labels that the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` should listen for.`}</p>\n    <p>{`Every `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field resolver's `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function must return an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`AsyncIterator`}</code>{` object. This brings us back to the code sample at the top of `}<a parentName=\"p\" {...{\n        \"href\": \"#resolving-a-subscription\"\n      }}>{`Resolving a subscription`}</a>{`:`}</p>\n    <div {...{\n      \"className\": \"gatsby-code-title\"\n    }}>{`index.js`}</div>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`postCreated`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`subscribe`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` pubsub`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`asyncIterator`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`[`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'POST_CREATED'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`]`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`With this `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`subscribe`}</code>{` function set, Apollo Server uses the payloads of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`POST_CREATED`}</code>{` events to push updated values for the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`postCreated`}</code>{` field.`}</p>\n    <h3 {...{\n      \"id\": \"filtering-events\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#filtering-events\",\n        \"aria-label\": \"filtering events permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Filtering events`}</h3>\n    <p>{`Sometimes, a client should only receive updated subscription data if that data meets certain criteria. To support this, you can call the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` helper function in your `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`Subscription`}</code>{` field's resolver.`}</p>\n    <h4 {...{\n      \"id\": \"example\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h4\" {...{\n        \"href\": \"#example\",\n        \"aria-label\": \"example permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Example`}</h4>\n    <p>{`Let's say our server provides a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`commentAdded`}</code>{` subscription, which should notify clients whenever a comment is added to a specified code repository. A client can execute a subscription that looks like this:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"graphql\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-graphql line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-graphql\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token variable\"\n          }}>{`$repoName`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token scalar\"\n          }}>{`String`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`!`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token property-query\"\n          }}>{`commentAdded`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token attr-name\"\n          }}>{`repoFullName`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token variable\"\n          }}>{`$repoName`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`id`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token property\"\n          }}>{`content`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`This presents a potential issue: our server probably `}<a parentName=\"p\" {...{\n        \"href\": \"#publishing-an-event\"\n      }}>{`publishes`}</a>{`  a `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`COMMENT_ADDED`}</code>{` event whenever a comment is added to `}<em parentName=\"p\">{`any`}</em>{` repository. This means that the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`commentAdded`}</code>{` resolver executes for `}<em parentName=\"p\">{`every`}</em>{` new comment, regardless of which repository it's added to. As a result, subscribing clients might receive data they don't want (or shouldn't even have access to).`}</p>\n    <p>{`To fix this, we can use the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` helper function to control updates on a per-client basis.`}</p>\n    <p>{`Here's an example resolver for `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`commentAdded`}</code>{` that uses the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` function:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight has-highlighted-lines\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` withFilter `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'apollo-server'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`Subscription`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`    `}<span parentName=\"span\" {...{\n              \"className\": \"token literal-property property\"\n            }}>{`commentAdded`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`      `}<span parentName=\"span\" {...{\n              \"className\": \"token literal-property property\"\n            }}>{`subscribe`}</span><span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`:`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`withFilter`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`        `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`=>`}</span>{` pubsub`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`asyncIterator`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{`'COMMENT_ADDED'`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`        `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span><span parentName=\"span\" {...{\n              \"className\": \"token parameter\"\n            }}>{`payload`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`,`}</span>{` variables`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`=>`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`          `}<span parentName=\"span\" {...{\n              \"className\": \"token comment\"\n            }}>{`// Only push an update if the comment is on`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`          `}<span parentName=\"span\" {...{\n              \"className\": \"token comment\"\n            }}>{`// the correct repository for this operation`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`          `}<span parentName=\"span\" {...{\n              \"className\": \"token keyword\"\n            }}>{`return`}</span>{` `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`payload`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span>{`commentAdded`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span>{`repository_name `}<span parentName=\"span\" {...{\n              \"className\": \"token operator\"\n            }}>{`===`}</span>{` variables`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span>{`repoFullName`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`        `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span></span>{`      `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other resolvers...`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` function takes two parameters:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`The first parameter is exactly the function you would use for `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`subscribe`}</code>{` if you `}<em parentName=\"li\">{`weren't`}</em>{` applying a filter.`}</li>\n      <li parentName=\"ul\">{`The second parameter is a `}<strong parentName=\"li\">{`filter function`}</strong>{` that returns `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`true`}</code>{` if a subscription update `}<em parentName=\"li\">{`should`}</em>{` be sent to a particular client, and `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`false`}</code>{` otherwise (`}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`Promise<boolean>`}</code>{` is also allowed). This function takes two parameters of its own:`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\"><code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`payload`}</code>{` is the payload of the event that was published.`}</li>\n          <li parentName=\"ul\"><code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`variables`}</code>{` is an object containing all arguments the client provided when initiating their subscription.`}</li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`Use `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`withFilter`}</code>{` to make sure clients get exactly the subscription updates they want (and are allowed to receive).`}</p>\n    <h2 {...{\n      \"id\": \"basic-runnable-example\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#basic-runnable-example\",\n        \"aria-label\": \"basic runnable example permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Basic runnable example`}</h2>\n    <p>{`An example server is available on `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/docs-examples/blob/main/server-subscriptions/index.js\"\n      }}>{`GitHub`}</a>{` and CodeSandbox:`}</p>\n    <a href=\"https://codesandbox.io/s/github/apollographql/docs-examples/tree/main/apollo-server/v2/subscriptions?fontsize=14&hidenavigation=1&theme=dark\">\n  <img alt=\"Edit server-subscriptions\" src=\"https://codesandbox.io/static/img/play-codesandbox.svg\" />\n    </a>\n    <p>{`The server exposes one subscription (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`numberIncremented`}</code>{`) that returns an integer that's incremented on the server every second. The example requires only the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`apollo-server`}</code>{` library.`}</p>\n    <p>{`After you start up this server locally, you can visit `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`http://localhost:4000`}</code>{` to test out running the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`numberIncremented`}</code>{` subscription in GraphQL Playground. You'll see the subscription's value update every second.`}</p>\n    <h2 {...{\n      \"id\": \"operation-context\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#operation-context\",\n        \"aria-label\": \"operation context permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Operation context`}</h2>\n    <p>{`When `}<a parentName=\"p\" {...{\n        \"href\": \"/v2/data/resolvers/#the-context-argument\"\n      }}>{`initializing context`}</a>{` for a query or mutation, you usually extract HTTP headers and other request metadata from the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`req`}</code>{` object provided to the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{` function.`}</p>\n    <p><strong parentName=\"p\">{`For subscriptions,`}</strong>{` you extract this metadata from the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connection`}</code>{` object instead. This object adheres to the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/subscriptions-transport-ws/blob/817e7de3a23db2b4d64eb846724175dba74025d0/src/server.ts#L24-L33\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`ExecutionParams`}</code>{` interface`}</a>{`.`}</p>\n    <p>{`Because all operation types use the same `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context`}</code>{` initialization function, you should check which of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`req`}</code>{` or `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connection`}</code>{` is present for each incoming request:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span>{` req`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` connection `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`if`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`connection`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Operation is a Subscription`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Obtain connectionParams-provided token from connection.context`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` token `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` connection`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`context`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authorization `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`||`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`\"\"`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` token `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`else`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Operation is a Query/Mutation`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Obtain header-provided token from req.headers`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` token `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` req`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`headers`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authorization `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`||`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`\"\"`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` token `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`This is especially important because metadata like auth tokens are sent differently depending on the transport.`}</p>\n    <h2 {...{\n      \"id\": \"onconnect-and-ondisconnect\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#onconnect-and-ondisconnect\",\n        \"aria-label\": \"onconnect and ondisconnect permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a><code parentName=\"h2\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` and `}<code parentName=\"h2\" {...{\n        \"className\": \"language-text\"\n      }}>{`onDisconnect`}</code></h2>\n    <p>{`You can define functions that Apollo Server executes whenever a subscription request connects (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{`) or disconnects (`}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onDisconnect`}</code>{`).`}</p>\n    <p>{`Defining an `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` function provides the following benefits:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`You can reject a particular incoming connection by throwing an exception or returning `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`false`}</code>{` in `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`onConnect`}</code>{`.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`This is especially useful for `}<a parentName=\"li\" {...{\n              \"href\": \"#example-authentication-with-onconnect\"\n            }}>{`authentication`}</a>{`.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">{`If `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`onConnect`}</code>{` returns an object, that object's fields are added to the WebSocket connection's `}<code parentName=\"li\" {...{\n          \"className\": \"language-text\"\n        }}>{`context`}</code>{` object.`}\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`This is `}<em parentName=\"li\">{`not`}</em>{` the `}<em parentName=\"li\">{`operation`}</em>{` `}<code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`context`}</code>{` that's passed between resolvers. However, you can transfer these values from the `}<code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`connection`}</code>{`'s `}<code parentName=\"li\" {...{\n              \"className\": \"language-text\"\n            }}>{`context`}</code>{` when you `}<a parentName=\"li\" {...{\n              \"href\": \"#operation-context\"\n            }}>{`initialize operation context`}</a>{`.`}</li>\n        </ul>\n      </li>\n    </ul>\n    <p>{`You provide these function definitions to the constructor of `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`ApolloServer`}</code>{`, like so:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`subscriptions`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`onConnect`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`connectionParams`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` webSocket`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      console`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Connected!'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`onDisconnect`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`webSocket`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` context`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      console`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Disconnected!'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ...other options...`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`These functions are passed the following parameters:`}</p>\n    <table class=\"field-table\">\n  <thead>\n    <tr>\n      <th>Name /<br />Type</th>\n      <th>Description</th>\n    </tr>\n  </thead>\n      <tbody>\n        <tr>\n          <td>\n            <h6 {...{\n              \"id\": \"connectionparams\",\n              \"style\": {\n                \"position\": \"relative\"\n              }\n            }}><a parentName=\"h6\" {...{\n                \"href\": \"#connectionparams\",\n                \"aria-label\": \"connectionparams permalink\",\n                \"className\": \"anchor before\"\n              }}><svg parentName=\"a\" {...{\n                  \"aria-hidden\": \"true\",\n                  \"focusable\": \"false\",\n                  \"height\": \"16\",\n                  \"version\": \"1.1\",\n                  \"viewBox\": \"0 0 16 16\",\n                  \"width\": \"16\"\n                }}><path parentName=\"svg\" {...{\n                    \"fillRule\": \"evenodd\",\n                    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n                  }}></path></svg></a><code parentName=\"h6\" {...{\n                \"className\": \"language-text\"\n              }}>{`connectionParams`}</code></h6>\n            <p><code parentName=\"p\" {...{\n                \"className\": \"language-text\"\n              }}>{`Object`}</code></p>\n          </td>\n          <td>\n            <p><strong parentName=\"p\">{`Passed to `}<code parentName=\"strong\" {...{\n                  \"className\": \"language-text\"\n                }}>{`onConnect`}</code>{` only.`}</strong></p>\n            <p>{`An object containing parameters included in the request, such as an `}<a parentName=\"p\" {...{\n                \"href\": \"#example-authentication-with-onconnect\"\n              }}>{`authentication token`}</a>{`.`}</p>\n            <p>{`For details, see `}<a parentName=\"p\" {...{\n                \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions/#4-authenticate-over-websocket-optional\"\n              }}>{`Authenticate over WebSocket`}</a>{` in the Apollo Client documentation.`}</p>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <h6 {...{\n              \"id\": \"websocket\",\n              \"style\": {\n                \"position\": \"relative\"\n              }\n            }}><a parentName=\"h6\" {...{\n                \"href\": \"#websocket\",\n                \"aria-label\": \"websocket permalink\",\n                \"className\": \"anchor before\"\n              }}><svg parentName=\"a\" {...{\n                  \"aria-hidden\": \"true\",\n                  \"focusable\": \"false\",\n                  \"height\": \"16\",\n                  \"version\": \"1.1\",\n                  \"viewBox\": \"0 0 16 16\",\n                  \"width\": \"16\"\n                }}><path parentName=\"svg\" {...{\n                    \"fillRule\": \"evenodd\",\n                    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n                  }}></path></svg></a><code parentName=\"h6\" {...{\n                \"className\": \"language-text\"\n              }}>{`webSocket`}</code></h6>\n            <p><code parentName=\"p\" {...{\n                \"className\": \"language-text\"\n              }}>{`WebSocket`}</code></p>\n          </td>\n          <td>\n            <p>{`The connecting or disconnecting `}<a parentName=\"p\" {...{\n                \"href\": \"https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\"\n              }}><code parentName=\"a\" {...{\n                  \"className\": \"language-text\"\n                }}>{`WebSocket`}</code></a>{`.`}</p>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <h6 {...{\n              \"id\": \"context\",\n              \"style\": {\n                \"position\": \"relative\"\n              }\n            }}><a parentName=\"h6\" {...{\n                \"href\": \"#context\",\n                \"aria-label\": \"context permalink\",\n                \"className\": \"anchor before\"\n              }}><svg parentName=\"a\" {...{\n                  \"aria-hidden\": \"true\",\n                  \"focusable\": \"false\",\n                  \"height\": \"16\",\n                  \"version\": \"1.1\",\n                  \"viewBox\": \"0 0 16 16\",\n                  \"width\": \"16\"\n                }}><path parentName=\"svg\" {...{\n                    \"fillRule\": \"evenodd\",\n                    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n                  }}></path></svg></a><code parentName=\"h6\" {...{\n                \"className\": \"language-text\"\n              }}>{`context`}</code></h6>\n            <p><code parentName=\"p\" {...{\n                \"className\": \"language-text\"\n              }}>{`ConnectionContext`}</code></p>\n          </td>\n          <td>\n            <p>{`Context object for the WebSocket connection. This is `}<em parentName=\"p\">{`not`}</em>{` the `}<code parentName=\"p\" {...{\n                \"className\": \"language-text\"\n              }}>{`context`}</code>{` object for the associated subscription operation.`}</p>\n            <p><a parentName=\"p\" {...{\n                \"href\": \"https://github.com/apollographql/subscriptions-transport-ws/blob/master/src/server.ts#L35-L43\"\n              }}>{`See fields`}</a></p>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <h3 {...{\n      \"id\": \"example-authentication-with-onconnect\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h3\" {...{\n        \"href\": \"#example-authentication-with-onconnect\",\n        \"aria-label\": \"example authentication with onconnect permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Example: Authentication with `}<code parentName=\"h3\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code></h3>\n    <p>{`On the client, `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`SubscriptionsClient`}</code>{` supports adding token information to `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connectionParams`}</code>{` (`}<a parentName=\"p\" {...{\n        \"href\": \"https://www.apollographql.com/docs/react/advanced/subscriptions/#authentication-over-websocket\"\n      }}>{`example`}</a>{`) that will be sent with the first WebSocket message. In the server, all GraphQL subscriptions are delayed until the connection has been fully authenticated and the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` callback returns a truthy value.`}</p>\n    <p>{`The `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`connectionParams`}</code>{` argument in the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`onConnect`}</code>{` callback contains the information passed by the client and can be used to validate user credentials.\nThe GraphQL context can also be extended with the authenticated user data to enable fine grain authorization.`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` ApolloServer `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'apollo-server'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` resolvers`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` typeDefs `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'./schema'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`validateToken`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`authToken`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ... validate token and return a Promise, rejects in case of an error`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`findUser`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`authToken`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`tokenValidationResult`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// ... finds user by auth token and return a Promise, rejects in case of an error`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  typeDefs`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  resolvers`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`subscriptions`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token function-variable function\"\n          }}>{`onConnect`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`connectionParams`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` webSocket`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`if`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authToken`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n        `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`validateToken`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authToken`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n          `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`then`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`findUser`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`connectionParams`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span>{`authToken`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n          `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`then`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`user`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n            `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n              `}<span parentName=\"code\" {...{\n            \"className\": \"token literal-property property\"\n          }}>{`currentUser`}</span><span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`:`}</span>{` user`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n            `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n          `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{`\n\n      `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`throw`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Error`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'Missing auth token!'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n    `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\nserver`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`listen`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`then`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`{`}</span>{` url`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`,`}</span>{` subscriptionsUrl `}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`}`}</span></span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  console`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token template-string\"\n          }}><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{` Server ready at `}</span><span parentName=\"span\" {...{\n              \"className\": \"token interpolation\"\n            }}><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`\\${`}</span>{`url`}<span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`}`}</span></span><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span></span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  console`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token template-string\"\n          }}><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{` Subscriptions ready at `}</span><span parentName=\"span\" {...{\n              \"className\": \"token interpolation\"\n            }}><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`\\${`}</span>{`subscriptionsUrl`}<span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`}`}</span></span><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span></span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <p>{`The example above validates the user's token that is sent with the first initialization message on the transport, then it looks up the user and returns the user object as a Promise. The user object found will be available as `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`context.currentUser`}</code>{` in your GraphQL resolvers.`}</p>\n    <p>{`In case of an authentication error, the Promise will be rejected, which prevents the client's connection.`}</p>\n    <h2 {...{\n      \"id\": \"using-with-middleware-integrations\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#using-with-middleware-integrations\",\n        \"aria-label\": \"using with middleware integrations permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Using with middleware integrations`}</h2>\n    <p>{`You can use subscriptions with any of Apollo Server's supported `}<a parentName=\"p\" {...{\n        \"href\": \"/v2/integrations/middleware/\"\n      }}>{`middleware integrations`}</a>{`. To do so, you call `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`installSubscriptionHandlers`}</code>{` on your `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`ApolloServer`}</code>{` instance.`}</p>\n    <p>{`This example enables subscriptions for an Express server that uses `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`apollo-server-express`}</code>{`:`}</p>\n    <div {...{\n      \"className\": \"gatsby-highlight\",\n      \"data-language\": \"js\"\n    }}><pre parentName=\"div\" {...{\n        \"style\": {\n          \"counterReset\": \"linenumber NaN\"\n        },\n        \"className\": \"language-js line-numbers\"\n      }}><code parentName=\"pre\" {...{\n          \"className\": \"language-js\"\n        }}><span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` http `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'http'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` ApolloServer `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'apollo-server-express'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` express `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`require`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token string\"\n          }}>{`'express'`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n\n`}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`async`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`function`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`startApolloServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token constant\"\n          }}>{`PORT`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token number\"\n          }}>{`4000`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` app `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`express`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` server `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`ApolloServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` typeDefs`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` resolvers `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` server`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`start`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  server`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`applyMiddleware`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{`app`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span>{`\n\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`const`}</span>{` httpServer `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=`}</span>{` http`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`createServer`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span>{`app`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"gatsby-highlight-code-line\"\n          }}>{`  server`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`.`}</span><span parentName=\"span\" {...{\n              \"className\": \"token function\"\n            }}>{`installSubscriptionHandlers`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`(`}</span>{`httpServer`}<span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`)`}</span><span parentName=\"span\" {...{\n              \"className\": \"token punctuation\"\n            }}>{`;`}</span></span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token comment\"\n          }}>{`// Make sure to call listen on httpServer, NOT on app.`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`await`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`new`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token class-name\"\n          }}>{`Promise`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token parameter\"\n          }}>{`resolve`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token operator\"\n          }}>{`=>`}</span>{` httpServer`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`listen`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token constant\"\n          }}>{`PORT`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` resolve`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  console`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token template-string\"\n          }}><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{` Server ready at http://localhost:`}</span><span parentName=\"span\" {...{\n              \"className\": \"token interpolation\"\n            }}><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`\\${`}</span><span parentName=\"span\" {...{\n                \"className\": \"token constant\"\n              }}>{`PORT`}</span><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`}`}</span></span><span parentName=\"span\" {...{\n              \"className\": \"token interpolation\"\n            }}><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`\\${`}</span>{`server`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span>{`graphqlPath`}<span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`}`}</span></span><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span></span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  console`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`.`}</span><span parentName=\"code\" {...{\n            \"className\": \"token function\"\n          }}>{`log`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`(`}</span><span parentName=\"code\" {...{\n            \"className\": \"token template-string\"\n          }}><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span><span parentName=\"span\" {...{\n              \"className\": \"token string\"\n            }}>{` Subscriptions ready at ws://localhost:`}</span><span parentName=\"span\" {...{\n              \"className\": \"token interpolation\"\n            }}><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`\\${`}</span><span parentName=\"span\" {...{\n                \"className\": \"token constant\"\n              }}>{`PORT`}</span><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`}`}</span></span><span parentName=\"span\" {...{\n              \"className\": \"token interpolation\"\n            }}><span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`\\${`}</span>{`server`}<span parentName=\"span\" {...{\n                \"className\": \"token punctuation\"\n              }}>{`.`}</span>{`subscriptionsPath`}<span parentName=\"span\" {...{\n                \"className\": \"token interpolation-punctuation punctuation\"\n              }}>{`}`}</span></span><span parentName=\"span\" {...{\n              \"className\": \"token template-punctuation string\"\n            }}>{`\\``}</span></span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`)`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n  `}<span parentName=\"code\" {...{\n            \"className\": \"token keyword\"\n          }}>{`return`}</span>{` `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`{`}</span>{` server`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` app`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`,`}</span>{` httpServer `}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span><span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`;`}</span>{`\n`}<span parentName=\"code\" {...{\n            \"className\": \"token punctuation\"\n          }}>{`}`}</span></code><span parentName=\"pre\" {...{\n          \"aria-hidden\": \"true\",\n          \"className\": \"line-numbers-rows\",\n          \"style\": {\n            \"whiteSpace\": \"normal\",\n            \"width\": \"auto\",\n            \"left\": \"0\"\n          }\n        }}><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span><span parentName=\"span\"></span></span></pre></div>\n    <h2 {...{\n      \"id\": \"production-pubsub-libraries\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#production-pubsub-libraries\",\n        \"aria-label\": \"production pubsub libraries permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Production `}<code parentName=\"h2\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` libraries`}</h2>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"#the-pubsub-class\"\n      }}>{`As mentioned above`}</a>{`, the `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` class is `}<em parentName=\"p\">{`not`}</em>{` recommended for production environments, because its event-publishing system is in-memory. This means that events published by `}<em parentName=\"p\">{`one`}</em>{` instance of your GraphQL server are not received by subscriptions that are handled by `}<em parentName=\"p\">{`other`}</em>{` instances.`}</p>\n    <p>{`Instead, you should use a subclass of the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apollographql/graphql-subscriptions/blob/master/src/pubsub-engine.ts\"\n      }}><code parentName=\"a\" {...{\n          \"className\": \"language-text\"\n        }}>{`PubSubEngine`}</code>{` abstract class`}</a>{` that you can back with an external datastore such as Redis or Kafka.`}</p>\n    <p>{`The following are community-created `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSub`}</code>{` libraries for popular event-publishing systems:`}</p>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/davidyaha/graphql-redis-subscriptions\"\n        }}>{`Redis`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/axelspringer/graphql-google-pubsub\"\n        }}>{`Google PubSub`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/davidyaha/graphql-mqtt-subscriptions\"\n        }}>{`MQTT enabled broker`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/cdmbase/graphql-rabbitmq-subscriptions\"\n        }}>{`RabbitMQ`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/ancashoria/graphql-kafka-subscriptions\"\n        }}>{`Kafka`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/GraphQLCollege/graphql-postgres-subscriptions\"\n        }}>{`Postgres`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/MrBoolean/graphql-firestore-subscriptions\"\n        }}>{`Google Cloud Firestore`}</a></li>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/ably-labs/graphql-ably-pubsub\"\n        }}>{`Ably Realtime`}</a></li>\n    </ul>\n    <p>{`If none of these libraries fits your use case, you can also create your own `}<code parentName=\"p\" {...{\n        \"className\": \"language-text\"\n      }}>{`PubSubEngine`}</code>{` subclass. If you create a new open-source library, click `}<strong parentName=\"p\">{`Edit on GitHub`}</strong>{` to let us know about it!`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}