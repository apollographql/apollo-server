{"expireTime":9007200901520847000,"key":"transformer-remark-markdown-ast-5ad450f61c10c531dce3b3e7b806e4db-gatsby-remark-autolink-headersgatsby-remark-copy-linked-filesgatsby-remark-mermaidgatsby-remark-code-titlesgatsby-remark-prismjsgatsby-remark-rewrite-relative-linksgatsby-remark-check-links-","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"Clients send queries to Apollo Server as HTTP requests that include the GraphQL string of the query to execute. Depending on your graph's schema, the size of a valid query string might be arbitrarily large. As query strings become larger, increased latency and network usage can noticeably degrade client performance.","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":318,"offset":318}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":318,"offset":318}}},{"type":"paragraph","children":[{"type":"text","value":"To improve network performance for large query strings, Apollo Server supports ","position":{"start":{"line":4,"column":1,"offset":320},"end":{"line":4,"column":80,"offset":399}}},{"type":"strong","children":[{"type":"text","value":"Automatic Persisted Queries","position":{"start":{"line":4,"column":82,"offset":401},"end":{"line":4,"column":109,"offset":428}}}],"position":{"start":{"line":4,"column":80,"offset":399},"end":{"line":4,"column":111,"offset":430}}},{"type":"text","value":"â€Š(","position":{"start":{"line":4,"column":111,"offset":430},"end":{"line":4,"column":113,"offset":432}}},{"type":"strong","children":[{"type":"text","value":"APQ","position":{"start":{"line":4,"column":115,"offset":434},"end":{"line":4,"column":118,"offset":437}}}],"position":{"start":{"line":4,"column":113,"offset":432},"end":{"line":4,"column":120,"offset":439}}},{"type":"text","value":"). A persisted query is a query string that's cached on the server side, along with its unique identifier (always its SHA-256 hash). Clients can send this identifier ","position":{"start":{"line":4,"column":120,"offset":439},"end":{"line":4,"column":286,"offset":605}}},{"type":"emphasis","children":[{"type":"text","value":"instead of","position":{"start":{"line":4,"column":287,"offset":606},"end":{"line":4,"column":297,"offset":616}}}],"position":{"start":{"line":4,"column":286,"offset":605},"end":{"line":4,"column":298,"offset":617}}},{"type":"text","value":" the corresponding query string, thus reducing request sizes dramatically (response sizes are unaffected).","position":{"start":{"line":4,"column":298,"offset":617},"end":{"line":4,"column":404,"offset":723}}}],"position":{"start":{"line":4,"column":1,"offset":320},"end":{"line":4,"column":404,"offset":723}}},{"type":"paragraph","children":[{"type":"text","value":"To persist a query string, Apollo Server must first receive it from a requesting client. Consequently, each unique query string must be sent to Apollo Server at least once. After ","position":{"start":{"line":6,"column":1,"offset":725},"end":{"line":6,"column":180,"offset":904}}},{"type":"emphasis","children":[{"type":"text","value":"any","position":{"start":{"line":6,"column":181,"offset":905},"end":{"line":6,"column":184,"offset":908}}}],"position":{"start":{"line":6,"column":180,"offset":904},"end":{"line":6,"column":185,"offset":909}}},{"type":"text","value":" client sends a query string to persist, ","position":{"start":{"line":6,"column":185,"offset":909},"end":{"line":6,"column":226,"offset":950}}},{"type":"emphasis","children":[{"type":"text","value":"every","position":{"start":{"line":6,"column":227,"offset":951},"end":{"line":6,"column":232,"offset":956}}}],"position":{"start":{"line":6,"column":226,"offset":950},"end":{"line":6,"column":233,"offset":957}}},{"type":"text","value":" client that executes that query can then benefit from APQ.","position":{"start":{"line":6,"column":233,"offset":957},"end":{"line":6,"column":292,"offset":1016}}}],"position":{"start":{"line":6,"column":1,"offset":725},"end":{"line":6,"column":292,"offset":1016}}},{"type":"html","lang":"mermaid","meta":null,"value":"<div class=\"mermaid\" data-processed=\"true\"><svg id=\"mermaid-1646779855272\" width=\"100%\" xmlns=\"http://www.w3.org/2000/svg\" height=\"643\" style=\"max-width: 695.5px;\" viewBox=\"-50 -10 695.5 643\"><style>#mermaid-1646779855272 {font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1646779855272 .error-icon{fill:#552222;}#mermaid-1646779855272 .error-text{fill:#552222;stroke:#552222;}#mermaid-1646779855272 .edge-thickness-normal{stroke-width:2px;}#mermaid-1646779855272 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1646779855272 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1646779855272 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1646779855272 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1646779855272 .marker{fill:#333333;stroke:#333333;}#mermaid-1646779855272 .marker.cross{stroke:#333333;}#mermaid-1646779855272 svg{font-family:\"trebuchet ms\",verdana,arial,sans-serif;font-size:16px;}#mermaid-1646779855272 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-1646779855272 text.actor&gt;tspan{fill:black;stroke:none;}#mermaid-1646779855272 .actor-line{stroke:grey;}#mermaid-1646779855272 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1646779855272 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1646779855272 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1646779855272 .sequenceNumber{fill:white;}#mermaid-1646779855272 #sequencenumber{fill:#333;}#mermaid-1646779855272 #crosshead path{fill:#333;stroke:#333;}#mermaid-1646779855272 .messageText{fill:#333;stroke:#333;}#mermaid-1646779855272 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-1646779855272 .labelText,#mermaid-1646779855272 .labelText&gt;tspan{fill:black;stroke:none;}#mermaid-1646779855272 .loopText,#mermaid-1646779855272 .loopText&gt;tspan{fill:black;stroke:none;}#mermaid-1646779855272 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mermaid-1646779855272 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1646779855272 .noteText,#mermaid-1646779855272 .noteText&gt;tspan{fill:black;stroke:none;}#mermaid-1646779855272 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1646779855272 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1646779855272 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1646779855272 .actorPopupMenu{position:absolute;}#mermaid-1646779855272 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-1646779855272 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mermaid-1646779855272 .actor-man circle,#mermaid-1646779855272 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mermaid-1646779855272 .node rect,#mermaid-1646779855272 .node circle,#mermaid-1646779855272 .node polygon,#mermaid-1646779855272 .node path{stroke-width:2px;stroke:#3f20ba;fill:#F4F6F8;}#mermaid-1646779855272 .node.secondary rect,#mermaid-1646779855272 .node.secondary circle,#mermaid-1646779855272 .node.secondary polygon,#mermaid-1646779855272 .node.tertiary rect,#mermaid-1646779855272 .node.tertiary circle,#mermaid-1646779855272 .node.tertiary polygon{fill:white;}#mermaid-1646779855272 .node.secondary rect,#mermaid-1646779855272 .node.secondary circle,#mermaid-1646779855272 .node.secondary polygon{stroke:#832363;}#mermaid-1646779855272 .cluster rect,#mermaid-1646779855272 .node.tertiary rect,#mermaid-1646779855272 .node.tertiary circle,#mermaid-1646779855272 .node.tertiary polygon{stroke:#1d7b78;}#mermaid-1646779855272 .cluster rect{fill:none;stroke-width:2px;}#mermaid-1646779855272 .label,#mermaid-1646779855272 .edgeLabel{background-color:white;line-height:1.3;}#mermaid-1646779855272 .edgeLabel rect{background:none;fill:none;}#mermaid-1646779855272 .messageText,#mermaid-1646779855272 .noteText,#mermaid-1646779855272 .loopText{font-size:12px;stroke:none;}#mermaid-1646779855272 g rect,#mermaid-1646779855272 polygon.labelBox{stroke-width:2px;}#mermaid-1646779855272 g rect.actor{stroke:#1d7b78;fill:white;}#mermaid-1646779855272 g rect.note{stroke:#832363;fill:white;}#mermaid-1646779855272 g line.loopLine,#mermaid-1646779855272 polygon.labelBox{stroke:#3f20ba;fill:white;}#mermaid-1646779855272 :root{--mermaid-font-family:\"trebuchet ms\",verdana,arial,sans-serif;}</style><g></g><defs><symbol id=\"computer\" width=\"24\" height=\"24\"><path transform=\"scale(.5)\" d=\"M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z\"></path></symbol></defs><defs><symbol id=\"database\" fill-rule=\"evenodd\" clip-rule=\"evenodd\"><path transform=\"scale(.5)\" d=\"M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z\"></path></symbol></defs><defs><symbol id=\"clock\" width=\"24\" height=\"24\"><path transform=\"scale(.5)\" d=\"M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z\"></path></symbol></defs><g><line id=\"actor0\" x1=\"75\" y1=\"5\" x2=\"75\" y2=\"577\" class=\"200\" stroke-width=\"0.5px\" stroke=\"#999\"></line><g id=\"root-0\"><rect x=\"0\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"75\" dy=\"0\">Client app</tspan></text></g></g><g><line id=\"actor1\" x1=\"478\" y1=\"5\" x2=\"478\" y2=\"577\" class=\"200\" stroke-width=\"0.5px\" stroke=\"#999\"></line><g id=\"root-1\"><rect x=\"403\" y=\"0\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"478\" y=\"32.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"478\" dy=\"0\">Apollo Server</tspan></text></g></g><defs><marker id=\"arrowhead\" refX=\"9\" refY=\"5\" markerUnits=\"userSpaceOnUse\" markerWidth=\"12\" markerHeight=\"12\" orient=\"auto\"><path d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker></defs><defs><marker id=\"crosshead\" markerWidth=\"15\" markerHeight=\"8\" orient=\"auto\" refX=\"16\" refY=\"4\"><path fill=\"black\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 9,2 V 6 L16,4 Z\" style=\"stroke-dasharray: 0, 0;\"></path><path fill=\"none\" stroke=\"#000000\" stroke-width=\"1px\" d=\"M 0,1 L 6,7 M 6,1 L 0,7\" style=\"stroke-dasharray: 0, 0;\"></path></marker></defs><defs><marker id=\"filled-head\" refX=\"18\" refY=\"7\" markerWidth=\"20\" markerHeight=\"28\" orient=\"auto\"><path d=\"M 18,7 L9,13 L14,7 L9,1 Z\"></path></marker></defs><defs><marker id=\"sequencenumber\" refX=\"15\" refY=\"15\" markerWidth=\"60\" markerHeight=\"40\" orient=\"auto\"><circle cx=\"15\" cy=\"15\" r=\"6\"></circle></marker></defs><text x=\"277\" y=\"80\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;\">Sends SHA-256 hash of query string to execute</text><line x1=\"75\" y1=\"113\" x2=\"478\" y2=\"113\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><g><rect x=\"360.5\" y=\"123\" fill=\"#EDF2AE\" stroke=\"#666\" width=\"235\" height=\"36\" rx=\"0\" ry=\"0\" class=\"note\"></rect><text x=\"478\" y=\"128\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"noteText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;\"><tspan x=\"478\">Fails to find persisted query string</tspan></text></g><text x=\"277\" y=\"174\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;\">Responds with error</text><line x1=\"478\" y1=\"207\" x2=\"75\" y2=\"207\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><text x=\"277\" y=\"222\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;\">Sends both query string AND hash</text><line x1=\"75\" y1=\"255\" x2=\"478\" y2=\"255\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><g><rect x=\"375\" y=\"265\" fill=\"#EDF2AE\" stroke=\"#666\" width=\"206\" height=\"36\" rx=\"0\" ry=\"0\" class=\"note\"></rect><text x=\"478\" y=\"270\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"noteText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;\"><tspan x=\"478\">Persists query string and hash</tspan></text></g><text x=\"277\" y=\"316\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;\">Executes query and returns result</text><line x1=\"478\" y1=\"349\" x2=\"75\" y2=\"349\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><g><rect x=\"0\" y=\"359\" fill=\"#EDF2AE\" stroke=\"#666\" width=\"150\" height=\"36\" rx=\"0\" ry=\"0\" class=\"note\"></rect><text x=\"75\" y=\"364\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"noteText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;\"><tspan x=\"75\">Time passes</tspan></text></g><text x=\"277\" y=\"410\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;\">Sends SHA-256 hash of query string to execute</text><line x1=\"75\" y1=\"443\" x2=\"478\" y2=\"443\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><g><rect x=\"381.5\" y=\"453\" fill=\"#EDF2AE\" stroke=\"#666\" width=\"193\" height=\"36\" rx=\"0\" ry=\"0\" class=\"note\"></rect><text x=\"478\" y=\"458\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"noteText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;\"><tspan x=\"478\">Finds persisted query string</tspan></text></g><text x=\"277\" y=\"504\" text-anchor=\"middle\" dominant-baseline=\"middle\" alignment-baseline=\"middle\" class=\"messageText\" dy=\"1em\" style=\"font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;\">Executes query and returns result</text><line x1=\"478\" y1=\"537\" x2=\"75\" y2=\"537\" class=\"messageLine0\" stroke-width=\"2\" stroke=\"none\" marker-end=\"url(#arrowhead)\" style=\"fill: none;\"></line><g><rect x=\"0\" y=\"557\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"75\" y=\"589.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"75\" dy=\"0\">Client app</tspan></text></g><g><rect x=\"403\" y=\"557\" fill=\"#eaeaea\" stroke=\"#666\" width=\"150\" height=\"65\" rx=\"3\" ry=\"3\" class=\"actor\"></rect><text x=\"478\" y=\"589.5\" dominant-baseline=\"central\" alignment-baseline=\"central\" class=\"actor\" style=\"text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;\"><tspan x=\"478\" dy=\"0\">Apollo Server</tspan></text></g></svg></div>","position":{"start":{"line":8,"column":1,"offset":1018},"end":{"line":20,"column":4,"offset":1656}}},{"type":"paragraph","children":[{"type":"text","value":"Persisted queries are especially effective when clients send queries as ","position":{"start":{"line":22,"column":1,"offset":1658},"end":{"line":22,"column":73,"offset":1730}}},{"type":"html","value":"<code class=\"language-text\">GET</code>","position":{"start":{"line":22,"column":73,"offset":1730},"end":{"line":22,"column":78,"offset":1735}}},{"type":"text","value":" requests. This enables clients to take advantage of the browser cache and ","position":{"start":{"line":22,"column":78,"offset":1735},"end":{"line":22,"column":153,"offset":1810}}},{"type":"link","title":null,"url":"#using-get-requests-with-apq-on-a-cdn","children":[{"type":"text","value":"integrate with a CDN","position":{"start":{"line":22,"column":154,"offset":1811},"end":{"line":22,"column":174,"offset":1831}}}],"position":{"start":{"line":22,"column":153,"offset":1810},"end":{"line":22,"column":214,"offset":1871}}},{"type":"text","value":".","position":{"start":{"line":22,"column":214,"offset":1871},"end":{"line":22,"column":215,"offset":1872}}}],"position":{"start":{"line":22,"column":1,"offset":1658},"end":{"line":22,"column":215,"offset":1872}}},{"type":"paragraph","children":[{"type":"text","value":"Because query identifiers are deterministic hashes, clients can generate them at runtime. No additional build steps are required.","position":{"start":{"line":24,"column":1,"offset":1874},"end":{"line":24,"column":130,"offset":2003}}}],"position":{"start":{"line":24,"column":1,"offset":1874},"end":{"line":24,"column":130,"offset":2003}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#apollo-client-setup","title":null,"children":[],"data":{"hProperties":{"aria-label":"apollo client setup permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Apollo Client setup","position":{"start":{"line":26,"column":4,"offset":2008},"end":{"line":26,"column":23,"offset":2027}}}],"position":{"start":{"line":26,"column":1,"offset":2005},"end":{"line":26,"column":23,"offset":2027}},"data":{"id":"apollo-client-setup","htmlAttributes":{"id":"apollo-client-setup"},"hProperties":{"id":"apollo-client-setup","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server supports APQ without any additional configuration. However, some ","position":{"start":{"line":28,"column":1,"offset":2029},"end":{"line":28,"column":80,"offset":2108}}},{"type":"emphasis","children":[{"type":"text","value":"client-side","position":{"start":{"line":28,"column":81,"offset":2109},"end":{"line":28,"column":92,"offset":2120}}}],"position":{"start":{"line":28,"column":80,"offset":2108},"end":{"line":28,"column":93,"offset":2121}}},{"type":"text","value":" configuration is required.","position":{"start":{"line":28,"column":93,"offset":2121},"end":{"line":28,"column":120,"offset":2148}}}],"position":{"start":{"line":28,"column":1,"offset":2029},"end":{"line":28,"column":120,"offset":2148}}},{"type":"paragraph","children":[{"type":"text","value":"To set up APQ in Apollo Client, first import the ","position":{"start":{"line":30,"column":1,"offset":2150},"end":{"line":30,"column":50,"offset":2199}}},{"type":"html","value":"<code class=\"language-text\">createPersistedQueryLink</code>","position":{"start":{"line":30,"column":50,"offset":2199},"end":{"line":30,"column":76,"offset":2225}}},{"type":"text","value":" function in the same file where you initialize ","position":{"start":{"line":30,"column":76,"offset":2225},"end":{"line":30,"column":124,"offset":2273}}},{"type":"html","value":"<code class=\"language-text\">ApolloClient</code>","position":{"start":{"line":30,"column":124,"offset":2273},"end":{"line":30,"column":138,"offset":2287}}},{"type":"text","value":":","position":{"start":{"line":30,"column":138,"offset":2287},"end":{"line":30,"column":139,"offset":2288}}}],"position":{"start":{"line":30,"column":1,"offset":2150},"end":{"line":30,"column":139,"offset":2288}}},{"type":"html","value":"<div class=\"gatsby-code-title\">index.js</div>"},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createPersistedQueryLink <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@apollo/client/link/persisted-queries\"</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":32,"column":1,"offset":2290},"end":{"line":34,"column":4,"offset":2396}}},{"type":"paragraph","children":[{"type":"text","value":"This function creates a link that you can add to your client's ","position":{"start":{"line":36,"column":1,"offset":2398},"end":{"line":36,"column":64,"offset":2461}}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/react/api/link/introduction/","children":[{"type":"text","value":"Apollo Link chain","position":{"start":{"line":36,"column":65,"offset":2462},"end":{"line":36,"column":82,"offset":2479}}}],"position":{"start":{"line":36,"column":64,"offset":2461},"end":{"line":36,"column":148,"offset":2545}}},{"type":"text","value":". The link takes care of generating APQ identifiers, using ","position":{"start":{"line":36,"column":148,"offset":2545},"end":{"line":36,"column":207,"offset":2604}}},{"type":"html","value":"<code class=\"language-text\">GET</code>","position":{"start":{"line":36,"column":207,"offset":2604},"end":{"line":36,"column":212,"offset":2609}}},{"type":"text","value":" requests for hashed queries, and retrying requests with query strings when necessary.","position":{"start":{"line":36,"column":212,"offset":2609},"end":{"line":36,"column":298,"offset":2695}}}],"position":{"start":{"line":36,"column":1,"offset":2398},"end":{"line":36,"column":298,"offset":2695}}},{"type":"paragraph","children":[{"type":"text","value":"Add the persisted query link anywhere in the chain before the terminating link. This example shows a basic two-link chain:","position":{"start":{"line":38,"column":1,"offset":2697},"end":{"line":38,"column":123,"offset":2819}}}],"position":{"start":{"line":38,"column":1,"offset":2697},"end":{"line":38,"column":123,"offset":2819}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloClient<span class=\"token punctuation\">,</span> InMemoryCache<span class=\"token punctuation\">,</span> HttpLink <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@apollo/client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createPersistedQueryLink <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@apollo/client/link/persisted-queries\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sha256 <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'crypto-hash'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> linkChain <span class=\"token operator\">=</span> <span class=\"token function\">createPersistedQueryLink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> sha256 <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpLink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">uri</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:4000/graphql\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InMemoryCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">link</span><span class=\"token operator\">:</span> linkChain<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":40,"column":1,"offset":2821},"end":{"line":52,"column":4,"offset":3233}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#command-line-testing","title":null,"children":[],"data":{"hProperties":{"aria-label":"command line testing permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Command-line testing","position":{"start":{"line":54,"column":4,"offset":3238},"end":{"line":54,"column":24,"offset":3258}}}],"position":{"start":{"line":54,"column":1,"offset":3235},"end":{"line":54,"column":24,"offset":3258}},"data":{"id":"command-line-testing","htmlAttributes":{"id":"command-line-testing"},"hProperties":{"id":"command-line-testing","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"You can test out APQ directly from the command line. This section also helps illustrate the shape of APQ requests, so you can use it to add APQ support to GraphQL clients besides Apollo Client.","position":{"start":{"line":56,"column":1,"offset":3260},"end":{"line":56,"column":194,"offset":3453}}}],"position":{"start":{"line":56,"column":1,"offset":3260},"end":{"line":56,"column":194,"offset":3453}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"This section assumes your server is running locally at ","position":{"start":{"line":58,"column":3,"offset":3457},"end":{"line":58,"column":58,"offset":3512}}},{"type":"html","value":"<code class=\"language-text\">http://localhost:4000/graphql</code>","position":{"start":{"line":58,"column":58,"offset":3512},"end":{"line":58,"column":89,"offset":3543}}},{"type":"text","value":".","position":{"start":{"line":58,"column":89,"offset":3543},"end":{"line":58,"column":90,"offset":3544}}}],"position":{"start":{"line":58,"column":3,"offset":3457},"end":{"line":58,"column":90,"offset":3544}}}],"position":{"start":{"line":58,"column":1,"offset":3455},"end":{"line":58,"column":90,"offset":3544}}},{"type":"paragraph","children":[{"type":"text","value":"Every GraphQL server supports the following query (which requests the ","position":{"start":{"line":60,"column":1,"offset":3546},"end":{"line":60,"column":71,"offset":3616}}},{"type":"html","value":"<code class=\"language-text\">__typename</code>","position":{"start":{"line":60,"column":71,"offset":3616},"end":{"line":60,"column":83,"offset":3628}}},{"type":"text","value":" field from the ","position":{"start":{"line":60,"column":83,"offset":3628},"end":{"line":60,"column":99,"offset":3644}}},{"type":"html","value":"<code class=\"language-text\">Query</code>","position":{"start":{"line":60,"column":99,"offset":3644},"end":{"line":60,"column":106,"offset":3651}}},{"type":"text","value":" type):","position":{"start":{"line":60,"column":106,"offset":3651},"end":{"line":60,"column":113,"offset":3658}}}],"position":{"start":{"line":60,"column":1,"offset":3546},"end":{"line":60,"column":113,"offset":3658}}},{"type":"html","lang":"graphql","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span><span class=\"token property\">__typename</span><span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":62,"column":1,"offset":3660},"end":{"line":64,"column":4,"offset":3687}}},{"type":"paragraph","children":[{"type":"text","value":"The SHA-256 hash of this query string is the following:","position":{"start":{"line":66,"column":1,"offset":3689},"end":{"line":66,"column":56,"offset":3744}}}],"position":{"start":{"line":66,"column":1,"offset":3689},"end":{"line":66,"column":56,"offset":3744}}},{"type":"html","lang":"none","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"none\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-none line-numbers\"><code class=\"language-none\">ecf4edb46db40b5132295c0291d62fb65d6759a9eedfa4d5d612dd5ec54a6b38</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":68,"column":1,"offset":3746},"end":{"line":70,"column":4,"offset":3822}}},{"type":"list","ordered":true,"start":1,"spread":true,"children":[{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Attempt to execute this query on your running server by providing its hash in a ","position":{"start":{"line":72,"column":4,"offset":3827},"end":{"line":72,"column":84,"offset":3907}}},{"type":"html","value":"<code class=\"language-text\">curl</code>","position":{"start":{"line":72,"column":84,"offset":3907},"end":{"line":72,"column":90,"offset":3913}}},{"type":"text","value":" command, like so:","position":{"start":{"line":72,"column":90,"offset":3913},"end":{"line":72,"column":108,"offset":3931}}}],"position":{"start":{"line":72,"column":4,"offset":3827},"end":{"line":72,"column":108,"offset":3931}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token function\">curl</span> --get http://localhost:4000/graphql <span class=\"token punctuation\">\\</span>\n  --data-urlencode <span class=\"token string\">'extensions={\"persistedQuery\":{\"version\":1,\"sha256Hash\":\"ecf4edb46db40b5132295c0291d62fb65d6759a9eedfa4d5d612dd5ec54a6b38\"}}'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>","position":{"start":{"line":74,"column":5,"offset":3937},"end":{"line":77,"column":8,"offset":4149}}},{"type":"paragraph","children":[{"type":"text","value":"The first time you try this, Apollo Server responds with an error with the code ","position":{"start":{"line":79,"column":5,"offset":4155},"end":{"line":79,"column":85,"offset":4235}}},{"type":"html","value":"<code class=\"language-text\">PERSISTED_QUERY_NOT_FOUND</code>","position":{"start":{"line":79,"column":85,"offset":4235},"end":{"line":79,"column":112,"offset":4262}}},{"type":"text","value":". This tells us that Apollo Server hasn't yet received the associated query string.","position":{"start":{"line":79,"column":112,"offset":4262},"end":{"line":79,"column":195,"offset":4345}}}],"position":{"start":{"line":79,"column":5,"offset":4155},"end":{"line":79,"column":195,"offset":4345}}}],"position":{"start":{"line":72,"column":1,"offset":3824},"end":{"line":79,"column":195,"offset":4345}}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Send a followup request that includes both the query string ","position":{"start":{"line":81,"column":4,"offset":4350},"end":{"line":81,"column":64,"offset":4410}}},{"type":"emphasis","children":[{"type":"text","value":"and","position":{"start":{"line":81,"column":65,"offset":4411},"end":{"line":81,"column":68,"offset":4414}}}],"position":{"start":{"line":81,"column":64,"offset":4410},"end":{"line":81,"column":69,"offset":4415}}},{"type":"text","value":" its hash, like so:","position":{"start":{"line":81,"column":69,"offset":4415},"end":{"line":81,"column":88,"offset":4434}}}],"position":{"start":{"line":81,"column":4,"offset":4350},"end":{"line":81,"column":88,"offset":4434}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token function\">curl</span> --get http://localhost:4000/graphql <span class=\"token punctuation\">\\</span>\n  --data-urlencode <span class=\"token string\">'query={__typename}'</span> <span class=\"token punctuation\">\\</span>\n  --data-urlencode <span class=\"token string\">'extensions={\"persistedQuery\":{\"version\":1,\"sha256Hash\":\"ecf4edb46db40b5132295c0291d62fb65d6759a9eedfa4d5d612dd5ec54a6b38\"}}'</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":83,"column":5,"offset":4440},"end":{"line":87,"column":8,"offset":4698}}},{"type":"paragraph","children":[{"type":"text","value":"This time, the server persists the query string and then responds with the query result as we'd expect.","position":{"start":{"line":89,"column":5,"offset":4704},"end":{"line":89,"column":108,"offset":4807}}}],"position":{"start":{"line":89,"column":5,"offset":4704},"end":{"line":89,"column":108,"offset":4807}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"The hash you provide ","position":{"start":{"line":91,"column":7,"offset":4815},"end":{"line":91,"column":28,"offset":4836}}},{"type":"emphasis","children":[{"type":"text","value":"must","position":{"start":{"line":91,"column":29,"offset":4837},"end":{"line":91,"column":33,"offset":4841}}}],"position":{"start":{"line":91,"column":28,"offset":4836},"end":{"line":91,"column":34,"offset":4842}}},{"type":"text","value":" be the exact SHA-256 hash of the query string. If it isn't, Apollo Server returns an error.","position":{"start":{"line":91,"column":34,"offset":4842},"end":{"line":91,"column":126,"offset":4934}}}],"position":{"start":{"line":91,"column":7,"offset":4815},"end":{"line":91,"column":126,"offset":4934}}}],"position":{"start":{"line":91,"column":5,"offset":4813},"end":{"line":91,"column":126,"offset":4934}}}],"position":{"start":{"line":81,"column":1,"offset":4347},"end":{"line":91,"column":126,"offset":4934}}},{"type":"listItem","spread":true,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Finally, attempt the request from step 1 again:","position":{"start":{"line":93,"column":4,"offset":4939},"end":{"line":93,"column":51,"offset":4986}}}],"position":{"start":{"line":93,"column":4,"offset":4939},"end":{"line":93,"column":51,"offset":4986}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\"><span class=\"token function\">curl</span> --get http://localhost:4000/graphql <span class=\"token punctuation\">\\</span>\n  --data-urlencode <span class=\"token string\">'extensions={\"persistedQuery\":{\"version\":1,\"sha256Hash\":\"ecf4edb46db40b5132295c0291d62fb65d6759a9eedfa4d5d612dd5ec54a6b38\"}}'</span>    ```\n\nThis time, the server responds with the query result because it successfully located the associated query string <span class=\"token keyword\">in</span> its cache.\n</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":95,"column":5,"offset":4992},"end":{"line":101,"column":1,"offset":5336}}}],"position":{"start":{"line":93,"column":1,"offset":4936},"end":{"line":101,"column":1,"offset":5336}}}],"position":{"start":{"line":72,"column":1,"offset":3824},"end":{"line":101,"column":1,"offset":5336}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#using-get-requests-with-apq-on-a-cdn","title":null,"children":[],"data":{"hProperties":{"aria-label":"using get requests with apq on a cdn permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Using ","position":{"start":{"line":101,"column":4,"offset":5339},"end":{"line":101,"column":10,"offset":5345}}},{"type":"html","value":"<code class=\"language-text\">GET</code>","position":{"start":{"line":101,"column":10,"offset":5345},"end":{"line":101,"column":15,"offset":5350}}},{"type":"text","value":" requests with APQ on a CDN","position":{"start":{"line":101,"column":15,"offset":5350},"end":{"line":101,"column":42,"offset":5377}}}],"position":{"start":{"line":101,"column":1,"offset":5336},"end":{"line":101,"column":42,"offset":5377}},"data":{"id":"using-get-requests-with-apq-on-a-cdn","htmlAttributes":{"id":"using-get-requests-with-apq-on-a-cdn"},"hProperties":{"id":"using-get-requests-with-apq-on-a-cdn","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"A great application for APQ is running Apollo Server behind a CDN. Many CDNs only cache GET requests, but many GraphQL queries are too long to fit comfortably in a cacheable GET request.  When the APQ link is created with ","position":{"start":{"line":103,"column":1,"offset":5379},"end":{"line":103,"column":223,"offset":5601}}},{"type":"html","value":"<code class=\"language-text\">createPersistedQueryLink({useGETForHashedQueries: true})</code>","position":{"start":{"line":103,"column":223,"offset":5601},"end":{"line":103,"column":281,"offset":5659}}},{"type":"text","value":", Apollo Client automatically sends the short hashed queries as GET requests allowing a CDN to serve those request. For full-length queries and for all mutations, Apollo Client will continue to use POST requests.","position":{"start":{"line":103,"column":281,"offset":5659},"end":{"line":103,"column":493,"offset":5871}}}],"position":{"start":{"line":103,"column":1,"offset":5379},"end":{"line":103,"column":493,"offset":5871}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#cdn-integration","title":null,"children":[],"data":{"hProperties":{"aria-label":"cdn integration permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"CDN Integration","position":{"start":{"line":105,"column":4,"offset":5876},"end":{"line":105,"column":19,"offset":5891}}}],"position":{"start":{"line":105,"column":1,"offset":5873},"end":{"line":105,"column":19,"offset":5891}},"data":{"id":"cdn-integration","htmlAttributes":{"id":"cdn-integration"},"hProperties":{"id":"cdn-integration","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"Content Delivery Networks (CDNs) such as ","position":{"start":{"line":107,"column":1,"offset":5893},"end":{"line":107,"column":42,"offset":5934}}},{"type":"link","title":null,"url":"https://fly.io","children":[{"type":"text","value":"fly.io","position":{"start":{"line":107,"column":43,"offset":5935},"end":{"line":107,"column":49,"offset":5941}}}],"position":{"start":{"line":107,"column":42,"offset":5934},"end":{"line":107,"column":66,"offset":5958}}},{"type":"text","value":", ","position":{"start":{"line":107,"column":66,"offset":5958},"end":{"line":107,"column":68,"offset":5960}}},{"type":"link","title":null,"url":"https://www.cloudflare.com/","children":[{"type":"text","value":"Cloudflare","position":{"start":{"line":107,"column":69,"offset":5961},"end":{"line":107,"column":79,"offset":5971}}}],"position":{"start":{"line":107,"column":68,"offset":5960},"end":{"line":107,"column":109,"offset":6001}}},{"type":"text","value":", ","position":{"start":{"line":107,"column":109,"offset":6001},"end":{"line":107,"column":111,"offset":6003}}},{"type":"link","title":null,"url":"https://www.akamai.com/","children":[{"type":"text","value":"Akamai","position":{"start":{"line":107,"column":112,"offset":6004},"end":{"line":107,"column":118,"offset":6010}}}],"position":{"start":{"line":107,"column":111,"offset":6003},"end":{"line":107,"column":144,"offset":6036}}},{"type":"text","value":", or ","position":{"start":{"line":107,"column":144,"offset":6036},"end":{"line":107,"column":149,"offset":6041}}},{"type":"link","title":null,"url":"https://www.fastly.com/","children":[{"type":"text","value":"Fastly","position":{"start":{"line":107,"column":150,"offset":6042},"end":{"line":107,"column":156,"offset":6048}}}],"position":{"start":{"line":107,"column":149,"offset":6041},"end":{"line":107,"column":182,"offset":6074}}},{"type":"text","value":" allow content caching close to clients, delivering data with low latency from a nearby server. Apollo Server makes it straightforward to use CDNs with GraphQL queries to cache full responses while still executing more dynamic queries.","position":{"start":{"line":107,"column":182,"offset":6074},"end":{"line":107,"column":417,"offset":6309}}}],"position":{"start":{"line":107,"column":1,"offset":5893},"end":{"line":107,"column":417,"offset":6309}}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server works well with a Content Distribution Network (CDN) to cache full GraphQL query results. By adding the appropriate cache hints, Apollo Server can calculate ","position":{"start":{"line":109,"column":1,"offset":6311},"end":{"line":109,"column":172,"offset":6482}}},{"type":"html","value":"<code class=\"language-text\">Cache-Control</code>","position":{"start":{"line":109,"column":172,"offset":6482},"end":{"line":109,"column":187,"offset":6497}}},{"type":"text","value":" headers that a CDN can use to determine how long a request should be cached. For subsequent requests, the result will be served directly from the CDN's cache. A CDN paired with Apollo Server's persisted queries is especially powerful since GraphQL operations can be shortened and sent with an HTTP GET request.","position":{"start":{"line":109,"column":187,"offset":6497},"end":{"line":109,"column":498,"offset":6808}}}],"position":{"start":{"line":109,"column":1,"offset":6311},"end":{"line":109,"column":498,"offset":6808}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#step-1-add-cache-hints-to-the-graphql-schema","title":null,"children":[],"data":{"hProperties":{"aria-label":"step 1 add cache hints to the graphql schema permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Step 1: Add cache hints to the GraphQL schema","position":{"start":{"line":111,"column":5,"offset":6814},"end":{"line":111,"column":50,"offset":6859}}}],"position":{"start":{"line":111,"column":1,"offset":6810},"end":{"line":111,"column":50,"offset":6859}},"data":{"id":"step-1-add-cache-hints-to-the-graphql-schema","htmlAttributes":{"id":"step-1-add-cache-hints-to-the-graphql-schema"},"hProperties":{"id":"step-1-add-cache-hints-to-the-graphql-schema","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"Add cache hints as ","position":{"start":{"line":113,"column":1,"offset":6861},"end":{"line":113,"column":20,"offset":6880}}},{"type":"link","title":null,"url":"/schema/directives/","children":[{"type":"text","value":"directives","position":{"start":{"line":113,"column":21,"offset":6881},"end":{"line":113,"column":31,"offset":6891}}}],"position":{"start":{"line":113,"column":20,"offset":6880},"end":{"line":113,"column":53,"offset":6913}}},{"type":"text","value":" to GraphQL schema so that Apollo Server knows which fields and types are cacheable and for how long. For example, this schema indicates that all fields that return an ","position":{"start":{"line":113,"column":53,"offset":6913},"end":{"line":113,"column":221,"offset":7081}}},{"type":"html","value":"<code class=\"language-text\">Author</code>","position":{"start":{"line":113,"column":221,"offset":7081},"end":{"line":113,"column":229,"offset":7089}}},{"type":"text","value":" should be cached for 60 seconds, and that the ","position":{"start":{"line":113,"column":229,"offset":7089},"end":{"line":113,"column":276,"offset":7136}}},{"type":"html","value":"<code class=\"language-text\">posts</code>","position":{"start":{"line":113,"column":276,"offset":7136},"end":{"line":113,"column":283,"offset":7143}}},{"type":"text","value":" field should itself be cached for 180 seconds:","position":{"start":{"line":113,"column":283,"offset":7143},"end":{"line":113,"column":330,"offset":7190}}}],"position":{"start":{"line":113,"column":1,"offset":6861},"end":{"line":113,"column":330,"offset":7190}}},{"type":"html","lang":"graphql","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-graphql line-numbers\"><code class=\"language-graphql\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">Author</span> <span class=\"token directive function\">@cacheControl</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">maxAge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token attr-name\">id</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">Int</span>\n  <span class=\"token attr-name\">firstName</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span>\n  <span class=\"token attr-name\">lastName</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span>\n  <span class=\"token attr-name\">posts</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">]</span> <span class=\"token directive function\">@cacheControl</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">maxAge</span><span class=\"token punctuation\">:</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":115,"column":1,"offset":7192},"end":{"line":122,"column":4,"offset":7340}}},{"type":"paragraph","children":[{"type":"text","value":"See ","position":{"start":{"line":124,"column":1,"offset":7342},"end":{"line":124,"column":5,"offset":7346}}},{"type":"link","title":null,"url":"/performance/caching/","children":[{"type":"text","value":"the cache control documentation","position":{"start":{"line":124,"column":6,"offset":7347},"end":{"line":124,"column":37,"offset":7378}}}],"position":{"start":{"line":124,"column":5,"offset":7346},"end":{"line":124,"column":49,"offset":7390}}},{"type":"text","value":" for more details, including how to define the ","position":{"start":{"line":124,"column":49,"offset":7390},"end":{"line":124,"column":96,"offset":7437}}},{"type":"html","value":"<code class=\"language-text\">@cacheControl</code>","position":{"start":{"line":124,"column":96,"offset":7437},"end":{"line":124,"column":111,"offset":7452}}},{"type":"text","value":" directive, how to specify hints dynamically inside resolvers, how to set a default ","position":{"start":{"line":124,"column":111,"offset":7452},"end":{"line":124,"column":195,"offset":7536}}},{"type":"html","value":"<code class=\"language-text\">maxAge</code>","position":{"start":{"line":124,"column":195,"offset":7536},"end":{"line":124,"column":203,"offset":7544}}},{"type":"text","value":" for all fields, and how to specify that a field should be cached for specific users only (in which case CDNs should ignore it). For example, to set a default max age other than ","position":{"start":{"line":124,"column":203,"offset":7544},"end":{"line":124,"column":381,"offset":7722}}},{"type":"html","value":"<code class=\"language-text\">0</code>","position":{"start":{"line":124,"column":381,"offset":7722},"end":{"line":124,"column":384,"offset":7725}}},{"type":"text","value":" modify the Apollo Server constructor to include ","position":{"start":{"line":124,"column":384,"offset":7725},"end":{"line":124,"column":433,"offset":7774}}},{"type":"html","value":"<code class=\"language-text\">cacheControl</code>","position":{"start":{"line":124,"column":433,"offset":7774},"end":{"line":124,"column":447,"offset":7788}}},{"type":"text","value":":","position":{"start":{"line":124,"column":447,"offset":7788},"end":{"line":124,"column":448,"offset":7789}}}],"position":{"start":{"line":124,"column":1,"offset":7342},"end":{"line":124,"column":448,"offset":7789}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServerPluginCacheControl <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'apollo-server-core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// The max age is calculated in seconds</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">ApolloServerPluginCacheControl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">defaultMaxAge</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":126,"column":1,"offset":7791},"end":{"line":135,"column":4,"offset":8042}}},{"type":"paragraph","children":[{"type":"text","value":"After this step, Apollo Server will serve the HTTP ","position":{"start":{"line":137,"column":1,"offset":8044},"end":{"line":137,"column":52,"offset":8095}}},{"type":"html","value":"<code class=\"language-text\">Cache-Control</code>","position":{"start":{"line":137,"column":52,"offset":8095},"end":{"line":137,"column":67,"offset":8110}}},{"type":"text","value":" header on fully cacheable responses, so that any CDN in front of Apollo Server will know which responses can be cached and for how long. A \"fully cacheable\" response contains only data with non-zero ","position":{"start":{"line":137,"column":67,"offset":8110},"end":{"line":137,"column":267,"offset":8310}}},{"type":"html","value":"<code class=\"language-text\">maxAge</code>","position":{"start":{"line":137,"column":267,"offset":8310},"end":{"line":137,"column":275,"offset":8318}}},{"type":"text","value":"; the header will refer to the minimum ","position":{"start":{"line":137,"column":275,"offset":8318},"end":{"line":137,"column":314,"offset":8357}}},{"type":"html","value":"<code class=\"language-text\">maxAge</code>","position":{"start":{"line":137,"column":314,"offset":8357},"end":{"line":137,"column":322,"offset":8365}}},{"type":"text","value":" value across the whole response, and it will be ","position":{"start":{"line":137,"column":322,"offset":8365},"end":{"line":137,"column":371,"offset":8414}}},{"type":"html","value":"<code class=\"language-text\">public</code>","position":{"start":{"line":137,"column":371,"offset":8414},"end":{"line":137,"column":379,"offset":8422}}},{"type":"text","value":" unless some of the data is tagged ","position":{"start":{"line":137,"column":379,"offset":8422},"end":{"line":137,"column":414,"offset":8457}}},{"type":"html","value":"<code class=\"language-text\">scope: PRIVATE</code>","position":{"start":{"line":137,"column":414,"offset":8457},"end":{"line":137,"column":430,"offset":8473}}},{"type":"text","value":". To observe this header, use any browser's network tab in its dev tools.","position":{"start":{"line":137,"column":430,"offset":8473},"end":{"line":137,"column":503,"offset":8546}}}],"position":{"start":{"line":137,"column":1,"offset":8044},"end":{"line":137,"column":503,"offset":8546}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#step-2-enable-automatic-persisted-queries","title":null,"children":[],"data":{"hProperties":{"aria-label":"step 2 enable automatic persisted queries permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Step 2: Enable automatic persisted queries","position":{"start":{"line":139,"column":5,"offset":8552},"end":{"line":139,"column":47,"offset":8594}}}],"position":{"start":{"line":139,"column":1,"offset":8548},"end":{"line":139,"column":47,"offset":8594}},"data":{"id":"step-2-enable-automatic-persisted-queries","htmlAttributes":{"id":"step-2-enable-automatic-persisted-queries"},"hProperties":{"id":"step-2-enable-automatic-persisted-queries","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"Often, GraphQL requests are big POST requests and most CDNs will only cache GET requests. Additionally, GET requests generally work best when the URL has a bounded size. Enabling automatic persisted queries means that short hashes are sent over the wire instead of full queries, and Apollo Client can be configured to use GET requests for those hashed queries.","position":{"start":{"line":141,"column":1,"offset":8596},"end":{"line":141,"column":361,"offset":8956}}}],"position":{"start":{"line":141,"column":1,"offset":8596},"end":{"line":141,"column":361,"offset":8956}}},{"type":"paragraph","children":[{"type":"text","value":"To do this, update the ","position":{"start":{"line":143,"column":1,"offset":8958},"end":{"line":143,"column":24,"offset":8981}}},{"type":"strong","children":[{"type":"text","value":"client","position":{"start":{"line":143,"column":26,"offset":8983},"end":{"line":143,"column":32,"offset":8989}}}],"position":{"start":{"line":143,"column":24,"offset":8981},"end":{"line":143,"column":34,"offset":8991}}},{"type":"text","value":" code. Add the persisted queries link to the Apollo Client constructor before the HTTP link:","position":{"start":{"line":143,"column":34,"offset":8991},"end":{"line":143,"column":126,"offset":9083}}}],"position":{"start":{"line":143,"column":1,"offset":8958},"end":{"line":143,"column":126,"offset":9083}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloClient<span class=\"token punctuation\">,</span> InMemoryCache<span class=\"token punctuation\">,</span> HttpLink <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@apollo/client\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createPersistedQueryLink <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@apollo/client/link/persisted-queries\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> sha256 <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'crypto-hash'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> <span class=\"token function\">createPersistedQueryLink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  sha256<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">useGETForHashedQueries</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">concat</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpLink</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">uri</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/graphql\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InMemoryCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  link<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":145,"column":1,"offset":9085},"end":{"line":161,"column":4,"offset":9495}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If you are testing locally, make sure to include the full ","position":{"start":{"line":163,"column":3,"offset":9499},"end":{"line":163,"column":61,"offset":9557}}},{"type":"link","title":null,"url":"https://developer.mozilla.org/en-US/docs/Glossary/URI","children":[{"type":"text","value":"URI","position":{"start":{"line":163,"column":62,"offset":9558},"end":{"line":163,"column":65,"offset":9561}}}],"position":{"start":{"line":163,"column":61,"offset":9557},"end":{"line":163,"column":121,"offset":9617}}},{"type":"text","value":" including the port number. For example:  ","position":{"start":{"line":163,"column":121,"offset":9617},"end":{"line":163,"column":163,"offset":9659}}},{"type":"html","value":"<code class=\"language-text\"> uri: \"http://localhost:4000/graphql\"</code>","position":{"start":{"line":163,"column":163,"offset":9659},"end":{"line":163,"column":202,"offset":9698}}},{"type":"text","value":".","position":{"start":{"line":163,"column":202,"offset":9698},"end":{"line":163,"column":203,"offset":9699}}}],"position":{"start":{"line":163,"column":3,"offset":9499},"end":{"line":163,"column":203,"offset":9699}}}],"position":{"start":{"line":163,"column":1,"offset":9497},"end":{"line":163,"column":203,"offset":9699}}},{"type":"paragraph","children":[{"type":"text","value":"Make sure to include ","position":{"start":{"line":165,"column":1,"offset":9701},"end":{"line":165,"column":22,"offset":9722}}},{"type":"html","value":"<code class=\"language-text\">useGETForHashedQueries: true</code>","position":{"start":{"line":165,"column":22,"offset":9722},"end":{"line":165,"column":52,"offset":9752}}},{"type":"text","value":". Note that the client will still use POSTs for mutations because it's generally best to avoid GETs for non-idempotent requests.","position":{"start":{"line":165,"column":52,"offset":9752},"end":{"line":165,"column":180,"offset":9880}}}],"position":{"start":{"line":165,"column":1,"offset":9701},"end":{"line":165,"column":180,"offset":9880}}},{"type":"paragraph","children":[{"type":"text","value":"If configured correctly, browser's dev tools should verify that queries are now sent as GET requests, and receive appropriate ","position":{"start":{"line":167,"column":1,"offset":9882},"end":{"line":167,"column":127,"offset":10008}}},{"type":"html","value":"<code class=\"language-text\">Cache-Control</code>","position":{"start":{"line":167,"column":127,"offset":10008},"end":{"line":167,"column":142,"offset":10023}}},{"type":"text","value":" response headers.","position":{"start":{"line":167,"column":142,"offset":10023},"end":{"line":167,"column":160,"offset":10041}}}],"position":{"start":{"line":167,"column":1,"offset":9882},"end":{"line":167,"column":160,"offset":10041}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#step-3-set-up-a-cdn","title":null,"children":[],"data":{"hProperties":{"aria-label":"step 3 set up a cdn permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Step 3: Set up a CDN","position":{"start":{"line":169,"column":5,"offset":10047},"end":{"line":169,"column":25,"offset":10067}}}],"position":{"start":{"line":169,"column":1,"offset":10043},"end":{"line":169,"column":25,"offset":10067}},"data":{"id":"step-3-set-up-a-cdn","htmlAttributes":{"id":"step-3-set-up-a-cdn"},"hProperties":{"id":"step-3-set-up-a-cdn","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"How exactly this works depends on exactly which CDN you chose. Configure your CDN to send requests to Apollo Server. Some CDNs may need to be specially configured to honor origin Cache-Control headers; for example, here is ","position":{"start":{"line":171,"column":1,"offset":10069},"end":{"line":171,"column":224,"offset":10292}}},{"type":"link","title":null,"url":"https://learn.akamai.com/en-us/webhelp/api-gateway/api-gateway-user-guide/GUID-7019E774-7A4D-44F9-A731-330F9780C34B.html","children":[{"type":"text","value":"Akamai's documentation on that setting","position":{"start":{"line":171,"column":225,"offset":10293},"end":{"line":171,"column":263,"offset":10331}}}],"position":{"start":{"line":171,"column":224,"offset":10292},"end":{"line":171,"column":386,"offset":10454}}},{"type":"text","value":". If all is well, cacheable queries should now be saved by the CDN.","position":{"start":{"line":171,"column":386,"offset":10454},"end":{"line":171,"column":453,"offset":10521}}}],"position":{"start":{"line":171,"column":1,"offset":10069},"end":{"line":171,"column":453,"offset":10521}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"Note that requests served directly by a CDN will not show up in the Studio dashboard.","position":{"start":{"line":173,"column":3,"offset":10525},"end":{"line":173,"column":88,"offset":10610}}}],"position":{"start":{"line":173,"column":3,"offset":10525},"end":{"line":173,"column":88,"offset":10610}}}],"position":{"start":{"line":173,"column":1,"offset":10523},"end":{"line":173,"column":88,"offset":10610}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#cache-configuration","title":null,"children":[],"data":{"hProperties":{"aria-label":"cache configuration permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Cache configuration","position":{"start":{"line":175,"column":4,"offset":10615},"end":{"line":175,"column":23,"offset":10634}}}],"position":{"start":{"line":175,"column":1,"offset":10612},"end":{"line":175,"column":23,"offset":10634}},"data":{"id":"cache-configuration","htmlAttributes":{"id":"cache-configuration"},"hProperties":{"id":"cache-configuration","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"By default, Apollo Server stores its APQ registry within its local in-memory cache. If you provide a different ","position":{"start":{"line":177,"column":1,"offset":10636},"end":{"line":177,"column":112,"offset":10747}}},{"type":"html","value":"<code class=\"language-text\">cache</code>","position":{"start":{"line":177,"column":112,"offset":10747},"end":{"line":177,"column":119,"offset":10754}}},{"type":"text","value":" as a top-level option to the ","position":{"start":{"line":177,"column":119,"offset":10754},"end":{"line":177,"column":149,"offset":10784}}},{"type":"html","value":"<code class=\"language-text\">ApolloServer</code>","position":{"start":{"line":177,"column":149,"offset":10784},"end":{"line":177,"column":163,"offset":10798}}},{"type":"text","value":" constructor, Apollo Server uses that cache instead.","position":{"start":{"line":177,"column":163,"offset":10798},"end":{"line":177,"column":215,"offset":10850}}}],"position":{"start":{"line":177,"column":1,"offset":10636},"end":{"line":177,"column":215,"offset":10850}}},{"type":"paragraph","children":[{"type":"text","value":"You can also designate a cache ","position":{"start":{"line":179,"column":1,"offset":10852},"end":{"line":179,"column":32,"offset":10883}}},{"type":"emphasis","children":[{"type":"text","value":"specifically","position":{"start":{"line":179,"column":33,"offset":10884},"end":{"line":179,"column":45,"offset":10896}}}],"position":{"start":{"line":179,"column":32,"offset":10883},"end":{"line":179,"column":46,"offset":10897}}},{"type":"text","value":" for the APQ registry. To do so, provide an instance of your preferred cache class to the ","position":{"start":{"line":179,"column":46,"offset":10897},"end":{"line":179,"column":136,"offset":10987}}},{"type":"html","value":"<code class=\"language-text\">ApolloServer</code>","position":{"start":{"line":179,"column":136,"offset":10987},"end":{"line":179,"column":150,"offset":11001}}},{"type":"text","value":" constructor as a ","position":{"start":{"line":179,"column":150,"offset":11001},"end":{"line":179,"column":168,"offset":11019}}},{"type":"html","value":"<code class=\"language-text\">cache</code>","position":{"start":{"line":179,"column":168,"offset":11019},"end":{"line":179,"column":175,"offset":11026}}},{"type":"text","value":" option nested inside the ","position":{"start":{"line":179,"column":175,"offset":11026},"end":{"line":179,"column":201,"offset":11052}}},{"type":"html","value":"<code class=\"language-text\">persistedQueries</code>","position":{"start":{"line":179,"column":201,"offset":11052},"end":{"line":179,"column":219,"offset":11070}}},{"type":"text","value":" options object. The following backing data stores are supported:","position":{"start":{"line":179,"column":219,"offset":11070},"end":{"line":179,"column":284,"offset":11135}}}],"position":{"start":{"line":179,"column":1,"offset":10852},"end":{"line":179,"column":284,"offset":11135}}},{"type":"table","align":[null,null,null],"children":[{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Data store","position":{"start":{"line":181,"column":3,"offset":11139},"end":{"line":181,"column":13,"offset":11149}}}],"position":{"start":{"line":181,"column":1,"offset":11137},"end":{"line":181,"column":16,"offset":11152}}},{"type":"tableCell","children":[{"type":"text","value":"Class name","position":{"start":{"line":181,"column":17,"offset":11153},"end":{"line":181,"column":27,"offset":11163}}}],"position":{"start":{"line":181,"column":16,"offset":11152},"end":{"line":181,"column":30,"offset":11166}}},{"type":"tableCell","children":[{"type":"text","value":"Library","position":{"start":{"line":181,"column":31,"offset":11167},"end":{"line":181,"column":38,"offset":11174}}}],"position":{"start":{"line":181,"column":30,"offset":11166},"end":{"line":181,"column":41,"offset":11177}}}],"position":{"start":{"line":181,"column":1,"offset":11137},"end":{"line":181,"column":41,"offset":11177}}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Local in-memory cache (default)","position":{"start":{"line":183,"column":3,"offset":11194},"end":{"line":183,"column":34,"offset":11225}}}],"position":{"start":{"line":183,"column":1,"offset":11192},"end":{"line":183,"column":37,"offset":11228}}},{"type":"tableCell","children":[{"type":"html","value":"<code class=\"language-text\">InMemoryLRUCache</code>","position":{"start":{"line":183,"column":38,"offset":11229},"end":{"line":183,"column":56,"offset":11247}}}],"position":{"start":{"line":183,"column":37,"offset":11228},"end":{"line":183,"column":59,"offset":11250}}},{"type":"tableCell","children":[{"type":"link","title":null,"url":"https://npm.im/apollo-server-caching","children":[{"type":"html","value":"<code class=\"language-text\">apollo-server-caching</code>","position":{"start":{"line":183,"column":61,"offset":11252},"end":{"line":183,"column":84,"offset":11275}}}],"position":{"start":{"line":183,"column":60,"offset":11251},"end":{"line":183,"column":123,"offset":11314}}}],"position":{"start":{"line":183,"column":59,"offset":11250},"end":{"line":183,"column":126,"offset":11317}}}],"position":{"start":{"line":183,"column":1,"offset":11192},"end":{"line":183,"column":126,"offset":11317}}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Memcached","position":{"start":{"line":184,"column":3,"offset":11320},"end":{"line":184,"column":12,"offset":11329}}}],"position":{"start":{"line":184,"column":1,"offset":11318},"end":{"line":184,"column":15,"offset":11332}}},{"type":"tableCell","children":[{"type":"html","value":"<code class=\"language-text\">MemcachedCache</code>","position":{"start":{"line":184,"column":16,"offset":11333},"end":{"line":184,"column":32,"offset":11349}}}],"position":{"start":{"line":184,"column":15,"offset":11332},"end":{"line":184,"column":35,"offset":11352}}},{"type":"tableCell","children":[{"type":"link","title":null,"url":"https://npm.im/apollo-server-cache-memcached","children":[{"type":"html","value":"<code class=\"language-text\">apollo-server-cache-memcached</code>","position":{"start":{"line":184,"column":37,"offset":11354},"end":{"line":184,"column":68,"offset":11385}}}],"position":{"start":{"line":184,"column":36,"offset":11353},"end":{"line":184,"column":115,"offset":11432}}}],"position":{"start":{"line":184,"column":35,"offset":11352},"end":{"line":184,"column":118,"offset":11435}}}],"position":{"start":{"line":184,"column":1,"offset":11318},"end":{"line":184,"column":118,"offset":11435}}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Redis (single instance or Sentinel)","position":{"start":{"line":185,"column":3,"offset":11438},"end":{"line":185,"column":38,"offset":11473}}}],"position":{"start":{"line":185,"column":1,"offset":11436},"end":{"line":185,"column":41,"offset":11476}}},{"type":"tableCell","children":[{"type":"html","value":"<code class=\"language-text\">RedisCache</code>","position":{"start":{"line":185,"column":42,"offset":11477},"end":{"line":185,"column":54,"offset":11489}}}],"position":{"start":{"line":185,"column":41,"offset":11476},"end":{"line":185,"column":57,"offset":11492}}},{"type":"tableCell","children":[{"type":"link","title":null,"url":"https://npm.im/apollo-server-cache-redis","children":[{"type":"html","value":"<code class=\"language-text\">apollo-server-cache-redis</code>","position":{"start":{"line":185,"column":59,"offset":11494},"end":{"line":185,"column":86,"offset":11521}}}],"position":{"start":{"line":185,"column":58,"offset":11493},"end":{"line":185,"column":129,"offset":11564}}}],"position":{"start":{"line":185,"column":57,"offset":11492},"end":{"line":185,"column":132,"offset":11567}}}],"position":{"start":{"line":185,"column":1,"offset":11436},"end":{"line":185,"column":132,"offset":11567}}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Redis Cluster","position":{"start":{"line":186,"column":3,"offset":11570},"end":{"line":186,"column":16,"offset":11583}}}],"position":{"start":{"line":186,"column":1,"offset":11568},"end":{"line":186,"column":18,"offset":11585}}},{"type":"tableCell","children":[{"type":"html","value":"<code class=\"language-text\">RedisClusterCache</code>","position":{"start":{"line":186,"column":19,"offset":11586},"end":{"line":186,"column":38,"offset":11605}}}],"position":{"start":{"line":186,"column":18,"offset":11585},"end":{"line":186,"column":39,"offset":11606}}},{"type":"tableCell","children":[{"type":"link","title":null,"url":"https://npm.im/apollo-server-cache-redis","children":[{"type":"html","value":"<code class=\"language-text\">apollo-server-cache-redis</code>","position":{"start":{"line":186,"column":41,"offset":11608},"end":{"line":186,"column":68,"offset":11635}}}],"position":{"start":{"line":186,"column":40,"offset":11607},"end":{"line":186,"column":111,"offset":11678}}}],"position":{"start":{"line":186,"column":39,"offset":11606},"end":{"line":186,"column":112,"offset":11679}}}],"position":{"start":{"line":186,"column":1,"offset":11568},"end":{"line":186,"column":112,"offset":11679}}}],"position":{"start":{"line":181,"column":1,"offset":11137},"end":{"line":186,"column":112,"offset":11679}}},{"type":"paragraph","children":[{"type":"text","value":"Examples for supported data stores are provided below.","position":{"start":{"line":188,"column":1,"offset":11681},"end":{"line":188,"column":55,"offset":11735}}}],"position":{"start":{"line":188,"column":1,"offset":11681},"end":{"line":188,"column":55,"offset":11735}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#memcached","title":null,"children":[],"data":{"hProperties":{"aria-label":"memcached permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Memcached","position":{"start":{"line":190,"column":5,"offset":11741},"end":{"line":190,"column":14,"offset":11750}}}],"position":{"start":{"line":190,"column":1,"offset":11737},"end":{"line":190,"column":14,"offset":11750}},"data":{"id":"memcached","htmlAttributes":{"id":"memcached"},"hProperties":{"id":"memcached","style":"position:relative;"}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> apollo-server-cache-memcached</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":192,"column":1,"offset":11752},"end":{"line":194,"column":4,"offset":11808}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> MemcachedCache <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'apollo-server-cache-memcached'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> ApolloServer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'apollo-server'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MemcachedCache</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">[</span><span class=\"token string\">'memcached-1.local'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'memcached-2.local'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'memcached-3.local'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">retries</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">retry</span><span class=\"token operator\">:</span> <span class=\"token number\">10000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Options</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":196,"column":1,"offset":11810},"end":{"line":212,"column":4,"offset":12235}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#redis-single-instance","title":null,"children":[],"data":{"hProperties":{"aria-label":"redis single instance permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Redis (single instance)","position":{"start":{"line":214,"column":5,"offset":12241},"end":{"line":214,"column":28,"offset":12264}}}],"position":{"start":{"line":214,"column":1,"offset":12237},"end":{"line":214,"column":28,"offset":12264}},"data":{"id":"redis-single-instance","htmlAttributes":{"id":"redis-single-instance"},"hProperties":{"id":"redis-single-instance","style":"position:relative;"}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> apollo-server-cache-redis ioredis</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":216,"column":1,"offset":12266},"end":{"line":218,"column":4,"offset":12326}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> BaseRedisCache <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'apollo-server-cache-redis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ioredis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BaseRedisCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">client</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Redis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> <span class=\"token string\">'redis-server'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":220,"column":1,"offset":12328},"end":{"line":237,"column":4,"offset":12681}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#redis-sentinel","title":null,"children":[],"data":{"hProperties":{"aria-label":"redis sentinel permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Redis (Sentinel)","position":{"start":{"line":239,"column":5,"offset":12687},"end":{"line":239,"column":21,"offset":12703}}}],"position":{"start":{"line":239,"column":1,"offset":12683},"end":{"line":239,"column":21,"offset":12703}},"data":{"id":"redis-sentinel","htmlAttributes":{"id":"redis-sentinel"},"hProperties":{"id":"redis-sentinel","style":"position:relative;"}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> apollo-server-cache-redis ioredis</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":241,"column":1,"offset":12705},"end":{"line":243,"column":4,"offset":12765}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> BaseRedisCache <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'apollo-server-cache-redis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ioredis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BaseRedisCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">client</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Redis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token literal-property property\">sentinels</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> <span class=\"token string\">'sentinel-host-01'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token number\">26379</span></span><span class=\"gatsby-highlight-code-line\">         <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> <span class=\"token string\">'my_password'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'service_name'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":245,"column":1,"offset":12767},"end":{"line":267,"column":4,"offset":13246}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#redis-cluster","title":null,"children":[],"data":{"hProperties":{"aria-label":"redis cluster permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Redis Cluster","position":{"start":{"line":269,"column":5,"offset":13252},"end":{"line":269,"column":18,"offset":13265}}}],"position":{"start":{"line":269,"column":1,"offset":13248},"end":{"line":269,"column":18,"offset":13265}},"data":{"id":"redis-cluster","htmlAttributes":{"id":"redis-cluster"},"hProperties":{"id":"redis-cluster","style":"position:relative;"}}},{"type":"html","lang":"shell","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"shell\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-shell line-numbers\"><code class=\"language-shell\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> apollo-server-cache-redis ioredis</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>","position":{"start":{"line":271,"column":1,"offset":13267},"end":{"line":273,"column":4,"offset":13327}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> BaseRedisCache <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'apollo-server-cache-redis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Redis <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ioredis'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">cache</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BaseRedisCache</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// Note that this uses the \"noMgetClient\" option rather than \"client\",</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token comment\">// which avoids using the mget command which doesn't work in cluster mode.</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token literal-property property\">noMgetClient</span><span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Redis<span class=\"token punctuation\">.</span>Cluster</span><span class=\"token punctuation\">(</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> <span class=\"token string\">'redis-node-01-host'</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token comment\">// Other Redis cluster client options</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":275,"column":1,"offset":13329},"end":{"line":299,"column":4,"offset":13951}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#adjusting-cache-time-to-live-ttl","title":null,"children":[],"data":{"hProperties":{"aria-label":"adjusting cache time to live ttl permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Adjusting cache time-to-live (TTL)","position":{"start":{"line":301,"column":4,"offset":13956},"end":{"line":301,"column":38,"offset":13990}}}],"position":{"start":{"line":301,"column":1,"offset":13953},"end":{"line":301,"column":38,"offset":13990}},"data":{"id":"adjusting-cache-time-to-live-ttl","htmlAttributes":{"id":"adjusting-cache-time-to-live-ttl"},"hProperties":{"id":"adjusting-cache-time-to-live-ttl","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The cache time-to-live (TTL) value determines how long a registered APQ remains in the cache. If a cached query's TTL elapses and the query is purged, it's re-registered the next time it's sent by a client.","position":{"start":{"line":303,"column":1,"offset":13992},"end":{"line":303,"column":207,"offset":14198}}}],"position":{"start":{"line":303,"column":1,"offset":13992},"end":{"line":303,"column":207,"offset":14198}}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server's default in-memory store does not specify a TTL for APQ (an APQ remains cached until it is overwritten by the cache's standard eviction policy). For all other ","position":{"start":{"line":305,"column":1,"offset":14200},"end":{"line":305,"column":175,"offset":14374}}},{"type":"link","title":null,"url":"#cache-configuration","children":[{"type":"text","value":"supported stores","position":{"start":{"line":305,"column":176,"offset":14375},"end":{"line":305,"column":192,"offset":14391}}}],"position":{"start":{"line":305,"column":175,"offset":14374},"end":{"line":305,"column":215,"offset":14414}}},{"type":"text","value":", the default TTL is 300 seconds. You can override or disable this value by setting the ","position":{"start":{"line":305,"column":215,"offset":14414},"end":{"line":305,"column":303,"offset":14502}}},{"type":"html","value":"<code class=\"language-text\">ttl</code>","position":{"start":{"line":305,"column":303,"offset":14502},"end":{"line":305,"column":308,"offset":14507}}},{"type":"text","value":" attribute of the ","position":{"start":{"line":305,"column":308,"offset":14507},"end":{"line":305,"column":326,"offset":14525}}},{"type":"html","value":"<code class=\"language-text\">persistedQueries</code>","position":{"start":{"line":305,"column":326,"offset":14525},"end":{"line":305,"column":344,"offset":14543}}},{"type":"text","value":" option, in seconds:","position":{"start":{"line":305,"column":344,"offset":14543},"end":{"line":305,"column":364,"offset":14563}}}],"position":{"start":{"line":305,"column":1,"offset":14200},"end":{"line":305,"column":364,"offset":14563}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">ttl</span><span class=\"token operator\">:</span> <span class=\"token number\">900</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 15 minutes</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":307,"column":1,"offset":14565},"end":{"line":317,"column":4,"offset":14744}}},{"type":"paragraph","children":[{"type":"text","value":"To disable TTL entirely, specify ","position":{"start":{"line":319,"column":1,"offset":14746},"end":{"line":319,"column":34,"offset":14779}}},{"type":"html","value":"<code class=\"language-text\">null</code>","position":{"start":{"line":319,"column":34,"offset":14779},"end":{"line":319,"column":40,"offset":14785}}},{"type":"text","value":" for the value of ","position":{"start":{"line":319,"column":40,"offset":14785},"end":{"line":319,"column":58,"offset":14803}}},{"type":"html","value":"<code class=\"language-text\">ttl</code>","position":{"start":{"line":319,"column":58,"offset":14803},"end":{"line":319,"column":63,"offset":14808}}},{"type":"text","value":":","position":{"start":{"line":319,"column":63,"offset":14808},"end":{"line":319,"column":64,"offset":14809}}}],"position":{"start":{"line":319,"column":1,"offset":14746},"end":{"line":319,"column":64,"offset":14809}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token literal-property property\">ttl</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span></span>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":321,"column":1,"offset":14811},"end":{"line":329,"column":4,"offset":14951}}},{"type":"paragraph","children":[{"type":"text","value":"As with the default behavior of the in-memory cache, this leaves APQs in the cache until they are overwritten by the cache's standard eviction policy.","position":{"start":{"line":331,"column":1,"offset":14953},"end":{"line":331,"column":151,"offset":15103}}}],"position":{"start":{"line":331,"column":1,"offset":14953},"end":{"line":331,"column":151,"offset":15103}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#disabling-apq","title":null,"children":[],"data":{"hProperties":{"aria-label":"disabling apq permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Disabling APQ","position":{"start":{"line":333,"column":4,"offset":15108},"end":{"line":333,"column":17,"offset":15121}}}],"position":{"start":{"line":333,"column":1,"offset":15105},"end":{"line":333,"column":17,"offset":15121}},"data":{"id":"disabling-apq","htmlAttributes":{"id":"disabling-apq"},"hProperties":{"id":"disabling-apq","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"You can disable APQ entirely by setting the ","position":{"start":{"line":335,"column":1,"offset":15123},"end":{"line":335,"column":45,"offset":15167}}},{"type":"html","value":"<code class=\"language-text\">persistedQueries</code>","position":{"start":{"line":335,"column":45,"offset":15167},"end":{"line":335,"column":63,"offset":15185}}},{"type":"text","value":" attribute to ","position":{"start":{"line":335,"column":63,"offset":15185},"end":{"line":335,"column":77,"offset":15199}}},{"type":"html","value":"<code class=\"language-text\">false</code>","position":{"start":{"line":335,"column":77,"offset":15199},"end":{"line":335,"column":84,"offset":15206}}},{"type":"text","value":" in the ","position":{"start":{"line":335,"column":84,"offset":15206},"end":{"line":335,"column":92,"offset":15214}}},{"type":"html","value":"<code class=\"language-text\">ApolloServer</code>","position":{"start":{"line":335,"column":92,"offset":15214},"end":{"line":335,"column":106,"offset":15228}}},{"type":"text","value":" constructor options:","position":{"start":{"line":335,"column":106,"offset":15228},"end":{"line":335,"column":127,"offset":15249}}}],"position":{"start":{"line":335,"column":1,"offset":15123},"end":{"line":335,"column":127,"offset":15249}}},{"type":"html","lang":"javascript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-javascript line-numbers\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token literal-property property\">persistedQueries</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":337,"column":1,"offset":15251},"end":{"line":343,"column":4,"offset":15376}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":344,"column":1,"offset":15377}}}}