{"expireTime":9007200901521015000,"key":"transformer-remark-markdown-ast-3438a5aff8cbd20cf13bdc80067c073b-gatsby-remark-autolink-headersgatsby-remark-copy-linked-filesgatsby-remark-mermaidgatsby-remark-code-titlesgatsby-remark-prismjsgatsby-remark-rewrite-relative-linksgatsby-remark-check-links-","val":{"type":"root","children":[{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"New in Apollo Server 3:","position":{"start":{"line":2,"column":5,"offset":5},"end":{"line":2,"column":28,"offset":28}}}],"position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":30,"offset":30}}},{"type":"text","value":" All plugin lifecycle methods are ","position":{"start":{"line":2,"column":30,"offset":30},"end":{"line":2,"column":64,"offset":64}}},{"type":"html","value":"<code class=\"language-text\">async</code>","position":{"start":{"line":2,"column":64,"offset":64},"end":{"line":2,"column":71,"offset":71}}},{"type":"text","value":", ","position":{"start":{"line":2,"column":71,"offset":71},"end":{"line":2,"column":73,"offset":73}}},{"type":"emphasis","children":[{"type":"text","value":"except for ","position":{"start":{"line":2,"column":74,"offset":74},"end":{"line":2,"column":85,"offset":85}}},{"type":"link","title":null,"url":"#willresolvefield","children":[{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":2,"column":86,"offset":86},"end":{"line":2,"column":104,"offset":104}}}],"position":{"start":{"line":2,"column":85,"offset":85},"end":{"line":2,"column":124,"offset":124}}},{"type":"text","value":" and ","position":{"start":{"line":2,"column":124,"offset":124},"end":{"line":2,"column":129,"offset":129}}},{"type":"link","title":null,"url":"#schemadidloadorupdate","children":[{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":2,"column":130,"offset":130},"end":{"line":2,"column":153,"offset":153}}}],"position":{"start":{"line":2,"column":129,"offset":129},"end":{"line":2,"column":178,"offset":178}}}],"position":{"start":{"line":2,"column":73,"offset":73},"end":{"line":2,"column":179,"offset":179}}},{"type":"text","value":".","position":{"start":{"line":2,"column":179,"offset":179},"end":{"line":2,"column":180,"offset":180}}}],"position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":180,"offset":180}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":180,"offset":180}}},{"type":"paragraph","children":[{"type":"text","value":"This reference describes the lifecycle events that your ","position":{"start":{"line":4,"column":1,"offset":182},"end":{"line":4,"column":57,"offset":238}}},{"type":"link","title":null,"url":"/integrations/plugins/","children":[{"type":"text","value":"custom Apollo Server plugin","position":{"start":{"line":4,"column":58,"offset":239},"end":{"line":4,"column":85,"offset":266}}}],"position":{"start":{"line":4,"column":57,"offset":238},"end":{"line":4,"column":98,"offset":279}}},{"type":"text","value":" can respond to.","position":{"start":{"line":4,"column":98,"offset":279},"end":{"line":4,"column":114,"offset":295}}}],"position":{"start":{"line":4,"column":1,"offset":182},"end":{"line":4,"column":114,"offset":295}}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server fires two types of events that plugins can hook into: ","position":{"start":{"line":6,"column":1,"offset":297},"end":{"line":6,"column":69,"offset":365}}},{"type":"strong","children":[{"type":"text","value":"server lifecycle\nevents","position":{"start":{"line":6,"column":71,"offset":367},"end":{"line":7,"column":7,"offset":390}}}],"position":{"start":{"line":6,"column":69,"offset":365},"end":{"line":7,"column":9,"offset":392}}},{"type":"text","value":" and ","position":{"start":{"line":7,"column":9,"offset":392},"end":{"line":7,"column":14,"offset":397}}},{"type":"strong","children":[{"type":"text","value":"request lifecycle events","position":{"start":{"line":7,"column":16,"offset":399},"end":{"line":7,"column":40,"offset":423}}}],"position":{"start":{"line":7,"column":14,"offset":397},"end":{"line":7,"column":42,"offset":425}}},{"type":"text","value":".","position":{"start":{"line":7,"column":42,"offset":425},"end":{"line":7,"column":43,"offset":426}}}],"position":{"start":{"line":6,"column":1,"offset":297},"end":{"line":7,"column":43,"offset":426}}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Server lifecycle events are high-level events related to the lifecycle of Apollo Server itself (e.g., ","position":{"start":{"line":9,"column":3,"offset":430},"end":{"line":9,"column":105,"offset":532}}},{"type":"link","title":null,"url":"#serverwillstart","children":[{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":9,"column":106,"offset":533},"end":{"line":9,"column":123,"offset":550}}}],"position":{"start":{"line":9,"column":105,"offset":532},"end":{"line":9,"column":142,"offset":569}}},{"type":"text","value":").","position":{"start":{"line":9,"column":142,"offset":569},"end":{"line":9,"column":144,"offset":571}}}],"position":{"start":{"line":9,"column":3,"offset":430},"end":{"line":9,"column":144,"offset":571}}}],"position":{"start":{"line":9,"column":1,"offset":428},"end":{"line":9,"column":144,"offset":571}}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Request lifecycle events are associated with the lifecycle of a specific request.","position":{"start":{"line":10,"column":3,"offset":574},"end":{"line":10,"column":84,"offset":655}}}],"position":{"start":{"line":10,"column":3,"offset":574},"end":{"line":10,"column":84,"offset":655}}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You define responses to these events ","position":{"start":{"line":11,"column":5,"offset":660},"end":{"line":11,"column":42,"offset":697}}},{"type":"emphasis","children":[{"type":"text","value":"within","position":{"start":{"line":11,"column":43,"offset":698},"end":{"line":11,"column":49,"offset":704}}}],"position":{"start":{"line":11,"column":42,"offset":697},"end":{"line":11,"column":50,"offset":705}}},{"type":"text","value":" the response to a ","position":{"start":{"line":11,"column":50,"offset":705},"end":{"line":11,"column":69,"offset":724}}},{"type":"html","value":"<code class=\"language-text\">requestDidStart</code>","position":{"start":{"line":11,"column":69,"offset":724},"end":{"line":11,"column":86,"offset":741}}},{"type":"text","value":" event, as described in ","position":{"start":{"line":11,"column":86,"offset":741},"end":{"line":11,"column":110,"offset":765}}},{"type":"link","title":null,"url":"/integrations/plugins/#responding-to-request-lifecycle-events","children":[{"type":"text","value":"Responding to request lifecycle events","position":{"start":{"line":11,"column":111,"offset":766},"end":{"line":11,"column":149,"offset":804}}}],"position":{"start":{"line":11,"column":110,"offset":765},"end":{"line":11,"column":200,"offset":855}}},{"type":"text","value":".","position":{"start":{"line":11,"column":200,"offset":855},"end":{"line":11,"column":201,"offset":856}}}],"position":{"start":{"line":11,"column":5,"offset":660},"end":{"line":11,"column":201,"offset":856}}}],"position":{"start":{"line":11,"column":3,"offset":658},"end":{"line":11,"column":201,"offset":856}}}],"position":{"start":{"line":11,"column":3,"offset":658},"end":{"line":11,"column":201,"offset":856}}}],"position":{"start":{"line":10,"column":1,"offset":572},"end":{"line":11,"column":201,"offset":856}}}],"position":{"start":{"line":9,"column":1,"offset":428},"end":{"line":11,"column":201,"offset":856}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"With two exceptions, all plugin methods in Apollo Server 3 are ","position":{"start":{"line":13,"column":3,"offset":860},"end":{"line":13,"column":66,"offset":923}}},{"type":"html","value":"<code class=\"language-text\">async</code>","position":{"start":{"line":13,"column":66,"offset":923},"end":{"line":13,"column":73,"offset":930}}},{"type":"text","value":". The first exception is ","position":{"start":{"line":13,"column":73,"offset":930},"end":{"line":13,"column":98,"offset":955}}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":13,"column":98,"offset":955},"end":{"line":13,"column":116,"offset":973}}},{"type":"text","value":", which is called much more frequently than other plugin methods. The second exception is ","position":{"start":{"line":13,"column":116,"offset":973},"end":{"line":13,"column":206,"offset":1063}}},{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":13,"column":206,"offset":1063},"end":{"line":13,"column":229,"offset":1086}}},{"type":"text","value":", where making the method ","position":{"start":{"line":13,"column":229,"offset":1086},"end":{"line":13,"column":255,"offset":1112}}},{"type":"html","value":"<code class=\"language-text\">async</code>","position":{"start":{"line":13,"column":255,"offset":1112},"end":{"line":13,"column":262,"offset":1119}}},{"type":"text","value":" would introduce unclear ordering semantics around method executions.","position":{"start":{"line":13,"column":262,"offset":1119},"end":{"line":13,"column":331,"offset":1188}}}],"position":{"start":{"line":13,"column":3,"offset":860},"end":{"line":13,"column":331,"offset":1188}}}],"position":{"start":{"line":13,"column":1,"offset":858},"end":{"line":13,"column":331,"offset":1188}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#server-lifecycle-events","title":null,"children":[],"data":{"hProperties":{"aria-label":"server lifecycle events permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Server lifecycle events","position":{"start":{"line":15,"column":4,"offset":1193},"end":{"line":15,"column":27,"offset":1216}}}],"position":{"start":{"line":15,"column":1,"offset":1190},"end":{"line":15,"column":27,"offset":1216}},"data":{"id":"server-lifecycle-events","htmlAttributes":{"id":"server-lifecycle-events"},"hProperties":{"id":"server-lifecycle-events","style":"position:relative;"}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#serverwillstart","title":null,"children":[],"data":{"hProperties":{"aria-label":"serverwillstart permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":17,"column":5,"offset":1222},"end":{"line":17,"column":22,"offset":1239}}}],"position":{"start":{"line":17,"column":1,"offset":1218},"end":{"line":17,"column":22,"offset":1239}},"data":{"id":"serverwillstart","htmlAttributes":{"id":"serverwillstart"},"hProperties":{"id":"serverwillstart","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":19,"column":1,"offset":1241},"end":{"line":19,"column":5,"offset":1245}}},{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":19,"column":5,"offset":1245},"end":{"line":19,"column":22,"offset":1262}}},{"type":"text","value":" event fires when Apollo Server is preparing to start serving GraphQL requests. The server doesn't start until this asynchronous method completes. If it throws (i.e., if the ","position":{"start":{"line":19,"column":22,"offset":1262},"end":{"line":19,"column":196,"offset":1436}}},{"type":"html","value":"<code class=\"language-text\">Promise</code>","position":{"start":{"line":19,"column":196,"offset":1436},"end":{"line":19,"column":205,"offset":1445}}},{"type":"text","value":" it returns is ","position":{"start":{"line":19,"column":205,"offset":1445},"end":{"line":19,"column":220,"offset":1460}}},{"type":"emphasis","children":[{"type":"text","value":"rejected","position":{"start":{"line":19,"column":221,"offset":1461},"end":{"line":19,"column":229,"offset":1469}}}],"position":{"start":{"line":19,"column":220,"offset":1460},"end":{"line":19,"column":230,"offset":1470}}},{"type":"text","value":"), startup ","position":{"start":{"line":19,"column":230,"offset":1470},"end":{"line":19,"column":241,"offset":1481}}},{"type":"emphasis","children":[{"type":"text","value":"fails","position":{"start":{"line":19,"column":242,"offset":1482},"end":{"line":19,"column":247,"offset":1487}}}],"position":{"start":{"line":19,"column":241,"offset":1481},"end":{"line":19,"column":248,"offset":1488}}},{"type":"text","value":" and your server does not serve GraphQL operations. This helps you make sure all of your server's dependencies are available before attempting to begin serving requests.","position":{"start":{"line":19,"column":248,"offset":1488},"end":{"line":19,"column":417,"offset":1657}}}],"position":{"start":{"line":19,"column":1,"offset":1241},"end":{"line":19,"column":417,"offset":1657}}},{"type":"paragraph","children":[{"type":"text","value":"This event is fired at different times depending on which ","position":{"start":{"line":21,"column":1,"offset":1659},"end":{"line":21,"column":59,"offset":1717}}},{"type":"link","title":null,"url":"/integrations/middleware/","children":[{"type":"text","value":"Apollo Server middleware","position":{"start":{"line":21,"column":60,"offset":1718},"end":{"line":21,"column":84,"offset":1742}}}],"position":{"start":{"line":21,"column":59,"offset":1717},"end":{"line":21,"column":100,"offset":1758}}},{"type":"text","value":" you're using:","position":{"start":{"line":21,"column":100,"offset":1758},"end":{"line":21,"column":114,"offset":1772}}}],"position":{"start":{"line":21,"column":1,"offset":1659},"end":{"line":21,"column":114,"offset":1772}}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In ","position":{"start":{"line":23,"column":3,"offset":1776},"end":{"line":23,"column":6,"offset":1779}}},{"type":"html","value":"<code class=\"language-text\">apollo-server</code>","position":{"start":{"line":23,"column":6,"offset":1779},"end":{"line":23,"column":21,"offset":1794}}},{"type":"text","value":", it's fired from the ","position":{"start":{"line":23,"column":21,"offset":1794},"end":{"line":23,"column":43,"offset":1816}}},{"type":"html","value":"<code class=\"language-text\">listen()</code>","position":{"start":{"line":23,"column":43,"offset":1816},"end":{"line":23,"column":53,"offset":1826}}},{"type":"text","value":" method.","position":{"start":{"line":23,"column":53,"offset":1826},"end":{"line":23,"column":61,"offset":1834}}}],"position":{"start":{"line":23,"column":3,"offset":1776},"end":{"line":23,"column":61,"offset":1834}}}],"position":{"start":{"line":23,"column":1,"offset":1774},"end":{"line":23,"column":61,"offset":1834}}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In non-serverless middleware libraries like ","position":{"start":{"line":24,"column":3,"offset":1837},"end":{"line":24,"column":47,"offset":1881}}},{"type":"html","value":"<code class=\"language-text\">apollo-server-express</code>","position":{"start":{"line":24,"column":47,"offset":1881},"end":{"line":24,"column":70,"offset":1904}}},{"type":"text","value":", it's fired from the ","position":{"start":{"line":24,"column":70,"offset":1904},"end":{"line":24,"column":92,"offset":1926}}},{"type":"html","value":"<code class=\"language-text\">start()</code>","position":{"start":{"line":24,"column":92,"offset":1926},"end":{"line":24,"column":101,"offset":1935}}},{"type":"text","value":" method.","position":{"start":{"line":24,"column":101,"offset":1935},"end":{"line":24,"column":109,"offset":1943}}}],"position":{"start":{"line":24,"column":3,"offset":1837},"end":{"line":24,"column":109,"offset":1943}}}],"position":{"start":{"line":24,"column":1,"offset":1835},"end":{"line":24,"column":109,"offset":1943}}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In serverless middleware libraries like ","position":{"start":{"line":25,"column":3,"offset":1946},"end":{"line":25,"column":43,"offset":1986}}},{"type":"html","value":"<code class=\"language-text\">apollo-server-lambda</code>","position":{"start":{"line":25,"column":43,"offset":1986},"end":{"line":25,"column":65,"offset":2008}}},{"type":"text","value":", it's fired in response to the first incoming request.","position":{"start":{"line":25,"column":65,"offset":2008},"end":{"line":25,"column":120,"offset":2063}}}],"position":{"start":{"line":25,"column":3,"offset":1946},"end":{"line":25,"column":120,"offset":2063}}}],"position":{"start":{"line":25,"column":1,"offset":1944},"end":{"line":25,"column":120,"offset":2063}}}],"position":{"start":{"line":23,"column":1,"offset":1774},"end":{"line":25,"column":120,"offset":2063}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#example","title":null,"children":[],"data":{"hProperties":{"aria-label":"example permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Example","position":{"start":{"line":27,"column":6,"offset":2070},"end":{"line":27,"column":13,"offset":2077}}}],"position":{"start":{"line":27,"column":1,"offset":2065},"end":{"line":27,"column":13,"offset":2077}},"data":{"id":"example","htmlAttributes":{"id":"example"},"hProperties":{"id":"example","style":"position:relative;"}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Server starting!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":29,"column":1,"offset":2079},"end":{"line":41,"column":4,"offset":2282}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#drainserver","title":null,"children":[],"data":{"hProperties":{"aria-label":"drainserver permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">drainServer</code>","position":{"start":{"line":43,"column":5,"offset":2288},"end":{"line":43,"column":18,"offset":2301}}}],"position":{"start":{"line":43,"column":1,"offset":2284},"end":{"line":43,"column":18,"offset":2301}},"data":{"id":"drainserver","htmlAttributes":{"id":"drainserver"},"hProperties":{"id":"drainserver","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":45,"column":1,"offset":2303},"end":{"line":45,"column":5,"offset":2307}}},{"type":"html","value":"<code class=\"language-text\">drainServer</code>","position":{"start":{"line":45,"column":5,"offset":2307},"end":{"line":45,"column":18,"offset":2320}}},{"type":"text","value":" event fires when Apollo Server is starting to shut down because ","position":{"start":{"line":45,"column":18,"offset":2320},"end":{"line":45,"column":83,"offset":2385}}},{"type":"link","title":null,"url":"/api/apollo-server/#stop","children":[{"type":"html","value":"<code class=\"language-text\">ApolloServer.stop()</code>","position":{"start":{"line":45,"column":84,"offset":2386},"end":{"line":45,"column":105,"offset":2407}}}],"position":{"start":{"line":45,"column":83,"offset":2385},"end":{"line":45,"column":134,"offset":2436}}},{"type":"text","value":" has been invoked (either explicitly by your code, or by one of the ","position":{"start":{"line":45,"column":134,"offset":2436},"end":{"line":45,"column":202,"offset":2504}}},{"type":"link","title":null,"url":"/api/apollo-server/#stoponterminationsignals","children":[{"type":"text","value":"termination signal handlers","position":{"start":{"line":45,"column":203,"offset":2505},"end":{"line":45,"column":230,"offset":2532}}}],"position":{"start":{"line":45,"column":202,"offset":2504},"end":{"line":45,"column":279,"offset":2581}}},{"type":"text","value":"). While ","position":{"start":{"line":45,"column":279,"offset":2581},"end":{"line":45,"column":288,"offset":2590}}},{"type":"html","value":"<code class=\"language-text\">drainServer</code>","position":{"start":{"line":45,"column":288,"offset":2590},"end":{"line":45,"column":301,"offset":2603}}},{"type":"text","value":" handlers run, GraphQL operations can still execute successfully. This hook is designed to allow you to stop accepting new connections and close existing connections. Apollo Server has a ","position":{"start":{"line":45,"column":301,"offset":2603},"end":{"line":45,"column":488,"offset":2790}}},{"type":"link","title":null,"url":"/api/plugin/drain-http-server/","children":[{"type":"text","value":"built-in plugin","position":{"start":{"line":45,"column":489,"offset":2791},"end":{"line":45,"column":504,"offset":2806}}}],"position":{"start":{"line":45,"column":488,"offset":2790},"end":{"line":45,"column":538,"offset":2840}}},{"type":"text","value":" which uses this event to drain a ","position":{"start":{"line":45,"column":538,"offset":2840},"end":{"line":45,"column":572,"offset":2874}}},{"type":"link","title":null,"url":"https://nodejs.org/api/http.html#http_class_http_server","children":[{"type":"text","value":"Node ","position":{"start":{"line":45,"column":573,"offset":2875},"end":{"line":45,"column":578,"offset":2880}}},{"type":"html","value":"<code class=\"language-text\">http.Server</code>","position":{"start":{"line":45,"column":578,"offset":2880},"end":{"line":45,"column":591,"offset":2893}}}],"position":{"start":{"line":45,"column":572,"offset":2874},"end":{"line":45,"column":649,"offset":2951}}},{"type":"text","value":".","position":{"start":{"line":45,"column":649,"offset":2951},"end":{"line":45,"column":650,"offset":2952}}}],"position":{"start":{"line":45,"column":1,"offset":2303},"end":{"line":45,"column":650,"offset":2952}}},{"type":"paragraph","children":[{"type":"text","value":"You define your ","position":{"start":{"line":47,"column":1,"offset":2954},"end":{"line":47,"column":17,"offset":2970}}},{"type":"html","value":"<code class=\"language-text\">drainServer</code>","position":{"start":{"line":47,"column":17,"offset":2970},"end":{"line":47,"column":30,"offset":2983}}},{"type":"text","value":" handler in the object returned by your ","position":{"start":{"line":47,"column":30,"offset":2983},"end":{"line":47,"column":70,"offset":3023}}},{"type":"link","title":null,"url":"#serverwillstart","children":[{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":47,"column":71,"offset":3024},"end":{"line":47,"column":88,"offset":3041}}}],"position":{"start":{"line":47,"column":70,"offset":3023},"end":{"line":47,"column":107,"offset":3060}}},{"type":"text","value":" handler, because the two handlers usually interact with the same data. Currently, ","position":{"start":{"line":47,"column":107,"offset":3060},"end":{"line":47,"column":190,"offset":3143}}},{"type":"html","value":"<code class=\"language-text\">drainServer</code>","position":{"start":{"line":47,"column":190,"offset":3143},"end":{"line":47,"column":203,"offset":3156}}},{"type":"text","value":" handlers do not take arguments (this might change in the future).","position":{"start":{"line":47,"column":203,"offset":3156},"end":{"line":47,"column":269,"offset":3222}}}],"position":{"start":{"line":47,"column":1,"offset":2954},"end":{"line":47,"column":269,"offset":3222}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#example-1","title":null,"children":[],"data":{"hProperties":{"aria-label":"example 1 permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Example","position":{"start":{"line":49,"column":6,"offset":3229},"end":{"line":49,"column":13,"offset":3236}}}],"position":{"start":{"line":49,"column":1,"offset":3224},"end":{"line":49,"column":13,"offset":3236}},"data":{"id":"example-1","htmlAttributes":{"id":"example-1"},"hProperties":{"id":"example-1","style":"position:relative;"}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">async</span> <span class=\"token function\">drainServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">await</span> myCustomServer<span class=\"token punctuation\">.</span><span class=\"token function\">drain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":51,"column":1,"offset":3238},"end":{"line":67,"column":4,"offset":3513}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#serverwillstop","title":null,"children":[],"data":{"hProperties":{"aria-label":"serverwillstop permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">serverWillStop</code>","position":{"start":{"line":69,"column":5,"offset":3519},"end":{"line":69,"column":21,"offset":3535}}}],"position":{"start":{"line":69,"column":1,"offset":3515},"end":{"line":69,"column":21,"offset":3535}},"data":{"id":"serverwillstop","htmlAttributes":{"id":"serverwillstop"},"hProperties":{"id":"serverwillstop","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":71,"column":1,"offset":3537},"end":{"line":71,"column":5,"offset":3541}}},{"type":"html","value":"<code class=\"language-text\">serverWillStop</code>","position":{"start":{"line":71,"column":5,"offset":3541},"end":{"line":71,"column":21,"offset":3557}}},{"type":"text","value":" event fires when Apollo Server is starting to shut down because ","position":{"start":{"line":71,"column":21,"offset":3557},"end":{"line":71,"column":86,"offset":3622}}},{"type":"link","title":null,"url":"/api/apollo-server/#stop","children":[{"type":"html","value":"<code class=\"language-text\">ApolloServer.stop()</code>","position":{"start":{"line":71,"column":87,"offset":3623},"end":{"line":71,"column":108,"offset":3644}}}],"position":{"start":{"line":71,"column":86,"offset":3622},"end":{"line":71,"column":137,"offset":3673}}},{"type":"text","value":" has been invoked (either explicitly by your code, or by one of the ","position":{"start":{"line":71,"column":137,"offset":3673},"end":{"line":71,"column":205,"offset":3741}}},{"type":"link","title":null,"url":"/api/apollo-server/#stoponterminationsignals","children":[{"type":"text","value":"termination signal handlers","position":{"start":{"line":71,"column":206,"offset":3742},"end":{"line":71,"column":233,"offset":3769}}}],"position":{"start":{"line":71,"column":205,"offset":3741},"end":{"line":71,"column":282,"offset":3818}}},{"type":"text","value":"). If your plugin is running any background tasks, this is a good place to shut them down.","position":{"start":{"line":71,"column":282,"offset":3818},"end":{"line":71,"column":372,"offset":3908}}}],"position":{"start":{"line":71,"column":1,"offset":3537},"end":{"line":71,"column":372,"offset":3908}}},{"type":"paragraph","children":[{"type":"text","value":"You define your ","position":{"start":{"line":73,"column":1,"offset":3910},"end":{"line":73,"column":17,"offset":3926}}},{"type":"html","value":"<code class=\"language-text\">serverWillStop</code>","position":{"start":{"line":73,"column":17,"offset":3926},"end":{"line":73,"column":33,"offset":3942}}},{"type":"text","value":" handler in the object returned by your ","position":{"start":{"line":73,"column":33,"offset":3942},"end":{"line":73,"column":73,"offset":3982}}},{"type":"link","title":null,"url":"#serverwillstart","children":[{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":73,"column":74,"offset":3983},"end":{"line":73,"column":91,"offset":4000}}}],"position":{"start":{"line":73,"column":73,"offset":3982},"end":{"line":73,"column":110,"offset":4019}}},{"type":"text","value":" handler, because the two handlers usually interact with the same data. Currently, ","position":{"start":{"line":73,"column":110,"offset":4019},"end":{"line":73,"column":193,"offset":4102}}},{"type":"html","value":"<code class=\"language-text\">serverWillStop</code>","position":{"start":{"line":73,"column":193,"offset":4102},"end":{"line":73,"column":209,"offset":4118}}},{"type":"text","value":" handlers do not take arguments (this might change in the future).","position":{"start":{"line":73,"column":209,"offset":4118},"end":{"line":73,"column":275,"offset":4184}}}],"position":{"start":{"line":73,"column":1,"offset":3910},"end":{"line":73,"column":275,"offset":4184}}},{"type":"paragraph","children":[{"type":"text","value":"When your ","position":{"start":{"line":75,"column":1,"offset":4186},"end":{"line":75,"column":11,"offset":4196}}},{"type":"html","value":"<code class=\"language-text\">serverWillStop</code>","position":{"start":{"line":75,"column":11,"offset":4196},"end":{"line":75,"column":27,"offset":4212}}},{"type":"text","value":" handler is called, Apollo Server is in a state where it will no longer start to execute new GraphQL operations, so it's a good place to flush observability data. If you are looking for a hook that runs while operations can still execute, try ","position":{"start":{"line":75,"column":27,"offset":4212},"end":{"line":75,"column":270,"offset":4455}}},{"type":"link","title":null,"url":"#drainserver","children":[{"type":"html","value":"<code class=\"language-text\">drainServer</code>","position":{"start":{"line":75,"column":271,"offset":4456},"end":{"line":75,"column":284,"offset":4469}}}],"position":{"start":{"line":75,"column":270,"offset":4455},"end":{"line":75,"column":299,"offset":4484}}},{"type":"text","value":".","position":{"start":{"line":75,"column":299,"offset":4484},"end":{"line":75,"column":300,"offset":4485}}}],"position":{"start":{"line":75,"column":1,"offset":4186},"end":{"line":75,"column":300,"offset":4485}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#example-2","title":null,"children":[],"data":{"hProperties":{"aria-label":"example 2 permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Example","position":{"start":{"line":77,"column":6,"offset":4492},"end":{"line":77,"column":13,"offset":4499}}}],"position":{"start":{"line":77,"column":1,"offset":4487},"end":{"line":77,"column":13,"offset":4499}},"data":{"id":"example-2","htmlAttributes":{"id":"example-2"},"hProperties":{"id":"example-2","style":"position:relative;"}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> interval <span class=\"token operator\">=</span> <span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span>doSomethingPeriodically<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>interval<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":79,"column":1,"offset":4501},"end":{"line":96,"column":4,"offset":4843}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#renderlandingpage","title":null,"children":[],"data":{"hProperties":{"aria-label":"renderlandingpage permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">renderLandingPage</code>","position":{"start":{"line":98,"column":5,"offset":4849},"end":{"line":98,"column":24,"offset":4868}}}],"position":{"start":{"line":98,"column":1,"offset":4845},"end":{"line":98,"column":24,"offset":4868}},"data":{"id":"renderlandingpage","htmlAttributes":{"id":"renderlandingpage"},"hProperties":{"id":"renderlandingpage","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"This event enables you to serve a ","position":{"start":{"line":100,"column":1,"offset":4870},"end":{"line":100,"column":35,"offset":4904}}},{"type":"link","title":null,"url":"/testing/build-run-queries/#custom-landing-page","children":[{"type":"text","value":"custom landing page","position":{"start":{"line":100,"column":36,"offset":4905},"end":{"line":100,"column":55,"offset":4924}}}],"position":{"start":{"line":100,"column":35,"offset":4904},"end":{"line":100,"column":107,"offset":4976}}},{"type":"text","value":" from Apollo Server's base URL. The event is fired once by Apollo Server after all ","position":{"start":{"line":100,"column":107,"offset":4976},"end":{"line":100,"column":190,"offset":5059}}},{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":100,"column":190,"offset":5059},"end":{"line":100,"column":207,"offset":5076}}},{"type":"text","value":" events run. ","position":{"start":{"line":100,"column":207,"offset":5076},"end":{"line":100,"column":220,"offset":5089}}},{"type":"strong","children":[{"type":"text","value":"At most one installed plugin can define a ","position":{"start":{"line":100,"column":222,"offset":5091},"end":{"line":100,"column":264,"offset":5133}}},{"type":"html","value":"<code class=\"language-text\">renderLandingPage</code>","position":{"start":{"line":100,"column":264,"offset":5133},"end":{"line":100,"column":283,"offset":5152}}},{"type":"text","value":" handler.","position":{"start":{"line":100,"column":283,"offset":5152},"end":{"line":100,"column":292,"offset":5161}}}],"position":{"start":{"line":100,"column":220,"offset":5089},"end":{"line":100,"column":294,"offset":5163}}},{"type":"text","value":" Otherwise, Apollo Server throws an error on startup.","position":{"start":{"line":100,"column":294,"offset":5163},"end":{"line":100,"column":347,"offset":5216}}}],"position":{"start":{"line":100,"column":1,"offset":4870},"end":{"line":100,"column":347,"offset":5216}}},{"type":"paragraph","children":[{"type":"text","value":"You define your plugin's ","position":{"start":{"line":102,"column":1,"offset":5218},"end":{"line":102,"column":26,"offset":5243}}},{"type":"html","value":"<code class=\"language-text\">renderLandingPage</code>","position":{"start":{"line":102,"column":26,"offset":5243},"end":{"line":102,"column":45,"offset":5262}}},{"type":"text","value":" handler in the object returned by your ","position":{"start":{"line":102,"column":45,"offset":5262},"end":{"line":102,"column":85,"offset":5302}}},{"type":"link","title":null,"url":"#serverwillstart","children":[{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":102,"column":86,"offset":5303},"end":{"line":102,"column":103,"offset":5320}}}],"position":{"start":{"line":102,"column":85,"offset":5302},"end":{"line":102,"column":122,"offset":5339}}},{"type":"text","value":" handler, which enables it to read values passed to ","position":{"start":{"line":102,"column":122,"offset":5339},"end":{"line":102,"column":174,"offset":5391}}},{"type":"html","value":"<code class=\"language-text\">serverWillStart</code>","position":{"start":{"line":102,"column":174,"offset":5391},"end":{"line":102,"column":191,"offset":5408}}},{"type":"text","value":":","position":{"start":{"line":102,"column":191,"offset":5408},"end":{"line":102,"column":192,"offset":5409}}}],"position":{"start":{"line":102,"column":1,"offset":5218},"end":{"line":102,"column":192,"offset":5409}}},{"type":"html","value":"<div class=\"gatsby-code-title\">index.js</div>"},{"type":"html","lang":"js{5-22}","meta":null,"value":"<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ... other configuration ...</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token keyword\">async</span> <span class=\"token function\">renderLandingPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">&lt;!DOCTYPE html></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">&lt;html></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">  &lt;head></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">  &lt;/head></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">  &lt;body></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">    &lt;h1>Hello world!&lt;/h1></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">  &lt;/body></span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token string\">&lt;/html></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> html <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">          <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">        <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">      <span class=\"token punctuation\">}</span></span><span class=\"gatsby-highlight-code-line\">    <span class=\"token punctuation\">}</span></span>  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":104,"column":1,"offset":5411},"end":{"line":129,"column":4,"offset":5812}}},{"type":"paragraph","children":[{"type":"text","value":"The handler should return an object with a string ","position":{"start":{"line":131,"column":1,"offset":5814},"end":{"line":131,"column":51,"offset":5864}}},{"type":"html","value":"<code class=\"language-text\">html</code>","position":{"start":{"line":131,"column":51,"offset":5864},"end":{"line":131,"column":57,"offset":5870}}},{"type":"text","value":" field. The value of that field is served as HTML for any requests with ","position":{"start":{"line":131,"column":57,"offset":5870},"end":{"line":131,"column":129,"offset":5942}}},{"type":"html","value":"<code class=\"language-text\">accept: text/html</code>","position":{"start":{"line":131,"column":129,"offset":5942},"end":{"line":131,"column":148,"offset":5961}}},{"type":"text","value":" headers.","position":{"start":{"line":131,"column":148,"offset":5961},"end":{"line":131,"column":157,"offset":5970}}}],"position":{"start":{"line":131,"column":1,"offset":5814},"end":{"line":131,"column":157,"offset":5970}}},{"type":"paragraph","children":[{"type":"text","value":"For more landing page options, see ","position":{"start":{"line":133,"column":1,"offset":5972},"end":{"line":133,"column":36,"offset":6007}}},{"type":"link","title":null,"url":"/testing/build-run-queries/#changing-the-landing-page","children":[{"type":"text","value":"Changing the landing page","position":{"start":{"line":133,"column":37,"offset":6008},"end":{"line":133,"column":62,"offset":6033}}}],"position":{"start":{"line":133,"column":36,"offset":6007},"end":{"line":133,"column":120,"offset":6091}}},{"type":"text","value":".","position":{"start":{"line":133,"column":120,"offset":6091},"end":{"line":133,"column":121,"offset":6092}}}],"position":{"start":{"line":133,"column":1,"offset":5972},"end":{"line":133,"column":121,"offset":6092}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#example-3","title":null,"children":[],"data":{"hProperties":{"aria-label":"example 3 permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Example","position":{"start":{"line":135,"column":6,"offset":6099},"end":{"line":135,"column":13,"offset":6106}}}],"position":{"start":{"line":135,"column":1,"offset":6094},"end":{"line":135,"column":13,"offset":6106}},"data":{"id":"example-3","htmlAttributes":{"id":"example-3"},"hProperties":{"id":"example-3","style":"position:relative;"}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">async</span> <span class=\"token function\">renderLandingPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">html</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;html>&lt;body>Welcome to your server!&lt;/body>&lt;/html></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":137,"column":1,"offset":6108},"end":{"line":153,"column":4,"offset":6429}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#requestdidstart","title":null,"children":[],"data":{"hProperties":{"aria-label":"requestdidstart permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">requestDidStart</code>","position":{"start":{"line":156,"column":5,"offset":6436},"end":{"line":156,"column":22,"offset":6453}}}],"position":{"start":{"line":156,"column":1,"offset":6432},"end":{"line":156,"column":22,"offset":6453}},"data":{"id":"requestdidstart","htmlAttributes":{"id":"requestdidstart"},"hProperties":{"id":"requestdidstart","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":158,"column":1,"offset":6455},"end":{"line":158,"column":5,"offset":6459}}},{"type":"html","value":"<code class=\"language-text\">requestDidStart</code>","position":{"start":{"line":158,"column":5,"offset":6459},"end":{"line":158,"column":22,"offset":6476}}},{"type":"text","value":" event fires whenever Apollo Server begins fulfilling a GraphQL request.","position":{"start":{"line":158,"column":22,"offset":6476},"end":{"line":158,"column":94,"offset":6548}}}],"position":{"start":{"line":158,"column":1,"offset":6455},"end":{"line":158,"column":94,"offset":6548}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">requestDidStart<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'request'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'context'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GraphQLRequestListener<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":160,"column":1,"offset":6550},"end":{"line":167,"column":4,"offset":6748}}},{"type":"paragraph","children":[{"type":"text","value":"This function can optionally return an object that includes functions for responding\nto request lifecycle events that might follow ","position":{"start":{"line":169,"column":1,"offset":6750},"end":{"line":170,"column":47,"offset":6881}}},{"type":"html","value":"<code class=\"language-text\">requestDidStart</code>","position":{"start":{"line":170,"column":47,"offset":6881},"end":{"line":170,"column":64,"offset":6898}}},{"type":"text","value":".","position":{"start":{"line":170,"column":64,"offset":6898},"end":{"line":170,"column":65,"offset":6899}}}],"position":{"start":{"line":169,"column":1,"offset":6750},"end":{"line":170,"column":65,"offset":6899}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">requestDidStart</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">requestContext</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Within this returned object, define functions that respond</span>\n        <span class=\"token comment\">// to request-specific lifecycle events.</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// The `parsingDidStart` request lifecycle event fires</span>\n          <span class=\"token comment\">// when parsing begins. The event is scoped within an</span>\n          <span class=\"token comment\">// associated `requestDidStart` server lifecycle event.</span>\n          <span class=\"token keyword\">async</span> <span class=\"token function\">parsingDidStart</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">requestContext</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Parsing started!'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":172,"column":1,"offset":6901},"end":{"line":193,"column":4,"offset":7526}}},{"type":"paragraph","children":[{"type":"text","value":"If your plugin doesn't need to respond to any request lifecycle events, ","position":{"start":{"line":195,"column":1,"offset":7528},"end":{"line":195,"column":73,"offset":7600}}},{"type":"html","value":"<code class=\"language-text\">requestDidStart</code>","position":{"start":{"line":195,"column":73,"offset":7600},"end":{"line":195,"column":90,"offset":7617}}},{"type":"text","value":"\nshould not return a value.","position":{"start":{"line":195,"column":90,"offset":7617},"end":{"line":196,"column":27,"offset":7644}}}],"position":{"start":{"line":195,"column":1,"offset":7528},"end":{"line":196,"column":27,"offset":7644}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#schemadidloadorupdate","title":null,"children":[],"data":{"hProperties":{"aria-label":"schemadidloadorupdate permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":198,"column":5,"offset":7650},"end":{"line":198,"column":28,"offset":7673}}}],"position":{"start":{"line":198,"column":1,"offset":7646},"end":{"line":198,"column":28,"offset":7673}},"data":{"id":"schemadidloadorupdate","htmlAttributes":{"id":"schemadidloadorupdate"},"hProperties":{"id":"schemadidloadorupdate","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":200,"column":1,"offset":7675},"end":{"line":200,"column":5,"offset":7679}}},{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":200,"column":5,"offset":7679},"end":{"line":200,"column":28,"offset":7702}}},{"type":"text","value":" event fires whenever Apollo Server initially loads the schema or updates the schema. A ","position":{"start":{"line":200,"column":28,"offset":7702},"end":{"line":200,"column":116,"offset":7790}}},{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":200,"column":116,"offset":7790},"end":{"line":200,"column":139,"offset":7813}}},{"type":"text","value":" handler is given the new API schema and optionally the new core schema (if using a gateway). If you provide a gateway and it is older than ","position":{"start":{"line":200,"column":139,"offset":7813},"end":{"line":200,"column":279,"offset":7953}}},{"type":"html","value":"<code class=\"language-text\">@apollo/gateway@0.35.0</code>","position":{"start":{"line":200,"column":279,"offset":7953},"end":{"line":200,"column":303,"offset":7977}}},{"type":"text","value":", attempting to register a ","position":{"start":{"line":200,"column":303,"offset":7977},"end":{"line":200,"column":330,"offset":8004}}},{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":200,"column":330,"offset":8004},"end":{"line":200,"column":353,"offset":8027}}},{"type":"text","value":" handler will fail.","position":{"start":{"line":200,"column":353,"offset":8027},"end":{"line":200,"column":372,"offset":8046}}}],"position":{"start":{"line":200,"column":1,"offset":7675},"end":{"line":200,"column":372,"offset":8046}}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">schemaDidLoadOrUpdate</code>","position":{"start":{"line":202,"column":1,"offset":8048},"end":{"line":202,"column":24,"offset":8071}}},{"type":"text","value":" is a synchronous plugin API (i.e., it does not return a ","position":{"start":{"line":202,"column":24,"offset":8071},"end":{"line":202,"column":81,"offset":8128}}},{"type":"html","value":"<code class=\"language-text\">Promise</code>","position":{"start":{"line":202,"column":81,"offset":8128},"end":{"line":202,"column":90,"offset":8137}}},{"type":"text","value":").","position":{"start":{"line":202,"column":90,"offset":8137},"end":{"line":202,"column":92,"offset":8139}}}],"position":{"start":{"line":202,"column":1,"offset":8048},"end":{"line":202,"column":92,"offset":8139}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#example-4","title":null,"children":[],"data":{"hProperties":{"aria-label":"example 4 permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Example","position":{"start":{"line":204,"column":6,"offset":8146},"end":{"line":204,"column":13,"offset":8153}}}],"position":{"start":{"line":204,"column":1,"offset":8141},"end":{"line":204,"column":13,"offset":8153}},"data":{"id":"example-4","htmlAttributes":{"id":"example-4"},"hProperties":{"id":"example-4","style":"position:relative;"}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">serverWillStart</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token function\">schemaDidLoadOrUpdate</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> apiSchema<span class=\"token punctuation\">,</span> coreSupergraphSdl <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">The API schema is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">printSchema</span><span class=\"token punctuation\">(</span>apiSchema<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>coreSupergraphSdl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">The core schema is </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>coreSupergraphSdl<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":206,"column":1,"offset":8155},"end":{"line":225,"column":4,"offset":8623}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#request-lifecycle-events","title":null,"children":[],"data":{"hProperties":{"aria-label":"request lifecycle events permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Request lifecycle events","position":{"start":{"line":227,"column":4,"offset":8628},"end":{"line":227,"column":28,"offset":8652}}}],"position":{"start":{"line":227,"column":1,"offset":8625},"end":{"line":227,"column":28,"offset":8652}},"data":{"id":"request-lifecycle-events","htmlAttributes":{"id":"request-lifecycle-events"},"hProperties":{"id":"request-lifecycle-events","style":"position:relative;"}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If you're using TypeScript to create your plugin, implement the ","position":{"start":{"line":229,"column":3,"offset":8656},"end":{"line":229,"column":67,"offset":8720}}},{"type":"link","title":null,"url":"https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-plugin-base/src/index.ts","children":[{"type":"text","value":" ","position":{"start":{"line":229,"column":68,"offset":8721},"end":{"line":229,"column":69,"offset":8722}}},{"type":"html","value":"<code class=\"language-text\">GraphQLRequestListener</code>","position":{"start":{"line":229,"column":69,"offset":8722},"end":{"line":229,"column":93,"offset":8746}}},{"type":"text","value":" interface","position":{"start":{"line":229,"column":93,"offset":8746},"end":{"line":229,"column":103,"offset":8756}}}],"position":{"start":{"line":229,"column":67,"offset":8720},"end":{"line":229,"column":210,"offset":8863}}},{"type":"text","value":" from the ","position":{"start":{"line":229,"column":210,"offset":8863},"end":{"line":229,"column":220,"offset":8873}}},{"type":"html","value":"<code class=\"language-text\">apollo-server-plugin-base</code>","position":{"start":{"line":229,"column":220,"offset":8873},"end":{"line":229,"column":247,"offset":8900}}},{"type":"text","value":" module to define functions for request lifecycle events.","position":{"start":{"line":229,"column":247,"offset":8900},"end":{"line":229,"column":304,"offset":8957}}}],"position":{"start":{"line":229,"column":3,"offset":8656},"end":{"line":229,"column":304,"offset":8957}}}],"position":{"start":{"line":229,"column":1,"offset":8654},"end":{"line":229,"column":304,"offset":8957}}},{"type":"paragraph","children":[{"type":"text","value":"When Apollo Server processes a request, these events fire in the order listed (with the exception of ","position":{"start":{"line":231,"column":1,"offset":8959},"end":{"line":231,"column":102,"offset":9060}}},{"type":"html","value":"<code class=\"language-text\">didEncounterErrors</code>","position":{"start":{"line":231,"column":102,"offset":9060},"end":{"line":231,"column":122,"offset":9080}}},{"type":"text","value":", which might fire in one of a few places depending on when errors occur). ","position":{"start":{"line":231,"column":122,"offset":9080},"end":{"line":231,"column":197,"offset":9155}}},{"type":"link","title":null,"url":"/integrations/plugins/#request-lifecycle-event-flow","children":[{"type":"text","value":"See the flow diagram","position":{"start":{"line":231,"column":198,"offset":9156},"end":{"line":231,"column":218,"offset":9176}}}],"position":{"start":{"line":231,"column":197,"offset":9155},"end":{"line":231,"column":260,"offset":9218}}}],"position":{"start":{"line":231,"column":1,"offset":8959},"end":{"line":231,"column":260,"offset":9218}}},{"type":"paragraph","children":[{"type":"text","value":"Note that not every event fires for every request (for example, ","position":{"start":{"line":233,"column":1,"offset":9220},"end":{"line":233,"column":65,"offset":9284}}},{"type":"html","value":"<code class=\"language-text\">parsingDidStart</code>","position":{"start":{"line":233,"column":65,"offset":9284},"end":{"line":233,"column":82,"offset":9301}}},{"type":"text","value":" doesn't fire for an operation that Apollo Server has cached and doesn't need to parse again).","position":{"start":{"line":233,"column":82,"offset":9301},"end":{"line":233,"column":176,"offset":9395}}}],"position":{"start":{"line":233,"column":1,"offset":9220},"end":{"line":233,"column":176,"offset":9395}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#didresolvesource","title":null,"children":[],"data":{"hProperties":{"aria-label":"didresolvesource permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">didResolveSource</code>","position":{"start":{"line":235,"column":5,"offset":9401},"end":{"line":235,"column":23,"offset":9419}}}],"position":{"start":{"line":235,"column":1,"offset":9397},"end":{"line":235,"column":23,"offset":9419}},"data":{"id":"didresolvesource","htmlAttributes":{"id":"didresolvesource"},"hProperties":{"id":"didresolvesource","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":237,"column":1,"offset":9421},"end":{"line":237,"column":5,"offset":9425}}},{"type":"html","value":"<code class=\"language-text\">didResolveSource</code>","position":{"start":{"line":237,"column":5,"offset":9425},"end":{"line":237,"column":23,"offset":9443}}},{"type":"text","value":" event is invoked after Apollo Server has determined the\n","position":{"start":{"line":237,"column":23,"offset":9443},"end":{"line":238,"column":1,"offset":9500}}},{"type":"html","value":"<code class=\"language-text\">String</code>","position":{"start":{"line":238,"column":1,"offset":9500},"end":{"line":238,"column":9,"offset":9508}}},{"type":"text","value":"-representation of the incoming operation that it will act upon.  In the\nevent that this ","position":{"start":{"line":238,"column":9,"offset":9508},"end":{"line":239,"column":17,"offset":9597}}},{"type":"html","value":"<code class=\"language-text\">String</code>","position":{"start":{"line":239,"column":17,"offset":9597},"end":{"line":239,"column":25,"offset":9605}}},{"type":"text","value":" was not directly passed in from the client, this\nmay be retrieved from a cache store (e.g., Automated Persisted Queries).","position":{"start":{"line":239,"column":25,"offset":9605},"end":{"line":240,"column":73,"offset":9727}}}],"position":{"start":{"line":237,"column":1,"offset":9421},"end":{"line":240,"column":73,"offset":9727}}},{"type":"paragraph","children":[{"type":"text","value":"At this stage, there is not a guarantee that the operation is not malformed.","position":{"start":{"line":242,"column":1,"offset":9729},"end":{"line":242,"column":77,"offset":9805}}}],"position":{"start":{"line":242,"column":1,"offset":9729},"end":{"line":242,"column":77,"offset":9805}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">didResolveSource<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":244,"column":1,"offset":9807},"end":{"line":250,"column":4,"offset":9957}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#parsingdidstart","title":null,"children":[],"data":{"hProperties":{"aria-label":"parsingdidstart permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">parsingDidStart</code>","position":{"start":{"line":252,"column":5,"offset":9963},"end":{"line":252,"column":22,"offset":9980}}}],"position":{"start":{"line":252,"column":1,"offset":9959},"end":{"line":252,"column":22,"offset":9980}},"data":{"id":"parsingdidstart","htmlAttributes":{"id":"parsingdidstart"},"hProperties":{"id":"parsingdidstart","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":254,"column":1,"offset":9982},"end":{"line":254,"column":5,"offset":9986}}},{"type":"html","value":"<code class=\"language-text\">parsingDidStart</code>","position":{"start":{"line":254,"column":5,"offset":9986},"end":{"line":254,"column":22,"offset":10003}}},{"type":"text","value":" event fires whenever Apollo Server will parse a GraphQL\nrequest to create its associated ","position":{"start":{"line":254,"column":22,"offset":10003},"end":{"line":255,"column":34,"offset":10093}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":255,"column":34,"offset":10093},"end":{"line":255,"column":44,"offset":10103}}},{"type":"text","value":" AST.","position":{"start":{"line":255,"column":44,"offset":10103},"end":{"line":255,"column":49,"offset":10108}}}],"position":{"start":{"line":254,"column":1,"offset":9982},"end":{"line":255,"column":49,"offset":10108}}},{"type":"paragraph","children":[{"type":"text","value":"If Apollo Server receives a request with a query string that matches a ","position":{"start":{"line":257,"column":1,"offset":10110},"end":{"line":257,"column":72,"offset":10181}}},{"type":"emphasis","children":[{"type":"text","value":"previous","position":{"start":{"line":257,"column":73,"offset":10182},"end":{"line":257,"column":81,"offset":10190}}}],"position":{"start":{"line":257,"column":72,"offset":10181},"end":{"line":257,"column":82,"offset":10191}}},{"type":"text","value":"\nrequest, the associated ","position":{"start":{"line":257,"column":82,"offset":10191},"end":{"line":258,"column":25,"offset":10216}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":258,"column":25,"offset":10216},"end":{"line":258,"column":35,"offset":10226}}},{"type":"text","value":" might already be available in Apollo Server's cache.\nIn this case, ","position":{"start":{"line":258,"column":35,"offset":10226},"end":{"line":259,"column":15,"offset":10294}}},{"type":"html","value":"<code class=\"language-text\">parsingDidStart</code>","position":{"start":{"line":259,"column":15,"offset":10294},"end":{"line":259,"column":32,"offset":10311}}},{"type":"text","value":" is ","position":{"start":{"line":259,"column":32,"offset":10311},"end":{"line":259,"column":36,"offset":10315}}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":259,"column":37,"offset":10316},"end":{"line":259,"column":40,"offset":10319}}}],"position":{"start":{"line":259,"column":36,"offset":10315},"end":{"line":259,"column":41,"offset":10320}}},{"type":"text","value":" called for the request, because parsing\ndoes not occur.","position":{"start":{"line":259,"column":41,"offset":10320},"end":{"line":260,"column":16,"offset":10376}}}],"position":{"start":{"line":257,"column":1,"offset":10110},"end":{"line":260,"column":16,"offset":10376}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">parsingDidStart<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>err<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Error<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":262,"column":1,"offset":10378},"end":{"line":269,"column":4,"offset":10574}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#validationdidstart","title":null,"children":[],"data":{"hProperties":{"aria-label":"validationdidstart permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">validationDidStart</code>","position":{"start":{"line":271,"column":5,"offset":10580},"end":{"line":271,"column":25,"offset":10600}}}],"position":{"start":{"line":271,"column":1,"offset":10576},"end":{"line":271,"column":25,"offset":10600}},"data":{"id":"validationdidstart","htmlAttributes":{"id":"validationdidstart"},"hProperties":{"id":"validationdidstart","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":273,"column":1,"offset":10602},"end":{"line":273,"column":5,"offset":10606}}},{"type":"html","value":"<code class=\"language-text\">validationDidStart</code>","position":{"start":{"line":273,"column":5,"offset":10606},"end":{"line":273,"column":25,"offset":10626}}},{"type":"text","value":" event fires whenever Apollo Server will validate a\nrequest's ","position":{"start":{"line":273,"column":25,"offset":10626},"end":{"line":274,"column":11,"offset":10688}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":274,"column":11,"offset":10688},"end":{"line":274,"column":21,"offset":10698}}},{"type":"text","value":" AST against your GraphQL schema.","position":{"start":{"line":274,"column":21,"offset":10698},"end":{"line":274,"column":54,"offset":10731}}}],"position":{"start":{"line":273,"column":1,"offset":10602},"end":{"line":274,"column":54,"offset":10731}}},{"type":"paragraph","children":[{"type":"text","value":"Like ","position":{"start":{"line":276,"column":1,"offset":10733},"end":{"line":276,"column":6,"offset":10738}}},{"type":"html","value":"<code class=\"language-text\">parsingDidStart</code>","position":{"start":{"line":276,"column":6,"offset":10738},"end":{"line":276,"column":23,"offset":10755}}},{"type":"text","value":", this event does ","position":{"start":{"line":276,"column":23,"offset":10755},"end":{"line":276,"column":41,"offset":10773}}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":276,"column":42,"offset":10774},"end":{"line":276,"column":45,"offset":10777}}}],"position":{"start":{"line":276,"column":41,"offset":10773},"end":{"line":276,"column":46,"offset":10778}}},{"type":"text","value":" fire if a request's ","position":{"start":{"line":276,"column":46,"offset":10778},"end":{"line":276,"column":67,"offset":10799}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":276,"column":67,"offset":10799},"end":{"line":276,"column":77,"offset":10809}}},{"type":"text","value":" is\nalready available in Apollo Server's cache (only successfully validated ","position":{"start":{"line":276,"column":77,"offset":10809},"end":{"line":277,"column":73,"offset":10885}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":277,"column":73,"offset":10885},"end":{"line":277,"column":83,"offset":10895}}},{"type":"text","value":"s are cached by Apollo Server).","position":{"start":{"line":277,"column":83,"offset":10895},"end":{"line":277,"column":114,"offset":10926}}}],"position":{"start":{"line":276,"column":1,"offset":10733},"end":{"line":277,"column":114,"offset":10926}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":279,"column":1,"offset":10928},"end":{"line":279,"column":5,"offset":10932}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":279,"column":5,"offset":10932},"end":{"line":279,"column":15,"offset":10942}}},{"type":"text","value":" AST is guaranteed to be\navailable at this stage, because parsing must succeed for validation to occur.","position":{"start":{"line":279,"column":15,"offset":10942},"end":{"line":280,"column":79,"offset":11045}}}],"position":{"start":{"line":279,"column":1,"offset":10928},"end":{"line":280,"column":79,"offset":11045}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">validationDidStart<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'document'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span> <span class=\"token operator\">|</span> <span class=\"token punctuation\">(</span>err<span class=\"token operator\">?</span><span class=\"token operator\">:</span> ReadonlyArray<span class=\"token operator\">&lt;</span>Error<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">>></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":282,"column":1,"offset":11047},"end":{"line":289,"column":4,"offset":11274}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#didresolveoperation","title":null,"children":[],"data":{"hProperties":{"aria-label":"didresolveoperation permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">didResolveOperation</code>","position":{"start":{"line":291,"column":5,"offset":11280},"end":{"line":291,"column":26,"offset":11301}}}],"position":{"start":{"line":291,"column":1,"offset":11276},"end":{"line":291,"column":26,"offset":11301}},"data":{"id":"didresolveoperation","htmlAttributes":{"id":"didresolveoperation"},"hProperties":{"id":"didresolveoperation","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":293,"column":1,"offset":11303},"end":{"line":293,"column":5,"offset":11307}}},{"type":"html","value":"<code class=\"language-text\">didResolveOperation</code>","position":{"start":{"line":293,"column":5,"offset":11307},"end":{"line":293,"column":26,"offset":11328}}},{"type":"text","value":" event fires after the ","position":{"start":{"line":293,"column":26,"offset":11328},"end":{"line":293,"column":49,"offset":11351}}},{"type":"html","value":"<code class=\"language-text\">graphql</code>","position":{"start":{"line":293,"column":49,"offset":11351},"end":{"line":293,"column":58,"offset":11360}}},{"type":"text","value":" library successfully\ndetermines the operation to execute from a request's ","position":{"start":{"line":293,"column":58,"offset":11360},"end":{"line":294,"column":54,"offset":11435}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":294,"column":54,"offset":11435},"end":{"line":294,"column":64,"offset":11445}}},{"type":"text","value":" AST. At this stage,\nboth the ","position":{"start":{"line":294,"column":64,"offset":11445},"end":{"line":295,"column":10,"offset":11475}}},{"type":"html","value":"<code class=\"language-text\">operationName</code>","position":{"start":{"line":295,"column":10,"offset":11475},"end":{"line":295,"column":25,"offset":11490}}},{"type":"text","value":" string and ","position":{"start":{"line":295,"column":25,"offset":11490},"end":{"line":295,"column":37,"offset":11502}}},{"type":"html","value":"<code class=\"language-text\">operation</code>","position":{"start":{"line":295,"column":37,"offset":11502},"end":{"line":295,"column":48,"offset":11513}}},{"type":"text","value":" AST are available.","position":{"start":{"line":295,"column":48,"offset":11513},"end":{"line":295,"column":67,"offset":11532}}}],"position":{"start":{"line":293,"column":1,"offset":11303},"end":{"line":295,"column":67,"offset":11532}}},{"type":"paragraph","children":[{"type":"text","value":"This event is ","position":{"start":{"line":297,"column":1,"offset":11534},"end":{"line":297,"column":15,"offset":11548}}},{"type":"emphasis","children":[{"type":"text","value":"not","position":{"start":{"line":297,"column":16,"offset":11549},"end":{"line":297,"column":19,"offset":11552}}}],"position":{"start":{"line":297,"column":15,"offset":11548},"end":{"line":297,"column":20,"offset":11553}}},{"type":"text","value":" associated with your GraphQL server's ","position":{"start":{"line":297,"column":20,"offset":11553},"end":{"line":297,"column":59,"offset":11592}}},{"type":"emphasis","children":[{"type":"text","value":"resolvers","position":{"start":{"line":297,"column":60,"offset":11593},"end":{"line":297,"column":69,"offset":11602}}}],"position":{"start":{"line":297,"column":59,"offset":11592},"end":{"line":297,"column":70,"offset":11603}}},{"type":"text","value":". When this event fires, your resolvers have not yet executed (they execute after ","position":{"start":{"line":297,"column":70,"offset":11603},"end":{"line":297,"column":152,"offset":11685}}},{"type":"link","title":null,"url":"#executiondidstart","children":[{"type":"html","value":"<code class=\"language-text\">executionDidStart</code>","position":{"start":{"line":297,"column":153,"offset":11686},"end":{"line":297,"column":172,"offset":11705}}}],"position":{"start":{"line":297,"column":152,"offset":11685},"end":{"line":297,"column":193,"offset":11726}}},{"type":"text","value":").","position":{"start":{"line":297,"column":193,"offset":11726},"end":{"line":297,"column":195,"offset":11728}}}],"position":{"start":{"line":297,"column":1,"offset":11534},"end":{"line":297,"column":195,"offset":11728}}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"If the operation is anonymous (i.e., the operation is ","position":{"start":{"line":299,"column":3,"offset":11732},"end":{"line":299,"column":57,"offset":11786}}},{"type":"html","value":"<code class=\"language-text\">query { ... }</code>","position":{"start":{"line":299,"column":57,"offset":11786},"end":{"line":299,"column":72,"offset":11801}}},{"type":"text","value":" instead of ","position":{"start":{"line":299,"column":72,"offset":11801},"end":{"line":299,"column":84,"offset":11813}}},{"type":"html","value":"<code class=\"language-text\">query NamedQuery { ... }</code>","position":{"start":{"line":299,"column":84,"offset":11813},"end":{"line":299,"column":110,"offset":11839}}},{"type":"text","value":"), then ","position":{"start":{"line":299,"column":110,"offset":11839},"end":{"line":299,"column":118,"offset":11847}}},{"type":"html","value":"<code class=\"language-text\">operationName</code>","position":{"start":{"line":299,"column":118,"offset":11847},"end":{"line":299,"column":133,"offset":11862}}},{"type":"text","value":" is ","position":{"start":{"line":299,"column":133,"offset":11862},"end":{"line":299,"column":137,"offset":11866}}},{"type":"html","value":"<code class=\"language-text\">null</code>","position":{"start":{"line":299,"column":137,"offset":11866},"end":{"line":299,"column":143,"offset":11872}}},{"type":"text","value":".","position":{"start":{"line":299,"column":143,"offset":11872},"end":{"line":299,"column":144,"offset":11873}}}],"position":{"start":{"line":299,"column":3,"offset":11732},"end":{"line":299,"column":144,"offset":11873}}}],"position":{"start":{"line":299,"column":1,"offset":11730},"end":{"line":299,"column":144,"offset":11873}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">didResolveOperation<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'document'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'operationName'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'operation'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":301,"column":1,"offset":11875},"end":{"line":308,"column":4,"offset":12087}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#responseforoperation","title":null,"children":[],"data":{"hProperties":{"aria-label":"responseforoperation permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">responseForOperation</code>","position":{"start":{"line":310,"column":5,"offset":12093},"end":{"line":310,"column":27,"offset":12115}}}],"position":{"start":{"line":310,"column":1,"offset":12089},"end":{"line":310,"column":27,"offset":12115}},"data":{"id":"responseforoperation","htmlAttributes":{"id":"responseforoperation"},"hProperties":{"id":"responseforoperation","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":312,"column":1,"offset":12117},"end":{"line":312,"column":5,"offset":12121}}},{"type":"html","value":"<code class=\"language-text\">responseForOperation</code>","position":{"start":{"line":312,"column":5,"offset":12121},"end":{"line":312,"column":27,"offset":12143}}},{"type":"text","value":" event is fired immediately before GraphQL execution\nwould take place. If its return value resolves to a non-null ","position":{"start":{"line":312,"column":27,"offset":12143},"end":{"line":313,"column":62,"offset":12257}}},{"type":"html","value":"<code class=\"language-text\">GraphQLResponse</code>","position":{"start":{"line":313,"column":62,"offset":12257},"end":{"line":313,"column":79,"offset":12274}}},{"type":"text","value":",\nthat result is used instead of executing the query. Hooks from different plugins\nare invoked in series, and the first non-null response is used.","position":{"start":{"line":313,"column":79,"offset":12274},"end":{"line":315,"column":64,"offset":12420}}}],"position":{"start":{"line":312,"column":1,"offset":12117},"end":{"line":315,"column":64,"offset":12420}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">responseForOperation<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'document'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'operationName'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'operation'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GraphQLResponse <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":317,"column":1,"offset":12422},"end":{"line":324,"column":4,"offset":12653}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#executiondidstart","title":null,"children":[],"data":{"hProperties":{"aria-label":"executiondidstart permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">executionDidStart</code>","position":{"start":{"line":326,"column":5,"offset":12659},"end":{"line":326,"column":24,"offset":12678}}}],"position":{"start":{"line":326,"column":1,"offset":12655},"end":{"line":326,"column":24,"offset":12678}},"data":{"id":"executiondidstart","htmlAttributes":{"id":"executiondidstart"},"hProperties":{"id":"executiondidstart","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":328,"column":1,"offset":12680},"end":{"line":328,"column":5,"offset":12684}}},{"type":"html","value":"<code class=\"language-text\">executionDidStart</code>","position":{"start":{"line":328,"column":5,"offset":12684},"end":{"line":328,"column":24,"offset":12703}}},{"type":"text","value":" event fires whenever Apollo Server begins executing the\nGraphQL operation specified by a request's ","position":{"start":{"line":328,"column":24,"offset":12703},"end":{"line":329,"column":44,"offset":12803}}},{"type":"html","value":"<code class=\"language-text\">document</code>","position":{"start":{"line":329,"column":44,"offset":12803},"end":{"line":329,"column":54,"offset":12813}}},{"type":"text","value":" AST.","position":{"start":{"line":329,"column":54,"offset":12813},"end":{"line":329,"column":59,"offset":12818}}}],"position":{"start":{"line":328,"column":1,"offset":12680},"end":{"line":329,"column":59,"offset":12818}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">executionDidStart<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'document'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'operationName'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'operation'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>GraphQLRequestExecutionListener <span class=\"token operator\">|</span> <span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":331,"column":1,"offset":12820},"end":{"line":338,"column":4,"offset":13064}}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">executionDidStart</code>","position":{"start":{"line":340,"column":1,"offset":13066},"end":{"line":340,"column":20,"offset":13085}}},{"type":"text","value":" may return an object with one or both of the methods ","position":{"start":{"line":340,"column":20,"offset":13085},"end":{"line":340,"column":74,"offset":13139}}},{"type":"html","value":"<code class=\"language-text\">executionDidEnd</code>","position":{"start":{"line":340,"column":74,"offset":13139},"end":{"line":340,"column":91,"offset":13156}}},{"type":"text","value":" and ","position":{"start":{"line":340,"column":91,"offset":13156},"end":{"line":340,"column":96,"offset":13161}}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":340,"column":96,"offset":13161},"end":{"line":340,"column":114,"offset":13179}}},{"type":"text","value":".  ","position":{"start":{"line":340,"column":114,"offset":13179},"end":{"line":340,"column":117,"offset":13182}}},{"type":"html","value":"<code class=\"language-text\">executionDidEnd</code>","position":{"start":{"line":340,"column":117,"offset":13182},"end":{"line":340,"column":134,"offset":13199}}},{"type":"text","value":" is treated like an end hook: it is called after execution with any errors that occurred. ","position":{"start":{"line":340,"column":134,"offset":13199},"end":{"line":340,"column":224,"offset":13289}}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":340,"column":224,"offset":13289},"end":{"line":340,"column":242,"offset":13307}}},{"type":"text","value":" is documented in the next section. (In Apollo Server 2, ","position":{"start":{"line":340,"column":242,"offset":13307},"end":{"line":340,"column":299,"offset":13364}}},{"type":"html","value":"<code class=\"language-text\">executionDidStart</code>","position":{"start":{"line":340,"column":299,"offset":13364},"end":{"line":340,"column":318,"offset":13383}}},{"type":"text","value":" could return also return an end hook directly.)","position":{"start":{"line":340,"column":318,"offset":13383},"end":{"line":340,"column":366,"offset":13431}}}],"position":{"start":{"line":340,"column":1,"offset":13066},"end":{"line":340,"column":366,"offset":13431}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#willresolvefield","title":null,"children":[],"data":{"hProperties":{"aria-label":"willresolvefield permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":342,"column":5,"offset":13437},"end":{"line":342,"column":23,"offset":13455}}}],"position":{"start":{"line":342,"column":1,"offset":13433},"end":{"line":342,"column":23,"offset":13455}},"data":{"id":"willresolvefield","htmlAttributes":{"id":"willresolvefield"},"hProperties":{"id":"willresolvefield","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":344,"column":1,"offset":13457},"end":{"line":344,"column":5,"offset":13461}}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":344,"column":5,"offset":13461},"end":{"line":344,"column":23,"offset":13479}}},{"type":"text","value":" event fires whenever Apollo Server is about to resolve a single field during the execution of an operation. The handler is passed an object with four fields (","position":{"start":{"line":344,"column":23,"offset":13479},"end":{"line":344,"column":182,"offset":13638}}},{"type":"html","value":"<code class=\"language-text\">source</code>","position":{"start":{"line":344,"column":182,"offset":13638},"end":{"line":344,"column":190,"offset":13646}}},{"type":"text","value":", ","position":{"start":{"line":344,"column":190,"offset":13646},"end":{"line":344,"column":192,"offset":13648}}},{"type":"html","value":"<code class=\"language-text\">args</code>","position":{"start":{"line":344,"column":192,"offset":13648},"end":{"line":344,"column":198,"offset":13654}}},{"type":"text","value":", ","position":{"start":{"line":344,"column":198,"offset":13654},"end":{"line":344,"column":200,"offset":13656}}},{"type":"html","value":"<code class=\"language-text\">context</code>","position":{"start":{"line":344,"column":200,"offset":13656},"end":{"line":344,"column":209,"offset":13665}}},{"type":"text","value":", and ","position":{"start":{"line":344,"column":209,"offset":13665},"end":{"line":344,"column":215,"offset":13671}}},{"type":"html","value":"<code class=\"language-text\">info</code>","position":{"start":{"line":344,"column":215,"offset":13671},"end":{"line":344,"column":221,"offset":13677}}},{"type":"text","value":") that correspond to the ","position":{"start":{"line":344,"column":221,"offset":13677},"end":{"line":344,"column":246,"offset":13702}}},{"type":"link","title":null,"url":"/data/resolvers/#resolver-arguments","children":[{"type":"text","value":"four positional arguments passed to resolvers","position":{"start":{"line":344,"column":247,"offset":13703},"end":{"line":344,"column":292,"offset":13748}}}],"position":{"start":{"line":344,"column":246,"offset":13702},"end":{"line":344,"column":332,"offset":13788}}},{"type":"text","value":". (Note that ","position":{"start":{"line":344,"column":332,"offset":13788},"end":{"line":344,"column":345,"offset":13801}}},{"type":"html","value":"<code class=\"language-text\">source</code>","position":{"start":{"line":344,"column":345,"offset":13801},"end":{"line":344,"column":353,"offset":13809}}},{"type":"text","value":" corresponds to the argument often called ","position":{"start":{"line":344,"column":353,"offset":13809},"end":{"line":344,"column":395,"offset":13851}}},{"type":"html","value":"<code class=\"language-text\">parent</code>","position":{"start":{"line":344,"column":395,"offset":13851},"end":{"line":344,"column":403,"offset":13859}}},{"type":"text","value":" in these docs.)","position":{"start":{"line":344,"column":403,"offset":13859},"end":{"line":344,"column":419,"offset":13875}}}],"position":{"start":{"line":344,"column":1,"offset":13457},"end":{"line":344,"column":419,"offset":13875}}},{"type":"paragraph","children":[{"type":"text","value":"You provide your ","position":{"start":{"line":346,"column":1,"offset":13877},"end":{"line":346,"column":18,"offset":13894}}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":346,"column":18,"offset":13894},"end":{"line":346,"column":36,"offset":13912}}},{"type":"text","value":" handler in the object returned by your ","position":{"start":{"line":346,"column":36,"offset":13912},"end":{"line":346,"column":76,"offset":13952}}},{"type":"link","title":null,"url":"#executiondidstart","children":[{"type":"html","value":"<code class=\"language-text\">executionDidStart</code>","position":{"start":{"line":346,"column":77,"offset":13953},"end":{"line":346,"column":96,"offset":13972}}}],"position":{"start":{"line":346,"column":76,"offset":13952},"end":{"line":346,"column":117,"offset":13993}}},{"type":"text","value":" handler.","position":{"start":{"line":346,"column":117,"offset":13993},"end":{"line":346,"column":126,"offset":14002}}}],"position":{"start":{"line":346,"column":1,"offset":13877},"end":{"line":346,"column":126,"offset":14002}}},{"type":"paragraph","children":[{"type":"text","value":"Your ","position":{"start":{"line":348,"column":1,"offset":14004},"end":{"line":348,"column":6,"offset":14009}}},{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":348,"column":6,"offset":14009},"end":{"line":348,"column":24,"offset":14027}}},{"type":"text","value":" handler can optionally return an ","position":{"start":{"line":348,"column":24,"offset":14027},"end":{"line":348,"column":58,"offset":14061}}},{"type":"link","title":null,"url":"/integrations/plugins/#end-hooks","children":[{"type":"text","value":"\"end hook\"","position":{"start":{"line":348,"column":59,"offset":14062},"end":{"line":348,"column":69,"offset":14072}}}],"position":{"start":{"line":348,"column":58,"offset":14061},"end":{"line":348,"column":92,"offset":14095}}},{"type":"text","value":" function that's invoked with the resolver's result (or the error that it throws). The end hook is called when your resolver has ","position":{"start":{"line":348,"column":92,"offset":14095},"end":{"line":348,"column":221,"offset":14224}}},{"type":"emphasis","children":[{"type":"text","value":"fully","position":{"start":{"line":348,"column":222,"offset":14225},"end":{"line":348,"column":227,"offset":14230}}}],"position":{"start":{"line":348,"column":221,"offset":14224},"end":{"line":348,"column":228,"offset":14231}}},{"type":"text","value":" resolved (e.g., if the resolver returns a Promise, the hook is called with the Promise's eventual resolved result).","position":{"start":{"line":348,"column":228,"offset":14231},"end":{"line":348,"column":344,"offset":14347}}}],"position":{"start":{"line":348,"column":1,"offset":14004},"end":{"line":348,"column":344,"offset":14347}}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">willResolveField</code>","position":{"start":{"line":350,"column":1,"offset":14349},"end":{"line":350,"column":19,"offset":14367}}},{"type":"text","value":" and its end hook are synchronous plugin APIs (i.e., they do not return ","position":{"start":{"line":350,"column":19,"offset":14367},"end":{"line":350,"column":91,"offset":14439}}},{"type":"html","value":"<code class=\"language-text\">Promise</code>","position":{"start":{"line":350,"column":91,"offset":14439},"end":{"line":350,"column":100,"offset":14448}}},{"type":"text","value":"s).","position":{"start":{"line":350,"column":100,"offset":14448},"end":{"line":350,"column":103,"offset":14451}}}],"position":{"start":{"line":350,"column":1,"offset":14349},"end":{"line":350,"column":103,"offset":14451}}},{"type":"heading","depth":4,"children":[{"type":"link","url":"#example-5","title":null,"children":[],"data":{"hProperties":{"aria-label":"example 5 permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Example","position":{"start":{"line":352,"column":6,"offset":14458},"end":{"line":352,"column":13,"offset":14465}}}],"position":{"start":{"line":352,"column":1,"offset":14453},"end":{"line":352,"column":13,"offset":14465}},"data":{"id":"example-5","htmlAttributes":{"id":"example-5"},"hProperties":{"id":"example-5","style":"position:relative;"}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/* ... other necessary configuration ... */</span>\n\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">async</span> <span class=\"token function\">requestDidStart</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">initialRequestContext</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">async</span> <span class=\"token function\">executionDidStart</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">executionRequestContext</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">willResolveField</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>source<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> info<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>hrtime<span class=\"token punctuation\">.</span><span class=\"token function\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                  <span class=\"token keyword\">const</span> end <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>hrtime<span class=\"token punctuation\">.</span><span class=\"token function\">bigint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Field </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>info<span class=\"token punctuation\">.</span>parentType<span class=\"token punctuation\">.</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>info<span class=\"token punctuation\">.</span>fieldName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> took </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>end <span class=\"token operator\">-</span> start<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">ns</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">It failed with </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>error<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">It returned </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>result<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":354,"column":1,"offset":14467},"end":{"line":383,"column":4,"offset":15338}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#didencountererrors","title":null,"children":[],"data":{"hProperties":{"aria-label":"didencountererrors permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">didEncounterErrors</code>","position":{"start":{"line":385,"column":5,"offset":15344},"end":{"line":385,"column":25,"offset":15364}}}],"position":{"start":{"line":385,"column":1,"offset":15340},"end":{"line":385,"column":25,"offset":15364}},"data":{"id":"didencountererrors","htmlAttributes":{"id":"didencountererrors"},"hProperties":{"id":"didencountererrors","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":387,"column":1,"offset":15366},"end":{"line":387,"column":5,"offset":15370}}},{"type":"html","value":"<code class=\"language-text\">didEncounterErrors</code>","position":{"start":{"line":387,"column":5,"offset":15370},"end":{"line":387,"column":25,"offset":15390}}},{"type":"text","value":" event fires when Apollo Server encounters errors while\nparsing, validating, or executing a GraphQL operation.","position":{"start":{"line":387,"column":25,"offset":15390},"end":{"line":388,"column":55,"offset":15500}}}],"position":{"start":{"line":387,"column":1,"offset":15366},"end":{"line":388,"column":55,"offset":15500}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">didEncounterErrors<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'source'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'errors'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":390,"column":1,"offset":15502},"end":{"line":397,"column":4,"offset":15679}}},{"type":"heading","depth":3,"children":[{"type":"link","url":"#willsendresponse","title":null,"children":[],"data":{"hProperties":{"aria-label":"willsendresponse permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">willSendResponse</code>","position":{"start":{"line":399,"column":5,"offset":15685},"end":{"line":399,"column":23,"offset":15703}}}],"position":{"start":{"line":399,"column":1,"offset":15681},"end":{"line":399,"column":23,"offset":15703}},"data":{"id":"willsendresponse","htmlAttributes":{"id":"willsendresponse"},"hProperties":{"id":"willsendresponse","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":401,"column":1,"offset":15705},"end":{"line":401,"column":5,"offset":15709}}},{"type":"html","value":"<code class=\"language-text\">willSendResponse</code>","position":{"start":{"line":401,"column":5,"offset":15709},"end":{"line":401,"column":23,"offset":15727}}},{"type":"text","value":" event fires whenever Apollo Server is about to send a response\nfor a GraphQL operation. This event fires (and Apollo Server sends a response) even\nif the GraphQL operation encounters one or more errors.","position":{"start":{"line":401,"column":23,"offset":15727},"end":{"line":403,"column":56,"offset":15930}}}],"position":{"start":{"line":401,"column":1,"offset":15705},"end":{"line":403,"column":56,"offset":15930}}},{"type":"html","lang":"typescript","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-typescript line-numbers\"><code class=\"language-typescript\">willSendResponse<span class=\"token operator\">?</span><span class=\"token punctuation\">(</span>\n  requestContext<span class=\"token operator\">:</span> WithRequired<span class=\"token operator\">&lt;</span>\n    GraphQLRequestContext<span class=\"token operator\">&lt;</span>TContext<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'metrics'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'response'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'logger'</span>\n  <span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":405,"column":1,"offset":15932},"end":{"line":412,"column":4,"offset":16098}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":413,"column":1,"offset":16099}}}}