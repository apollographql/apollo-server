{"expireTime":9007200901521017000,"key":"transformer-remark-markdown-ast-3beb1c7863fabb2528e091bf17291c45-gatsby-remark-autolink-headersgatsby-remark-copy-linked-filesgatsby-remark-mermaidgatsby-remark-code-titlesgatsby-remark-prismjsgatsby-remark-rewrite-relative-linksgatsby-remark-check-links-","val":{"type":"root","children":[{"type":"heading","depth":2,"children":[{"type":"link","url":"#using-the-plugin","title":null,"children":[],"data":{"hProperties":{"aria-label":"using the plugin permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Using the plugin","position":{"start":{"line":2,"column":4,"offset":4},"end":{"line":2,"column":20,"offset":20}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":20,"offset":20}},"data":{"id":"using-the-plugin","htmlAttributes":{"id":"using-the-plugin"},"hProperties":{"id":"using-the-plugin","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"text","value":"This API reference documents the ","position":{"start":{"line":4,"column":1,"offset":22},"end":{"line":4,"column":34,"offset":55}}},{"type":"html","value":"<code class=\"language-text\">ApolloServerPluginInlineTrace</code>","position":{"start":{"line":4,"column":34,"offset":55},"end":{"line":4,"column":65,"offset":86}}},{"type":"text","value":" plugin.","position":{"start":{"line":4,"column":65,"offset":86},"end":{"line":4,"column":73,"offset":94}}}],"position":{"start":{"line":4,"column":1,"offset":22},"end":{"line":4,"column":73,"offset":94}}},{"type":"paragraph","children":[{"type":"text","value":"This plugin enables your GraphQL server to include encoded performance and usage traces inside responses. This is primarily designed for use with ","position":{"start":{"line":6,"column":1,"offset":96},"end":{"line":6,"column":147,"offset":242}}},{"type":"link","title":null,"url":"https://www.apollographql.com/docs/federation/metrics/","children":[{"type":"text","value":"Apollo Federation","position":{"start":{"line":6,"column":148,"offset":243},"end":{"line":6,"column":165,"offset":260}}}],"position":{"start":{"line":6,"column":147,"offset":242},"end":{"line":6,"column":222,"offset":317}}},{"type":"text","value":". Federated subgraphs use this plugin and include a trace in the ","position":{"start":{"line":6,"column":222,"offset":317},"end":{"line":6,"column":287,"offset":382}}},{"type":"html","value":"<code class=\"language-text\">ftv1</code>","position":{"start":{"line":6,"column":287,"offset":382},"end":{"line":6,"column":293,"offset":388}}},{"type":"text","value":" GraphQL response extension if requested to do so by the Apollo gateway. The gateway requests this trace by passing the HTTP header ","position":{"start":{"line":6,"column":293,"offset":388},"end":{"line":6,"column":425,"offset":520}}},{"type":"html","value":"<code class=\"language-text\">apollo-federation-include-trace: ftv1</code>","position":{"start":{"line":6,"column":425,"offset":520},"end":{"line":6,"column":464,"offset":559}}},{"type":"text","value":".","position":{"start":{"line":6,"column":464,"offset":559},"end":{"line":6,"column":465,"offset":560}}}],"position":{"start":{"line":6,"column":1,"offset":96},"end":{"line":6,"column":465,"offset":560}}},{"type":"paragraph","children":[{"type":"text","value":"Apollo Server installs this plugin by default in all federated subgraphs, with its default configuration. (Apollo Server decides that it is a federated subgraph if the schema it is serving includes a field ","position":{"start":{"line":8,"column":1,"offset":562},"end":{"line":8,"column":207,"offset":768}}},{"type":"html","value":"<code class=\"language-text\">_Service.sdl: String</code>","position":{"start":{"line":8,"column":207,"offset":768},"end":{"line":8,"column":229,"offset":790}}},{"type":"text","value":".)  You typically do not have to install this plugin yourself; you only need to do so if you want to provide non-default configuration.","position":{"start":{"line":8,"column":229,"offset":790},"end":{"line":8,"column":364,"offset":925}}}],"position":{"start":{"line":8,"column":1,"offset":562},"end":{"line":8,"column":364,"offset":925}}},{"type":"paragraph","children":[{"type":"text","value":"If you want to configure this plugin (or if you want to use it in a graph that is not a federated subgraph), import it from the ","position":{"start":{"line":10,"column":1,"offset":927},"end":{"line":10,"column":129,"offset":1055}}},{"type":"html","value":"<code class=\"language-text\">apollo-server-core</code>","position":{"start":{"line":10,"column":129,"offset":1055},"end":{"line":10,"column":149,"offset":1075}}},{"type":"text","value":" package and pass it to your ","position":{"start":{"line":10,"column":149,"offset":1075},"end":{"line":10,"column":178,"offset":1104}}},{"type":"html","value":"<code class=\"language-text\">ApolloServer</code>","position":{"start":{"line":10,"column":178,"offset":1104},"end":{"line":10,"column":192,"offset":1118}}},{"type":"text","value":" in the ","position":{"start":{"line":10,"column":192,"offset":1118},"end":{"line":10,"column":200,"offset":1126}}},{"type":"html","value":"<code class=\"language-text\">plugins</code>","position":{"start":{"line":10,"column":200,"offset":1126},"end":{"line":10,"column":209,"offset":1135}}},{"type":"text","value":" array:","position":{"start":{"line":10,"column":209,"offset":1135},"end":{"line":10,"column":216,"offset":1142}}}],"position":{"start":{"line":10,"column":1,"offset":927},"end":{"line":10,"column":216,"offset":1142}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"apollo-server\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServerPluginInlineTrace <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"apollo-server-core\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token function\">ApolloServerPluginInlineTrace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">rewriteError</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token constant\">SENSITIVE_REGEX</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">:</span> err<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":12,"column":1,"offset":1144},"end":{"line":25,"column":4,"offset":1471}}},{"type":"paragraph","children":[{"type":"text","value":"If you don't want to use the inline trace plugin even though your schema defines ","position":{"start":{"line":27,"column":1,"offset":1473},"end":{"line":27,"column":82,"offset":1554}}},{"type":"html","value":"<code class=\"language-text\">_Service.sdl: String</code>","position":{"start":{"line":27,"column":82,"offset":1554},"end":{"line":27,"column":104,"offset":1576}}},{"type":"text","value":", you can explicitly disable it with the ","position":{"start":{"line":27,"column":104,"offset":1576},"end":{"line":27,"column":145,"offset":1617}}},{"type":"html","value":"<code class=\"language-text\">ApolloServerPluginInlineTraceDisabled</code>","position":{"start":{"line":27,"column":145,"offset":1617},"end":{"line":27,"column":184,"offset":1656}}},{"type":"text","value":" plugin:","position":{"start":{"line":27,"column":184,"offset":1656},"end":{"line":27,"column":192,"offset":1664}}}],"position":{"start":{"line":27,"column":1,"offset":1473},"end":{"line":27,"column":192,"offset":1664}}},{"type":"html","lang":"js","meta":null,"value":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"apollo-server\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ApolloServerPluginInlineTraceDisabled <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"apollo-server-core\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ApolloServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  typeDefs<span class=\"token punctuation\">,</span>\n  resolvers<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">ApolloServerPluginInlineTraceDisabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","position":{"start":{"line":29,"column":1,"offset":1666},"end":{"line":38,"column":4,"offset":1915}}},{"type":"paragraph","children":[{"type":"text","value":"Note that when this plugin is installed in your app, any client can request a trace for any operation they run, which may reveal information about your server that you consider sensitive (such as how long each individual field takes to execute). Federated subgraphs generally should not be directly exposed to the public Internet.","position":{"start":{"line":40,"column":1,"offset":1917},"end":{"line":40,"column":331,"offset":2247}}}],"position":{"start":{"line":40,"column":1,"offset":1917},"end":{"line":40,"column":331,"offset":2247}}},{"type":"paragraph","children":[{"type":"text","value":"(Note: in addition to this plugin (which adds a base64-encoded trace to the ","position":{"start":{"line":42,"column":1,"offset":2249},"end":{"line":42,"column":77,"offset":2325}}},{"type":"html","value":"<code class=\"language-text\">ftv1</code>","position":{"start":{"line":42,"column":77,"offset":2325},"end":{"line":42,"column":83,"offset":2331}}},{"type":"text","value":" extension of responses), the Apollo platform used to have support for an older JSON-based format which added a ","position":{"start":{"line":42,"column":83,"offset":2331},"end":{"line":42,"column":195,"offset":2443}}},{"type":"html","value":"<code class=\"language-text\">tracing</code>","position":{"start":{"line":42,"column":195,"offset":2443},"end":{"line":42,"column":204,"offset":2452}}},{"type":"text","value":" extension to responses. This support was enabled in Apollo Server 2 by passing ","position":{"start":{"line":42,"column":204,"offset":2452},"end":{"line":42,"column":284,"offset":2532}}},{"type":"html","value":"<code class=\"language-text\">tracing: true</code>","position":{"start":{"line":42,"column":284,"offset":2532},"end":{"line":42,"column":299,"offset":2547}}},{"type":"text","value":" to the ","position":{"start":{"line":42,"column":299,"offset":2547},"end":{"line":42,"column":307,"offset":2555}}},{"type":"html","value":"<code class=\"language-text\">ApolloServer</code>","position":{"start":{"line":42,"column":307,"offset":2555},"end":{"line":42,"column":321,"offset":2569}}},{"type":"text","value":" constructor; that option has been removed from Apollo Server 3. That format was designed for use with a no longer supported tool called ","position":{"start":{"line":42,"column":321,"offset":2569},"end":{"line":42,"column":458,"offset":2706}}},{"type":"html","value":"<code class=\"language-text\">engineproxy</code>","position":{"start":{"line":42,"column":458,"offset":2706},"end":{"line":42,"column":471,"offset":2719}}},{"type":"text","value":", and also is recognized by graphql-playground.  That format was more verbose due to its use of JSON and the way that it represented trace node IDs.)","position":{"start":{"line":42,"column":471,"offset":2719},"end":{"line":42,"column":620,"offset":2868}}}],"position":{"start":{"line":42,"column":1,"offset":2249},"end":{"line":42,"column":620,"offset":2868}}},{"type":"paragraph","children":[{"type":"text","value":"When using Federation, you typically run this plugin in subgraphs and you run the usage reporting plugin in gateways; this is how the default behavior works. If you include this plugin in a gateway, then the gateway will include a full trace including the query plan and all subgraph traces inline in its responses. This is not recommended for publicly exposed servers, but can be helpful when developing locally if you want to see the exact query plan generated by your gateway.","position":{"start":{"line":44,"column":1,"offset":2870},"end":{"line":44,"column":480,"offset":3349}}}],"position":{"start":{"line":44,"column":1,"offset":2870},"end":{"line":44,"column":480,"offset":3349}}},{"type":"heading","depth":2,"children":[{"type":"link","url":"#options","title":null,"children":[],"data":{"hProperties":{"aria-label":"options permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"text","value":"Options","position":{"start":{"line":46,"column":4,"offset":3354},"end":{"line":46,"column":11,"offset":3361}}}],"position":{"start":{"line":46,"column":1,"offset":3351},"end":{"line":46,"column":11,"offset":3361}},"data":{"id":"options","htmlAttributes":{"id":"options"},"hProperties":{"id":"options","style":"position:relative;"}}},{"type":"html","value":"<table class=\"field-table\">\n  <thead>\n    <tr>\n      <th>Name /<br/>Type</th>\n      <th>Description</th>\n    </tr>\n  </thead>","position":{"start":{"line":48,"column":1,"offset":3363},"end":{"line":54,"column":11,"offset":3488}}},{"type":"html","value":"<tbody>","position":{"start":{"line":56,"column":1,"offset":3490},"end":{"line":56,"column":8,"offset":3497}}},{"type":"html","value":"<tr>\n<td>","position":{"start":{"line":58,"column":1,"offset":3499},"end":{"line":59,"column":5,"offset":3508}}},{"type":"heading","depth":6,"children":[{"type":"link","url":"#rewriteerror","title":null,"children":[],"data":{"hProperties":{"aria-label":"rewriteerror permalink","class":"anchor before"},"hChildren":[{"type":"raw","value":"<svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg>"}]}},{"type":"html","value":"<code class=\"language-text\">rewriteError</code>","position":{"start":{"line":61,"column":8,"offset":3517},"end":{"line":61,"column":22,"offset":3531}}}],"position":{"start":{"line":61,"column":1,"offset":3510},"end":{"line":61,"column":22,"offset":3531}},"data":{"id":"rewriteerror","htmlAttributes":{"id":"rewriteerror"},"hProperties":{"id":"rewriteerror","style":"position:relative;"}}},{"type":"paragraph","children":[{"type":"html","value":"<code class=\"language-text\">Function</code>","position":{"start":{"line":63,"column":1,"offset":3533},"end":{"line":63,"column":11,"offset":3543}}}],"position":{"start":{"line":63,"column":1,"offset":3533},"end":{"line":63,"column":11,"offset":3543}}},{"type":"html","value":"</td>\n<td>","position":{"start":{"line":64,"column":1,"offset":3544},"end":{"line":65,"column":5,"offset":3554}}},{"type":"paragraph","children":[{"type":"text","value":"By default, all errors from this service get included in the trace. You can specify a filter function to exclude specific errors from being reported by returning an explicit ","position":{"start":{"line":67,"column":1,"offset":3556},"end":{"line":67,"column":175,"offset":3730}}},{"type":"html","value":"<code class=\"language-text\">null</code>","position":{"start":{"line":67,"column":175,"offset":3730},"end":{"line":67,"column":181,"offset":3736}}},{"type":"text","value":", or you can mask certain details of the error by modifying it and returning the modified error. This function has type ","position":{"start":{"line":67,"column":181,"offset":3736},"end":{"line":67,"column":301,"offset":3856}}},{"type":"html","value":"<code class=\"language-text\">(GraphQLError) => GraphQLError | null</code>","position":{"start":{"line":67,"column":301,"offset":3856},"end":{"line":67,"column":340,"offset":3895}}},{"type":"text","value":".","position":{"start":{"line":67,"column":340,"offset":3895},"end":{"line":67,"column":341,"offset":3896}}}],"position":{"start":{"line":67,"column":1,"offset":3556},"end":{"line":67,"column":341,"offset":3896}}},{"type":"html","value":"</td>\n</tr>","position":{"start":{"line":68,"column":1,"offset":3897},"end":{"line":69,"column":6,"offset":3908}}},{"type":"html","value":"</tbody>\n</table>","position":{"start":{"line":71,"column":1,"offset":3910},"end":{"line":72,"column":9,"offset":3927}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":73,"column":1,"offset":3928}}}}