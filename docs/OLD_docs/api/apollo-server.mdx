---
title: "API Reference: ApolloServer"
api_reference: true
---

This API reference documents the `ApolloServer` class.

There are [multiple implementations](../integrations/middleware/) of `ApolloServer` for different web frameworks with slightly different behavior.

## `constructor`

Returns an initialized `ApolloServer` instance.

Takes an `options` object as a parameter. Supported fields of this object are described below.

### Example

```js
const server = new ApolloServer({
	typeDefs,
	resolvers,
  csrfPrevention: true,  // highly recommended
  cache: 'bounded',
  plugins: [
    ApolloServerPluginLandingPageLocalDefault({ embed: true }),
  ],
});
```

### Options

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr>
<td colspan="2">

**Schema options**
</td>
</tr>
<tr class="required">
<td>

##### `typeDefs`

`DocumentNode` or `Array<DocumentNode>`
</td>
<td>

Document or documents that represent your server's GraphQL schema, generated by applying the `gql` tag to valid Schema Definition Language (SDL) strings.

**Required** unless you provide [`schema`](#schema).

For an example, see [Define your GraphQL schema](../getting-started/#step-3-define-your-graphql-schema).
</td>
</tr>


<tr class="required">
<td>

##### `resolvers`

`Object` or `Array`
</td>
<td>

A map of functions that populate data for individual schema fields. Can also be an array of multiple maps that are merged.

**Required** unless you provide [`schema`](#schema).

For details, see [Resolvers](../data/resolvers/).
</td>
</tr>


<tr>
<td>

##### `context`

`Object` or `Function`
</td>
<td>

An object (or a function that _creates_ an object) that's passed to every resolver that executes for a particular operation. This enables resolvers to share helpful context, such as a database connection.

[Certain fields](#middleware-specific-context-fields) are added to this object automatically, depending on which [Node.js middleware](../integrations/middleware/) your server uses.

For more details, see [The `context` argument](../data/resolvers/#the-context-argument).
</td>
</tr>


<tr>
<td>

##### `dataSources`

`Function`
</td>
<td>

A function that returns an object containing `DataSource` instances for use by your resolvers. The object is automatically added to each operation's [`context`](#context).

For more details, see [Adding data sources to Apollo Server](../data/data-sources/#adding-data-sources-to-apollo-server).
</td>
</tr>


<tr>
<td>

##### `introspection`

`Boolean`
</td>

<td>

If `true`, enables [schema introspection](https://graphql.org/learn/introspection/) by clients. This is required to use tools that figure out your server's schema from talking to it directly, like Apollo Sandbox and GraphQL Playground. (It's not needed for the non-Sandbox version of Apollo Studio Explorer, which uses the schema published in the Studio schema registry instead.)

The default value is `true`, **unless** the `NODE_ENV` environment variable is set to `production`.
</td>
</tr>


<tr>
<td>

##### `schema`

`Object`
</td>

<td>

An executable GraphQL schema. You usually don't need to provide this value, because Apollo Server generates it from [`typeDefs`](#typedefs) and [`resolvers`](#resolvers).

This field is most commonly used with [Apollo Federation](https://www.apollographql.com/docs/federation/implementing-services/#generating-a-federated-schema), which uses a special `buildFederatedSchema` function to generate its schema.
</td>
</tr>


<tr>
<td>

##### `persistedQueries`

`Object` or `false`
</td>

<td>

If you're using [automated persisted queries (APQ)](../performance/apq/), you can provide an object with `cache` and/or `ttl` fields to customize how Apollo Server stores the mapping between operation hashes and query strings, or provide `false` to disable APQ entirely.
</td>
</tr>


<tr>
<td>

##### `rootValue`

`Any` or `Function`
</td>
<td>

A value or function called with the parsed `Document`, creating the root value passed to the GraphQL executor.

Providing a function is useful if you want to use a different root value depending on the operation's details, such as whether it's a query or mutation.
</td>
</tr>


<tr>
<td>

##### `validationRules`

`Array<Function>`
</td>
<td>

An array containing custom functions to use as additional [validation rules](https://github.com/graphql/graphql-js/tree/master/src/validation/rules) when validating the schema.
</td>
</tr>


<tr>
<td>

##### `documentStore`

`KeyValueCache<DocumentNode>` or `null`
</td>
<td>

A key-value cache that Apollo Server uses to store previously encountered GraphQL operations (as `DocumentNode`s). It does _not_ store query _results_.

Whenever Apollo Server receives an incoming operation, it checks whether that exact operation is present in its `documentStore`. If it's present, Apollo Server can safely skip parsing and validating the operation, thereby improving performance.

The default `documentStore` is an [`InMemoryLRUCache`](https://github.com/apollographql/apollo-utils/blob/main/packages/keyValueCache/src/InMemoryLRUCache.ts) with an approximate size of 30MiB. This is usually sufficient unless the server processes a large number of unique operations. Provide this option if you want to change the cache size or store the cache information in an alternate location.

To use `InMemoryLRUCache` but change its size to an amount `approximateDocumentStoreMiB`:

<div style="max-width: 400px;">

```typescript
import { InMemoryLRUCache } from '@apollo/utils.keyvaluecache';
import type { DocumentNode } from 'graphql';
new ApolloServer({
  documentStore: new InMemoryLRUCache<DocumentNode>({
    maxSize: Math.pow(2, 20) * approximateDocumentStoreMiB,
    sizeCalculation: InMemoryLRUCache.sizeCalculation,
  }),
  // ...
})
```

</div>

Pass `null` to disable this cache entirely.

Available in Apollo Server v3.4.0 and later.
</td>
</tr>

<tr>
<td>

##### `cache`

`KeyValueCache | "bounded"`
</td>
<td>

A `KeyValueCache` which Apollo Server uses for several features, including APQs and full response caching. This cache is also available to Apollo Server's data sources and plugins.

By default, the cache that Apollo Server 3 uses is unbounded. We _strongly recommend_ that all users pass `cache: "bounded"` or configure their cache in a manner that isn't unbounded. This protects your server from attacks that exhaust available memory, causing a DOS.

The default bounded cache is an [`InMemoryLRUCache`](https://www.npmjs.com/package/@apollo/utils.keyvaluecache) with a default size of roughly 30MiB.

To learn more about configuring Apollo Server's cache, see [Configuring cache backends](../performance/cache-backends).

</td>
</tr>


<tr>
<td colspan="2">

**Networking options**
</td>
</tr>

<tr>
<td>

##### `csrfPrevention`

`Boolean` or `Object`
</td>
<td>

Passing `true` enables Apollo Server's [CSRF and XS-Search prevention](../security/cors#preventing-cross-site-request-forgery-csrf) features. This flag is **highly recommended** for all users and will be enabled by default in Apollo Server 4. Enabling this feature prevents certain `GET` requests from executing GraphQL operations. If your server has clients that send `GET` requests and those clients are _not_ one of Apollo Client Web, Apollo iOS, or Apollo Kotlin, you might need to modify the configuration of those clients before enabling this feature. For more details, see [the full CSRF prevention documentation](../security/cors#preventing-cross-site-request-forgery-csrf).
</td>
</tr>

<tr>
<td>

##### `formatError`

`Function`
</td>
<td>

Provide this function to transform the structure of error objects before they're sent to a client. The function takes a [`GraphQLError`](https://github.com/graphql/graphql-js/blob/main/src/error/GraphQLError.ts) object and should return a [`GraphQLFormattedError`](https://github.com/graphql/graphql-js/blob/main/src/error/GraphQLError.ts#L26) object.
</td>
</tr>

<tr>
<td>

##### `formatResponse`

`Function`
</td>
<td>

Provide this function to transform the structure of GraphQL response objects before they're sent to a client. The function takes a [`GraphQLResponse`](https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-types/src/index.ts#109-L114) object and a [`GraphQLRequestContext`](https://github.com/apollographql/apollo-server/blob/main/packages/apollo-server-types/src/index.ts#L127-L162) object, and it should return a `GraphQLResponse` object, or null to preserve the existing structure.
</td>
</tr>

<tr>
<td>

##### `apollo`

`Object`
</td>
<td>

An object containing configuration options for connecting Apollo Server to [Apollo Studio](https://www.apollographql.com/docs/studio/). Each field of this object can also be set with an environment variable, which is the recommended method of setting these parameters. All fields are optional. The fields are:

- `key`: The [graph API key](https://www.apollographql.com/docs/studio/api-keys/#graph-api-keys) that Apollo Server should use to authenticate with Apollo Studio. You can set this with the `APOLLO_KEY` environment variable.
- `graphRef`: A reference of your graph in Apollo's registry, such as `graph-id@my-variant` or just `graph-id`. You can set this with the `APOLLO_GRAPH_REF` environment variable.
- `graphId`: The ID of your graph in Apollo's registry. You can set this with the `APOLLO_GRAPH_ID` environment variable. You may not specify this if you specify the graph ref.
- `graphVariant`: The [variant](https://www.apollographql.com/docs/studio/schema/registry/#managing-environments-with-variants) of your graph to associate this server's schema and metrics with. You can set this with the `APOLLO_GRAPH_VARIANT` environment variable. The default value is `current`. You may not specify this if you specify the graph ref.

</td>
</tr>

<tr>
<td>

##### `allowBatchedHttpRequests`

`Boolean`
</td>
<td>

Controls whether to allow [Batching Queries](../requests/#batching) in a single HTTP Request. Defaults to `true`. If the GraphQL Server has this flag set to `false` and a request comes in formatted as an array rather than as a single request object, an error will be thrown.
</td>
</tr>


<tr>
<td colspan="2">

**Lifecycle options**
</td>
</tr>

<tr>
<td>

##### `plugins`

`Array`
</td>
<td>

An array of [plugins](../integrations/plugins) to install in your server instance. Each array element can be either a valid plugin object or a zero-argument function that _returns_ a valid plugin object.

In certain cases, Apollo Server installs some of its built-in plugins automatically (for example, when you provide an Apollo Studio API key with the `APOLLO_KEY` environment variable). For details, see the API references for these plugins: [usage reporting](./plugin/usage-reporting/), [schema reporting](./plugin/schema-reporting/), and [inline trace](./plugin/inline-trace/).

</td>
</tr>


<tr>
<td>

##### `stopOnTerminationSignals`

`Boolean`
</td>
<td>

By default (when running in Node when the `NODE_ENV` environment variable does not equal `test` and not using a [serverless-specific package](../integrations/middleware/#all-supported-packages)), whenever Apollo Server receives a `SIGINT` or `SIGTERM` signal, it calls `await this.stop()` on itself. (While this call to `this.stop()` is running, it ignores all `SIGINT` and `SIGTERM` signals.) It then sends that same signal to itself to continue process shutdown.

Set this option to `false` to disable this default behavior, or to `true` to enable the behavior even when `NODE_ENV` _does_ equal `test`.

The signal handler is installed after [`start()`](#start) returns successfully.

You can also manually call `stop()` in other contexts. Note that `stop()` is asynchronous, so it isn't useful in a `process.on('exit')` handler.

</td>
</tr>


<tr>
<td colspan="2">

**Debugging options**
</td>
</tr>

<tr>
<td>

##### `debug`

`Boolean`
</td>

<td>

If `true`, stack traces are included in GraphQL responses when errors occur, and some extra information is logged via the `logger` at the `debug` level.

Defaults to `true` unless the `NODE_ENV` environment variable is `production` or `test`.
</td>
</tr>


<tr>
<td>

##### `logger`

[`Logger`](https://www.npmjs.com/package/@apollo/utils.logger)
</td>
<td>

An object to use for logging in place of `console`. If provided, this object must implement all methods of [the `Logger` interface](https://www.npmjs.com/package/@apollo/utils.logger).

If you provide this value, Apollo Server automatically logs all messages of _all_ severity levels (`debug` through `error`), regardless of whether the `debug` option is set to `true`. It is the responsibility of the logger to determine how to handle logged messages of each level.

This logger is automatically added to the `GraphQLRequestContext` object that's passed to all Apollo Server [plugin functions](../integrations/plugins/).
</td>
</tr>


<tr>
<td>

##### `mocks`

`Boolean` or `Object`
</td>
<td>

If `true`, enables [default mock resolvers](../testing/mocking/#using-default-mocks) for schema fields. If an object, enables [_custom_ mock resolvers](../testing/mocking/#customizing-mocks) based on the object's fields.
</td>
</tr>


<tr>
<td>

##### `mockEntireSchema`

`Boolean`
</td>
<td>

If `true` and `mocks` is also specified, mock resolvers are enabled even for fields that you've defined a resolver for.

The default value is `true`. Set this to `false` to use mocked resolvers only for fields that you _haven't_ defined a resolver for.
</td>
</tr>

<tr>
<td>

##### `nodeEnv`

`string`
</td>
<td>

If this is set to any string value, use that value instead of the environment variable `NODE_ENV` for the features whose defaults depend on `NODE_ENV` (like the [`debug`](#introspection) and [`introspection`](#introspection) options). Note that passing the empty string here is equivalent to running with the `NODE_ENV` environment variable unset. This is primarily meant for testing the effects of the `NODE_ENV` environment variable.
</td>
</tr>

</tbody>
</table>

### `apollo-server`-specific options

**These options are only part of the batteries-included `apollo-server` package.**  They do not exist in framework integrations.

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>

<tr>
<td>

##### `healthCheckPath`

`string` or `null`
</td>
<td>

Disable [HTTP-level health checks](../monitoring/health-checks/#http-level-health-checks) by passing `null`, or change the path on which it is served from the default of `/.well-known/apollo/server-health`.

</td>
</tr>

<tr>
<td>

##### `onHealthCheck`

`Function`
</td>
<td>

A custom function to execute when Apollo Server receives a request at the [HTTP-level health check](../monitoring/health-checks/#http-level-health-checks) endpoint.

</td>
</tr>


<tr>
<td>

##### `cors`

`Object` or `Boolean`
</td>
<td>

An `Object` containing [configuration options](https://github.com/expressjs/cors#configuration-options) for the server's CORS behavior. Provide `false` to remove CORS middleware entirely.

</td>
</tr>

<tr>
<td>

##### `stopGracePeriodMillis`

`number`
</td>
<td>

The amount of time to wait after [`ApolloServer.stop()`](#stop) is called (including via a [termination signal](#stoponterminationsignals)) before forcefully closing all active connections. If you pass `Infinity`, Apollo Server waits indefinitely for all active connections to go idle.

The default value is `10_000` (10 seconds).

</td>
</tr>


</tbody>
</table>

### Middleware-specific `context` fields

The `context` object passed between Apollo Server resolvers automatically includes certain fields, depending on which [Node.js middleware](../integrations/middleware/) you're using:

| Middleware | Context fields |
|---|---|
| AWS Lambda | <code>{<br/>&nbsp;&nbsp;event: [`APIGatewayProxyEvent`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/aws-lambda/index.d.ts#L78-L92),<br/>&nbsp;&nbsp;context: [`LambdaContext`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/aws-lambda/index.d.ts#L510-L534),<br/>&nbsp;&nbsp;express: {<br/>&nbsp;&nbsp;&nbsp;&nbsp;req: [`express.Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts),<br/>&nbsp;&nbsp;&nbsp;&nbsp;res: [`express.Response`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts#L490-L861)<br/>&nbsp;&nbsp;}<br/>}</code> |
| Azure Functions  | <code>{<br/>&nbsp;&nbsp;request: [`HttpRequest`](https://github.com/Azure/azure-functions-nodejs-worker/blob/ba8402bd3e86344e68cb06f65f9740b5d05a9700/types/public/Interfaces.d.ts#L73-L108),<br/>&nbsp;&nbsp;context: [`Context`](https://github.com/Azure/azure-functions-nodejs-worker/blob/ba8402bd3e86344e68cb06f65f9740b5d05a9700/types/public/Interfaces.d.ts#L18-L69)<br/>}</code> |
| Cloudflare  | <code>{ req: [`Request`](https://github.com/apollographql/apollo-server/blob/04fe6aa1314ca84de26b4dc26e9b29dda16b81bc/packages/apollo-server-env/src/fetch.d.ts#L37-L45) }</code> |
| Express (including `apollo-server`) | <code>{<br/>&nbsp;&nbsp;req: [`express.Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts),<br/>&nbsp;&nbsp;res: [`express.Response`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts#L490-L861)<br/>}</code> |
| Fastify  | <code>{<br/>&nbsp;&nbsp;request: [`FastifyRequest`](https://github.com/fastify/fastify/blob/1d4dcf2bcde46256c72e96c2cafc843a461c721e/types/request.d.ts#L15),<br/>&nbsp;&nbsp;reply: [`FastifyReply`](https://github.com/fastify/fastify/blob/1d4dcf2bcde46256c72e96c2cafc843a461c721e/types/reply.d.ts#L10)<br/>}</code> |
| Google Cloud Functions  | <code>{ req: [`Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts), res: [`Response`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/express-serve-static-core/index.d.ts#L490-L861) }</code> |
| hapi  | <code>{<br/>&nbsp;&nbsp;request: [`hapi.Request`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/05cbc5521f895344fb7dbf5c51902b6ff235aa69/types/hapi__hapi/index.d.ts#L406-L615),<br/>&nbsp;&nbsp;h: [`hapi.ResponseToolkit`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/05cbc5521f895344fb7dbf5c51902b6ff235aa69/types/hapi__hapi/index.d.ts#L999-L1113)<br/>}</code> |
| Koa | <code>{ ctx: [`Koa.Context`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/koa/index.d.ts#L724-L731) }</code> |
| Micro | <code>{ req: [`MicroRequest`](https://github.com/apollographql/apollo-server/blob/c356bcf3f2864b8d2fcca0add455071e0606ef46/packages/apollo-server-micro/src/types.ts#L3-L5), res: [`ServerResponse`](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/50adc95acf873e714256074311353232fcc1b5ed/types/node/v10/http.d.ts#L145-L158) }</code> |

## `listen`

> This method is provided only by the `apollo-server` package. If you're integrating with Node.js middleware via a different package (such as `apollo-server-express`), instead see both [`start`](#start) and the [framework-specific middleware function](#framework-specific-middleware-function).

Instructs Apollo Server to begin listening for incoming requests:

```js
await server.listen({
  port: 4001,
});
```

Takes an `options` object as a parameter, which is passed to the `listen` method of `http.Server`. Supported options are listed in the [documentation for `net.Server.listen`](https://nodejs.org/api/net.html#net_server_listen_options_callback).

Returns a `Promise` that resolves to an object containing the following properties:

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr>
<td>

##### `url`

`string`
</td>
<td>

The URL that the server is listening on.
</td>
</tr>


<tr>
<td>

##### `server`

[`http.Server`](https://nodejs.org/api/http.html#http_class_http_server)
</td>
<td>

The server instance that's listening at `url`.
</td>
</tr>

</tbody>
</table>

## `start`

The async `start` method instructs Apollo Server to prepare to handle incoming operations.

> Call `start` **only** if you are using a [middleware integration](../integrations/middleware/) for a non-"serverless" environment (e.g., `apollo-server-express`).
>
> * If you're using the core `apollo-server` library, call [`listen`](#listen) instead.
> * If you're using a "serverless" middleware integration (such as `apollo-server-lambda`), this method isn't necessary because the integration doesn't distinguish between starting the server and serving a request.

Always call `await server.start()` *before* calling `server.applyMiddleware` and starting your HTTP server. This allows you to react to Apollo Server startup failures by crashing your process instead of starting to serve traffic.

If the only thing you are doing with your server is calling [`executeOperation`](../testing/testing/) on it (ie, you're not actually starting an HTTP server), you don't have to call `start()`; `executeOperation` will do that for you.

This method was optional in Apollo Server 2 but is required in Apollo Server 3.

### Triggered actions

The `start` method triggers the following actions:

1. If your server is a [federated gateway](https://www.apollographql.com/docs/federation/managed-federation/overview/), it attempts to fetch its schema. If the fetch fails, `start` throws an error.
2. Your server calls all of the [`serverWillStart` handlers](../integrations/plugins-event-reference/#serverwillstart) of your installed plugins. If any of these handlers throw an error, `start` throws an error.


## `stop`

`ApolloServer.stop()` is an async method that tells all of Apollo Server's background tasks to complete. Specifically, it:

- Calls and awaits all [`drainServer` plugin handlers](../integrations/plugins-event-reference/#drainserver). These should generally:
  * Stop listening for new connections
  * Closes idle connections (i.e., connections with no current HTTP request)
  * Closes active connections whenever they become idle
  * Waits for all connections to be closed
  * After a grace period, if any connections remain active, forcefully close them.
  If you're using the batteries-included `apollo-server` package, it does this by default. (You can configure the grace period with the [`stopGracePeriodMillis` constructor option](#stopgraceperiodmillis).) Otherwise, you can use the [drain HTTP server plugin](./plugin/drain-http-server/) to drain your HTTP server.
- Transitions the server to a state where it will not start executing more GraphQL operations.
- Calls and awaits all [`serverWillStop` plugin handlers](../integrations/plugins-event-reference/#serverwillstop) (including the [usage reporting plugin](./plugin/usage-reporting/)'s handler, which sends a final usage report to Apollo Studio).
- If your server is a [federated gateway](https://www.apollographql.com/docs/federation/gateway/), `stop` also stops gateway-specific background activities, such as polling for updated service configuration.

This method takes no arguments. You should only call it after [`start()`](#start) returns successfully (or [`listen()`](#listen) if you're using the batteries-included `apollo-server` package).

In some circumstances, Apollo Server calls `stop` automatically when the process receives a `SIGINT` or `SIGTERM` signal. See the [`stopOnTerminationSignals` constructor option](#stoponterminationsignals) for details.


## `executeOperation`

The async `executeOperation` method is used primarily for [testing GraphQL operations](../testing/testing/#testing-using-executeoperation) through Apollo Server's request pipeline _without_ sending an HTTP request.

```js
const result = await server.executeOperation({
  query: 'query SayHelloWorld($name: String) { hello(name: $name) }',
  variables: { name: 'world' },
});
```

The `executeOperation` method takes two arguments:
* The first argument is an object describing the GraphQL operation to be executed.
  * Supported fields are listed in the table below.
* The second optional argument is passed to `ApolloServer`'s `context` function.
  * This is helpful when [testing](../testing/testing/) that your server's `context` is correctly gathering the values needed from a request.

Below are the available fields for the first argument of `executeOperation`:

### Fields
<table class="field-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr class="required">
<td>

##### `query`

`string` or `DocumentNode`
</td>

<td>

**Required**. The GraphQL operation to run. Note that you must use the `query` field even if the operation is a mutation.
</td>
</tr>

<tr>
<td>

##### `variables`

`object`
</td>
<td>
An object containing any GraphQL variables to use as argument values for the executed operation.
</td>
</tr>

<tr>
<td>

##### `operationName`

`string`
</td>
<td>

If `query` contains more than one operation definition, you must provide this option to indicate which operation to execute.
</td>
</tr>

</tbody>
</table>

## Framework-specific middleware function

[Framework-specific Apollo Server packages](../integrations/middleware/) (such as `apollo-server-express`) each define a method that you use to connect Apollo Server to your web framework. Depending on the package, this function is `applyMiddleware`, `getMiddleware`, or `createHandler`.

You call this method instead of [`listen`](#listen) if you're using a framework-specific package. For non-serverless frameworks (Express, Fastify, Hapi, Koa, and Micro), you _must_ call [`await server.start()`](#start) _before_ calling this method.

These functions take an `options` object as a parameter. Some supported fields of this object are described below. **Not all packages support all options.** See [your package's description](../integrations/middleware/#basic-usage) to see what the name of the function is and which options are supported.

Here's an example of using `applyMiddleware` with `apollo-server-express`.

<MultiCodeBlock>

```ts title="index.ts"
const express = require('express');
const { ApolloServer } = require('apollo-server-express');
const {
  ApolloServerPluginDrainHttpServer,
  ApolloServerPluginLandingPageLocalDefault
} = require('apollo-server-core');
const { typeDefs, resolvers } = require('./schema');

async function startApolloServer() {
  const app = express();
  const httpServer = http.createServer(app);
  const server = new ApolloServer({
    typeDefs,
    resolvers,
    csrfPrevention: true,
    cache: 'bounded',
    plugins: [
      ApolloServerPluginDrainHttpServer({ httpServer }),
      ApolloServerPluginLandingPageLocalDefault({ embed: true }),
    ],
  });

  await server.start();

  // Additional middleware can be mounted at this point to run before Apollo.
  app.use('*', jwtCheck, requireAuth, checkScope);

  // Mount Apollo middleware here.
  server.applyMiddleware({ app, path: '/specialUrl' });
  await new Promise<void>(resolve => httpServer.listen({ port: 4000 }, resolve));
  console.log(`🚀 Server ready at http://localhost:4000${server.graphqlPath}`);
  return { server, app };
}
```

</MultiCodeBlock>

### Options

<table class="field-table">
  <thead>
    <tr>
      <th>Name /<br/>Type</th>
      <th>Description</th>
    </tr>
  </thead>

<tbody>
<tr class="required">
<td>

##### `app`

`HttpServer`
</td>
<td>

**Required** for `applyMiddleware` (not supported for `getMiddleware`/`getHandler`). The server middleware instance to integrate with Apollo Server.
</td>
</tr>


<tr>
<td>

##### `path`

`string`
</td>
<td>

The path for Apollo Server to listen on.

The default value for framework-specific packages (`apollo-server-express`, `apollo-server-fastify`, etc) is `/graphql`.

The default value for `apollo-server` and serverless-specific packages (`apollo-server-lambda`, etc) is `/`.
</td>
</tr>


<tr>
<td>

##### `cors`

`Object` or `Boolean`
</td>
<td>

Middleware-specific configuration options for CORS. See available options for your middleware: [express](https://github.com/expressjs/cors#cors) | [hapi](https://hapi.dev/api/?v=20.1.2#-routeoptionscors) | [koa](https://github.com/koajs/cors/)

Provide `false` to remove CORS middleware entirely, or `true` to use your middleware's default configuration.

The default value is `true`.
</td>
</tr>


<tr>
<td>

##### `bodyParserConfig`

`Object` or `Boolean`
</td>
<td>

Middleware-specific configuration options for body parsing. See available options for your middleware: [express](https://github.com/expressjs/body-parser#body-parser) | [koa](https://github.com/koajs/bodyparser)

Provide `false` to remove body parsing middleware entirely, or `true` to use your middleware's default configuration.

The default value is `true`.
</td>
</tr>


<tr>
<td>

##### `onHealthCheck`

`Function`
</td>
<td>

A custom function to execute when Apollo Server receives a request at its health checks endpoint.

For details, see [Health checks](../monitoring/health-checks/).

</td>
</tr>


<tr>
<td>

##### `disableHealthCheck`

`Boolean`
</td>
<td>

If `true`, Apollo Server disables its [health checks endpoint](../monitoring/health-checks/).

The default value is `false`.
</td>
</tr>

</tbody>
</table>
